import{s as w}from"./dialog.esm-VmiGjN6p.js";import{b as $,c as D,s as C,a as M}from"./column.esm-B0kMEs2H.js";import{s as N}from"./toolbar.esm-mLzmTsQ_.js";import{o as n,c as h,w as a,a as s,t as d,b as i,e as c,m as b,k as f,v as y,g as R,f as S}from"./app-CEnNdpTV.js";import{_ as G}from"./AppLayout-ClivM-_U.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const V={class:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight"},U={class:"card"},P={class:"flex items-center min-w-[150px] max-w-full overflow-hidden text-ellipsis whitespace-nowrap"},B={key:0,class:"truncate"},T={key:1},j={class:"flex items-center"},E={class:"flex justify-between"},q={class:"align-middle ml-2 font-bold leading-normal"},F={class:"grid gap-3 mb-6 md:grid-cols-1"},O=["placeholder"],z={class:"grid gap-3 md:grid-cols-1 justify-items-end"},A={type:"submit",class:"text-white bg-blue-600 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"},L={class:"grid gap-3 mb-6 md:grid-cols-1"},Y=["placeholder"],H={class:"grid gap-3 md:grid-cols-1 justify-items-end"},I={type:"submit",class:"text-white bg-blue-600 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"},J={class:"confirmation-content"},K=s("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),Q={key:0},W={data(){return{createRoleDialog:!1,updateRoleDialog:!1,deleteRoleDialog:!1,submitted:!1,group_names:[],selectedPermissions:[],myRol:{},editedRoleName:"",roles:[],selectedRole:[],expandedRowGroups:[]}},async mounted(){this.group_names=await this.$page.props.result.permission_group_names,this.roles=await this.$page.props.result.roles},methods:{async onRoleChange(o){const e=await axios.get("/roles/"+o.value.id+"/");e&&(this.selectedPermissions=e.data.permissions)},async changePermissionState(o){console.log(this.selectedRole),console.log(o.id);const e=await axios.put("/add-permission/"+this.selectedRole.id+"/"+o.id);if(e){let l=this.selectedPermissions.find(u=>u.id===o.id);l?this.selectedPermissions=this.selectedPermissions.filter(u=>u!==l):this.selectedPermissions.push(o),this.$toast(this.$t(e.data.message),e.data.type)}else this.$toast(this.$t("Error connecting to the server"),"error")},getSeverity(o){return o?"success":"danger"},openNew(){this.submitted=!1,this.createRoleDialog=!0},hideDialog(){this.updateRoleDialog=!1,this.createRoleDialog=!1,this.submitted=!1},async saveMyRol(){try{const o=await axios.post("/roles",this.myRol);if(o){let e=o.data.role;this.roles.push(e),this.selectedRole=o.data.role}this.$toast(this.$t(o.data.message),o.data.type),this.createRoleDialog=!1}catch{this.$toast(this.$t("Error connecting to the server"),"error")}},editMyRol(){this.myRol=this.selectedRole,this.editedRoleName=this.selectedRole.name,this.updateRoleDialog=!0},updateMyRol(){if(this.selectedRole.name!==this.editedRoleName)this.selectedRole.name=this.editedRoleName;else{this.$toast(this.$t("Successfully updated."),"success"),this.updateRoleDialog=!1;return}axios.put("/roles/"+this.myRol.id,this.myRol).then(async o=>{this.$toast(this.$t(o.data.message),o.data.type),this.updateRoleDialog=!1}).catch(o=>{this.$toast(this.$t("Error connecting to the server"),"error")})},confirmDeleteRol(){this.deleteRoleDialog=!0},deleteMyRol(){this.myRol=this.selectedRole,axios.delete("/roles/"+this.myRol.id).then(o=>{o.data.type==="success"&&(this.roles=this.roles.filter(e=>e.id!==this.myRol.id),this.selectedRole=[],this.selectedPermissions=[]),this.$toast(this.$t(o.data.message),o.data.type)}).catch(o=>{this.$toast(this.$t(o.response.message),o.response.type)}),this.deleteRoleDialog=!1}}},se=Object.assign(W,{__name:"TableRole",setup(o){return(e,l)=>{const u=$,r=D,v=N,p=C,k=M,m=w;return n(),h(G,{title:"Profile"},{header:a(()=>[s("h2",V,d(e.$t("Manage roles")),1)]),default:a(()=>[s("div",U,[i(v,{class:"mb-4 border flex justify-start border-slate-200 ..."},{start:a(()=>[i(u,{modelValue:e.selectedRole,"onUpdate:modelValue":l[0]||(l[0]=t=>e.selectedRole=t),options:e.roles,filter:"",optionLabel:"name",onChange:e.onRoleChange,placeholder:e.$t("Select a role"),class:"mr-2 w-full md:w-64 bg-gray-50 border border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500"},{value:a(t=>[s("div",P,[t.value&&t.value.name?(n(),c("div",B,d(t.value.name),1)):(n(),c("span",T,d(t.placeholder),1))])]),option:a(t=>[s("div",j,[s("div",null,d(t.option.name),1)])]),_:1},8,["modelValue","options","onChange","placeholder"]),s("div",E,[i(r,{label:e.$t("New"),icon:"pi pi-plus",severity:"success",class:"mr-2 success-button",onClick:e.openNew},null,8,["label","onClick"]),i(r,{label:e.$t("Edit"),icon:"pi pi-pencil",severity:"success",class:"mr-2 success-button",onClick:e.editMyRol,disabled:e.selectedRole.length===0},null,8,["label","onClick","disabled"]),i(r,{label:e.$t("Delete"),icon:"pi pi-trash",severity:"danger",class:"danger-button",onClick:e.confirmDeleteRol,disabled:e.selectedRole.length===0},null,8,["label","onClick","disabled"])])]),_:1}),i(k,{expandedRowGroups:e.expandedRowGroups,"onUpdate:expandedRowGroups":l[1]||(l[1]=t=>e.expandedRowGroups=t),value:e.group_names,tableStyle:"min-width: 50rem",expandableRowGroups:"",rowGroupMode:"subheader",groupRowsBy:"group_name",sortMode:"single",sortField:"group_name",sortOrder:1},{groupheader:a(t=>[s("span",q,d(e.$t(t.data.group_name)),1)]),default:a(()=>[i(p,{field:"group_name",header:"Role Type"}),i(p,{field:"name",header:e.$t("Group"),style:{width:"20%"},class:"pl-24"},{body:a(t=>[s("span",null,d(e.$t(t.data.name)),1)]),_:1},8,["header"]),i(p,{field:"description",header:e.$t("Description"),style:{width:"50%"},class:"pl-24"},{body:a(t=>[s("span",null,d(e.$t(t.data.description)),1)]),_:1},8,["header"]),i(p,{field:"id",header:e.$t("Status"),style:{width:"10%"}},{body:a(t=>[e.selectedPermissions.some(g=>g.id===t.data.id)?(n(),h(r,{key:0,icon:"pi pi-check",outlined:"",rounded:"",class:"mr-2 info-active",severity:"danger",onClick:g=>e.changePermissionState(t.data)},null,8,["onClick"])):(n(),h(r,{key:1,disabled:e.selectedRole.length===0,icon:"pi pi-times",outlined:"",rounded:"",class:"mr-2 info-disable",severity:"danger",onClick:g=>e.changePermissionState(t.data)},null,8,["disabled","onClick"]))]),_:1},8,["header"])]),_:1},8,["expandedRowGroups","value"])]),s("template",null,[i(m,{visible:e.createRoleDialog,"onUpdate:visible":l[5]||(l[5]=t=>e.createRoleDialog=t),header:e.$t("Create role"),id:"titleRol",modal:!0,class:"p-fluid"},{default:a(()=>[s("form",{style:{width:"600px"},onSubmit:l[4]||(l[4]=b((...t)=>e.saveMyRol&&e.saveMyRol(...t),["prevent"]))},[s("div",F,[s("div",null,[f(s("input",{type:"text",id:"name","onUpdate:modelValue":l[2]||(l[2]=t=>e.myRol.name=t),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("Rol name"),required:""},null,8,O),[[y,e.myRol.name]])])]),s("div",z,[s("div",null,[s("button",{type:"button",class:"mr-3 text-white bg-red-600 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800",onClick:l[3]||(l[3]=(...t)=>e.hideDialog&&e.hideDialog(...t))},d(e.$t("Close")),1),s("button",A,d(e.$t("Save")),1)])])],32)]),_:1},8,["visible","header"])]),s("template",null,[i(m,{visible:e.updateRoleDialog,"onUpdate:visible":l[9]||(l[9]=t=>e.updateRoleDialog=t),header:e.$t("Update role"),id:"titleRol",modal:!0,class:"p-fluid"},{default:a(()=>[s("form",{style:{width:"600px"},onSubmit:l[8]||(l[8]=b((...t)=>e.updateMyRol&&e.updateMyRol(...t),["prevent"]))},[s("div",L,[s("div",null,[f(s("input",{type:"text",id:"name","onUpdate:modelValue":l[6]||(l[6]=t=>e.editedRoleName=t),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("Rol name"),required:""},null,8,Y),[[y,e.editedRoleName]])])]),s("div",H,[s("div",null,[s("button",{type:"button",class:"mr-3 text-white bg-red-600 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800",onClick:l[7]||(l[7]=(...t)=>e.hideDialog&&e.hideDialog(...t))},d(e.$t("Close")),1),s("button",I,d(e.$t("Save")),1)])])],32)]),_:1},8,["visible","header"])]),i(m,{visible:e.deleteRoleDialog,"onUpdate:visible":l[11]||(l[11]=t=>e.deleteRoleDialog=t),style:{width:"450px"},header:e.$t("Confirm"),modal:!0},{footer:a(()=>[i(r,{label:e.$t("No"),icon:"pi pi-times",text:"",onClick:l[10]||(l[10]=t=>e.deleteRoleDialog=!1)},null,8,["label"]),i(r,{label:e.$t("Yes"),icon:"pi pi-check",text:"",onClick:e.deleteMyRol},null,8,["label","onClick"])]),default:a(()=>[s("div",J,[K,e.myRol?(n(),c("span",Q,[R(d(e.$t("Are you sure you want to delete")),1),s("b",null,d(e.myRol.name),1),R("?")])):S("",!0)])]),_:1},8,["visible","header"])]),_:1})}}});export{se as default};
