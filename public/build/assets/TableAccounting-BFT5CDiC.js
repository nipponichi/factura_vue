import{s as y}from"./dialog.esm-QlC0ueHt.js";import{s as v,a as w,b as _}from"./column.esm-DkbfGITB.js";import{o as u,c as x,w as d,i as p,j as D,a as t,t as o,e as g,g as $,f,b as r,k as m,v as h}from"./app-B8b0aqRm.js";import{_ as C}from"./AppLayout-9ILkxSd3.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const F={class:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight"},k={class:"py-12"},T={class:"max-w-9xl mx-auto sm:px-6 lg:px-8"},S={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg"},R={class:"card"},N={class:"relative inline-block flex mb-5"},V={class:"font-bold text-lg"},j=t("i",{class:"pi pi-plus mr-2"},null,-1),M={class:"flex flex-col sm:flex-row justify-between items-center mt-2 space-y-2 sm:space-y-0"},B={class:"flex items-center space-x-2 sm:space-x-0"},L={class:"font-semibold mr-3"},A={class:"flex items-center space-x-2 sm:space-x-0"},U={class:"font-semibold ml-3"},I={class:"relative rounded-md shadow-sm ml-auto"},O=["placeholder"],E=t("div",{class:"absolute inset-y-0 left-0 flex items-center pl-3"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"})])],-1),z={class:"text-center"},P={class:"flex gap-2 justify-center text-sm text-gray-500"},Y={class:"w-1/3 text-center px-3"},H={class:"w-1/3 text-center px-12"},K={class:"w-1/3 text-center pl-16"},q={class:"flex gap-2 justify-center"},G={class:"w-1/3 border-r border-gray-400 px-2 text-center"},J={class:"w-1/3 border-r border-gray-400 px-2 text-center"},Q={class:"w-1/3 px-2 text-center"},W={class:"text-center"},X={class:"flex gap-2 justify-center text-sm text-gray-500"},Z={class:"w-1/3 text-center px-3"},ee={class:"w-1/3 text-center px-12"},te={class:"w-1/3 text-center pl-16"},se={class:"flex gap-2 justify-center"},ae={class:"w-1/3 border-r border-gray-400 px-2 text-center"},oe={class:"w-1/3 border-r border-gray-400 px-2 text-center"},le={class:"w-1/3 px-2 text-center"},ne={class:"flex flex-col items-center justify-center sm:flex-row sm:justify-end"},ie={class:"totals-container w-full sm:w-1/3 mb-4 sm:mb-0 sm:ml-4"},de={class:"totals p-4 rounded-md"},re={class:"w-full"},ce={class:"text-gray-600 pr-4"},ue={class:"pl-4"},me=t("hr",{class:"my-2 border-gray-300"},null,-1),he={class:"text-gray-600 pr-4"},pe={class:"pl-4"},ge=t("hr",{class:"my-2 border-gray-300"},null,-1),fe={class:"text-gray-600 pr-4"},be={class:"pl-4"},ye={for:"name",class:"block text-sm font-medium text-gray-900 dark:text-white"},ve={key:0,class:"flex align-items-center"},we={class:"flex align-items-center"},_e={data(){return{documents:[],companies:[],totalDocuments:[],balance:{subtotal:0,amount:0,tax:0},initialDate:"",endDate:"",startDate:"",selectedCompany:"",accountingDialog:!1,selectedDocuments:[],filters:{global:{value:null,matchMode:p.CONTAINS}}}},created(){this.filters={global:{value:null,matchMode:p.CONTAINS}};const i=new Date,e=i.getFullYear(),a=(i.getMonth()+1).toString().padStart(2,"0"),n=i.getDate().toString().padStart(2,"0");this.initialDate=`${e}-01-01`,this.endDate=`${e}-${a}-${n}`},async mounted(){this.companies=this.$page.props.companies,this.selectedCompany=this.companies[0],await this.fetchDocuments(),await this.calculateBalance(this.documents),await this.itemsFiltrados()},watch:{async selectedCompany(i,e){i!==e&&(await this.fetchDocuments(),await this.calculateBalance(this.documents),await this.itemsFiltrados())}},methods:{async fetchDocuments(){await D.get(`/accountings/${this.selectedCompany.id}`).then(i=>{this.totalDocuments=i.data.documents}).catch(i=>{console.error("Error fetching documents data:",i)})},async itemsFiltrados(){if(this.documents=[],console.log("itemsFiltrados"),console.log(this.documents),!this.initialDate||!this.endDate)return this.totalDocuments;const i=new Date(this.initialDate),e=new Date(this.endDate);console.log(i),console.log(e),this.documents=this.totalDocuments.filter(l=>{const c=new Date(l.date);return c>=i&&c<=e});let a,n;for(let l=0;l<this.documents.length;l++)a=this.documents[l].date,n=this.dateFormat(a),this.documents[l].date=n},async calculateBalance(i){let e=0,a=0,n=0;for(let l=0;l<this.documents.length;l++)this.documents[l].isReceived?(e-=parseFloat(this.documents[l].amount),a-=parseFloat(this.documents[l].subtotal),n-=parseFloat(this.documents[l].tax)):(e+=parseFloat(this.documents[l].amount),a+=parseFloat(this.documents[l].subtotal),n+=parseFloat(this.documents[l].tax));this.balance={subtotal:a.toFixed(2),amount:e.toFixed(2),tax:n.toFixed(2)}},dateFormat(i){let e=new Date(i),a=e.getDate(),n=e.getMonth()+1,l=e.getFullYear();return a<10&&(a="0"+a),n<10&&(n="0"+n),`${a}/${n}/${l}`},hideDialog(){this.accountingDialog=!1},openNew(){this.accountingDialog=!0}}},ke=Object.assign(_e,{__name:"TableAccounting",setup(i){return(e,a)=>{const n=v,l=w,c=_,b=y;return u(),x(C,{title:"Company"},{header:d(()=>[t("h2",F,o(e.$t("Accounting")),1)]),default:d(()=>[t("div",k,[t("div",T,[t("div",S,[t("div",null,[t("div",R,[t("div",N,[!e.loading&&e.companies.length>0?(u(),g("button",{key:0,type:"button",class:"px-4 py-2 bg-black text-white border border-gray-200 rounded-md flex items-center justify-between",onClick:a[0]||(a[0]=(...s)=>e.openNew&&e.openNew(...s))},[t("span",V,[j,$(" "+o(e.selectedCompany.name),1)])])):f("",!0)]),r(l,{ref:"dt",value:e.documents,selection:e.selectedDocuments,"onUpdate:selection":a[6]||(a[6]=s=>e.selectedDocuments=s),dataKey:"id",paginator:!0,rows:10,filters:e.filters,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:`${e.$t("Showing")} {first} ${e.$t("of")} {last} ${e.$t("of")} {totalRecords} ${e.$t("documents")}`,selectionMode:"single",onRowClick:e.handleRowClick},{header:d(()=>[t("div",M,[t("div",B,[t("div",L,o(e.$t("Initial date"))+": ",1),m(t("input",{type:"date","onUpdate:modelValue":a[1]||(a[1]=s=>e.initialDate=s),onChange:a[2]||(a[2]=(...s)=>e.itemsFiltrados&&e.itemsFiltrados(...s)),class:"border border-gray-300 rounded-md w-48 px-3 py-2 focus:outline-none focus:border-blue-400"},null,544),[[h,e.initialDate]])]),t("div",A,[t("div",U,o(e.$t("End date"))+": ",1),m(t("input",{type:"date","onUpdate:modelValue":a[3]||(a[3]=s=>e.endDate=s),onChange:a[4]||(a[4]=(...s)=>e.itemsFiltrados&&e.itemsFiltrados(...s)),class:"border border-gray-300 rounded-md w-48 px-3 py-2 focus:outline-none focus:border-blue-400"},null,544),[[h,e.endDate]])]),t("div",I,[m(t("input",{type:"search",class:"block w-full h-11 rounded-md border-0 py-1.5 pl-10 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm","onUpdate:modelValue":a[5]||(a[5]=s=>e.filters.global.value=s),placeholder:e.$t("Search...")},null,8,O),[[h,e.filters.global.value]]),E])])]),default:d(()=>[r(n,{field:"date",header:e.$t("Date"),sortable:"",class:"dateTable"},null,8,["header"]),r(n,{field:"number",header:e.$t("Concept"),sortable:"",class:"dateTable"},null,8,["header"]),r(n,{class:"dateTable"},{header:d(()=>[t("div",z,[t("div",null,o(e.$t("Duty")),1),t("div",P,[t("div",Y,o(e.$t("Subtotal")),1),t("div",H,o(e.$t("Tax")),1),t("div",K,o(e.$t("Total")),1)])])]),body:d(s=>[t("div",q,[t("div",G,o(s.data.isReceived?"-":s.data.subtotal),1),t("div",J,o(s.data.isReceived?"-":s.data.tax),1),t("div",Q,o(s.data.isReceived?"-":s.data.amount),1)])]),_:1}),r(n,{class:"dateTable"},{header:d(()=>[t("div",W,[t("div",null,o(e.$t("Have")),1),t("div",X,[t("div",Z,o(e.$t("Subtotal")),1),t("div",ee,o(e.$t("Tax")),1),t("div",te,o(e.$t("Total")),1)])])]),body:d(s=>[t("div",se,[t("div",ae,o(s.data.isReceived?s.data.subtotal:"-"),1),t("div",oe,o(s.data.isReceived?s.data.tax:"-"),1),t("div",le,o(s.data.isReceived?s.data.amount:"-"),1)])]),_:1})]),_:1},8,["value","selection","filters","currentPageReportTemplate","onRowClick"]),t("div",ne,[t("div",ie,[t("div",de,[t("table",re,[t("tbody",null,[t("tr",null,[t("td",ce,o(e.$t("Subtotal (excluding Tax)"))+":",1),t("td",ue,o(e.balance.subtotal)+"€",1)]),me,t("tr",null,[t("td",he,o(e.$t("Total Tax"))+":",1),t("td",pe,o(e.balance.tax)+"€",1)]),ge,t("tr",null,[t("td",fe,o(e.$t("Total (with IVA)"))+":",1),t("td",be,o(e.balance.amount)+"€",1)])])])])])])])])])])]),r(b,{visible:e.accountingDialog,"onUpdate:visible":a[8]||(a[8]=s=>e.accountingDialog=s),header:e.$t("Select companies"),modal:!0,onChange:e.handleCompanySelection,class:"p-fluid w-full sm:w-3/4 md:w-2/3 lg:w-1/2 max-w-4xl"},{default:d(()=>[t("label",ye,o(e.$t("Select your company"))+":",1),r(c,{modelValue:e.selectedCompany,"onUpdate:modelValue":a[7]||(a[7]=s=>e.selectedCompany=s),options:e.companies,filter:"",optionLabel:"name",class:"w-full h-11 md:w-64rem mb-4 bg-gray-50 border border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500",onChange:e.handleCompanySelection},{value:d(s=>[s.value?(u(),g("div",ve,[t("div",null,o(s.value.name),1)])):f("",!0)]),option:d(s=>[t("div",we,[t("div",null,o(s.option.name),1)])]),_:1},8,["modelValue","options","onChange"])]),_:1},8,["visible","header","onChange"])]),_:1})}}});export{ke as default};
