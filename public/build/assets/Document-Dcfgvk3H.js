import{s as So}from"./dialog.esm-Cx5sVhN_.js";import{c as To,s as wo,d as Ao,b as Eo,a as Oo}from"./column.esm-oOxVb6Zo.js";import{s as Io}from"./toolbar.esm-D6IE1FWU.js";import{s as _o}from"./document-1SbHCtNq.js";import{o as H,e as K,a as t,b as j,w as W,t as c,g as Me,F as Mt,h as $t,i as Do,n as We,f as Ee,c as Lt,k as ke,x as Ro,v as Oe,m as Ut,a6 as Mo,a7 as Po}from"./app-BEfExbJH.js";import{_ as No}from"./AppLayout-FbYF6R7B.js";import jt from"./TableDocumentSelector-CsOeoZjo.js";import{_ as Fo}from"./_plugin-vue_export-helper-DlAUqK2U.js";if(document.all&&!window.setTimeout.isPolyfill){var $o=window.setTimeout;window.setTimeout=function(r,e){var s=Array.prototype.slice.call(arguments,2);return $o(r instanceof Function?function(){r.apply(null,s)}:r,e)},window.setTimeout.isPolyfill=!0}var Lo=window.XMLHttpRequest,Se=function(r,e){var s="1.8.2.1",x=2,I=null,oe=null,E=null,Z=null,te=null,de=!1,G=!1,a=!1,ce=new Array;ce.es_ES={checktime_warn:"Se ha detectado un desfase horario entre su sistema y el servidor. Se recomienda que se corrija antes de pulsar Aceptar para continuar.",checktime_err:"Se ha detectado un desfase horario entre su sistema y el servidor. Debe corregir la hora de su sistema y recargar esta página antes de continuar.",checktime_local_time:"Hora de su sistema",checktime_server_time:"Hora del servidor"},ce.gl_ES={checktime_warn:"Destectouse un desfase horario entre o seu sistema e o servidor. Recoméndase corrixilo antes de pulsar Aceptar para continuar.",checktime_err:"Destectouse un desfase horario entre o seu sistema e o servidor. Debe corrixir a hora do seu sistema antes de continuar.",checktime_local_time:"Hora do seu sistema",checktime_server_time:"Hora do servidor"};var Ge=ce.es_ES,Pe=Ge,fe=null,$e="WINDOWS",Le="APPLE",V="PKCS12",Ue="PKCS11",ve="MOZ_UNI",Y="SHARED_NSS",w="JAVA",Ke="JCEKS",ee="JAVACE",Q="DNIEJAVA",Ne="CT_NO",pt="CT_RECOMMENDED",mt="CT_OBLIGATORY",At=2e3,ht=15,ct=!1,Fe,Ze,_e,ze=null,Et=!1;function Vt(){return"WebSocket"in r||"MozWebSocket"in r}function dt(y){return y!=null&&y.length>8&&(y.substr(0,5)=="http:"||y.substr(0,6)=="https:")}var _t=null,Dt=null,ut=null;function qt(y,A,g){_t=A,Dt=g;var R=Xe();R.open("GET",y,!0),"responseType"in R&&Uint8Array?(R.responseType="arraybuffer",ut="arraybuffer"):"overrideMimeType"in R?(R.overrideMimeType("text/plain; charset=x-user-defined"),ut="string"):(R.setRequestHeader("Accept-Charset","x-user-defined"),ut="bytearray"),"onload"in R||(R.onreadystatechange=function(){this.readyState===4&&this.onload()}),R.onload=function(L){if(R.readyState==4&&R.status==200&&_t){"response"in this||(this.response=new VBArray(this.responseBody).toArray());var $;ut=="arraybuffer"?$=D.encodeArrayBuffer(this.response):ut=="bytearray"?$=D.encodeByteArray(this.response):ut=="string"?$=D.encode(this.response):this.onerror(new Error("No se conoce el modo usado para la descarga de los datos")),_t($)}};try{R.onerror=function(L){Dt&&Dt(L)}}catch{}R.send()}function Xe(){var y=null;if(typeof XMLHttpRequest<"u")typeof Sarissa<"u"&&Sarissa.originalXMLHttpRequest?y=new Sarissa.originalXMLHttpRequest:y=new Lo;else if(typeof r.ActiveXObject<"u")try{y=new ActiveXObject("Msxml2.XMLHTTP.4.0")}catch{try{y=new ActiveXObject("MSXML2.XMLHTTP")}catch{try{y=new ActiveXObject("Microsoft.XMLHTTP")}catch{y=null}}}return y}var Ht=function(y){ct=y},Bt=function(y){_e=y};function Kt(){return!0}function Jt(){return!1}var Yt=function(y){},Gt=function(y){},Pt=function(y,A,g){if(!(!y||y==Ne||A&&A<=0)){A||(A=3e5);try{var R;g?R=g:R=document.URL+"/"+Math.random();var L=Xe();L.open("GET",R,!1),L.send();var $=new Date,re=new Date(L.getResponseHeader("Date"));if(re==null||re.getTime()==0)return;console.log("Hora cliente: "+$),console.log("Hora servidor: "+re);var Ie=Math.abs($.getTime()-re.getTime());Ie>A&&(y==pt?alert(Pe.checktime_warn+`
`+Pe.checktime_local_time+": "+$.toLocaleString()+`
`+Pe.checktime_server_time+": "+re.toLocaleString()):y==mt&&(de=!0,alert(Pe.checktime_err+`
`+Pe.checktime_local_time+": "+$.toLocaleString()+`
`+Pe.checktime_server_time+": "+re.toLocaleString())))}catch(pe){console.log("Error en la obtencion de la hora del servidor: "+pe);return}}};function Xt(){return ae.isFirefox()?ve:null}var Wt=function(y){E.setKeyStore(y??fe),a=!0},zt=function(y,A,g){E.selectCertificate(y,A,g),a=!1},Qt=function(y,A,g,R,L,$){E.sign(y,A,g,R,L,$),a=!1},Zt=function(y,A,g,R,L,$,re){E.coSign(y,g,R,L,$,re),a=!1},eo=function(y,A,g,R,L,$){E.coSign(y,A,g,R,L,$),a=!1},to=function(y,A,g,R,L,$){E.counterSign(y,A,g,R,L,$),a=!1},oo=function(y,A,g,R,L,$,re,Ie){E.signAndSaveToFile(y,A,g,R,L,$,re,Ie),a=!1},ro=function(y,A,g,R,L,$){E.signBatchXML(y,A,g,R,L,$),a=!1},ao=function(y,A,g,R){var L=new Object;L.algorithm=y,L.format=A,L.suboperation=g,R&&(L.extraparams=D.encode(R)),L.singlesigns=new Array,ze=L},so=function(y,A,g,R,L){if(!y||A==null)throw new Error("No se ha indicado el id o datareference de la firma");if(!ze)throw new Error("No hay ningun lote creado. Es necesario crear uno antes de agregar firmas");ye.checkExistingId(ze.singlesigns,y);var $=new Object;$.id=y,$.datareference=A,g&&($.format=g),R&&($.suboperation=R),L&&($.extraparams=D.encode(L)),ze.singlesigns.push($)},no=function(y){Et=y},io=function(y,A,g,R,L,$){if(!ze)throw new Error("No hay ningun lote creado. Es necesario crear uno antes de firmar.");ze.stoponerror=y;var re=D.encode(JSON.stringify(ze),!0);E.signBatchJSON(re,A,g,R,L,$),ze=null,a=!1},lo=function(y){return y!=null?D.encode(y):null},co=function(y){return y!=null?D.decode(y):null},uo=function(y,A,g,R,L,$,re){E.saveDataToFile(y,A,g,R,L,$,re)},fo=function(y,A,g,R,L,$){E.getFileNameContentBase64(y,A,g,R,L,$)},po=function(y,A,g,R,L,$){E.getMultiFileNameContentBase64(y,A,g,R,L,$)},mo=function(y,A){E.getCurrentLog(y,A)},ho=function(){return E.echo()},Ot=function(y){G&&!y&&(a=!0),G=y},It=function(y){Pe=y==null||ce[y]==null?Ge:ce[y]},go=function(){return E.getErrorMessage()},vo=function(){return E.getErrorType()},yo=function(y,A){Z=y,te=A,E&&E.setServlets&&E.setServlets(y,A)},xo=function(y,A){var g=1024,R=65535;Fe=y&&y>=g&&y<=R?y:g,Ze=A?A<=R&&A>=Fe?A:R:y&&y==Fe?Fe:R,E&&E.setPortRange&&E.setPortRange(Fe,Ze)};function Rt(y){if(ae.isChrome()||ae.isIOS()||ae.isAndroid()&&ae.isFirefox())document.location=y;else{if(document.getElementById("iframeAfirma")!=null)try{var A=document.getElementById("iframeAfirma");A.outerHTML="",A=null}catch{}navigator.msLaunchUri?navigator.msLaunchUri(y,null,function(){wrongInstallation=!0}):bo(y)}}function bo(y){var A=document.createElement("iframe"),g=document.createAttribute("id");g.value="iframeAfirma",A.setAttributeNode(g);var R=document.createAttribute("src");R.value=y,A.setAttributeNode(R);var L=document.createAttribute("height");L.value=1,A.setAttributeNode(L);var $=document.createAttribute("width");if($.value=1,A.setAttributeNode($),!ae.isInternetExplorer7orLower()){var re=document.createAttribute("style");re.value="display: none;",A.setAttributeNode(re)}document.body.appendChild(A)}function Nt(y,A,g){if(de){console&&console.log&&console.log("Se ha detectado un desfase grave entre la hora del sistema y la del servidor. Se cancela la carga del cliente de firma");return}ct||ae.isIOS()||ae.isAndroid()?(E=new Ft(y,r,e),(Z||te)&&E.setServlets(Z,te)):Vt()&&!ae.isInternetExplorer()&&!ae.isFirefox60orLower()?(E=new Co(r,e),Fe&&E.setPortRange(Fe,Ze)):!ae.isInternetExplorer10orLower()&&!ae.isSafari10()?(E=new ko(y,r,e),Fe&&E.setPortRange(Fe,Ze)):(E=new Ft(y,r,e),(Z||te)&&E.setServlets(Z,te)),A||(A=Xt()),E.setKeyStore(A)}var ae=function(y,A){function g(){return navigator.userAgent.toUpperCase().indexOf("ANDROID")!=-1||navigator.appVersion.toUpperCase().indexOf("ANDROID")!=-1||navigator.userAgent.toUpperCase().indexOf("SILK/")!=-1||navigator.userAgent.toUpperCase().indexOf("KFJWI")!=-1||navigator.userAgent.toUpperCase().indexOf("KFJWA")!=-1||navigator.userAgent.toUpperCase().indexOf("KFTT")!=-1||navigator.userAgent.toUpperCase().indexOf("KFOT")!=-1||navigator.userAgent.toUpperCase().indexOf("KINDLE FIRE")!=-1}function R(){return navigator.userAgent.toUpperCase().indexOf("IPAD")!=-1||navigator.userAgent.toUpperCase().indexOf("IPOD")!=-1||navigator.userAgent.toUpperCase().indexOf("IPHONE")!=-1||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1}function L(){return!!navigator.userAgent.match(/MSIE/)||!!(navigator.userAgent.match(/Trident/)&&navigator.userAgent.match(/rv:11/))||!!navigator.userAgent.match(/Trident.*rv[ :]*11\./)}function $(){return!!navigator.userAgent.match(/MSIE/)}function re(){var le=navigator.userAgent.toLowerCase();return 7>=(le.indexOf("msie")!=-1)?parseInt(le.split("msie")[1]):!1}function Ie(){return navigator.sayswho=function(){var le=navigator.userAgent,X,ne=le.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(ne[1])?(X=/\brv[ :]+(\d+)/g.exec(le)||[],"IE "+(X[1]||"")):ne[1]==="Chrome"&&(X=le.match(/\b(OPR|Edge)\/(\d+)/),X!=null)?X.slice(1).join(" ").replace("OPR","Opera"):(ne=ne[2]?[ne[1],ne[2]]:[navigator.appName,navigator.appVersion,"-?"],(X=le.match(/version\/(\d+)/i))!=null&&ne.splice(1,1,X[1]),ne.join(" "))}(),navigator.sayswho=="Safari 10"}function pe(){return navigator.userAgent.toUpperCase().indexOf("FIREFOX")!=-1}function Te(){navigator.sayswho=function(){var X=navigator.userAgent,ne,se=X.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(se[1])?(ne=/\brv[ :]+(\d+)/g.exec(X)||[],"IE "+(ne[1]||"")):se[1]==="Chrome"&&(ne=X.match(/\b(OPR|Edge)\/(\d+)/),ne!=null)?ne.slice(1).join(" ").replace("OPR","Opera"):(se=se[2]?[se[1],se[2]]:[navigator.appName,navigator.appVersion,"-?"],(ne=X.match(/version\/(\d+)/i))!=null&&se.splice(1,1,ne[1]),se.join(" "))}();var le=navigator.sayswho;return le.indexOf("Firefox")!=-1?60>=parseInt(le.split("Firefox")[1]):!1}function he(){return navigator.userAgent.toUpperCase().indexOf("CHROME/")!=-1||navigator.userAgent.toUpperCase().indexOf("CHROMIUM")!=-1}return{isAndroid:g,isIOS:R,isInternetExplorer:L,isInternetExplorer10orLower:$,isInternetExplorer7orLower:re,isSafari10:Ie,isFirefox:pe,isFirefox60orLower:Te,isChrome:he}}(),ye=function(y,A){var g=2147483648,R="1234567890abcdefghijklmnopqrstuwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",L=1024,$=49152,re=65535;function Ie(){var z=20,O="",B;if(typeof y.crypto<"u"&&typeof y.crypto.getRandomValues<"u")B=new Uint32Array(z),y.crypto.getRandomValues(B);else{B=new Array(z);for(var q=0;q<z;q++)B[q]=pe()}for(var q=0;q<z;q++)O+=R.charAt(Math.floor(B[q]%R.length));return O}function pe(){return he()*g}var Te;function he(){return Te==A&&(Te=new Date().getMilliseconds()*1e3*Math.random()),Te=(Te*9301+49297)%233280,Te/233280}function le(z,O){var B=z?Math.max(z,L):$,q=O?Math.min(O,re):re,N=new Array;switch(q-B){case 0:N[0]=B;break;case 1:N[0]=X(B,q,N),N[1]=X(B,q,N);break;default:N[0]=X(B,q,N),N[1]=X(B,q,N),N[2]=X(B,q,N)}return N}function X(z,O,B){if(B.length>O-z)return 0;var q;do{var N=Math.floor(Math.random()*(O+1-z))+z;q=ne(N,B)}while(q);return N}function ne(z,O){for(var B=0;B<O.length;B++)if(O[B]===z)return!0;return!1}function se(z){var O=D.decode(z);return JSON.parse(O)}function J(z,O){for(var B=0;B<z.length;B++)if(z[B].id==O)throw new Error('El id de la firma a agregar = "'+z[B].id+'" ya existe en el lote')}return{generateNewIdSession:Ie,getRandomPorts:le,parseJSONData:se,checkExistingId:J,getRandom:pe}}(r,e),Co=function(y,A){var g=4,R="127.0.0.1",L="wss://"+R+":",$="load",re="multiload",Ie="save",pe="batch",Te="log",he="certificate",le="sign",X="",ne="",se="",J="",z="",O=!1,B=ye.generateNewIdSession(),q=null,N=null,De=null,et=null,tt=null,ot=function(u,m){et=u,tt=m},gt=function(u){q=u},vt=function(u,m,o){ie(m,o),J=he;var n=Je(u);ge(be(n))},yt=function(u,m,o,n,f,d){rt("sign",u,m,o,n,f,d)},xt=function(u,m,o,n,f,d){rt("cosign",u,m,o,n,f,d)},bt=function(u,m,o,n,f,d){rt("countersign",u,m,o,n,f,d)};function rt(u,m,o,n,f,d,b){ie(d,b),J=le;var P=Ve(u,o,n,f,we(m));ge(be(P))}var at=function(u,m,o,n,f,d,b,P){ie(b,P),J=le;var U=qe(u,we(m),o,n,f,d);ge(be(U))},Ct=function(u,m,o,n,f,d){ie(f,d),J=pe;var b=st(m,o,n,we(u),!1);ge(be(b))},kt=function(u,m,o,n,f,d){ie(f,d),J=pe;var b=st(m,o,n,u,!0);ge(be(b))},St=function(u,m,o,n,f,d){ie(f,d),J=$;var b=nt("load",u,m,o,n,!1);ge(be(b))},Tt=function(u,m,o,n,f,d){ie(f,d),J=re;var b=nt("load",u,m,o,n,!0);ge(be(b))},xe=function(u,m){ie(u,m),J=Te;var o=nt("getLog");ge(be(o))},je=function(u,m,o,n,f,d,b){ie(d,b),J=Ie;var P=it(we(u),m,o,n,f);ge(be(P))};function ie(u,m){N=u,De=m}function we(u){return u?u.replace(/\+/g,"-").replace(/\//g,"_"):null}function Je(u){var m=new Object;return m.op=v("op","selectcert"),m.idsession=v("idsession",B),m.properties=v("properties",u!=null?D.encode(u,!0):null,!0),m.ksb64=v("ksb64",q!=null?D.encode(q,!0):null,!0),m.sticky=v("sticky",G),a&&(m.resetSticky=v("resetsticky",a)),m}function Ve(u,m,o,n,f){var d=new Object;return d.op=v("op",u),d.idsession=v("idsession",B),d.algorithm=v("algorithm",m),d.format=v("format",o),d.properties=v("properties",n!=null?D.encode(n,!0):null,!0),d.ksb64=v("ksb64",q!=null?D.encode(q,!0):null,!0),d.sticky=v("sticky",G),a&&(d.resetSticky=v("resetsticky",a)),d.dat=v("dat",f==""?null:f,!0),d}function qe(u,m,o,n,f,d){var b=new Object;return b.op=v("op","signandsave"),b.idsession=v("idsession",B),b.cryptoOp=v("cop",u),b.algorithm=v("algorithm",o),b.format=v("format",n),b.properties=v("properties",f?D.encode(f,!0):null,!0),b.filename=v("filename",d),b.ksb64=v("ksb64",q?D.encode(q,!0):null,!0),b.sticky=v("sticky",G),a&&(b.resetSticky=v("resetsticky",a)),b.dat=v("dat",m==""?null:m,!0),b}function st(u,m,o,n,f){var d=new Object;return d.op=v("op","batch"),d.idsession=v("idsession",B),d.batchpresignerurl=v("batchpresignerurl",u),d.batchpostsignerurl=v("batchpostsignerurl",m),d.properties=v("properties",o!=null?D.encode(o,!0):null,!0),d.ksb64=v("ksb64",q!=null?D.encode(q,!0):null,!0),d.sticky=v("sticky",G),a&&(d.resetSticky=v("resetsticky",a)),d.needcert=v("needcert",!0),d.dat=v("dat",n==""?null:n,!0),f&&(d.jsonbatch=v("jsonbatch",!0),Et&&(d.localBatchProcess=v("localBatchProcess",!0))),d}function nt(u,m,o,n,f,d){var b=new Object;return b.op=v("op",u),b.idsession=v("idsession",B),b.title=v("title",m),b.extensions=v("exts",o),b.description=v("desc",n),b.filePath=v("filePath",f),b.multiload=v("multiload",d),b}function it(u,m,o,n,f){var d=new Object;return d.op=v("op","save"),d.idsession=v("idsession",B),d.title=v("title",m),d.filename=v("filename",o),d.extension=v("exts",n),d.description=v("desc",f),d.dat=v("dat",u==""?null:u,!0),d}function be(u){var m=[];_e&&m.push(v("mcv",_e));for(var o in u)m.push(u[o]);for(var n="afirma://"+encodeURIComponent(u.op.value)+"?",f=0;f<m.length;f++)m[f].value!=null&&m[f].value!="null"&&(n+=(f!=0?"&":"")+m[f].key+"="+(m[f].avoidEncoding===!0?m[f].value:encodeURIComponent(m[f].value)));return n}function ge(u){if(z=u,lt())console.log("Enviamos el mensaje al socket abierto"),He(Se.AUTOFIRMA_CONNECTION_RETRIES);else{var m=ye.getRandomPorts(et,tt);ft(m),console.log("Tratamos de conectar con el cliente a traves de WebSockets en los puertos "+m),setTimeout(Re,3e3,m,Se.AUTOFIRMA_CONNECTION_RETRIES)}}function lt(){return!!se&&O}function ft(u){for(var m="",o=0;o<u.length;o++)m+=u[o],o<u.length-1&&(m+=",");var n="afirma://websocket?ports="+m+"&v="+g+"&jvc="+x+"&idsession="+B;Rt(n)}function Re(u,m){if(O)console.log("Enviamos el mensaje al socket"),He(Se.AUTOFIRMA_CONNECTION_RETRIES);else if(m>0){for(var o=0;!O&&o<u.length;o++)wt(u[o]);setTimeout(Re,Se.AUTOFIRMA_LAUNCHING_TIME,u,m-1)}else l("es.gob.afirma.standalone.ApplicationNotFoundException","No se ha podido conectar con AutoFirma.")}function wt(u){var m;try{m=new WebSocket(L+u)}catch(o){console.log("Error estableciendo el WebSocket: "+o)}return m.onopen=function(o,n){O=!0,se=this,console.log("Se abre el socket")},m.onclose=function(o){se!=null&&se===this&&(O=!1,se=null,console.log("Se cierra el socket. Codigo WebSocket de cierre: "+(o?o.code:null)),l("java.lang.InterruptedException","AutoFirma se ha cerrado o ha cerrado el websocket de comunicacion"))},m.onmessage=function(o){console.log("Procesado por defecto del mensaje")},m.onerror=function(o){console.log("Procesado por defecto del error")},m}function He(u){se.onmessage=ue,se.onerror=function(m){console.log("Error en la comunicacion por websocket: "+m),Qe(se,B,u-1)},Qe(se,B,u)}var ue=function(u){console.log("Respuesta de la peticion de eco"),se.onmessage=function(m){console.log("Respuesta obtenida de la operacion enviada"),Ae(m.data)},se.send(z)};function Qe(u,m,o){if(o<=0){l("java.util.concurrent.TimeoutException","AutoFirma no respondio al saludo.");return}if(u.readyState===1)try{u.send("echo=-idsession="+m+"@EOF")}catch(n){console.log("Error en echo: "+n),setTimeout(Qe,Se.AUTOFIRMA_LAUNCHING_TIME,u,m,o-1)}else console.log("El socket aun no esta preparado"),setTimeout(Qe,Se.AUTOFIRMA_LAUNCHING_TIME,u,m,o-1)}function Ae(u){if(u==A||u==null||u=="CANCEL"){l("es.gob.afirma.core.AOCancelledOperationException","Operacion cancelada por el usuario");return}if(u=="MEMORY_ERROR"){l("es.gob.afirma.core.OutOfMemoryError","El fichero que se pretende firmar o guardar excede de la memoria disponible para aplicacion");return}if(u.length>4&&u.substr(0,4)=="SAF_"){l("java.lang.Exception",u);return}if(u=="NULL"){l("java.lang.Exception","Error desconocido");return}if(J==Ie)p(u);else if(J==$)h(u,!1);else if(J==re)h(u,!0);else if(J==he)C(u);else if(J==pe)S(u);else if(J==Te)M(u);else if(J==le)_(u);else if(console.log("Operacion desconocida. Se devuelve directamente su resultado."),N){var m=N;ie(null,null),m(u)}else console.log("No se ha proporcionado funcion callback para procesar el resultado de la operacion")}function l(u,m){if(ne=u,X=m,De){var o=De;ie(null,null),o(u,m)}}function h(u,m){if(u.indexOf(":")<=0){l("java.lang.Exception","Respuesta no valida");return}if(!N){console.log("No se ha proporcionado funcion callback para procesar el resultado del lote de firma");return}var o,n,f=u.split("|");if(m)for(o=new Array,n=new Array,i=0;i<f.length;i++){var d=f[i].indexOf(":");o.push(f[i].substring(0,d)),n.push(f[i].substring(d+1).replace(/\-/g,"+").replace(/\_/g,"/"))}else{var d=f[0].indexOf(":");o=f[0].substring(0,d),n=f[0].substring(d+1).replace(/\-/g,"+").replace(/\_/g,"/")}if(N){var b=N;ie(null,null),b(o,n)}else console.log("No se ha proporcionado funcion callback a la que notificar el resultado de la carga de datos")}function p(u){if(u=="OK"||u=="SAVE_OK")if(N){var m=N;ie(null,null),m(u)}else console.log("No se ha proporcionado funcion callback a la notificar el resultado");else l("java.lang.Exception","Error desconocido al procesar los datos")}function C(u){if(N){var m=N;ie(null,null),m(u.replace(/\-/g,"+").replace(/\_/g,"/"))}else console.log("No se ha proporcionado funcion callback para devolver el certificado seleccionado")}function S(u){if(N){var m,o=null,n=u.indexOf("|");n==-1?m=u:(m=u.substring(0,n).replace(/\-/g,"+").replace(/\_/g,"/"),o=u.substring(n+1).replace(/\-/g,"+").replace(/\_/g,"/"));try{m=ye.parseJSONData(m)}catch{}if(N){var f=N;ie(null,null),f(m,o)}else console.log("No se ha proporcionado funcion callback a la que devolver el resultado del lote")}else console.log("No se ha proporcionado funcion callback para procesar el resultado del lote de firma")}function M(u){if(!N){console.log("No se ha proporcionado funcion callback para procesar el log");return}var m=` === JAVASCRIPT INFORMATION === 
navigator.appCodeName: `+navigator.appCodeName+`
navigator.appName: `+navigator.appName+`
navigator.appVersion: `+navigator.appVersion+`
navigator.platform: `+navigator.platform+`
navigator.userAgent: `+navigator.userAgent+`
navigator.javaEnabled(): `+navigator.javaEnabled()+`
screen.width: `+(y.screen?screen.width:0)+`
screen.height: `+(y.screen?screen.height:0)+`

   === CLIENTE LOG === 
`+u;if(N){var o=N;ie(null,null),o(m)}else console.log("No se ha proporcionado funcion callback a la que devolver el log")}function _(u){if(!N){console.log("No se ha proporcionado funcion callback para procesar el resultado de la firma");return}var m,o=null,n=null,f=u.indexOf("|");if(f==-1)m=D.decode(u,!0).replace(/\-/g,"+").replace(/\_/g,"/");else{o=u.substring(0,f).replace(/\-/g,"+").replace(/\_/g,"/");var d=u.indexOf("|",f+1);d==-1?m=u.substring(f+1).replace(/\-/g,"+").replace(/\_/g,"/"):(m=u.substring(f+1,d).replace(/\-/g,"+").replace(/\_/g,"/"),n=D.decode(u.substring(d),!0))}if(N){var b=N;ie(null,null),b(m,o,n)}else console.log("No se ha proporcionado funcion callback a la que devolver la firma generada")}function v(u,m,o){var n=new Object;return n.key=u,n.value=m,n.avoidEncoding=!!o,n}function F(){return"Cliente JavaScript"}function k(){return X}function T(){return ne}return{echo:F,setKeyStore:gt,setPortRange:ot,sign:yt,coSign:xt,counterSign:bt,signBatchJSON:kt,signBatchXML:Ct,selectCertificate:vt,saveDataToFile:je,signAndSaveToFile:at,getFileNameContentBase64:St,getMultiFileNameContentBase64:Tt,setStickySignatory:Ot,setLocale:It,getErrorMessage:k,getErrorType:T,getCurrentLog:xe}},ko=function(y,A,g){var R="",L="",$="",re,Ie=1,pe=500,Te="https://127.0.0.1:",he="",le=0,X=!1,ne=!1,se=!1,J="",z=ae.isInternetExplorer()?12e3:ae.isFirefox()?458752:1048576,O=!1,B=null,q=null,N=null,De=null,et=null,tt=null,ot=function(o,n){et=o,tt=n};function gt(o){B=o}function vt(o,n,f){q=n,N=f,yt(o)}function yt(o){var n=new Object;n.op=p("op","selectcert"),n.properties=p("properties",o!=null?D.encode(o):null),n.keystore=p("keystore",B??null),n.ksb64=p("ksb64",B!=null?D.encode(B):null),n.sticky=p("sticky",G),a&&(n.resetSticky=p("resetsticky",a)),we(ie(n))}function xt(o,n,f,d,b,P){q=b,N=P,at("sign",o,n,f,d)}function bt(o,n,f,d,b,P){q=b,N=P,at("cosign",o,n,f,d)}function rt(o,n,f,d,b,P){q=b,N=P,at("countersign",o,n,f,d)}function at(o,n,f,d,b){(n==g||n=="")&&(n=null),n!=null&&!dt(n)&&(n=n.replace(/\+/g,"-").replace(/\//g,"_"));var P=Ve(o,f,d,b,n,B);we(ie(P))}function Ct(o,n,f,d,b,P,U,Ce){q=U,N=Ce,kt(o,n,f,d,b,P)}function kt(o,n,f,d,b,P){(n==g||n=="")&&(n=null),n!=null&&!dt(n)&&(n=n.replace(/\+/g,"-").replace(/\//g,"_"));var U=qe(o,f,d,b,P,n,B);we(ie(U))}function St(o,n,f,d,b,P){q=b,N=P,xe(o,n,f,d,!1)}function Tt(o,n,f,d,b,P){q=b,N=P,xe(o,n,f,d,!0)}function xe(o,n,f,d,b){(o==g||o=="")&&(o=null),o!=null&&(o=o.replace(/\+/g,"-").replace(/\//g,"_"));var P=je(B,n,f,d,o,b);we(ie(P))}function je(o,n,f,d,b,P){var U=new Object;return U.op=p("op","batch"),U.keystore=p("keystore",o??null),U.ksb64=p("ksb64",o!=null?D.encode(o):null),U.batchpresignerurl=p("batchpresignerurl",n),U.batchpostsignerurl=p("batchpostsignerurl",f),U.properties=p("properties",d!=null?D.encode(d):null),U.dat=p("dat",b==""?null:b),U.needcert=p("needcert",!0),U.sticky=p("sticky",G),a&&(U.resetSticky=p("resetsticky",a)),P&&(U.jsonbatch=p("jsonbatch",!0)),Et&&(U.localBatchProcess=p("localBatchProcess",!0)),U}function ie(o){var n=[];_e&&n.push(p("mcv",_e));for(var f in o)n.push(o[f]);for(var d="afirma://"+encodeURIComponent(o.op.value)+"?",b=0;b<n.length;b++)n[b].value!=null&&n[b].value!="null"&&(d+=(b!=0?"&":"")+n[b].key+"="+encodeURIComponent(n[b].value));return d}function we(o){if($==""){var n=ye.getRandomPorts(et,tt);Je(n),setTimeout(nt,Se.AUTOFIRMA_LAUNCHING_TIME,n,o)}else O=!1,it($,o,Se.AUTOFIRMA_CONNECTION_RETRIES)}function Je(o){for(var n="",f=0;f<o.length;f++)n+=o[f],f<o.length-1&&(n+=",");re=ye.generateNewIdSession();var d="afirma://service?ports="+n+"&v="+Ie+"&jvc="+x+"&idsession="+re;Rt(d)}function Ve(o,n,f,d,b,P){var U=new Object;return U.op=p("op",o),U.keystore=p("keystore",P??null),U.ksb64=p("ksb64",P!=null?D.encode(P):null),U.algorithm=p("algorithm",n),U.format=p("format",f),U.properties=p("properties",d!=null?D.encode(d):null),U.dat=p("dat",b==""?null:b),U.sticky=p("sticky",G),a&&(U.resetSticky=p("resetsticky",a)),U}function qe(o,n,f,d,b,P,U){var Ce=new Object;return Ce.op=p("op","signandsave"),Ce.cryptoOp=p("cop",o),Ce.keystore=p("keystore",U??null),Ce.ksb64=p("ksb64",U!=null?D.encode(U):null),Ce.algorithm=p("algorithm",n),Ce.format=p("format",f),Ce.properties=p("properties",d!=null?D.encode(d):null),Ce.filename=p("filename",b),Ce.dat=p("dat",P==""?null:P),Ce.sticky=p("sticky",G),a&&(Ce.resetSticky=p("resetsticky",a)),Ce}function st(o,n,f,d,b,P){var U=new Object;return U.op=p("op",o),U.title=p("title",n),U.extensions=p("exts",f),U.description=p("desc",d),U.filePath=p("filePath",b),U.multiload=p("multiload",P),U}function nt(o,n){O=!1;var f=new Object;f.locked=!1;for(var d=0;!O&&d<o.length;d++)it(o[d],n,Se.AUTOFIRMA_CONNECTION_RETRIES,f)}function it(o,n,f,d){De=n;var b=Xe();b.open("POST",Te+o+"/afirma",!0),b.setRequestHeader("Content-type","application/x-www-form-urlencoded"),b.onreadystatechange=function(){if(b.readyState==4&&b.status==200&&D.decode(b.responseText,!0)=="OK"&&!O)$=o,J=Te+$+"/afirma",O=!0,d&&(d.locked=!0),X=De.indexOf("afirma://selectcert")>-1,ne=De.indexOf("afirma://save")>-1,se=De.indexOf("afirma://batch")>-1,De.indexOf("afirma://signandsave")>-1,ge();else if((!d||!d.locked)&&!O&&b.readyState!=2&&b.readyState!=3)if(f--,$!=""&&f<Se.AUTOFIRMA_CONNECTION_RETRIES/2)$="",d&&(d.locked=!0),f=Se.AUTOFIRMA_CONNECTION_RETRIES,we(De);else if(f==0){(!d||!d.locked)&&(d&&(d.locked=!0),N("es.gob.afirma.standalone.ApplicationNotFoundException","No se ha podido conectar con AutoFirma."));return}else setTimeout(be,Se.AUTOFIRMA_LAUNCHING_TIME,o,f,d)},O||b.send("echo=-idsession="+re+"@EOF")}function be(o,n,f){it(o,De,n,f)}function ge(){var o=De;if(o.length>z){lt(o,1,Math.ceil(o.length/z));return}var n=Xe();n.open("POST",J,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(n.status==404&&ue("java.lang.IOException",n.responseText),ne){n.readyState==4&&D.decode(n.responseText)!=""&&He(D.decode(n.responseText));return}else if(n.readyState==4&&n.status==200&&n.responseText!=""){if(D.decode(n.responseText)=="MEMORY_ERROR"){ue("java.lang.OutOfMemoryError","Problema de memoria en servidor");return}he="",Re(1,D.decode(n.responseText,!0))}else n.responseText==""&&n.status==0&&n.readyState==0&&setTimeout(ge,pe)};try{n.onerror=function(f){f.target.status==0?ue("java.lang.IOException","Se ha perdido la conexion con la aplicacion @firma "+f.target.statusText):ue("java.lang.IOException","Ocurrio un error de red en la llamada al servicio de firma "+f.target.statusText)}}catch{}n.send("cmd="+D.encode(o,!0)+"idsession="+re+"@EOF")}function lt(o,n,f){var d=Xe();d.open("POST",J,!0),d.setRequestHeader("Content-type","application/x-www-form-urlencoded");var b=o.substring((n-1)*z,Math.min(z*n,o.length));d.onreadystatechange=function(P){if(d.status==404){ue("java.lang.Exception",d.responseText);return}d.readyState==4&&d.status==200&&d.responseText!=""?(le++,D.decode(d.responseText,!0)=="MORE_DATA_NEED"?le<f&&lt(o,n+1,f):D.decode(d.responseText,!0)=="OK"?le==f&&(le=0,ft()):D.decode(d.responseText)=="MEMORY_ERROR"&&He(D.decode(d.responseText))):d.responseText==""&&d.status==0&&d.readyState==0&&setTimeout(lt,pe,o,n,f)};try{d.onerror=function(P){P.target.status==0?ue("java.lang.IOException","Se ha perdido la conexion con la aplicacion @firma "+P.target.statusText):ue("java.lang.IOException","Ocurrio un error de red en la llamada al servicio de firma "+P.target.statusText)}}catch{}d.send("fragment=@"+n+"@"+f+"@"+D.encode(b,!0)+"idsession="+re+"@EOF")}function ft(){httpRequest=Xe(),httpRequest.open("POST",J,!0),httpRequest.setRequestHeader("Content-type","application/x-www-form-urlencoded"),httpRequest.onreadystatechange=function(){if(httpRequest.status==404&&ue("java.lang.Exception",httpRequest.responseText),ne){httpRequest.readyState==4&&D.decode(httpRequest.responseText)!=""&&He(D.decode(httpRequest.responseText));return}else httpRequest.readyState==4&&httpRequest.status==200&&httpRequest.responseText!=""?(D.decode(httpRequest.responseText)=="MEMORY_ERROR"&&He(D.decode(httpRequest.responseText)),he="",Re(1,D.decode(httpRequest.responseText,!0))):httpRequest.status==0&&httpRequest.readyState==0&&setTimeout(ft,pe)};try{httpRequest.onerror=function(o){o.target.status==0?ue("java.lang.IOException","Se ha perdido la conexion con la aplicacion @firma "+o.target.statusText):ue("java.lang.IOException","Ocurrio un error de red en la llamada al servicio de firma "+o.target.statusText)}}catch{}httpRequest.send("firm=idsession="+re+"@EOF")}function Re(o,n){httpRequest=Xe(),httpRequest.open("POST",J,!0),httpRequest.setRequestHeader("Content-type","application/x-www-form-urlencoded"),httpRequest.onreadystatechange=function(){if(httpRequest.readyState==4&&httpRequest.status==200&&httpRequest.responseText!=""){if(D.decode(httpRequest.responseText)=="MEMORY_ERROR"){ue("java.lang.OutOfMemoryError","Problema de memoria en servidor");return}he+=D.decode(httpRequest.responseText,!0),o==n?(se?(Qe(he),se=!1):X?(wt(he),X=!1):He(he),he=""):Re(o+1,n)}else httpRequest.responseText==""&&httpRequest.status==0&&httpRequest.readyState==0&&setTimeout(Re,pe,o,n)};try{httpRequest.onerror=function(f){f.target.status==0?ue("java.lang.IOException","Se ha perdido la conexion con la aplicacion @firma "+f.target.statusText):ue("java.lang.IOException","Ocurrio un error de red en la llamada al servicio de firma "+f.target.statusText)}}catch{}o<=n&&httpRequest.send("send=@"+o+"@"+n+"idsession="+re+"@EOF")}function wt(o){if(o==g||o==null||o=="CANCEL"){N("es.gob.afirma.core.AOCancelledOperationException","Operacion cancelada por el usuario");return}if(o.length>4&&o.substr(0,4)=="SAF_"){N("java.lang.Exception",o);return}if(o=="NULL"){N("java.lang.Exception","Error desconocido");return}q(o.replace(/\-/g,"+").replace(/\_/g,"/"))}function He(o){if(o==g||o==null||o=="CANCEL"){N("es.gob.afirma.core.AOCancelledOperationException","Operacion cancelada por el usuario");return}if(o=="OK"){try{o=ye.parseJSONData(o)}catch{}q(o,null);return}if(o=="MEMORY_ERROR"){N("es.gob.afirma.core.OutOfMemoryError","El fichero que se pretende firmar o guardar excede de la memoria disponible para aplicacion");return}if(o.length>4&&o.substr(0,4)=="SAF_"){N("java.lang.Exception",o);return}if(o=="NULL"){N("java.lang.Exception","Error desconocido");return}if(o=="SAVE_OK"){q&&q(o);return}if(o.length>150&&o.substr(0,150).indexOf("<log>")!=-1){var n=` === JAVASCRIPT INFORMATION === 
navigator.appCodeName: `+navigator.appCodeName+`
navigator.appName: `+navigator.appName+`
navigator.appVersion: `+navigator.appVersion+`
navigator.platform: `+navigator.platform+`
navigator.userAgent: `+navigator.userAgent+`
navigator.javaEnabled(): `+navigator.javaEnabled()+`
screen.width: `+(A.screen?screen.width:0)+`
screen.height: `+(A.screen?screen.height:0)+`

   === CLIENTE LOG === 
`+o;q(n);return}if(o.indexOf(":")>0){var f=o.split("|");if(f.length==1){var Be=f[0].indexOf(":"),d=f[0];Be==-1?fileName=D.decode(d,!0):(fileName=d.substring(0,Be),dataB64=d.substring(Be+1).replace(/\-/g,"+").replace(/\_/g,"/")),q(fileName,dataB64);return}else if(f.length>1){var b=new Array,P=new Array;for(i=0;i<f.length;i++){var Be=f[i].indexOf(":");Be==-1?(b.push(f[i]),P.push("")):(b.push(f[i].substring(0,Be)),P.push(f[i].substring(Be+1).replace(/\-/g,"+").replace(/\_/g,"/")))}}q(b,P);return}var U,Ce=null,Be=o.indexOf("|");Be==-1?U=D.decode(o,!0).replace(/\-/g,"+").replace(/\_/g,"/"):(Ce=o.substring(0,Be).replace(/\-/g,"+").replace(/\_/g,"/"),U=o.substring(Be+1).replace(/\-/g,"+").replace(/\_/g,"/")),q(U,Ce)}function ue(o,n){N&&N(o,n)}function Qe(o){if(o==g||o==null||o=="CANCEL"){N("es.gob.afirma.core.AOCancelledOperationException","Operacion cancelada por el usuario");return}if(o.length>4&&o.substr(0,4)=="SAF_"){N("java.lang.Exception",o);return}if(o=="NULL"){N("java.lang.Exception","Error desconocido");return}var n,f=null,d=o.indexOf("|");d==-1?n=o:(n=o.substring(0,d).replace(/\-/g,"+").replace(/\_/g,"/"),f=o.substring(d+1).replace(/\-/g,"+").replace(/\_/g,"/"));try{n=ye.parseJSONData(n)}catch{}q(n,f)}function Ae(o,n,f,d,b,P,U){q=P,N=U,l(o,n,f,d,b)}function l(o,n,f,d,b){(o==g||o=="")&&(o=null),o!=null&&!dt(o)&&(o=o.replace(/\+/g,"-").replace(/\//g,"_"));var P=h(o,n,f,d,b);we(ie(P))}function h(o,n,f,d,b){var P=new Object;return P.op=p("op","save"),P.title=p("title",n),P.filename=p("filename",f),P.extension=p("exts",d),P.description=p("desc",b),P.dat=p("dat",o==""?null:o),P}function p(o,n){var f=new Object;return f.key=o,f.value=n,f}function C(o,n){return o!=null?D.encode(o):null}function S(o,n){return o!=null?D.decode(o):null}function M(o,n,f,d,b,P){q=b,N=P,F("load",o,n,f,d,!1)}function _(o,n,f,d,b,P){q=b,N=P,F("load",o,n,f,d,!0)}function v(o,n){q=o,N=n,k()}function F(o,n,f,d,b,P){var U=st(o,n,f,d,b,P);we(ie(U))}function k(){var o=st("getLog");we(ie(o))}function T(){return"Cliente JavaScript"}function u(){return R}function m(){return L}return{echo:T,checkTime:Pt,setKeyStore:gt,setPortRange:ot,sign:xt,coSign:bt,counterSign:rt,signBatchJSON:Tt,signBatchXML:St,selectCertificate:vt,saveDataToFile:Ae,signAndSaveToFile:Ct,getFileNameContentBase64:M,getMultiFileNameContentBase64:_,getBase64FromText:C,getTextFromBase64:S,setStickySignatory:Ot,setLocale:It,getErrorMessage:u,getErrorType:m,getCurrentLog:v}},Ft=function(y,A,g){var R=2e3,L=3,$=ae.isAndroid()||ae.isIOS()?4e3:3e3,re=ae.isAndroid()||ae.isIOS()?15:10,Ie=!0,pe="batch",Te="certificate",he="sign",le=he,X,ne="",se="",J=null,z=null,O=null;if(y!=g&&y!=null)if(y.indexOf("://")!=-1&&y.indexOf("/",y.indexOf("://")+3)!=-1){var B=y.substring(0,y.indexOf("/",y.indexOf("://")+3));z=B+"/afirma-signature-retriever/RetrieveService",O=B+"/afirma-signature-storage/StorageService"}else z=y+"/afirma-signature-retriever/RetrieveService",O=y+"/afirma-signature-storage/StorageService";function q(l){J=l}function N(l,h,p){le=Te;var C=ye.generateNewIdSession(),S=ie(),M="selectcert";G&&!a&&X&&(l=ge(X,l));var _=0,v=new Array;v[_++]={key:"ver",value:L},v[_++]={key:"op",value:M},C!=null&&C!=g&&(v[_++]={key:"id",value:C}),S!=null&&S!=g&&(v[_++]={key:"key",value:S}),J!=null&&J!=g&&(v[_++]={key:"keystore",value:J},v[_++]={key:"ksb64",value:D.encode(J)}),O!=null&&O!=g&&(v[_++]={key:"stservlet",value:O}),l!=null&&l!=g&&(v[_++]={key:"properties",value:D.encode(l)}),!ae.isAndroid()&&!ae.isIOS()&&(v[_++]={key:"aw",value:"true"});var F=qe(M,v);if(je(F)){if(O==null||O==g){xe("java.lang.IllegalArgumentException","No se ha indicado la direccion del servlet para el guardado de datos");return}else if(z==null||z==g){xe("java.lang.IllegalArgumentException","No se ha indicado la direccion del servlet para la recuperacion de datos");return}Je(C,S,O,z,M,v,h,p)}else Ve(F,C,S,h,p)}function De(l,h,p,C,S,M){ot("sign",l,h,p,C,S,M)}function et(l,h,p,C,S,M){ot("cosign",l,h,p,C,S,M)}function tt(l,h,p,C,S,M){ot("countersign",l,h,p,C,S,M)}function ot(l,h,p,C,S,M,_){le=he,(h==g||h=="")&&(h=null),h!=null&&!dt(h)&&(h=h.replace(/\+/g,"-").replace(/\//g,"_"),h=h.replace(/\n/g,"").replace(/\r/g,"")),G&&!a&&X&&(S=ge(X,S));var v=ye.generateNewIdSession(),F=ie(),k=0,T=new Array;T[k++]={key:"ver",value:L},l!=null&&l!=g&&(T[k++]={key:"op",value:l}),v!=null&&v!=g&&(T[k++]={key:"id",value:v}),F!=null&&F!=g&&(T[k++]={key:"key",value:F}),J!=null&&J!=g&&(T[k++]={key:"keystore",value:J},T[k++]={key:"ksb64",value:D.encode(J)}),O!=null&&O!=g&&(T[k++]={key:"stservlet",value:O}),C!=null&&C!=g&&(T[k++]={key:"format",value:C}),p!=null&&p!=g&&(T[k++]={key:"algorithm",value:p}),S!=null&&S!=g&&(T[k++]={key:"properties",value:D.encode(S)}),!ae.isAndroid()&&!ae.isIOS()&&(T[k++]={key:"aw",value:"true"}),h!=null&&(T[k++]={key:"dat",value:h});var u=qe(l,T);if(je(u)){if(O==null||O==g){xe("java.lang.IllegalArgumentException","No se ha indicado la direccion del servlet para el guardado de datos");return}Je(v,F,O,z,l,T,M,_)}else Ve(u,v,F,M,_)}function gt(l,h,p,C,S,M,_,v){le=he,(h==g||h=="")&&(h=null),h!=null&&!dt(h)&&(h=h.replace(/\+/g,"-").replace(/\//g,"_"),h=h.replace(/\n/g,"").replace(/\r/g,"")),G&&!a&&X&&(S=ge(X,S));var F=ye.generateNewIdSession(),k=ie(),T=0,u="signandsave",m=new Array;m[T++]={key:"ver",value:L},m[T++]={key:"op",value:u},l!=null&&l!=g&&(m[T++]={key:"cop",value:l}),F!=null&&F!=g&&(m[T++]={key:"id",value:F}),k!=null&&k!=g&&(m[T++]={key:"key",value:k}),J!=null&&J!=g&&(m[T++]={key:"keystore",value:J},m[T++]={key:"ksb64",value:D.encode(J)}),O!=null&&O!=g&&(m[T++]={key:"stservlet",value:O}),C!=null&&C!=g&&(m[T++]={key:"format",value:C}),p!=null&&p!=g&&(m[T++]={key:"algorithm",value:p}),S!=null&&S!=g&&(m[T++]={key:"properties",value:D.encode(S)}),M!=null&&M!=g&&(m[T++]={key:"filename",value:M}),!ae.isAndroid()&&!ae.isIOS()&&(m[T++]={key:"aw",value:"true"}),h!=null&&(m[T++]={key:"dat",value:h});var o=qe(u,m);if(je(o)){if(O==null||O==g){xe("java.lang.IllegalArgumentException","No se ha indicado la direccion del servlet para el guardado de datos");return}Je(F,k,O,z,u,m,_,v)}else Ve(o,F,k,_,v)}function vt(l,h,p,C,S,M){le=pe,(l==g||l=="")&&(l=null),l!=null&&!dt(l)&&(l=l.replace(/\+/g,"-").replace(/\//g,"_"),l=l.replace(/\n/g,"").replace(/\r/g,"")),G&&!a&&X&&(C=ge(X,C));var _=ye.generateNewIdSession(),v=ie(),F="batch",k=0,T=new Array;T[k++]={key:"ver",value:L},T[k++]={key:"op",value:F},_!=null&&_!=g&&(T[k++]={key:"id",value:_}),v!=null&&v!=g&&(T[k++]={key:"key",value:v}),J!=null&&J!=g&&(T[k++]={key:"keystore",value:J},T[k++]={key:"ksb64",value:D.encode(J)}),O!=null&&O!=g&&(T[k++]={key:"stservlet",value:O}),h!=null&&h!=g&&(T[k++]={key:"batchpresignerurl",value:h}),p!=null&&p!=g&&(T[k++]={key:"batchpostsignerurl",value:p}),C!=null&&C!=g&&(T[k++]={key:"properties",value:D.encode(C)}),!ae.isAndroid()&&!ae.isIOS()&&(T[k++]={key:"aw",value:"true"}),T[k++]={key:"needcert",value:"true"},l!=null&&(T[k++]={key:"dat",value:l});var u=qe(F,T);if(je(u)){if(O==null||O==g){xe("java.lang.IllegalArgumentException","No se ha indicado la direccion del servlet para el guardado de datos");return}Je(_,v,O,z,F,T,S,M)}else Ve(u,_,v,S,M)}function yt(l,h,p,C,S,M){le=pe,G&&!a&&X&&(C=ge(X,C));var _=ye.generateNewIdSession(),v=ie(),F="batch",k=0,T=new Array;T[k++]={key:"ver",value:L},T[k++]={key:"op",value:F},_!=null&&_!=g&&(T[k++]={key:"id",value:_}),v!=null&&v!=g&&(T[k++]={key:"key",value:v}),J!=null&&J!=g&&(T[k++]={key:"keystore",value:J},T[k++]={key:"ksb64",value:D.encode(J)}),O!=null&&O!=g&&(T[k++]={key:"stservlet",value:O}),h!=null&&h!=g&&(T[k++]={key:"batchpresignerurl",value:h}),p!=null&&p!=g&&(T[k++]={key:"batchpostsignerurl",value:p}),C!=null&&C!=g&&(T[k++]={key:"properties",value:D.encode(C)}),!ae.isAndroid()&&!ae.isIOS()&&(T[k++]={key:"aw",value:!0}),Et&&(T[k++]={key:"localBatchProcess",value:!0}),T[k++]={key:"needcert",value:!0},T[k++]={key:"jsonbatch",value:!0},T[k++]={key:"dat",value:l};var u=qe(F,T);if(je(u)){if(O==null||O==g){xe("java.lang.IllegalArgumentException","No se ha indicado la direccion del servlet para el guardado de datos");return}Je(_,v,O,z,F,T,S,M)}else Ve(u,_,v,S,M)}function xt(l,h,p,C,S,M,_){l!=g&&l!=null&&l!=""&&(l=l.replace(/\+/g,"-").replace(/\//g,"_"));var v=ye.generateNewIdSession(),F=ie(),k=0,T="save",u=new Array;u[k++]={key:"ver",value:L},u[k++]={key:"op",value:T},v!=null&&v!=g&&(u[k++]={key:"id",value:v}),F!=null&&F!=g&&(u[k++]={key:"key",value:F}),O!=null&&O!=g&&(u[k++]={key:"stservlet",value:O}),h!=null&&h!=g&&(u[k++]={key:"title",value:h}),p!=null&&p!=g&&(u[k++]={key:"filename",value:p}),C!=null&&C!=g&&(u[k++]={key:"extension",value:C}),S!=null&&S!=g&&(u[k++]={key:"description",value:S}),!ae.isAndroid()&&!ae.isIOS()&&(u[k++]={key:"aw",value:"true"}),l!=null&&l!=g&&l!=""&&(u[k++]={key:"dat",value:l});var m=qe(T,u);if(je(m)){if(O==null||O==g){xe("java.lang.IllegalArgumentException","No se ha indicado la direccion del servlet para el guardado de datos");return}Je(v,F,O,z,T,u,M,_)}else Ve(m,v,F,M,_)}function bt(l,h,p,C,S,M){var _="java.lang.UnsupportedOperationException",v="La operacion de carga de fichero no esta disponible por servidor intermedio";M?M(_,v):xe(_,v)}function rt(l,h,p,C,S,M){var _="java.lang.UnsupportedOperationException",v="La operacion de carga de multiples ficheros no esta disponible por servidor intermedio";M?M(_,v):xe(_,v)}function at(){return"Cliente JavaScript"}function Ct(){return ne}function kt(){return se}function St(l,h){var p="java.lang.UnsupportedOperationException",C="La operacion de obtencion del log no esta disponible por servidor intermedio";h?h(p,C):xe(p,C)}function Tt(l,h){O=l,z=h}function xe(l,h){throw se=l,ne=h,new Error}function je(l){return l.length>R}function ie(){var l;if(typeof A.crypto<"u"&&typeof A.crypto.getRandomValues<"u"){var h=new Uint32Array(1);A.crypto.getRandomValues(h),l=we(h[0]%1e8,8)}else l=we(Math.floor((ye.getRandom()+1)%1e8),8);return l}function we(l,h){return h-=l.toString().length,h>0?new Array(h+(/\./.test(l)?2:1)).join("0")+l:l+""}function Je(l,h,p,C,S,M,_,v){var F=ye.generateNewIdSession(),k=Xe();k||xe("java.lang.Exception","Su navegador no permite preprocesar los datos que desea tratar"),k.open("POST",p,!0),k.setRequestHeader("Content-type","application/x-www-form-urlencoded"),k.onreadystatechange=function(){if(k.readyState==4)if(k.status==200){var u=nt(S,F,C,h);if(je(u)){v("java.lang.IllegalArgumentException","La URL de invocacion al servicio de firma es demasiado larga.");return}Ve(u,l,h,_,v)}else console.log("Error al enviar los datos al servidor intermedio. HTTP Status: "+k.status),v("java.lang.IOException","Ocurrio un error al enviar los datos a la aplicacion nativa")};try{k.onerror=function(u){console.log("Error al enviar los datos al servidor intermedio (HTTP Status: "+k.status+"): "+u.message),v("java.lang.IOException","Ocurrio un error al enviar los datos al servicio intermedio para la comunicacion con la aplicacion nativa")}}catch{}_e&&(M[M.length]={key:"mcv",value:_e});var T="op=put&v=1_0&id="+F+"&dat="+Qe(st(S,M),h);try{k.send(T)}catch{v("java.lang.IOException","No se pudo conectar con el servidor remoto")}}function Ve(l,h,p,C,S){Ie=!1,Rt(l),h&&(C||S)&&wt(h,z,p,l,C,S)}function qe(l,h){var p="jvc="+x;if(_e&&(p+="&mcv="+encodeURIComponent(_e)),h!=null&&h!=g)for(var C=0;C<h.length;C++)h[C].value!=null&&h[C].value!="null"&&(p+="&"+h[C].key+"="+encodeURIComponent(h[C].value));var S;return ae.isChrome()&&ae.isAndroid()?S="intent://"+l+"?"+p+"#Intent;scheme=afirma;package=es.gob.afirma;end":S="afirma://"+l+"?"+p,S}function st(l,h){l=l??"op";var p="<"+l+">";if(h!=null)for(var C=0;C<h.length;C++)p+='<e k="'+h[C].key+'" v="'+h[C].value+'"/>';return D.encode(p+"</"+l+">")}function nt(l,h,p,C){var S=0,M=new Array;return M[S++]={key:"fileid",value:h},(p!=null||p!=g)&&(M[S++]={key:"rtservlet",value:p}),(C!=null||C!=g)&&(M[S++]={key:"key",value:C}),qe(l,M)}function it(l,h,p,C){if(l.substr(0,6).toLowerCase()=="err-06")return!0;if(l.substr(0,5).toLowerCase()=="#wait")return"reset";if(l.substr(0,4).toLowerCase()=="err-"&&l.indexOf(":=")!=-1)return ne=l.substring(l.indexOf(":=")+2),l.substr(0,7).toLowerCase()=="err-11:"?se="es.gob.afirma.core.AOCancelledOperationException":se="java.lang.Exception",C(se,ne),!1;if(l=="CANCEL"||l==`CANCEL\r
`)return C("es.gob.afirma.core.AOCancelledOperationException","Operacion cancelada por el usuario"),!1;if(l=="OK"||l==`OK\r
`)return p(),!1;if(l.length>4&&l.substr(0,4)=="SAF_")return C("java.lang.Exception",l),!1;if(le==pe){var S,_=null,F=l.indexOf("|");F==-1?h!=g&&h!=null?S=ue(l,h):S=Ae(l):(h!=g&&h!=null?(S=ue(l.substring(0,F),h,!0),_=ue(l.substring(F+1),h)):(S=Ae(l.substring(0,F)),_=Ae(l.substring(F+1))),G?_&&(X=_):X=null);try{S=ye.parseJSONData(S)}catch{}return p(S,_),!1}else if(le==Te){var _;return h!=g&&h!=null?_=ue(l,h):_=Ae(l),X=G?_:null,p(_),!1}var M,_=null,v=null,F=l.indexOf("|");if(F==-1)h!=g&&h!=null?M=ue(l,h):M=Ae(l);else{var k=l.indexOf("|",F+1);k==-1?h!=g&&h!=null?(_=ue(l.substring(0,F),h,!0),M=ue(l.substring(F+1),h)):(_=Ae(l.substring(0,F)),M=Ae(l.substring(F+1))):h!=g&&h!=null?(_=ue(l.substring(0,F),h,!0),M=ue(l.substring(F+1,k),h,!0),v=D.decode(ue(l.substring(k+1),h))):(_=Ae(l.substring(0,F)),M=Ae(l.substring(F+1)),v=D.decode(Ae(l.substring(k+1))))}return G?_&&(X=_):X=null,p(M,_,v),!1}function be(l,h,p){se=l!=null&&l.length>0?l:"java.lang.Exception",ne=h!=null&&h.length>0?h:"No se ha podido extablecer la comunicación entre la aplicación de firma y la página web",p!=g&&p!=null&&p(se,ne)}function ge(l,h){for(var p=ft(h,`
`),C=[],S=0;S<p.length;S++)p[S]&&!lt(p[S])&&C.push(p[S]);C.push("filters=encodedcert:"+l),C.push("headless=true");var M="";if(C.length>0){M=C[0];for(var S=1;S<C.length;S++)M+=`
`+C[S]}return M}function lt(l){return l.indexOf("filters=")==0||l.indexOf("filter=")==0||l.indexOf("filters.")==0||l.indexOf("headless=")==0}function ft(l,h){var p=[];if(l){for(var C=0,S;(S=l.indexOf(h,C))!=-1;)p.push(l.substring(C,S)),C=S+1;p.push(l.substring(C))}return p}var Re=0;function wt(l,h,p,C,S,M){var _=Xe();_||xe("java.lang.Exception","Su navegador no permite obtener el resulado de la operación"),Re=0,setTimeout(He,$,_,h,"op=get&v=1_0&id="+l+"&it=0",p,C,l,S,M)}function He(l,h,p,C,S,M,_,v){if(Ie){be("es.gob.afirma.standalone.ApplicationNotFoundException","AutoFirma no se encuentra instalado en el sistema.",v);return}if(Re>re){be("java.util.concurrent.TimeoutException","El tiempo para la recepcion de la firma por la pagina web ha expirado",v);return}Re++,l.onreadystatechange=function(){if(l.readyState==4)if(l.status==200){var F=it(l.responseText,C,_,v);if(F){var k=Re-1;F=="reset"&&(Re=0),setTimeout(He,$,l,h,p.replace("&it="+k,"&it="+Re),C,S,M,_,v)}}else be("java.lang.Exception","No se pudo conectar con el servidor intermedio para la recuperacion del resultado de la operacion (Status: "+l.status+")",v)};try{l.onerror=function(){be("java.lang.Exception","No se pudo conectar con el servidor intermedio para la recuperacion del resultado de la operacion (Status: "+l.status+")",v)}}catch{}l.open("POST",h,!0),l.setRequestHeader("Content-type","application/x-www-form-urlencoded");try{l.send(p)}catch{be("java.lang.IOException","Ocurrio un error de red en la llamada al servicio de firma",v);return}}function ue(l,h,p){var C=l.indexOf("."),S=l.substr(0,C),M=Ye.des(h,Ye.base64ToString(Ae(l.substr(C+1))),0,0,null);return Ye.stringToBase64(M.substr(0,M.length-parseInt(S)-(p?0:8)))}function Qe(l,h){var p=Ye.base64ToString(Ae(l)),C=(8-p.length%8)%8;return C+"."+Ye.stringToBase64(Ye.des(h,p,1,0,null)).replace(/\+/g,"-").replace(/\//g,"_")}function Ae(l){return l&&l.replace(/\-/g,"+").replace(/\_/g,"/")}return{echo:at,setKeyStore:q,sign:De,coSign:et,counterSign:tt,signBatchJSON:yt,signBatchXML:vt,selectCertificate:N,saveDataToFile:xt,signAndSaveToFile:gt,getFileNameContentBase64:bt,getMultiFileNameContentBase64:rt,setServlets:Tt,setStickySignatory:Ot,setLocale:It,getErrorMessage:Ct,getErrorType:kt,getCurrentLog:St}};return{VERSION:s,CHECKTIME_NO:Ne,CHECKTIME_RECOMMENDED:pt,CHECKTIME_OBLIGATORY:mt,JAVA_ARGUMENTS:I,SYSTEM_PROPERTIES:oe,setForceAFirma:Yt,cargarMiniApplet:Nt,echo:ho,setJnlpService:Gt,isJNLP:Jt,needNativeAppInstalled:Kt,KEYSTORE_WINDOWS:$e,KEYSTORE_APPLE:Le,KEYSTORE_PKCS12:V,KEYSTORE_PKCS11:Ue,KEYSTORE_MOZILLA:ve,KEYSTORE_SHARED_NSS:Y,KEYSTORE_JAVA:w,KEYSTORE_JCEKS:Ke,KEYSTORE_JAVACE:ee,KEYSTORE_DNIE:Q,AUTOFIRMA_LAUNCHING_TIME:At,AUTOFIRMA_CONNECTION_RETRIES:ht,cargarAppAfirma:Nt,sign:Qt,coSign:Zt,cosign:eo,counterSign:to,createBatch:ao,addDocumentToBatch:so,setLocalBatchProcess:no,signBatchProcess:io,signBatch:ro,selectCertificate:zt,signAndSaveToFile:oo,getCurrentLog:mo,saveDataToFile:uo,getFileNameContentBase64:fo,getMultiFileNameContentBase64:po,checkTime:Pt,setKeyStore:Wt,setForceWSMode:Ht,setServlets:yo,setPortRange:xo,setStickySignatory:Ot,setLocale:It,setMinimumClientVersion:Bt,getErrorMessage:go,getErrorType:vo,getBase64FromText:lo,getTextFromBase64:co,downloadRemoteData:qt,isAndroid:ae.isAndroid,isIOS:ae.isIOS}}(window,void 0),D={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_keyStr_URL_SAFE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",encode:function(r,e){var s=e==!0?this._keyStr_URL_SAFE:this._keyStr,x="",I,oe,E,Z,te,de,G,a=0;for(r=D._utf8_encode(r);a<r.length;)I=r.charCodeAt(a++),oe=r.charCodeAt(a++),E=r.charCodeAt(a++),Z=I>>2,te=(I&3)<<4|oe>>4,de=(oe&15)<<2|E>>6,G=E&63,isNaN(oe)?de=G=64:isNaN(E)&&(G=64),x=x+s.charAt(Z)+s.charAt(te)+s.charAt(de)+s.charAt(G);return x},encodeArrayBuffer:function(r,e){for(var s=new Uint8Array(r),x=s.length,I=new Array(x);x--;)I[x]=String.fromCharCode(s[x]);return e?window.btoa(I.join("")).replace("+","-").replace("/","_"):window.btoa(I.join(""))},encodeByteArray:function(r,e){for(var s=e==!0?this._keyStr_URL_SAFE:this._keyStr,x=[],I=0;I<r.length;I+=3){var oe=r[I],E=I+1<r.length,Z=E?r[I+1]:0,te=I+2<r.length,de=te?r[I+2]:0,G=oe>>2,a=(oe&3)<<4|Z>>4,ce=(Z&15)<<2|de>>6,Ge=de&63;te||(Ge=64,E||(ce=64)),x.push(s.charAt(G),s.charAt(a),s.charAt(ce),s.charAt(Ge))}return x.join("")},decode:function(r,e){var s=e==!0?this._keyStr_URL_SAFE:this._keyStr,x="",I,oe,E,Z,te,de,G,a=0;for(r=e==!0?r.replace(/[^A-Za-z0-9\-\_\=]/g,""):r.replace(/[^A-Za-z0-9\+\/\=]/g,"");a<r.length;)Z=s.indexOf(r.charAt(a++)),te=s.indexOf(r.charAt(a++)),de=s.indexOf(r.charAt(a++)),G=s.indexOf(r.charAt(a++)),I=Z<<2|te>>4,oe=(te&15)<<4|de>>2,E=(de&3)<<6|G,x=x+String.fromCharCode(I),de!=64&&(x=x+String.fromCharCode(oe)),G!=64&&(x=x+String.fromCharCode(E));return x=D._utf8_decode(x),x},_utf8_encode:function(r){r=r.replace(/\r\n/g,`
`);for(var e="",s=0;s<r.length;s++){var x=r.charCodeAt(s);x<128?e+=String.fromCharCode(x):x>127&&x<2048?(e+=String.fromCharCode(x>>6|192),e+=String.fromCharCode(x&63|128)):(e+=String.fromCharCode(x>>12|224),e+=String.fromCharCode(x>>6&63|128),e+=String.fromCharCode(x&63|128))}return e},_utf8_decode:function(r){for(var e="",s=0,x=0,I=0;s<r.length;)if(x=r.charCodeAt(s),x<128)e+=String.fromCharCode(x),s++;else if(x>191&&x<224)I=r.charCodeAt(s+1),e+=String.fromCharCode((x&31)<<6|I&63),s+=2;else{I=r.charCodeAt(s+1);var oe=r.charCodeAt(s+2);e+=String.fromCharCode((x&15)<<12|(I&63)<<6|oe&63),s+=3}return e}},Ye={tableStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",tableStr_URL_SAFE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",des:function(r,e,s,x,I,oe){var E=new Array(16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756),Z=new Array(-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344),te=new Array(520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584),de=new Array(8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928),G=new Array(256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080),a=new Array(536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312),ce=new Array(2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154),Ge=new Array(268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696),Pe=Ye.des_createKeys(r),fe=0,$e,Le,V,Ue,ve,Y,w,Ke,ee,Q,Ne,pt,mt,At,ht=e.length,ct=0,Fe=Pe.length==32?3:9;Fe==3?Ke=s?new Array(0,32,2):new Array(30,-2,-2):Ke=s?new Array(0,32,2,62,30,-2,64,96,2):new Array(94,62,-2,32,64,2,30,-2,-2),oe==2?e+="        ":oe==1?(V=8-ht%8,e+=String.fromCharCode(V,V,V,V,V,V,V,V),V==8&&(ht+=8)):oe||(e+="\0\0\0\0\0\0\0\0");var Ze="",_e="";for(x==1&&(ee=I.charCodeAt(fe++)<<24|I.charCodeAt(fe++)<<16|I.charCodeAt(fe++)<<8|I.charCodeAt(fe++),Ne=I.charCodeAt(fe++)<<24|I.charCodeAt(fe++)<<16|I.charCodeAt(fe++)<<8|I.charCodeAt(fe++),fe=0);fe<ht;){for(Y=e.charCodeAt(fe++)<<24|e.charCodeAt(fe++)<<16|e.charCodeAt(fe++)<<8|e.charCodeAt(fe++),w=e.charCodeAt(fe++)<<24|e.charCodeAt(fe++)<<16|e.charCodeAt(fe++)<<8|e.charCodeAt(fe++),x==1&&(s?(Y^=ee,w^=Ne):(Q=ee,pt=Ne,ee=Y,Ne=w)),V=(Y>>>4^w)&252645135,w^=V,Y^=V<<4,V=(Y>>>16^w)&65535,w^=V,Y^=V<<16,V=(w>>>2^Y)&858993459,Y^=V,w^=V<<2,V=(w>>>8^Y)&16711935,Y^=V,w^=V<<8,V=(Y>>>1^w)&1431655765,w^=V,Y^=V<<1,Y=Y<<1|Y>>>31,w=w<<1|w>>>31,Le=0;Le<Fe;Le+=3){for(mt=Ke[Le+1],At=Ke[Le+2],$e=Ke[Le];$e!=mt;$e+=At)Ue=w^Pe[$e],ve=(w>>>4|w<<28)^Pe[$e+1],V=Y,Y=w,w=V^(Z[Ue>>>24&63]|de[Ue>>>16&63]|a[Ue>>>8&63]|Ge[Ue&63]|E[ve>>>24&63]|te[ve>>>16&63]|G[ve>>>8&63]|ce[ve&63]);V=Y,Y=w,w=V}Y=Y>>>1|Y<<31,w=w>>>1|w<<31,V=(Y>>>1^w)&1431655765,w^=V,Y^=V<<1,V=(w>>>8^Y)&16711935,Y^=V,w^=V<<8,V=(w>>>2^Y)&858993459,Y^=V,w^=V<<2,V=(Y>>>16^w)&65535,w^=V,Y^=V<<16,V=(Y>>>4^w)&252645135,w^=V,Y^=V<<4,x==1&&(s?(ee=Y,Ne=w):(Y^=Q,w^=pt)),_e+=String.fromCharCode(Y>>>24,Y>>>16&255,Y>>>8&255,Y&255,w>>>24,w>>>16&255,w>>>8&255,w&255),ct+=8,ct==512&&(Ze+=_e,_e="",ct=0)}return Ze+_e},des_createKeys:function(r){for(var e=new Array(0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964),s=new Array(0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697),x=new Array(0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272),I=new Array(0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144),oe=new Array(0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256),E=new Array(0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488),Z=new Array(0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746),te=new Array(0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568),de=new Array(0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578),G=new Array(0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488),a=new Array(0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800),ce=new Array(0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744),Ge=new Array(0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128),Pe=new Array(0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261),fe=r.length>8?3:1,$e=new Array(32*fe),Le=new Array(0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0),V,Ue,ve=0,Y=0,w,Ke=0;Ke<fe;Ke++){var ee=r.charCodeAt(ve++)<<24|r.charCodeAt(ve++)<<16|r.charCodeAt(ve++)<<8|r.charCodeAt(ve++),Q=r.charCodeAt(ve++)<<24|r.charCodeAt(ve++)<<16|r.charCodeAt(ve++)<<8|r.charCodeAt(ve++);w=(ee>>>4^Q)&252645135,Q^=w,ee^=w<<4,w=(Q>>>-16^ee)&65535,ee^=w,Q^=w<<-16,w=(ee>>>2^Q)&858993459,Q^=w,ee^=w<<2,w=(Q>>>-16^ee)&65535,ee^=w,Q^=w<<-16,w=(ee>>>1^Q)&1431655765,Q^=w,ee^=w<<1,w=(Q>>>8^ee)&16711935,ee^=w,Q^=w<<8,w=(ee>>>1^Q)&1431655765,Q^=w,ee^=w<<1,w=ee<<8|Q>>>20&240,ee=Q<<24|Q<<8&16711680|Q>>>8&65280|Q>>>24&240,Q=w;for(var Ne=0;Ne<Le.length;Ne++)Le[Ne]?(ee=ee<<2|ee>>>26,Q=Q<<2|Q>>>26):(ee=ee<<1|ee>>>27,Q=Q<<1|Q>>>27),ee&=-15,Q&=-15,V=e[ee>>>28]|s[ee>>>24&15]|x[ee>>>20&15]|I[ee>>>16&15]|oe[ee>>>12&15]|E[ee>>>8&15]|Z[ee>>>4&15],Ue=te[Q>>>28]|de[Q>>>24&15]|G[Q>>>20&15]|a[Q>>>16&15]|ce[Q>>>12&15]|Ge[Q>>>8&15]|Pe[Q>>>4&15],w=(Ue>>>16^V)&65535,$e[Y++]=V^w,$e[Y++]=Ue^w<<16}return $e},stringToBase64:function(r){for(var e="",s=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"),x=0;x<r.length;x++)e+=s[r.charCodeAt(x)>>4]+s[r.charCodeAt(x)&15];var I,oe=e.replace(/\r|\n/g,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ");e="";try{I=String.fromCharCode.apply(null,oe)}catch{for(var I="",x=0,E=oe.length;x<E;x++)I+=String.fromCharCode(oe[x])}return Ye.btoa(I,null)},base64ToString:function(r){for(var e=new Array("A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"),s=new Object,x=0;x<e.length;x++)s[e[x]]=x;s["="]=0;var I="",oe,E,Z,te,de=r.length;r+="====";for(var x=0;x<de;x+=4)oe=r.charAt(x),E=r.charAt(x+1),Z=r.charAt(x+2),te=r.charAt(x+3),I+=String.fromCharCode(s[oe]<<2&255|s[E]>>4),Z!="="&&(I+=String.fromCharCode(s[E]<<4&255|s[Z]>>2)),te!="="&&(I+=String.fromCharCode(s[Z]<<6&255|s[te]));return I},btoa:function(r,e){for(var s=(e==!0?Ye.tableStr_URL_SAFE:Ye.tableStr).split(""),x=0,I=0,oe=r.length/3,E=[];x<oe;++x){var Z=r.charCodeAt(I++),te=r.charCodeAt(I++),de=r.charCodeAt(I++);if((Z|te|de)>255)throw new Error("String contains an invalid character");E[E.length]=s[Z>>2]+s[Z<<4&63|te>>4]+(isNaN(te)?"=":s[te<<2&63|de>>6])+(isNaN(te+de)?"=":s[de&63])}return E.join("")}};const me=r=>(Mo("data-v-e3d8a268"),r=r(),Po(),r),Uo={class:"no-imprimir"},jo={class:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight"},Vo={class:"py-12"},qo={class:"max-w-10xl mx-auto sm:px-6 lg:px-24"},Ho={class:"card"},Bo={class:"md:flex justify-between items-center"},Ko={class:"flex flex-col md:flex-row justify-start items-center"},Jo={class:"flex flex-wrap justify-start items-center"},Yo={class:"relative inline-block w-50 flex justify-between"},Go=["disabled"],Xo={class:"font-bold text-lg"},Wo={key:0,class:"pi pi-plus mr-2"},zo=["disabled"],Qo=me(()=>t("i",{class:"pi pi-eye mr-2"},null,-1)),Zo={class:"flex items-center"},er={id:"app",class:"relative inline-block w-50 ml-2"},tr={class:"flex"},or=me(()=>t("i",{class:"pi pi-plus mr-2"},null,-1)),rr={key:0,class:"split-button-container ml-2"},ar={class:"split-button-container ml-2"},sr=me(()=>t("hr",{class:"linea-grosor mt-5"},null,-1)),nr={class:"selector flex flex-col md:flex-row justify-between mt-5 ml-12"},ir={class:"showCustomer mt-12"},lr={class:"grid md:grid-cols-1 text-m gap-y-1"},cr={class:"flex items-center justify-between w-full"},dr={key:0,class:"font-semibold whitespace-nowrap mr-3"},ur={key:1,class:"font-semibold mr-3 flex-shrink-0 w-32"},fr={class:"text-gray-700 w-full font-bold text-lg"},pr={class:"relative w-full mr-20"},mr={class:"flex items-center justify-between w-full"},hr={class:"font-semibold mr-3 flex-shrink-0 w-32"},gr={class:"text-gray-700 w-full uppercase"},vr={class:"flex items-center justify-between w-full"},yr={class:"font-semibold mr-3 flex-shrink-0 w-32"},xr={class:"text-gray-700 w-full"},br={class:"flex items-center justify-between w-full"},Cr={class:"font-semibold mr-3 flex-shrink-0 w-32"},kr={class:"text-gray-700 w-full"},Sr={class:"flex items-center justify-between w-full"},Tr={class:"font-semibold mr-3 flex-shrink-0 w-32"},wr={key:0,class:"text-gray-700 w-full"},Ar={class:"grid md:grid-cols-1 text-sm gap-y-1 mr-28"},Er={class:"flex items-center cursor-pointer justify-end max-w-xs ml-auto"},Or={class:"text-m font-medium text-gray-900 dark:text-gray-300 flex-shrink-0"},Ir=me(()=>t("div",{class:"relative w-11 h-6 ml-3 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"},null,-1)),_r={class:"flex items-center justify-end w-full mt-4"},Dr={class:"font-semibold mr-4 flex-shrink-0"},Rr={class:"input-wrapper"},Mr=["min"],Pr={class:"flex items-center"},Nr={class:"font-semibold mr-8 min-w-20 flex-shrink-0"},Fr={class:"relative w-full"},$r={key:0,class:"input-wrapper"},Lr={class:"font-bold flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none"},Ur={class:"flex items-center justify-between w-full"},jr={class:"font-semibold mr-3 flex-shrink-0"},Vr={class:"input-wrapper"},qr={class:"flex items-center justify-between w-full"},Hr={class:"font-semibold mr-3 flex-shrink-0"},Br={class:"input-wrapper"},Kr=["min"],Jr={class:"flex items-center justify-between"},Yr={class:"flex items-center"},Gr=me(()=>t("div",{class:"flex-grow"},null,-1)),Xr={class:"relative rounded-md shadow-sm"},Wr=["placeholder"],zr=me(()=>t("div",{class:"absolute inset-y-0 right-0 flex items-center pr-3"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"})])],-1)),Qr={class:"relative text-gray-600"},Zr={key:0,class:"flex justify-end mt-4 pr-4"},ea={class:"hidden md:flex justify-between mt-4 pr-4 mb-4"},ta={class:"totals-container w-1/3"},oa={class:"ml-4 totals p-4 rounded-md"},ra={class:"w-full"},aa={class:"text-gray-600 pr-4"},sa={class:"text-gray-600 pr-4"},na={class:"relative w-full ml-4"},ia={class:"flex items-center pointer-events-none"},la={class:"absolute inset-y-0 right-0 flex items-center pr-3"},ca=me(()=>t("tr",null,[t("td",{colspan:"2"},[t("hr",{class:"my-2 border-gray-300"})])],-1)),da={class:"text-gray-600 pr-4"},ua={key:0},fa={key:1},pa={key:2},ma={key:3},ha={class:"pl-4"},ga={key:0},va={key:1},ya={key:2},xa={key:3},ba=me(()=>t("div",{class:"w-1/12"},null,-1)),Ca={class:"totals-container w-1/3"},ka={class:"totals p-4 rounded-md"},Sa={class:"w-full"},Ta={class:"text-gray-600 pr-4"},wa={class:"pl-4"},Aa=me(()=>t("hr",{class:"my-2 border-gray-300"},null,-1)),Ea={class:"text-gray-600 pr-4"},Oa={class:"pl-4"},Ia=me(()=>t("hr",{class:"my-2 border-gray-300"},null,-1)),_a={class:"text-gray-600 pr-4"},Da={class:"pl-4"},Ra={class:"flex flex-wrap justify-between mt-4 pr-4 mb-4 md:hidden"},Ma={class:"totals-container w-full md:w-1/3 flex flex-col mb-4 md:mb-0"},Pa=me(()=>t("i",{class:"pi pi-plus"},null,-1)),Na={class:"ml-4 totals p-4 rounded-md flex-grow"},Fa={class:"w-full"},$a={class:"text-gray-600 pr-4"},La={class:"pl-4"},Ua=me(()=>t("tr",null,[t("td",{colspan:"2"},[t("hr",{class:"my-2 border-gray-300"})])],-1)),ja={class:"text-gray-600 pr-4"},Va={key:0},qa={key:1},Ha={key:2},Ba={key:3},Ka={class:"pl-4"},Ja={key:0},Ya={key:1},Ga={key:2},Xa={key:3},Wa=me(()=>t("div",{class:"hidden md:block w-1/12"},null,-1)),za={class:"totals-container w-full md:w-1/3 flex flex-col"},Qa={class:"ml-4 totals bg-gray-100 p-4 rounded-md flex-grow"},Za={class:"w-full"},es={class:"text-gray-600 pr-4"},ts={class:"pl-4"},os={class:"text-gray-600 pr-4"},rs={class:"pl-4"},as={class:"text-gray-600 pr-4"},ss={class:"pl-4"},ns={style:{display:"flex","flex-direction":"column"}},is=["placeholder"],ls={style:{display:"flex","justify-content":"flex-end","margin-top":"8px"}},cs={for:"name",class:"block text-sm font-medium text-gray-900 dark:text-white"},ds={key:0,class:"flex align-items-center"},us={class:"flex align-items-center"},fs={for:"name",class:"block text-sm font-medium text-gray-900 dark:text-white"},ps={key:0,class:"flex align-items-center"},ms={class:"flex align-items-center"},hs={for:"name",class:"block text-sm font-medium text-gray-900 dark:text-white"},gs={key:0,class:"flex align-items-center"},vs={class:"flex align-items-center"},ys={class:"confirmation-content"},xs=me(()=>t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),bs={key:0},Cs={class:"confirmation-content"},ks=me(()=>t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),Ss={key:0},Ts={key:0,class:"flex align-items-center"},ws={class:"flex align-items-center"},As={class:"grid gap-3 md:grid-cols-1 justify-items"},Es={class:"flex justify-between"},Os=me(()=>t("i",{class:"pi pi-plus"},null,-1)),Is={for:"name",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},_s={key:0,class:"flex items-center"},Ds={class:"flex items-center"},Rs={key:0,for:"name",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},Ms={key:0,class:"flex items-center"},Ps={class:"flex items-center"},Ns={class:"flex justify-end"},Fs={class:"grid gap-3 mb-6 md:grid-cols-2"},$s={for:"name",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},Ls=["placeholder","required"],Us={for:"tax_number",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},js=["placeholder","required"],Vs={class:"mb-6"},qs={for:"address",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},Hs=["placeholder","required"],Bs={class:"grid gap-3 mb-6 md:grid-cols-2"},Ks={for:"town",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},Js=["placeholder","required"],Ys={for:"province",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},Gs=["placeholder","required"],Xs={for:"post_code",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},Ws=["placeholder","required"],zs={for:"country",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},Qs=["placeholder","required"],Zs={for:"email",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},en=["placeholder","required"],tn={for:"phone",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},on=["placeholder","required"],rn={class:"grid gap-3 md:grid-cols-1 justify-items-end"},an={type:"submit",class:"text-white bg-blue-600 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"},sn={class:"imprimir"},nn={class:"invoice"},ln={class:"invoice-header"},cn=me(()=>t("div",{class:"logo"},[t("img",{src:"https://d1csarkz8obe9u.cloudfront.net/posterpreviews/company-logo-design-template-e089327a5c476ce5c70c74f7359c5898_screen.jpg?ts=1672291305",alt:"Logo de la empresa"})],-1)),dn={class:"invoice_details"},un={class:"invoice-info"},fn={class:"company-details"},pn={class:"name"},mn=me(()=>t("br",null,null,-1)),hn={class:"customer-details"},gn={class:"name"},vn=me(()=>t("br",null,null,-1)),yn={class:"invoice-table"},xn={class:"header"},bn={class:"table-break"},Cn={class:"table-container"},kn={class:"totals"},Sn={class:"title"},Tn={class:"title"},wn={class:"title"},An={class:"bank"},En={class:"text-gray-600 pr-4"},On={key:0},In={key:1},_n={key:2},Dn={key:3},Rn={class:"pl-4"},Mn={key:0},Pn={key:1},Nn={key:2},Fn={key:3},$n={components:{TableDocumentSelector:jt},data(){return{itemsSave:[{label:this.$t("Guardar y crear nueva"),icon:"pi pi-refresh",command:()=>this.saveAndReset()},{label:this.$t("Cancelar"),command:()=>this.cancelInvoice()}],itemsExport:[{label:this.$t("Exportar a PDF"),icon:"pi pi-file-pdf",command:()=>this.exportToPDF()},{label:this.$t("Exportar a XML"),icon:"pi pi-file-o",command:()=>this.exportToXML()}],taxMap:new Map,today:new Date,fecha:"",fechaPaid:"",expiration:"",fechaFormateada:"",loading:!0,isSaving:!1,isChecked:!1,isMobileMenuOpen:!1,showTable:!1,isDropdownOpen:!1,saveRestart:!1,taxTypes:[],taxValues:[],taxOptions:[{label:"0",value:0},{label:"4",value:4},{label:"5",value:5},{label:"7",value:7},{label:"8",value:8},{label:"10",value:10},{label:"16",value:16},{label:"18",value:18},{label:"21",value:21}],paymentMethods:[{id:1},{id:2},{id:3},{id:4}],imageUrl:"https://placehold.co/300x300/e2e8f0/e2e8f0",companies:null,customers:null,types:[],series:[],serie:"",counter:"",updateDate:!1,showButton:!1,productDialog:!1,documentDialog:!1,customerDialog:!1,deleteProductDialog:!1,deleteProductsDialog:!1,selectACustomerDialog:!1,selectAPaymentMethodDialog:!1,documentListDialog:!1,descriptionDialog:!1,selectedDescription:"",productDescription:"",options:[],concepts:[],selectedBankAccount:[],selectedEmail:[],selectedPhone:[],products:[],selectedCompany:[],selectedCustomer:[],selectedType:[],selectedSerie:[],emails:[],phones:[],selectedProducts:[],selectedPaymentMethod:[],selectedPaymentSystemId:"",filters:{},submitted:!1,myDocument:{document_counter:"",number:"",company_id_company:"",company_id_customer:"",documents_type_id:"",documents_series_id:"",payment_system_id:"",expiration:"",date:"",date_paid:"",amount:"",payment_methods_id:"",totalTax:"",subTotal:"",paid:!1,invoiced:!1,isReceived:!1,concept:[]},customer:{id:"",name:"",tax_number:"",email:"",phone:"",address:"",post_code:"",town:"",province:"",country:""},company:{id:"",name:"",tax_number:"",email:"",phone:"",address:"",post_code:"",town:"",province:"",country:"",documentId:""}}},computed:{charCount(){return this.selectedDescription===null?"":this.selectedDescription.length},dynamicOptionLabel(){switch(this.selectedPaymentMethod.id){case 1:case 7:return"complete_bank_account";case 3:return"phone";case 4:return"email";default:return""}},isDropdownHidden(){return this.dynamicOptionLabel===""},subtotal(){return this.products.reduce((r,e)=>r+e.subTotal,0)},totalIVA(){return this.products.reduce((r,e)=>r+e.priceTax,0)},totalConIVA(){return this.subtotal+this.totalIVA}},async created(){this.filters={global:{value:null,matchMode:Do.CONTAINS}},this.isChecked=this.$page.props.isChecked,this.fecha=await this.getDate(),this.fechaPaid=await this.getDate(),this.expiration=await this.getExpirationDate()},async mounted(){await this.fetchCompanies(),await this.fetchCustomers(),await this.fetchPayments(),this.isChecked?(this.selectedType.id=1,this.selectedType.name="Factura",this.selectedSerie=[]):await this.fetchDocuments()},watch:{fecha(r){this.validateDate()},selectedPaymentMethod(r){console.log("PaymentId "+r.id),this.handlePaymentMethodChange(r)},selectedOption(r){if(r)switch(this.selectedPaymentMethod.id){case 1:case 7:this.selectedBankAccount=r,this.selectedPaymentSystemId=r.id;break;case 3:this.selectedPhone=r,this.selectedPaymentSystemId=r.id;break;case 4:this.selectedEmail=r,this.selectedPaymentSystemId=r.id;break;default:this.selectedPaymentSystemId="";break}}},methods:{validateDate(){new Date(this.fecha)>new Date(this.expiration)&&(alert("La fecha seleccionada no puede ser mayor que la fecha de vencimiento."),this.fecha=this.getDate(),this.expiration=this.getExpirationDate(),this.fechaPaid=this.fecha)},openDescriptionDialog(r){this.productDescription=r,this.selectedDescription=r.description,this.descriptionDialog=!0},saveDescription(){this.selectedDescription===null||this.selectedDescription.length<=255?(this.products.forEach(r=>{this.productDescription.id===r.id&&(r.description=this.selectedDescription)}),this.descriptionDialog=!1,this.selectedDescription=""):this.$toast(this.$t("Too many characters, need to be 255 at maximum"),"error")},async handlePaymentMethodChange(r){switch(r.id){case 1:console.log("handlePaymentMethodChange 1"),this.selectedPaymentMethod.name="Transferencia",await this.fetchBanks(),console.log("handlePayment "+this.selectedBankAccount.id);break;case 2:console.log("handlePaymentMethodChange 2"),this.selectedPaymentMethod.name="Efectivo";break;case 3:console.log("handlePaymentMethodChange 3"),this.selectedPaymentMethod.name="Bizum",await this.fetchPhones();break;case 4:console.log("handlePaymentMethodChange 4"),this.selectedPaymentMethod.name="Paypal",await this.fetchEmails();break;case 5:console.log("handlePaymentMethodChange 5"),this.selectedPaymentMethod.name="Tarjeta";break;case 6:console.log("handlePaymentMethodChange 6"),this.selectedPaymentMethod.name="Cheque";break;case 7:console.log("handlePaymentMethodChange 7"),this.selectedPaymentMethod.name="Domiciliación",await this.fetchBanks();break}},async handleDocumentSelected(r){r&&(this.documentListDialog=!1),this.company=this.selectedCompany,this.company.documentId=r;const e=await axios.get("/documents-show/"+this.company.id+"/"+this.company.documentId);if(e){this.myDocument=e.data.documents,this.fecha=this.myDocument.date,this.expiration=this.myDocument.expiration,this.selectedType.name=this.myDocument.document_type_name,this.selectedType.id=this.myDocument.documents_type_id,this.selectedSerie.id=this.myDocument.documents_series_id,this.selectedSerie.serie=this.myDocument.document_series_serie,this.selectedPaymentSystemId=this.myDocument.payment_system_id,this.selectedPaymentMethod.id=this.myDocument.payment_methods_id;let x=this.myDocument.number.replace(this.selectedSerie.serie,"");this.selectedSerie.number=x,this.myDocument.paid===0?(this.fechaPaid=await this.getDate(),this.myDocument.paid=!1):(this.fechaPaid=this.myDocument.date_paid,this.myDocument.paid=!0),this.selectedCompany=e.data.company,this.selectedCustomer=e.data.customer,this.concepts=e.data.concepts,this.products=e.data.concepts;for(let I=0;I<this.concepts.length;I++)this.products[I].taxes=parseFloat(this.concepts[I].tax);this.selectedPaymentMethod=[],this.selectedPaymentMethod.id=this.myDocument.payment_methods_id}else this.$toast(this.$t("Error connecting to the server"),"error")},async fetchBanks(){try{const r=await axios.get("/banks/"+this.selectedCompany.id);this.banks=r.data.accounts,console.log("this.banks"),console.log(this.banks),this.selectedBankAccount=await this.changePaymentMethodSystemId(this.banks,this.selectedBankAccount),this.selectedPaymentSystemId=this.selectedBankAccount.id,console.log("selectedBankaccount"),console.log(this.selectedBankAccount),this.options=this.banks}catch(r){this.$toast(this.$t("Error connecting to the server"),"error"),console.log("banks error"),console.log(r)}},async fetchEmails(){try{const r=this.isChecked?`/emails/${this.selectedCustomer.id}`:`/emails/${this.selectedCompany.id}`,e=await axios.get(r);this.emails=e.data.emails,this.selectedEmail=await this.changePaymentMethodSystemId(this.emails,this.selectedEmail),this.options=this.emails}catch{this.$toast(this.$t("Error connecting to the server"),"error")}},async fetchPhones(){try{const r=this.isChecked?`/phones/${this.selectedCustomer.id}`:`/phones/${this.selectedCompany.id}`,e=await axios.get(r);this.phones=e.data.phones,this.selectedPhone=await this.changePaymentMethodSystemId(this.phones,this.selectedPhone),this.options=this.phones}catch{this.$toast(this.$t("Error connecting to the server"),"error")}},async changePaymentMethodSystemId(r,e){if(console.log("Entra al methodSystem"),this.selectedPaymentSystemId!=null){console.log("Entra al methodSystem");const s=r.find(x=>x.id===this.selectedPaymentSystemId);s?(e=s,console.log(e)):(e=r.length>0?r[0]:null,console.log(e))}else e=r.length>0?r[0]:null,console.log(e);return e},async fetchPayments(){const r=this.isChecked?`/payment/${this.selectedCustomer.id}`:`/payment/${this.selectedCompany.id}`,e=await axios.get(r);this.payment_methods=e.data.methods,this.selectedPaymentMethod=this.payment_methods[0],console.log(this.selectedPaymentMethod)},async fetchCompanies(){try{const r=await axios.get("/companies-invoice");this.companies=r.data.companies,this.companies.length===1?(this.selectedCompany=this.companies[0],this.companyId=this.selectedCompany.id):this.selectedCompany=this.companies[0],this.loading=!1}catch(r){console.error("Error fetching data:",r),this.loading=!1}},async fetchCustomers(){try{const r=this.isChecked?`/providers/${this.selectedCompany.id}`:`/customers/${this.selectedCompany.id}`,e=await axios.get(r);this.isChecked?this.customers=e.data.providers:this.customers=e.data.customers,this.customers.length===1&&(this.selectedCustomer=this.customers[0]),this.loading=!1}catch(r){console.error("Error fetching data:",r),this.loading=!1}},hideDialog(){this.selectACustomerDialog=!1,this.selectAPaymentMethodDialog=!1,this.customerDialog=!1,this.submitted=!1},openNew(){this.selectACustomerDialog=!1,this.customer={companyID:this.selectedCompany.id},this.submitted=!1,this.customerDialog=!0},selectACustomer(){this.selectACustomerDialog=!0},selectAProvider(){this.selectACustomerDialog=!0},selectAPaymentMethod(){this.selectAPaymentMethodDialog=!0},saveCustomer(){let r;this.isChecked?r=axios.post("/provider",this.customer):r=axios.post("/customer",this.customer),r.then(e=>{this.customer.id=e.data.companyId,this.selectedCustomer=this.customer}).catch(e=>{console.error("Error:",e),this.customerDialog=!1}),this.customerDialog=!1},async handleCompanySelection(){this.selectedCustomer=[];try{const r=await axios.get("/customers/"+this.selectedCompany.id);await this.fetchDocuments(),await this.fetchPayments(),this.customers=r.data.customers,this.customers.length===1&&(this.selectedCustomer=this.customers[0])}catch(r){console.error("Error fetching phone data:",r)}},async fetchDocuments(){await axios.get("/documents-type").then(r=>(this.types=r.data.types,this.selectedType=this.types[0],axios.get("/documents-serie/"+this.selectedType.id+"/"+this.selectedCompany.id))).catch(r=>{console.error("Error fetching phone data:",r)}).then(r=>{r&&(this.series=r.data.series,this.selectedSerie=this.series[0])}).catch(r=>{console.error("Error fetching data:",r),this.loading=!1})},handleListDocument(){this.documentListDialog=!0},handleTypeSelection(){this.selectedSerie=[],axios.get("/documents-serie/"+this.selectedType.id+"/"+this.selectedCompany.id).then(r=>{this.series=r.data.series}).catch(r=>{console.error("Error fetching phone data:",r)})},selectCompany(){this.productDialog=!0},selectDocument(){this.documentDialog=!0},openFileInput(){this.$refs.fileInput.click()},handleFileChange(r){const e=r.target.files[0],s=new FileReader;s.onload=()=>{this.imageUrl=s.result},s.readAsDataURL(e)},addRow(){let r={reference:"",description:"",price:0,quantity:0,discount:0,discount_reason:"Descuento profesional",subtotal:0,taxes:21,priceTax:0,total:0,id:this.products.length+1};this.products.push(r)},saveAndReset(){this.saveRestart=!0,this.checkDocument()},handleClick(){this.$nextTick(()=>{const e=this.$refs.splitButton.$el.querySelector(".p-splitbutton-menubutton");e&&(e.classList.add("no-print"),e.click())})},checkDocument(){this.isChecked?this.saveDocument():axios.get("/documents-serie/"+this.selectedType.id+"/"+this.selectedCompany.id+"/"+this.selectedSerie.serie).then(r=>{if(this.date=r.data.date.date,this.serie=r.data.serie.number,this.selectedSerie.number<=this.serie)switch(prompt(`El número de documento ya existe. ¿Qué deseas hacer?
1. Conservar el número ingresado: ${this.selectedSerie.serie}${this.selectedSerie.number} 
2. Asignar el siguiente valor disponible: ${this.selectedSerie.serie}${++this.serie}`)){case null:this.$toast(this.$t("Operation cancelled."),"error");break;case"1":this.$toast(this.$t("The number entered will be retained: ")+this.selectedSerie.serie+this.selectedSerie.number,"success"),this.serie="",this.saveDocument();break;case"2":this.updateDate=!0,this.selectedSerie.number=this.serie,this.$toast(this.$t("The following available number has been assigned: ")+this.selectedSerie.serie+this.selectedSerie.number,"success"),this.serie="",this.saveDocument();break;default:this.$toast(this.$t("Invalid input."),"error")}else if(this.date>this.fecha){let e=this.dateFormat(this.date),s=this.dateFormat(this.fecha);switch(prompt(`La fecha seleccionada es anterior a la de la última factura, ¿deseas asignarle la fecha actual?
1. Conservar la fecha seleccionada: ${s} 
2. Asignar la fecha actual: ${e}`)){case null:this.$toast(this.$t("Operation cancelled."),"error");break;case"1":this.$toast(this.$t("The date will be retained: ")+this.fecha,"success"),this.saveDocument();break;case"2":const I=new Date,oe=I.getFullYear(),E=(I.getMonth()+1).toString().padStart(2,"0"),Z=I.getDate().toString().padStart(2,"0");this.fecha=`${oe}-${E}-${Z}`,this.$toast(this.$t("The current date has been assigned."),"success"),this.saveDocument();break;default:this.$toast(this.$t("Invalid input."),"error")}}else this.saveDocument()}).catch(r=>{this.$toast(this.$t("Error saving document data."),"error"),console.log(r)})},myDocumentSave(){this.isChecked?(this.myDocument.number=this.selectedSerie.number,this.myDocument.company_id_company=this.selectedCustomer.id,this.myDocument.company_id_customer=this.selectedCompany.id,this.myDocument.documents_series_id=""):(this.myDocument.number=this.selectedSerie.serie+this.selectedSerie.number,this.myDocument.document_counter=this.selectedSerie.number,this.myDocument.company_id_company=this.selectedCompany.id,this.myDocument.company_id_customer=this.selectedCustomer.id,this.myDocument.documents_series_id=this.selectedSerie.id),this.myDocument.paid?this.myDocument.date_paid=this.fechaPaid:this.myDocument.date_paid="",this.myDocument.isReceived=this.isChecked,this.myDocument.documents_type_id=this.selectedType.id,this.updateDate&&(this.fecha=this.getDate(),this.expiration=this.getExpirationDate()),this.myDocument.expiration=this.expiration,this.myDocument.date=this.fecha,this.updateDate=!1,this.myDocument.payment_methods_id=this.selectedPaymentMethod.id,console.log("selectedPaymentSystemId"),console.log(this.selectedPaymentSystemId),this.myDocument.payment_system_id=this.selectedPaymentSystemId,this.myDocument.document_counter=1,this.myDocument.subTotal=this.subtotal.toFixed(2),this.myDocument.totalTax=this.totalIVA.toFixed(2),this.myDocument.amount=this.totalConIVA.toFixed(2)},saveDocument(){this.myDocumentSave(),this.selectedType.id==1&&(this.myDocument.invoiced=!0),console.log(this.fecha),console.log(this.expiration),this.myDocument.concept=[],this.products.forEach(r=>{try{let e={reference:r.reference,description:r.description,quantity:r.quantity,price:r.price,taxes:r.taxes,discount:r.discount,discount_reason:r.discount_reason,total:this.calculateTotal(r)};this.myDocument.concept.push(e)}catch(e){console.error("Error al crear el objeto newProduct:",e)}}),axios.post("/documents",{documentData:this.myDocument}).then(r=>{this.$toast(this.$t("Invoice saved correctly."),"success"),this.myDocument.concept=[],this.saveRestart&&this.resetData()}).catch(r=>{this.$toast(this.$t("Error saving invoice."),"error"),console.log(r),this.myDocument.concept=[]})},getDate(){const r=this.today.getFullYear(),e=(this.today.getMonth()+1).toString().padStart(2,"0"),s=this.today.getDate().toString().padStart(2,"0");return`${r}-${e}-${s}`},getExpirationDate(){const r=new Date;r.setDate(this.today.getDate()+15);const e=r.getFullYear(),s=(r.getMonth()+1).toString().padStart(2,"0"),x=r.getDate().toString().padStart(2,"0");return`${e}-${s}-${x}`},resetData(){this.isSaving=!0,setTimeout(function(){window.location.reload()},1e3)},calculateGross(r){return r.quantity*r.price},calculateTax(r){return r.priceTax=parseFloat(r.taxes/100*parseFloat(r.subTotal)),r.priceTax},calculateTotal(r){let e=this.calculateTax(r);return r.total=e+parseFloat(r.subTotal),r.total.toFixed(2)},calculateSubtotal(r){let e=parseFloat(r.quantity)*parseFloat(r.price);return r.subTotal=e-r.discount/100*e,r.subTotal},confirmDeleteProduct(r){this.product=r,this.deleteProductDialog=!0},deleteProduct(){this.products=this.products.filter(r=>r.id!==this.product.id),this.product=null,this.deleteProductDialog=!1},confirmDeleteSelected(){this.deleteProductsDialog=!0},deleteSelectedProducts(){this.selectedProducts.forEach(r=>{this.products=this.products.filter(e=>e.id!==r.id)}),this.selectedProducts=[],this.deleteProductsDialog=!1},dateFormat(r){let e=new Date(r),s=e.getDate(),x=e.getMonth()+1,I=e.getFullYear();return s<10&&(s="0"+s),x<10&&(x="0"+x),`${s}/${x}/${I}`},manejarFecha(){let r=this.dateFormat(this.fecha),e=prompt(`La fecha seleccionada (${r}) es anterior a la de la última factura, ¿deseas asignarle la fecha actual?
1. Conservar la fecha seleccionada. 
2. Asignar la fecha actual.`);if(e==="1")console.log("Se conservará la fecha seleccionada:",r);else if(e==="2"){let s=new Date().toISOString().split("T")[0],x=this.dateFormat(s);console.log("Se asignará la fecha actual:",x)}else console.log("Opción no válida.")},calcularImporteBase(r,e){return r<=0?0:e/(r/100)},exportToPDF(){this.myDocumentSave(),this.calculateTaxes().then(()=>{this.showTable=!this.showTable,window.print()}).catch(r=>{this.$toast(this.$t("Could not generate the PDF."),"error")})},addsign(r){Se.setForceWSMode(!0),Se.cargarAppAfirma(),Se.setServlets(window.location.origin+"/afirma-signature-storage/StorageService",window.location.origin+"/afirma-signature-retriever/RetrieveService");function e(){console.log("OK")}function s(){console.log("ERR")}var x=Se.getBase64FromText(r);Se.signAndSaveToFile("sign",x!=null&&x!=null&&x!=""?x:null,"SHA512withRSA","AUTO","",null,e,s)},exportToXML(){this.myDocumentSave(),this.calculateTaxes().then(()=>{this.myDocument.document_counter=1,console.log("contador: "+this.myDocument.document_counter);const r=this.convertToFacturaeXML();this.$toast(this.$t("XML document generated correctly."),"success"),this.addsign(r)})},convertToFacturaeXML(){let r=`<?xml version="1.0" encoding="UTF-8"?>
            <fe:Facturae xmlns:ds="http://www.w3.org/2000/09/xmldsig#" xmlns:fe="http://www.facturae.es/Facturae/2014/v3.2.1/Facturae">
                <FileHeader>
                    <SchemaVersion>3.2.1</SchemaVersion>
                    <Modality>I</Modality>
                    <InvoiceIssuerType>EM</InvoiceIssuerType>
                    <Batch>
                        <BatchIdentifier>${this.selectedCompany.tax_number}${this.selectedSerie.number}${this.selectedSerie.serie}</BatchIdentifier>
                        <InvoicesCount>${this.myDocument.document_counter}</InvoicesCount>
                        <TotalInvoicesAmount>
                            <TotalAmount>${this.myDocument.amount}</TotalAmount>
                        </TotalInvoicesAmount>
                        <TotalOutstandingAmount>
                            <TotalAmount>${this.myDocument.amount}</TotalAmount>
                        </TotalOutstandingAmount>
                        <TotalExecutableAmount>
                            <TotalAmount>${this.myDocument.amount}</TotalAmount>
                        </TotalExecutableAmount>
                        <InvoiceCurrencyCode>EUR</InvoiceCurrencyCode>
                    </Batch>
                </FileHeader> 
                
                <Parties>
                    <SellerParty>
                        <TaxIdentification>
                            <PersonTypeCode>J</PersonTypeCode>
                            <ResidenceTypeCode>R</ResidenceTypeCode>
                            <TaxIdentificationNumber>${this.selectedCompany.tax_number}</TaxIdentificationNumber>
                        </TaxIdentification>
                        <LegalEntity>
                            <CorporateName>${this.selectedCompany.name}</CorporateName>
                            <AddressInSpain>
                                <Address>${this.selectedCompany.address}</Address>
                                <PostCode>${this.selectedCompany.post_code}</PostCode>
                                <Town>${this.selectedCompany.town}</Town>
                                <Province>${this.selectedCompany.province}</Province>
                                <CountryCode>ESP</CountryCode>
                            </AddressInSpain>
                            <ContactDetails>
                                <Telephone>${this.selectedCompany.phone}</Telephone>
                                <ElectronicMail>${this.selectedCompany.email}</ElectronicMail>
                            </ContactDetails>
                        </LegalEntity>
                    </SellerParty>
                    
                    <BuyerParty>
                        <TaxIdentification>
                            <PersonTypeCode>J</PersonTypeCode>
                            <ResidenceTypeCode>R</ResidenceTypeCode>
                            <TaxIdentificationNumber>${this.selectedCustomer.tax_number}</TaxIdentificationNumber>
                        </TaxIdentification>
                        <LegalEntity>
                            <CorporateName>${this.selectedCustomer.name}</CorporateName>
                            <AddressInSpain>
                                <Address>${this.selectedCustomer.address}</Address>
                                <PostCode>${this.selectedCustomer.post_code}</PostCode>
                                <Town>${this.selectedCustomer.town}</Town>
                                <Province>${this.selectedCustomer.province}</Province>
                                <CountryCode>ESP</CountryCode>
                            </AddressInSpain>
                            <ContactDetails>
                                <Telephone>${this.selectedCustomer.phone}</Telephone>
                                <ElectronicMail>${this.selectedCustomer.email}</ElectronicMail>
                            </ContactDetails>
                        </LegalEntity>
                    </BuyerParty> 
                </Parties>
                <Invoices>
                    <Invoice>
                        <InvoiceHeader>
                            <InvoiceNumber>${this.selectedSerie.number}</InvoiceNumber>
                            <InvoiceSeriesCode>${this.selectedSerie.serie}</InvoiceSeriesCode>
                            <InvoiceDocumentType>FC</InvoiceDocumentType>
                            <InvoiceClass>OO</InvoiceClass>
                        </InvoiceHeader>
                        <InvoiceIssueData>
                            <IssueDate>${this.myDocument.date}</IssueDate>
                            <InvoiceCurrencyCode>EUR</InvoiceCurrencyCode>
                            <TaxCurrencyCode>EUR</TaxCurrencyCode>
                            <LanguageName>es</LanguageName>
                        </InvoiceIssueData>
                        <TaxesOutputs>
`;return this.taxMap.forEach((e,s)=>{r+=`  <Tax>
`,r+=`    <TaxTypeCode>01</TaxTypeCode>
`,r+=`    <TaxRate>${parseFloat(s).toFixed(2)}</TaxRate>
`,r+=`    <TaxableBase>
`,r+=`      <TotalAmount>${this.calcularImporteBase(s,e).toFixed(2)}</TotalAmount>
`,r+=`    </TaxableBase>
`,r+=`    <TaxAmount>
`,r+=`      <TotalAmount>${e.toFixed(2)}</TotalAmount>
`,r+=`    </TaxAmount>
`,r+=`  </Tax>
`}),r+=`</TaxesOutputs>
                        <InvoiceTotals>
                            <TotalGrossAmount>${this.subtotal.toFixed(2)}</TotalGrossAmount>
                            <TotalGeneralDiscounts>0.0</TotalGeneralDiscounts>
                            <TotalGeneralSurcharges>0.0</TotalGeneralSurcharges>
                            <TotalGrossAmountBeforeTaxes>${this.subtotal.toFixed(2)}</TotalGrossAmountBeforeTaxes>
                            <TotalTaxOutputs>${this.totalIVA.toFixed(2)}</TotalTaxOutputs>
                            <TotalTaxesWithheld>0.0</TotalTaxesWithheld>
                            <InvoiceTotal>${this.myDocument.amount}</InvoiceTotal>
                            <TotalOutstandingAmount>${this.myDocument.amount}</TotalOutstandingAmount>
                            <TotalExecutableAmount>${this.myDocument.amount}</TotalExecutableAmount>
                        </InvoiceTotals>
                        <Items>`,this.products.forEach(e=>{r+=`
                    <InvoiceLine>
                        <ItemDescription>${e.description}</ItemDescription>
                        <Quantity>${e.quantity}</Quantity>
                        <UnitOfMeasure>01</UnitOfMeasure>
                        <UnitPriceWithoutTax>${e.price}</UnitPriceWithoutTax>
                        <TotalCost>${e.quantity*e.price}</TotalCost>
                        <DiscountsAndRebates>
                            <Discount>
                                <DiscountReason>${e.discount_reason}</DiscountReason>
                                <DiscountRate>${parseFloat(e.discount).toFixed(1)}</DiscountRate>
                                <DiscountAmount>${(e.quantity*e.price*(e.discount/100)).toFixed(1)}</DiscountAmount>
                            </Discount>
                        </DiscountsAndRebates>
                        <GrossAmount>${e.subTotal}</GrossAmount>
                        <TaxesOutputs>
                            <Tax>
                                <TaxTypeCode>01</TaxTypeCode>
                                <TaxRate>${e.taxes}</TaxRate>
                                <TaxableBase>
                                    <TotalAmount>${e.subTotal}</TotalAmount>
                                </TaxableBase>
                                <TaxAmount>
                                    <TotalAmount>${e.priceTax.toFixed(2)}</TotalAmount>
                                </TaxAmount>
                            </Tax>
                        </TaxesOutputs>
                    </InvoiceLine>`}),r+=`
                        </Items>
                    </Invoice>
                </Invoices>
            </fe:Facturae>`,r},cancelInvoice(){confirm("¿Está seguro? Los datos de esta factura serán descartados")&&this.resetData()},calculateTaxes(){return new Promise((r,e)=>{try{this.taxMap.clear(),this.products.forEach(s=>{let x=s.taxes,I=parseFloat(s.priceTax);if(this.taxMap.has(x)){let oe=this.taxMap.get(x);this.taxMap.set(x,oe+I)}else this.taxMap.set(x,I)}),r()}catch(s){e(s)}})}}},Ln=Object.assign($n,{__name:"Document",setup(r){return(e,s)=>{const x=To,I=_o,oe=Io,E=wo,Z=Ao,te=Eo,de=Oo,G=So;return H(),K(Mt,null,[t("div",Uo,[j(No,{title:"Document"},{header:W(()=>[t("h2",jo,c(e.$t("New invoice")),1)]),default:W(()=>[t("div",Vo,[t("div",qo,[t("div",{class:We({"border-blue-500 border-2":e.isChecked,"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg":!0})},[t("div",Ho,[t("div",Bo,[t("div",Ko,[t("div",Jo,[t("div",Yo,[!e.loading&&e.companies.length>0?(H(),K("button",{key:0,type:"button",class:"px-4 py-2 bg-gray-800 hover:bg-gray-900 focus:ring-4 focus:ring-gray-300 font-medium rounded-lg text-white flex items-center",onClick:s[0]||(s[0]=a=>e.companies.length>1?e.selectCompany():null),disabled:e.companies.length===1},[t("span",Xo,[e.companies.length>1?(H(),K("i",Wo)):Ee("",!0),Me(" "+c(e.selectedCompany.name),1)])],8,Go)):Ee("",!0),t("button",{type:"button",class:We(["ml-2 px-4 py-2 bg-yellow-400 hover:bg-yellow-500 focus:ring-4 focus:ring-yellow-300 font-medium rounded-lg text-white rounded flex items-center justify-between",{"opacity-50":!e.selectedCompany.id}]),onClick:s[1]||(s[1]=a=>e.handleListDocument()),disabled:!e.selectedCompany.id},[t("span",null,[Qo,Me(" "+c(e.$t("Document check")),1)])],10,zo)])])]),t("div",Zo,[t("div",er,[t("div",tr,[e.isChecked?Ee("",!0):(H(),Lt(x,{key:0,type:"button",class:We(["px-4 ml-2 py-2 bg-green-500 hover:bg-green-600 focus:ring-4 focus:ring-green-300 font-medium rounded-lg text-white text-white rounded flex items-center justify-between",{"opacity-50":!e.selectedCompany.id}]),onClick:s[2]||(s[2]=a=>e.resetData()),disabled:!e.selectedCompany.id},{default:W(()=>[t("span",null,[or,Me(" "+c(e.$t("New invoice")),1)])]),_:1},8,["class","disabled"]))])]),e.isChecked?Ee("",!0):(H(),K("div",rr,[j(I,{ref:"splitButton",class:We(["bg-purple-400 hover:bg-purple-500 focus:ring-4 focus:ring-pur-300 font-medium rounded-lg text-white text-white p-2",{"opacity-50":e.totalConIVA<=0||e.isSaving||!e.selectedCustomer.id||!e.selectedSerie.number}]),label:e.$t("Export"),onClick:e.handleClick,model:e.itemsExport,disabled:e.totalConIVA<=0||e.isSaving||!e.selectedCustomer.id||!e.selectedSerie.number},{icon:W(()=>[t("i",{class:We(["pi pi-upload mr-2",{"opacity-50":e.totalConIVA<=0}])},null,2)]),_:1},8,["label","onClick","model","disabled","class"])])),t("div",ar,[j(I,{class:We(["blue-button",{"opacity-50":e.totalConIVA<=0||e.isSaving||!e.selectedCustomer.id||!e.selectedSerie.number}]),label:e.$t("Save"),onClick:e.checkDocument,model:e.itemsSave,disabled:e.totalConIVA<=0||e.isSaving||!e.selectedCustomer.id||!e.selectedSerie.number},{icon:W(()=>[t("i",{class:We(["pi pi-save mr-2",{"opacity-50":e.totalConIVA<=0}])},null,2)]),_:1},8,["label","onClick","model","disabled","class"])])])]),sr,t("div",nr,[t("div",ir,[t("div",lr,[t("div",cr,[t("div",null,[e.selectedCustomer.name?(H(),K("div",ur,c(e.isChecked?e.$t("Provider"):e.$t("Customer"))+": ",1)):(H(),K("div",dr,c(e.isChecked?e.$t("Select a provider"):e.$t("Select a customer")),1))]),t("div",fr,c(e.selectedCustomer.name),1),t("div",pr,[j(x,{type:"button",icon:"pi pi-search",id:"voice-search",onClick:e.selectACustomer,class:"bg-gray-100 p-2 rounded-md text-gray-900 text-sm hover:bg-gray-300"},null,8,["onClick"])])]),t("div",null,[t("div",mr,[t("div",hr,c(e.$t("Tax number"))+":",1),t("div",gr,c(e.selectedCustomer.tax_number),1)]),t("div",vr,[t("div",yr,c(e.$t("Phone"))+":",1),t("div",xr,c(e.selectedCustomer.phone),1)]),t("div",br,[t("div",Cr,c(e.$t("Email"))+":",1),t("div",kr,c(e.selectedCustomer.email),1)]),t("div",Sr,[t("div",Tr,c(e.$t("Address"))+":",1),e.selectedCustomer.name?(H(),K("div",wr,c(e.selectedCustomer.address)+", "+c(e.selectedCustomer.post_code)+", "+c(e.selectedCustomer.town)+", "+c(e.selectedCustomer.province)+" ( "+c(e.selectedCustomer.country)+" ) ",1)):Ee("",!0)])])])]),t("div",Ar,[t("label",Er,[t("span",Or,c(e.$t("Mark as paid")),1),ke(t("input",{type:"checkbox",class:"sr-only peer","onUpdate:modelValue":s[3]||(s[3]=a=>e.myDocument.paid=a)},null,512),[[Ro,e.myDocument.paid]]),Ir]),t("div",_r,[t("div",Dr,c(e.$t("Payment date"))+":",1),t("div",Rr,[ke(t("input",{type:"date",min:e.fecha,"onUpdate:modelValue":s[4]||(s[4]=a=>e.fechaPaid=a),onChange:s[5]||(s[5]=(...a)=>e.cambiarFormatoFecha&&e.cambiarFormatoFecha(...a)),disabled:!1,class:We([{"bg-gray-100 text-gray-300 cursor-not-allowed":!e.myDocument.paid,"bg-white text-black":e.myDocument.paid,"pointer-events-none":!e.myDocument.paid},"styled-input bg-gray-50 border border-gray-300 rounded-md w-48 px-3 py-2 focus:outline-none focus:border-blue-400"])},null,42,Mr),[[Oe,e.fechaPaid]])])]),t("form",Pr,[t("div",Nr,"Nº "+c(e.selectedType.name)+":",1),t("div",Fr,[e.isChecked?ke((H(),K("input",{key:1,type:"text",id:"voice-search",class:"border-gray-300 rounded-md text-gray-900 text-sm focus:ring-blue-500 focus:border-blue-500 block w-[161px] pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500","onUpdate:modelValue":s[8]||(s[8]=a=>e.selectedSerie.number=a),required:""},null,512)),[[Oe,e.selectedSerie.number]]):(H(),K("div",$r,[t("div",Lr,c(e.selectedSerie.serie)+" / ",1),ke(t("input",{type:"text",id:"voice-search",class:"border-gray-300 rounded-md text-gray-900 text-sm focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500","onUpdate:modelValue":s[6]||(s[6]=a=>e.selectedSerie.number=a),required:""},null,512),[[Oe,e.selectedSerie.number]]),j(x,{type:"button",icon:"pi pi-search",onClick:s[7]||(s[7]=a=>e.selectDocument()),class:"button-search font-bold flex absolute inset-y-0 right-0 items-center border-gray-300 pr-1"})]))])]),t("div",Ur,[t("div",jr,c(e.$t("Date"))+":",1),t("div",Vr,[ke(t("input",{type:"date","onUpdate:modelValue":s[9]||(s[9]=a=>e.fecha=a),onChange:s[10]||(s[10]=(...a)=>e.cambiarFormatoFecha&&e.cambiarFormatoFecha(...a)),class:"styled-input bg-gray-50 border border-gray-300 rounded-md w-48 px-3 py-2 focus:outline-none focus:border-blue-400"},null,544),[[Oe,e.fecha]])])]),t("div",qr,[t("div",Hr,c(e.$t("Expiration"))+":",1),t("div",Br,[ke(t("input",{type:"date","onUpdate:modelValue":s[11]||(s[11]=a=>e.expiration=a),min:e.fecha,onChange:s[12]||(s[12]=(...a)=>e.cambiarFormatoFecha&&e.cambiarFormatoFecha(...a)),class:"styled-input bg-gray-50 border border-gray-300 rounded-md w-48 px-3 py-2 focus:outline-none focus:border-blue-400"},null,40,Kr),[[Oe,e.expiration]])])])])]),j(oe,{class:"mb-4 mt-8 border border-slate-200 ..."},{start:W(()=>[t("div",Jr,[t("div",Yr,[j(x,{label:e.$t("Concept"),icon:"pi pi-plus",severity:"success",class:"mr-2 bg-green-500 hover:bg-green-600 focus:ring-4 focus:ring-green-300 font-medium rounded-lg text-white rounded-md p-2",onClick:e.addRow},null,8,["label","onClick"]),j(x,{label:e.$t("Delete"),icon:"pi pi-trash",severity:"danger",class:"bg-red-400 hover:bg-red-500 focus:ring-4 focus:ring-red-300 font-medium rounded-lg text-white rounded-md p-2",onClick:e.confirmDeleteSelected,disabled:!e.selectedProducts||!e.selectedProducts.length},null,8,["label","onClick","disabled"])]),Gr])]),end:W(()=>[t("div",Xr,[ke(t("input",{type:"search",class:"block w-full h-11 rounded-md border-0 py-1.5 pl-3 pr-10 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm","onUpdate:modelValue":s[13]||(s[13]=a=>e.filters.global.value=a),placeholder:e.$t("Search...")},null,8,Wr),[[Oe,e.filters.global.value]]),zr])]),_:1}),j(de,{ref:"dt",value:e.products,selection:e.selectedProducts,"onUpdate:selection":s[14]||(s[14]=a=>e.selectedProducts=a),dataKey:"id",class:"w-full lg:w-4/4 mx-auto",filters:e.filters},{default:W(()=>[j(E,{selectionMode:"multiple",exportable:!1,class:"datetable checkbox"}),j(E,{field:"reference",header:e.$t("Reference"),sortable:"",class:"dateTable w-1/4"},{body:W(a=>[j(Z,{class:"input w-full",placeholder:e.$t("Reference"),modelValue:a.data.reference,"onUpdate:modelValue":ce=>a.data.reference=ce},null,8,["placeholder","modelValue","onUpdate:modelValue"])]),_:1},8,["header"]),j(E,{field:"description",header:e.$t("Concept"),sortable:"",class:"dateTable w-full"},{body:W(a=>[t("div",Qr,[j(Z,{modelValue:a.data.description,"onUpdate:modelValue":ce=>a.data.description=ce,placeholder:e.$t("Concept"),class:"input bg-white mt-3 rounded-md border border-gray-100 text-m"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),j(x,{type:"submit",icon:"pi pi-search-plus",onClick:ce=>e.openDescriptionDialog(a.data),class:"bg-gray-100 hover:bg-gray-200 p-2 absolute right-0 top-0 mt-3 mr-0.5 rounded rounded-r-lg rounded-l-none"},null,8,["onClick"])])]),_:1},8,["header"]),j(E,{field:"quantity",header:e.$t("Quantity"),sortable:"",class:"dateTable w-1/8"},{body:W(a=>[j(Z,{class:"input input-short w-full",modelValue:a.data.quantity,"onUpdate:modelValue":ce=>a.data.quantity=ce},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["header"]),j(E,{field:"price",header:e.$t("Price"),sortable:"",class:"dateTable w-1/8"},{body:W(a=>[j(Z,{class:"input input-short w-full",modelValue:a.data.price,"onUpdate:modelValue":ce=>a.data.price=ce},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["header"]),j(E,{field:"discount",header:e.$t("Discount (%)"),sortable:"",class:"dateTable w-1/4"},{body:W(a=>[j(Z,{class:"input input-short w-full",modelValue:a.data.discount,"onUpdate:modelValue":ce=>a.data.discount=ce},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["header"]),j(E,{field:"subTotal",header:e.$t("Subtotal"),sortable:"",class:"dateTable w-1/12"},{body:W(a=>[j(Z,{class:"input input-short w-1/12",value:e.calculateSubtotal(a.data),readonly:""},null,8,["value"])]),_:1},8,["header"]),j(E,{field:"taxes",header:e.$t("Tax (%)"),sortable:"",class:"dateTable w-1/4"},{body:W(a=>[j(te,{class:"input-short w-full",modelValue:a.data.taxes,"onUpdate:modelValue":ce=>a.data.taxes=ce,options:e.taxOptions,optionLabel:"label",optionValue:"value"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1},8,["header"]),j(E,{field:"total",header:e.$t("Total"),sortable:"",class:"dateTable w-1/12"},{body:W(a=>[j(Z,{class:"input input-short w-1/12",value:e.calculateTotal(a.data),readonly:""},null,8,["value"])]),_:1},8,["header"]),j(E,{exportable:!1,header:e.$t("Utility"),class:"dateTable w-1/12"},{body:W(a=>[j(x,{icon:"pi pi-trash",outlined:"",rounded:"",class:"simpleDelete-button",severity:"danger",onClick:ce=>e.confirmDeleteProduct(a.data)},null,8,["onClick"])]),_:1},8,["header"])]),_:1},8,["value","selection","filters"]),e.showButton?(H(),K("div",Zr,[j(x,{label:e.$t("Concept"),icon:"pi pi-plus",severity:"success",class:"bg-green-500 hover:bg-green-600 focus:ring-4 focus:ring-green-300 font-medium rounded-lg text-white",onClick:s[15]||(s[15]=a=>e.addRow())},null,8,["label"])])):Ee("",!0),t("div",ea,[t("div",ta,[t("div",oa,[t("table",ra,[t("tbody",null,[t("tr",null,[t("td",aa,c(e.$t("Payment method"))+":",1),t("td",sa,[t("div",na,[t("div",ia,c(e.selectedPaymentMethod.name),1),t("div",la,[j(x,{type:"button",icon:"pi pi-search",id:"voice-search",onClick:s[16]||(s[16]=a=>e.selectAPaymentMethod()),class:"bg-gray-100 p-2 rounded-md text-gray-900 text-sm hover:bg-gray-300"})])])])]),ca,t("tr",null,[t("td",da,[e.selectedPaymentMethod.id===1||e.selectedPaymentMethod.id===7?(H(),K("span",ua,c(e.$t("Bank account"))+":",1)):e.selectedPaymentMethod.id===3?(H(),K("span",fa,c(e.$t("Phone"))+":",1)):e.selectedPaymentMethod.id===4?(H(),K("span",pa,c(e.$t("Email"))+":",1)):(H(),K("span",ma,c("")))]),t("td",ha,[e.selectedPaymentMethod.id===1||e.selectedPaymentMethod.id===7?(H(),K("span",ga,c(e.selectedBankAccount.complete_bank_account),1)):e.selectedPaymentMethod.id===3?(H(),K("span",va,c(e.selectedPhone.phone),1)):e.selectedPaymentMethod.id===4?(H(),K("span",ya,c(e.selectedEmail.email),1)):(H(),K("span",xa,c("")))])])])])])]),ba,t("div",Ca,[t("button",{class:"ml-4 mb-5 rounded-md",onClick:s[17]||(s[17]=a=>e.selectAPaymentMethod())}),t("div",ka,[t("table",Sa,[t("tbody",null,[t("tr",null,[t("td",Ta,c(e.$t("Subtotal (excluding Tax)"))+":",1),t("td",wa,c(e.subtotal.toFixed(2))+"€",1)]),Aa,t("tr",null,[t("td",Ea,c(e.$t("Total Tax"))+":",1),t("td",Oa,c(e.totalIVA.toFixed(2))+"€",1)]),Ia,t("tr",null,[t("td",_a,c(e.$t("Total (with IVA)"))+":",1),t("td",Da,c(e.totalConIVA.toFixed(2))+"€",1)])])])])])])])],2),t("div",Ra,[t("div",Ma,[t("button",{class:"ml-4 mb-2 success-button rounded-md",onClick:s[18]||(s[18]=a=>e.selectAPaymentMethod())},[Pa,Me(" "+c(e.$t("Payment method")),1)]),t("div",Na,[t("table",Fa,[t("tbody",null,[t("tr",null,[t("td",$a,c(e.$t("Payment method"))+": ",1),t("td",La,c(e.selectedPaymentMethod.name),1)]),Ua,t("tr",null,[t("td",ja,[e.selectedPaymentMethod.id===1||e.selectedPaymentMethod.id===7?(H(),K("span",Va,c(e.$t("Bank account"))+":",1)):e.selectedPaymentMethod.id===3?(H(),K("span",qa,c(e.$t("Phone"))+":",1)):e.selectedPaymentMethod.id===4?(H(),K("span",Ha,c(e.$t("Email"))+":",1)):(H(),K("span",Ba,c("")))]),t("td",Ka,[e.selectedPaymentMethod.id===1||e.selectedPaymentMethod.id===7?(H(),K("span",Ja,c(e.selectedBankAccount.complete_bank_account),1)):e.selectedPaymentMethod.id===3?(H(),K("span",Ya,c(e.selectedPhone.phone),1)):e.selectedPaymentMethod.id===4?(H(),K("span",Ga,c(e.selectedEmail.email),1)):(H(),K("span",Xa,c("")))])])])])])]),Wa,t("div",za,[t("div",Qa,[t("table",Za,[t("tbody",null,[t("tr",null,[t("td",es,c(e.$t("Subtotal (excluding Tax)"))+":",1),t("td",ts,c(e.subtotal.toFixed(2))+"€",1)]),t("tr",null,[t("td",os,c(e.$t("Total Tax"))+":",1),t("td",rs,c(e.totalIVA.toFixed(2))+"€",1)]),t("tr",null,[t("td",as,c(e.$t("Total (with IVA)"))+":",1),t("td",ss,c(e.totalConIVA.toFixed(2))+"€",1)])])])])])])])]),j(G,{visible:e.descriptionDialog,"onUpdate:visible":s[20]||(s[20]=a=>e.descriptionDialog=a),style:{width:"450px"},header:e.$t("Concept"),modal:""},{footer:W(()=>[j(x,{label:e.$t("Save"),icon:"pi pi-check",onClick:e.saveDescription},null,8,["label","onClick"])]),default:W(()=>[t("div",ns,[ke(t("textarea",{"onUpdate:modelValue":s[19]||(s[19]=a=>e.selectedDescription=a),rows:"7",class:"block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("Insert the description here")},null,8,is),[[Oe,e.selectedDescription]]),t("div",ls,[t("div",{class:We({"char-counter":!0,"text-red-500":e.charCount>255})},c(e.charCount)+"/255 ",3)])])]),_:1},8,["visible","header"]),j(G,{visible:e.productDialog,"onUpdate:visible":s[22]||(s[22]=a=>e.productDialog=a),header:e.$t("Select companies"),modal:!0,onChange:e.handleCompanySelection,class:"p-fluid w-full sm:w-3/4 md:w-2/3 lg:w-1/2 max-w-4xl"},{default:W(()=>[t("label",cs,c(e.$t("Select your company"))+":",1),j(te,{modelValue:e.selectedCompany,"onUpdate:modelValue":s[21]||(s[21]=a=>e.selectedCompany=a),options:e.companies,filter:"",optionLabel:"name",class:"w-full h-11 md:w-64rem mb-4 bg-gray-50 border border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500",onChange:e.handleCompanySelection},{value:W(a=>[a.value?(H(),K("div",ds,[t("div",null,c(a.value.name),1)])):Ee("",!0)]),option:W(a=>[t("div",us,[t("div",null,c(a.option.name),1)])]),_:1},8,["modelValue","options","onChange"])]),_:1},8,["visible","header","onChange"]),j(G,{visible:e.documentDialog,"onUpdate:visible":s[25]||(s[25]=a=>e.documentDialog=a),style:{width:"450px"},header:e.$t("Select document"),modal:!0,onChange:e.handleTypeSelection},{default:W(()=>[t("label",fs,c(e.$t("Select document type")),1),j(te,{modelValue:e.selectedType,"onUpdate:modelValue":s[23]||(s[23]=a=>e.selectedType=a),options:e.types,filter:"",optionLabel:"name",class:"w-full h-11 md:w-64rem mb-4 bg-gray-50 border border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500",onChange:e.handleTypeSelection},{value:W(a=>[a.value?(H(),K("div",ps,[t("div",null,c(a.value.name),1)])):Ee("",!0)]),option:W(a=>[t("div",ms,[t("div",null,c(a.option.name),1)])]),_:1},8,["modelValue","options","onChange"]),t("label",hs,c(e.$t("Select document serie")),1),j(te,{modelValue:e.selectedSerie,"onUpdate:modelValue":s[24]||(s[24]=a=>e.selectedSerie=a),options:e.series,filter:"",optionLabel:"serie",class:"w-full h-11 md:w-64rem mb-4 bg-gray-50 border border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500"},{value:W(a=>[a.value?(H(),K("div",gs,[t("div",null,c(a.value.serie),1)])):Ee("",!0)]),option:W(a=>[t("div",vs,[t("div",null,c(a.option.serie),1)])]),_:1},8,["modelValue","options"])]),_:1},8,["visible","header","onChange"]),j(G,{visible:e.documentListDialog,"onUpdate:visible":s[26]||(s[26]=a=>e.documentListDialog=a),class:"w-3/4",header:e.isChecked?e.$t("Received invoices"):e.$t("Emitted invoices"),modal:!0},{default:W(()=>[j(jt,{companyId:e.selectedCompany.id,isChecked:e.isChecked,onDocumentSelected:e.handleDocumentSelected},null,8,["companyId","isChecked","onDocumentSelected"])]),_:1},8,["visible","header"]),j(G,{visible:e.deleteProductDialog,"onUpdate:visible":s[28]||(s[28]=a=>e.deleteProductDialog=a),style:{width:"450px"},header:e.$t("Confirm"),modal:!0},{footer:W(()=>[j(x,{label:e.$t("No"),icon:"pi pi-times",text:"",onClick:s[27]||(s[27]=a=>e.deleteProductDialog=!1)},null,8,["label"]),j(x,{label:e.$t("Yes"),icon:"pi pi-check",text:"",onClick:e.deleteProduct},null,8,["label","onClick"])]),default:W(()=>[t("div",ys,[xs,e.companies?(H(),K("span",bs,[Me(c(e.$t("Are you sure you want to delete")),1),t("b",null,c(e.companies.name),1),Me("?")])):Ee("",!0)])]),_:1},8,["visible","header"]),j(G,{visible:e.deleteProductsDialog,"onUpdate:visible":s[30]||(s[30]=a=>e.deleteProductsDialog=a),style:{width:"450px"},header:e.$t("Confirm"),modal:!0},{footer:W(()=>[j(x,{label:e.$t("No"),icon:"pi pi-times",text:"",onClick:s[29]||(s[29]=a=>e.deleteProductsDialog=!1)},null,8,["label"]),j(x,{label:e.$t("Yes"),icon:"pi pi-check",text:"",onClick:e.deleteSelectedProducts},null,8,["label","onClick"])]),default:W(()=>[t("div",Cs,[ks,e.companies?(H(),K("span",Ss,c(e.$t("Are you sure you want to delete the selected concepts?")),1)):Ee("",!0)])]),_:1},8,["visible","header"]),j(G,{visible:e.selectACustomerDialog,"onUpdate:visible":s[34]||(s[34]=a=>e.selectACustomerDialog=a),header:e.isChecked?e.$t("Select a provider"):e.$t("Select a customer"),id:"titleCompany",modal:!0,class:"p-fluid w-full sm:w-3/4 md:w-2/3 lg:w-1/2 max-w-4xl"},{default:W(()=>[j(te,{modelValue:e.selectedCustomer,"onUpdate:modelValue":s[31]||(s[31]=a=>e.selectedCustomer=a),options:e.customers,filter:"",optionLabel:"name",class:"w-full h-11 md:w-64rem mb-4 bg-gray-50 border border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500"},{value:W(a=>[a.value?(H(),K("div",Ts,[t("div",null,c(a.value.name),1)])):Ee("",!0)]),option:W(a=>[t("div",ws,[t("div",null,c(a.option.name),1)])]),_:1},8,["modelValue","options"]),t("div",As,[t("div",Es,[t("button",{class:"bg-green-500 hover:bg-green-600 focus:ring-4 focus:ring-green-300 font-medium rounded-lg text-white text-white p-2 mr-1 mr-1 rounded-md",onClick:s[32]||(s[32]=(...a)=>e.openNew&&e.openNew(...a))},[Os,Me(" "+c(e.isChecked?e.$t("Create provider"):e.$t("Create customer")),1)]),t("button",{class:"text-white bg-red-600 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800",onClick:s[33]||(s[33]=a=>e.hideDialog())},c(e.$t("Close")),1)])])]),_:1},8,["visible","header"]),j(G,{visible:e.selectAPaymentMethodDialog,"onUpdate:visible":s[38]||(s[38]=a=>e.selectAPaymentMethodDialog=a),header:e.$t("Select a payment method"),id:"titleCompany",modal:!0,class:"p-fluid w-full sm:w-3/4 md:w-2/3 lg:w-1/2 max-w-4xl"},{default:W(()=>[t("label",Is,c(e.$t("Payment method")),1),j(te,{modelValue:e.selectedPaymentMethod,"onUpdate:modelValue":s[35]||(s[35]=a=>e.selectedPaymentMethod=a),options:e.payment_methods,filter:"",optionLabel:"name",class:"w-full h-11 md:w-64rem mb-4 bg-gray-50 border border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500"},{value:W(a=>[a.value?(H(),K("div",_s,[t("div",null,c(a.value.name),1)])):Ee("",!0)]),option:W(a=>[t("div",Ds,[t("div",null,c(a.option.name),1)])]),_:1},8,["modelValue","options"]),e.isDropdownHidden?Ee("",!0):(H(),K("label",Rs,c(e.$t("Select an option")),1)),e.isDropdownHidden?Ee("",!0):(H(),Lt(te,{key:1,modelValue:e.selectedOption,"onUpdate:modelValue":s[36]||(s[36]=a=>e.selectedOption=a),options:e.options,filter:"",optionLabel:e.dynamicOptionLabel,class:"w-full h-11 md:w-64rem mb-4 bg-gray-50 border border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500"},{value:W(a=>[a.value?(H(),K("div",Ms,[t("div",null,c(a.value[e.dynamicOptionLabel]),1)])):Ee("",!0)]),option:W(a=>[t("div",Ps,[t("div",null,c(a.option[e.dynamicOptionLabel]),1)])]),_:1},8,["modelValue","options","optionLabel"])),t("div",Ns,[t("button",{class:"text-white bg-red-600 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800",onClick:s[37]||(s[37]=a=>e.hideDialog())},c(e.$t("Close")),1)])]),_:1},8,["visible","header"]),j(G,{visible:e.customerDialog,"onUpdate:visible":s[50]||(s[50]=a=>e.customerDialog=a),header:e.$t("Create company"),id:"titleCompany",modal:!0,class:"p-fluid"},{default:W(()=>[t("form",{style:{width:"800px"},onSubmit:s[49]||(s[49]=Ut((...a)=>e.saveCustomer&&e.saveCustomer(...a),["prevent"]))},[t("div",Fs,[t("div",null,[t("label",$s,c(e.$t("Company name")),1),ke(t("input",{type:"text",id:"name","onUpdate:modelValue":s[39]||(s[39]=a=>e.customer.name=a),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("Company name"),required:!e.selectedCustomer},null,8,Ls),[[Oe,e.customer.name]])]),t("div",null,[t("label",Us,c(e.$t("Tax number")),1),ke(t("input",{type:"text",id:"tax_number","onUpdate:modelValue":s[40]||(s[40]=a=>e.customer.tax_number=a),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("Tax number"),required:!e.selectedCustomer},null,8,js),[[Oe,e.customer.tax_number]])])]),t("div",Vs,[t("label",qs,c(e.$t("Address")),1),ke(t("input",{type:"text",id:"address1","onUpdate:modelValue":s[41]||(s[41]=a=>e.customer.address=a),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("Address"),required:!e.selectedCustomer},null,8,Hs),[[Oe,e.customer.address]])]),t("div",Bs,[t("div",null,[t("label",Ks,c(e.$t("Town")),1),ke(t("input",{type:"text",id:"town","onUpdate:modelValue":s[42]||(s[42]=a=>e.customer.town=a),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("Town"),required:!e.selectedCustomer},null,8,Js),[[Oe,e.customer.town]])]),t("div",null,[t("label",Ys,c(e.$t("Province")),1),ke(t("input",{type:"text",id:"province","onUpdate:modelValue":s[43]||(s[43]=a=>e.customer.province=a),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("Province"),required:!e.selectedCustomer},null,8,Gs),[[Oe,e.customer.province]])]),t("div",null,[t("label",Xs,c(e.$t("Post code")),1),ke(t("input",{type:"text",id:"post_code","onUpdate:modelValue":s[44]||(s[44]=a=>e.customer.post_code=a),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("Post code"),pattern:"^\\d+$",required:!e.selectedCustomer},null,8,Ws),[[Oe,e.customer.post_code]])]),t("div",null,[t("label",zs,c(e.$t("Country")),1),ke(t("input",{type:"text",id:"country","onUpdate:modelValue":s[45]||(s[45]=a=>e.customer.country=a),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("Country"),required:!e.selectedCustomer},null,8,Qs),[[Oe,e.customer.country]])]),t("div",null,[t("label",Zs,c(e.$t("Email")),1),ke(t("input",{type:"email",id:"email","onUpdate:modelValue":s[46]||(s[46]=a=>e.customer.email=a),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("info@mycompany.com"),required:!e.selectedCustomer},null,8,en),[[Oe,e.customer.email]])]),t("div",null,[t("label",tn,c(e.$t("Phone")),1),ke(t("input",{type:"tel",id:"phone","onUpdate:modelValue":s[47]||(s[47]=a=>e.customer.phone=a),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("Phone"),pattern:"^\\+\\d{1,3}\\s?\\d{1,14}$",required:!e.selectedCustomer},null,8,on),[[Oe,e.customer.phone]])])]),t("div",rn,[t("div",null,[t("button",{class:"mr-3 text-white bg-red-600 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800",onClick:s[48]||(s[48]=Ut(a=>e.hideDialog(),["prevent"]))},c(e.$t("Close")),1),t("button",an,c(e.$t("Save")),1)])])],32)]),_:1},8,["visible","header"])]),_:1})]),t("div",sn,[t("div",nn,[t("div",ln,[cn,t("div",dn,[t("h3",null,c(e.selectedType.name),1),t("p",null,[t("strong",null,c(e.$t("Date"))+": ",1),Me(c(e.fecha),1)]),t("p",null,[t("strong",null,c(e.$t("Expiration"))+": ",1),Me(c(e.expiration),1)]),t("p",null,[t("strong",null,c(e.$t("Number of"))+" "+c(e.selectedType.name)+":",1),Me(" "+c(e.selectedSerie.serie)+" "+c(e.selectedSerie.number),1)])])]),t("div",un,[t("div",fn,[t("h3",null,[t("strong",null,c(e.$t("Company")),1)]),t("p",pn,c(e.selectedCompany.name),1),t("p",null,c(e.selectedCompany.tax_number),1),t("p",null,[Me(c(e.selectedCompany.address),1),mn,Me(" "+c(e.selectedCompany.post_code)+", "+c(e.selectedCompany.town)+", "+c(e.selectedCompany.province)+", "+c("(")+" "+c(e.selectedCompany.country)+" "+c(")"),1)]),t("p",null,c(e.selectedCompany.email),1),t("p",null,c(e.selectedCompany.phone),1)]),t("div",hn,[t("h3",null,[t("strong",null,c(e.$t("Customer")),1)]),t("p",gn,c(e.selectedCustomer.name),1),t("p",null,c(e.selectedCustomer.tax_number),1),t("p",null,[Me(c(e.selectedCustomer.address),1),vn,Me(" "+c(e.selectedCustomer.post_code)+", "+c(e.selectedCustomer.town)+", "+c(e.selectedCustomer.province)+", "+c("(")+" "+c(e.selectedCustomer.country)+" "+c(")"),1)]),t("p",null,c(e.selectedCustomer.email),1),t("p",null,c(e.selectedCustomer.phone),1)])]),t("table",yn,[t("thead",null,[t("tr",xn,[t("th",null,c(e.$t("Reference")),1),t("th",null,c(e.$t("Description")),1),t("th",null,c(e.$t("Quantity")),1),t("th",null,c(e.$t("Price")),1),t("th",null,c(e.$t("Discount (%)")),1),t("th",null,c(e.$t("Subtotal")),1),t("th",null,c(e.$t("Tax (%)")),1),t("th",null,c(e.$t("Total")),1)])]),t("tbody",null,[(H(!0),K(Mt,null,$t(e.products,a=>(H(),K("tr",{key:a.id},[t("td",null,c(a.reference),1),t("td",null,c(a.description),1),t("td",null,c(a.quantity),1),t("td",null,c(a.price),1),t("td",null,c(a.discount),1),t("td",null,c(a.subTotal),1),t("td",null,c(a.taxes),1),t("td",null,c(e.calculateTotal(a)),1)]))),128))])]),t("div",bn,[t("div",Cn,[t("table",kn,[t("tr",null,[t("td",Sn,c(e.$t("Subtotal (excluding Tax)")),1),t("td",null,c(e.subtotal.toFixed(2))+"€",1)]),(H(!0),K(Mt,null,$t(e.taxMap,(a,ce)=>(H(),K("tr",{key:ce},[t("td",Tn,c(e.$t("Total IVA"))+" "+c(Object.values(a)[0])+" %",1),t("td",null,c(Object.values(a)[1].toFixed(2))+"€",1)]))),128)),t("tr",null,[t("td",wn,[t("strong",null,c(e.$t("Total (with IVA)")),1)]),t("td",null,[t("strong",null,c(e.totalConIVA.toFixed(2))+"€",1)])])])]),t("table",An,[t("tr",null,[t("td",null,c(e.$t("Payment method"))+":",1),t("td",null,c(e.selectedPaymentMethod.name),1)]),t("tr",null,[t("td",En,[e.selectedPaymentMethod.id===2?(H(),K("span",On,c(""))):e.selectedPaymentMethod.id===3?(H(),K("span",In,c(e.$t("Phone"))+":",1)):e.selectedPaymentMethod.id===4?(H(),K("span",_n,c(e.$t("Email"))+":",1)):(H(),K("span",Dn,c(e.$t("Bank account"))+":",1))]),t("td",Rn,[e.selectedPaymentMethod.id===1?(H(),K("span",Mn,c(e.selectedBankAccount.complete_bank_account),1)):e.selectedPaymentMethod.id===3?(H(),K("span",Pn,c(e.selectedPhone.phone),1)):e.selectedPaymentMethod.id===4?(H(),K("span",Nn,c(e.selectedEmail.email),1)):(H(),K("span",Fn,c("")))])])])])])])],64)}}}),Gn=Fo(Ln,[["__scopeId","data-v-e3d8a268"]]);export{Gn as default};
