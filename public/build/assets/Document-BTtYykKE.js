import{s as ko}from"./dialog.esm-VmiGjN6p.js";import{c as So,s as wo,d as To,b as Ao,a as Eo}from"./column.esm-B0kMEs2H.js";import{s as Oo}from"./toolbar.esm-mLzmTsQ_.js";import{s as _o}from"./document-BDOfBfbR.js";import{d as Io,o as X,e as J,a as t,b as F,w as K,t as c,g as me,F as Mt,h as Lt,i as Do,l as Ro,n as $e,f as Re,k as Te,x as Mo,v as Ie,c as Po,m as $t,A as No,B as Fo}from"./app-CEnNdpTV.js";import{_ as Lo}from"./AppLayout-ClivM-_U.js";import Ut from"./TableDocumentSelector-HUfROEH6.js";import{_ as $o}from"./_plugin-vue_export-helper-DlAUqK2U.js";if(document.all&&!window.setTimeout.isPolyfill){var Uo=window.setTimeout;window.setTimeout=function(o,f){var e=Array.prototype.slice.call(arguments,2);return Uo(o instanceof Function?function(){o.apply(null,e)}:o,f)},window.setTimeout.isPolyfill=!0}var jo=window.XMLHttpRequest,Ae=function(o,f){var e="1.8.2.1",a=2,_=null,L=null,P=null,ie=null,z=null,re=!1,Q=!1,q=!1,ge=new Array;ge.es_ES={checktime_warn:"Se ha detectado un desfase horario entre su sistema y el servidor. Se recomienda que se corrija antes de pulsar Aceptar para continuar.",checktime_err:"Se ha detectado un desfase horario entre su sistema y el servidor. Debe corregir la hora de su sistema y recargar esta página antes de continuar.",checktime_local_time:"Hora de su sistema",checktime_server_time:"Hora del servidor"},ge.gl_ES={checktime_warn:"Destectouse un desfase horario entre o seu sistema e o servidor. Recoméndase corrixilo antes de pulsar Aceptar para continuar.",checktime_err:"Destectouse un desfase horario entre o seu sistema e o servidor. Debe corrixir a hora do seu sistema antes de continuar.",checktime_local_time:"Hora do seu sistema",checktime_server_time:"Hora do servidor"};var l=ge.es_ES,de=l,pe=null,Ue="WINDOWS",je="APPLE",H="PKCS12",Ve="PKCS11",be="MOZ_UNI",W="SHARED_NSS",T="JAVA",Je="JCEKS",oe="JAVACE",te="DNIEJAVA",Fe="CT_NO",pt="CT_RECOMMENDED",mt="CT_OBLIGATORY",At=2e3,ht=15,ct=!1,Le,Ze,Me,ze=null,Et=!1;function jt(){return"WebSocket"in o||"MozWebSocket"in o}function dt(x){return x!=null&&x.length>8&&(x.substr(0,5)=="http:"||x.substr(0,6)=="https:")}var It=null,Dt=null,ut=null;function Vt(x,A,v){It=A,Dt=v;var D=We();D.open("GET",x,!0),"responseType"in D&&Uint8Array?(D.responseType="arraybuffer",ut="arraybuffer"):"overrideMimeType"in D?(D.overrideMimeType("text/plain; charset=x-user-defined"),ut="string"):(D.setRequestHeader("Accept-Charset","x-user-defined"),ut="bytearray"),"onload"in D||(D.onreadystatechange=function(){this.readyState===4&&this.onload()}),D.onload=function(j){if(D.readyState==4&&D.status==200&&It){"response"in this||(this.response=new VBArray(this.responseBody).toArray());var U;ut=="arraybuffer"?U=I.encodeArrayBuffer(this.response):ut=="bytearray"?U=I.encodeByteArray(this.response):ut=="string"?U=I.encode(this.response):this.onerror(new Error("No se conoce el modo usado para la descarga de los datos")),It(U)}};try{D.onerror=function(j){Dt&&Dt(j)}}catch{}D.send()}function We(){var x=null;if(typeof XMLHttpRequest<"u")typeof Sarissa<"u"&&Sarissa.originalXMLHttpRequest?x=new Sarissa.originalXMLHttpRequest:x=new jo;else if(typeof o.ActiveXObject<"u")try{x=new ActiveXObject("Msxml2.XMLHTTP.4.0")}catch{try{x=new ActiveXObject("MSXML2.XMLHTTP")}catch{try{x=new ActiveXObject("Microsoft.XMLHTTP")}catch{x=null}}}return x}var qt=function(x){ct=x},Ht=function(x){Me=x};function Bt(){return!0}function Kt(){return!1}var Xt=function(x){},Jt=function(x){},Pt=function(x,A,v){if(!(!x||x==Fe||A&&A<=0)){A||(A=3e5);try{var D;v?D=v:D=document.URL+"/"+Math.random();var j=We();j.open("GET",D,!1),j.send();var U=new Date,se=new Date(j.getResponseHeader("Date"));if(se==null||se.getTime()==0)return;console.log("Hora cliente: "+U),console.log("Hora servidor: "+se);var De=Math.abs(U.getTime()-se.getTime());De>A&&(x==pt?alert(de.checktime_warn+`
`+de.checktime_local_time+": "+U.toLocaleString()+`
`+de.checktime_server_time+": "+se.toLocaleString()):x==mt&&(re=!0,alert(de.checktime_err+`
`+de.checktime_local_time+": "+U.toLocaleString()+`
`+de.checktime_server_time+": "+se.toLocaleString())))}catch(ve){console.log("Error en la obtencion de la hora del servidor: "+ve);return}}};function Gt(){return ae.isFirefox()?be:null}var Yt=function(x){P.setKeyStore(x??pe),q=!0},Wt=function(x,A,v){P.selectCertificate(x,A,v),q=!1},zt=function(x,A,v,D,j,U){P.sign(x,A,v,D,j,U),q=!1},Qt=function(x,A,v,D,j,U,se){P.coSign(x,v,D,j,U,se),q=!1},Zt=function(x,A,v,D,j,U){P.coSign(x,A,v,D,j,U),q=!1},eo=function(x,A,v,D,j,U){P.counterSign(x,A,v,D,j,U),q=!1},to=function(x,A,v,D,j,U,se,De){P.signAndSaveToFile(x,A,v,D,j,U,se,De),q=!1},oo=function(x,A,v,D,j,U){P.signBatchXML(x,A,v,D,j,U),q=!1},so=function(x,A,v,D){var j=new Object;j.algorithm=x,j.format=A,j.suboperation=v,D&&(j.extraparams=I.encode(D)),j.singlesigns=new Array,ze=j},ao=function(x,A,v,D,j){if(!x||A==null)throw new Error("No se ha indicado el id o datareference de la firma");if(!ze)throw new Error("No hay ningun lote creado. Es necesario crear uno antes de agregar firmas");Ce.checkExistingId(ze.singlesigns,x);var U=new Object;U.id=x,U.datareference=A,v&&(U.format=v),D&&(U.suboperation=D),j&&(U.extraparams=I.encode(j)),ze.singlesigns.push(U)},no=function(x){Et=x},ro=function(x,A,v,D,j,U){if(!ze)throw new Error("No hay ningun lote creado. Es necesario crear uno antes de firmar.");ze.stoponerror=x;var se=I.encode(JSON.stringify(ze),!0);P.signBatchJSON(se,A,v,D,j,U),ze=null,q=!1},io=function(x){return x!=null?I.encode(x):null},lo=function(x){return x!=null?I.decode(x):null},co=function(x,A,v,D,j,U,se){P.saveDataToFile(x,A,v,D,j,U,se)},uo=function(x,A,v,D,j,U){P.getFileNameContentBase64(x,A,v,D,j,U)},fo=function(x,A,v,D,j,U){P.getMultiFileNameContentBase64(x,A,v,D,j,U)},po=function(x,A){P.getCurrentLog(x,A)},mo=function(){return P.echo()},Ot=function(x){Q&&!x&&(q=!0),Q=x},_t=function(x){de=x==null||ge[x]==null?l:ge[x]},ho=function(){return P.getErrorMessage()},go=function(){return P.getErrorType()},vo=function(x,A){ie=x,z=A,P&&P.setServlets&&P.setServlets(x,A)},yo=function(x,A){var v=1024,D=65535;Le=x&&x>=v&&x<=D?x:v,Ze=A?A<=D&&A>=Le?A:D:x&&x==Le?Le:D,P&&P.setPortRange&&P.setPortRange(Le,Ze)};function Rt(x){if(ae.isChrome()||ae.isIOS()||ae.isAndroid()&&ae.isFirefox())document.location=x;else{if(document.getElementById("iframeAfirma")!=null)try{var A=document.getElementById("iframeAfirma");A.outerHTML="",A=null}catch{}navigator.msLaunchUri?navigator.msLaunchUri(x,null,function(){wrongInstallation=!0}):xo(x)}}function xo(x){var A=document.createElement("iframe"),v=document.createAttribute("id");v.value="iframeAfirma",A.setAttributeNode(v);var D=document.createAttribute("src");D.value=x,A.setAttributeNode(D);var j=document.createAttribute("height");j.value=1,A.setAttributeNode(j);var U=document.createAttribute("width");if(U.value=1,A.setAttributeNode(U),!ae.isInternetExplorer7orLower()){var se=document.createAttribute("style");se.value="display: none;",A.setAttributeNode(se)}document.body.appendChild(A)}function Nt(x,A,v){if(re){console&&console.log&&console.log("Se ha detectado un desfase grave entre la hora del sistema y la del servidor. Se cancela la carga del cliente de firma");return}ct||ae.isIOS()||ae.isAndroid()?(P=new Ft(x,o,f),(ie||z)&&P.setServlets(ie,z)):jt()&&!ae.isInternetExplorer()&&!ae.isFirefox60orLower()?(P=new bo(o,f),Le&&P.setPortRange(Le,Ze)):!ae.isInternetExplorer10orLower()&&!ae.isSafari10()?(P=new Co(x,o,f),Le&&P.setPortRange(Le,Ze)):(P=new Ft(x,o,f),(ie||z)&&P.setServlets(ie,z)),A||(A=Gt()),P.setKeyStore(A)}var ae=function(x,A){function v(){return navigator.userAgent.toUpperCase().indexOf("ANDROID")!=-1||navigator.appVersion.toUpperCase().indexOf("ANDROID")!=-1||navigator.userAgent.toUpperCase().indexOf("SILK/")!=-1||navigator.userAgent.toUpperCase().indexOf("KFJWI")!=-1||navigator.userAgent.toUpperCase().indexOf("KFJWA")!=-1||navigator.userAgent.toUpperCase().indexOf("KFTT")!=-1||navigator.userAgent.toUpperCase().indexOf("KFOT")!=-1||navigator.userAgent.toUpperCase().indexOf("KINDLE FIRE")!=-1}function D(){return navigator.userAgent.toUpperCase().indexOf("IPAD")!=-1||navigator.userAgent.toUpperCase().indexOf("IPOD")!=-1||navigator.userAgent.toUpperCase().indexOf("IPHONE")!=-1||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1}function j(){return!!navigator.userAgent.match(/MSIE/)||!!(navigator.userAgent.match(/Trident/)&&navigator.userAgent.match(/rv:11/))||!!navigator.userAgent.match(/Trident.*rv[ :]*11\./)}function U(){return!!navigator.userAgent.match(/MSIE/)}function se(){var ue=navigator.userAgent.toLowerCase();return 7>=(ue.indexOf("msie")!=-1)?parseInt(ue.split("msie")[1]):!1}function De(){return navigator.sayswho=function(){var ue=navigator.userAgent,Z,le=ue.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(le[1])?(Z=/\brv[ :]+(\d+)/g.exec(ue)||[],"IE "+(Z[1]||"")):le[1]==="Chrome"&&(Z=ue.match(/\b(OPR|Edge)\/(\d+)/),Z!=null)?Z.slice(1).join(" ").replace("OPR","Opera"):(le=le[2]?[le[1],le[2]]:[navigator.appName,navigator.appVersion,"-?"],(Z=ue.match(/version\/(\d+)/i))!=null&&le.splice(1,1,Z[1]),le.join(" "))}(),navigator.sayswho=="Safari 10"}function ve(){return navigator.userAgent.toUpperCase().indexOf("FIREFOX")!=-1}function Ee(){navigator.sayswho=function(){var Z=navigator.userAgent,le,ne=Z.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(ne[1])?(le=/\brv[ :]+(\d+)/g.exec(Z)||[],"IE "+(le[1]||"")):ne[1]==="Chrome"&&(le=Z.match(/\b(OPR|Edge)\/(\d+)/),le!=null)?le.slice(1).join(" ").replace("OPR","Opera"):(ne=ne[2]?[ne[1],ne[2]]:[navigator.appName,navigator.appVersion,"-?"],(le=Z.match(/version\/(\d+)/i))!=null&&ne.splice(1,1,le[1]),ne.join(" "))}();var ue=navigator.sayswho;return ue.indexOf("Firefox")!=-1?60>=parseInt(ue.split("Firefox")[1]):!1}function ye(){return navigator.userAgent.toUpperCase().indexOf("CHROME/")!=-1||navigator.userAgent.toUpperCase().indexOf("CHROMIUM")!=-1}return{isAndroid:v,isIOS:D,isInternetExplorer:j,isInternetExplorer10orLower:U,isInternetExplorer7orLower:se,isSafari10:De,isFirefox:ve,isFirefox60orLower:Ee,isChrome:ye}}(),Ce=function(x,A){var v=2147483648,D="1234567890abcdefghijklmnopqrstuwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",j=1024,U=49152,se=65535;function De(){var ee=20,E="",G;if(typeof x.crypto<"u"&&typeof x.crypto.getRandomValues<"u")G=new Uint32Array(ee),x.crypto.getRandomValues(G);else{G=new Array(ee);for(var B=0;B<ee;B++)G[B]=ve()}for(var B=0;B<ee;B++)E+=D.charAt(Math.floor(G[B]%D.length));return E}function ve(){return ye()*v}var Ee;function ye(){return Ee==A&&(Ee=new Date().getMilliseconds()*1e3*Math.random()),Ee=(Ee*9301+49297)%233280,Ee/233280}function ue(ee,E){var G=ee?Math.max(ee,j):U,B=E?Math.min(E,se):se,N=new Array;switch(B-G){case 0:N[0]=G;break;case 1:N[0]=Z(G,B,N),N[1]=Z(G,B,N);break;default:N[0]=Z(G,B,N),N[1]=Z(G,B,N),N[2]=Z(G,B,N)}return N}function Z(ee,E,G){if(G.length>E-ee)return 0;var B;do{var N=Math.floor(Math.random()*(E+1-ee))+ee;B=le(N,G)}while(B);return N}function le(ee,E){for(var G=0;G<E.length;G++)if(E[G]===ee)return!0;return!1}function ne(ee){var E=I.decode(ee);return JSON.parse(E)}function Y(ee,E){for(var G=0;G<ee.length;G++)if(ee[G].id==E)throw new Error('El id de la firma a agregar = "'+ee[G].id+'" ya existe en el lote')}return{generateNewIdSession:De,getRandomPorts:ue,parseJSONData:ne,checkExistingId:Y,getRandom:ve}}(o,f),bo=function(x,A){var v=4,D="127.0.0.1",j="wss://"+D+":",U="load",se="multiload",De="save",ve="batch",Ee="log",ye="certificate",ue="sign",Z="",le="",ne="",Y="",ee="",E=!1,G=Ce.generateNewIdSession(),B=null,N=null,Pe=null,et=null,tt=null,ot=function(u,h){et=u,tt=h},gt=function(u){B=u},vt=function(u,h,s){ce(h,s),Y=ye;var n=Ge(u);xe(Se(n))},yt=function(u,h,s,n,p,d){st("sign",u,h,s,n,p,d)},xt=function(u,h,s,n,p,d){st("cosign",u,h,s,n,p,d)},bt=function(u,h,s,n,p,d){st("countersign",u,h,s,n,p,d)};function st(u,h,s,n,p,d,b){ce(d,b),Y=ue;var M=He(u,s,n,p,Oe(h));xe(Se(M))}var at=function(u,h,s,n,p,d,b,M){ce(b,M),Y=ue;var V=Be(u,Oe(h),s,n,p,d);xe(Se(V))},Ct=function(u,h,s,n,p,d){ce(p,d),Y=ve;var b=nt(h,s,n,Oe(u),!1);xe(Se(b))},kt=function(u,h,s,n,p,d){ce(p,d),Y=ve;var b=nt(h,s,n,u,!0);xe(Se(b))},St=function(u,h,s,n,p,d){ce(p,d),Y=U;var b=rt("load",u,h,s,n,!1);xe(Se(b))},wt=function(u,h,s,n,p,d){ce(p,d),Y=se;var b=rt("load",u,h,s,n,!0);xe(Se(b))},ke=function(u,h){ce(u,h),Y=Ee;var s=rt("getLog");xe(Se(s))},qe=function(u,h,s,n,p,d,b){ce(d,b),Y=De;var M=it(Oe(u),h,s,n,p);xe(Se(M))};function ce(u,h){N=u,Pe=h}function Oe(u){return u?u.replace(/\+/g,"-").replace(/\//g,"_"):null}function Ge(u){var h=new Object;return h.op=y("op","selectcert"),h.idsession=y("idsession",G),h.properties=y("properties",u!=null?I.encode(u,!0):null,!0),h.ksb64=y("ksb64",B!=null?I.encode(B,!0):null,!0),h.sticky=y("sticky",Q),q&&(h.resetSticky=y("resetsticky",q)),h}function He(u,h,s,n,p){var d=new Object;return d.op=y("op",u),d.idsession=y("idsession",G),d.algorithm=y("algorithm",h),d.format=y("format",s),d.properties=y("properties",n!=null?I.encode(n,!0):null,!0),d.ksb64=y("ksb64",B!=null?I.encode(B,!0):null,!0),d.sticky=y("sticky",Q),q&&(d.resetSticky=y("resetsticky",q)),d.dat=y("dat",p==""?null:p,!0),d}function Be(u,h,s,n,p,d){var b=new Object;return b.op=y("op","signandsave"),b.idsession=y("idsession",G),b.cryptoOp=y("cop",u),b.algorithm=y("algorithm",s),b.format=y("format",n),b.properties=y("properties",p?I.encode(p,!0):null,!0),b.filename=y("filename",d),b.ksb64=y("ksb64",B?I.encode(B,!0):null,!0),b.sticky=y("sticky",Q),q&&(b.resetSticky=y("resetsticky",q)),b.dat=y("dat",h==""?null:h,!0),b}function nt(u,h,s,n,p){var d=new Object;return d.op=y("op","batch"),d.idsession=y("idsession",G),d.batchpresignerurl=y("batchpresignerurl",u),d.batchpostsignerurl=y("batchpostsignerurl",h),d.properties=y("properties",s!=null?I.encode(s,!0):null,!0),d.ksb64=y("ksb64",B!=null?I.encode(B,!0):null,!0),d.sticky=y("sticky",Q),q&&(d.resetSticky=y("resetsticky",q)),d.needcert=y("needcert",!0),d.dat=y("dat",n==""?null:n,!0),p&&(d.jsonbatch=y("jsonbatch",!0),Et&&(d.localBatchProcess=y("localBatchProcess",!0))),d}function rt(u,h,s,n,p,d){var b=new Object;return b.op=y("op",u),b.idsession=y("idsession",G),b.title=y("title",h),b.extensions=y("exts",s),b.description=y("desc",n),b.filePath=y("filePath",p),b.multiload=y("multiload",d),b}function it(u,h,s,n,p){var d=new Object;return d.op=y("op","save"),d.idsession=y("idsession",G),d.title=y("title",h),d.filename=y("filename",s),d.extension=y("exts",n),d.description=y("desc",p),d.dat=y("dat",u==""?null:u,!0),d}function Se(u){var h=[];Me&&h.push(y("mcv",Me));for(var s in u)h.push(u[s]);for(var n="afirma://"+encodeURIComponent(u.op.value)+"?",p=0;p<h.length;p++)h[p].value!=null&&h[p].value!="null"&&(n+=(p!=0?"&":"")+h[p].key+"="+(h[p].avoidEncoding===!0?h[p].value:encodeURIComponent(h[p].value)));return n}function xe(u){if(ee=u,lt())console.log("Enviamos el mensaje al socket abierto"),Ke(Ae.AUTOFIRMA_CONNECTION_RETRIES);else{var h=Ce.getRandomPorts(et,tt);ft(h),console.log("Tratamos de conectar con el cliente a traves de WebSockets en los puertos "+h),setTimeout(Ne,3e3,h,Ae.AUTOFIRMA_CONNECTION_RETRIES)}}function lt(){return!!ne&&E}function ft(u){for(var h="",s=0;s<u.length;s++)h+=u[s],s<u.length-1&&(h+=",");var n="afirma://websocket?ports="+h+"&v="+v+"&jvc="+a+"&idsession="+G;Rt(n)}function Ne(u,h){if(E)console.log("Enviamos el mensaje al socket"),Ke(Ae.AUTOFIRMA_CONNECTION_RETRIES);else if(h>0){for(var s=0;!E&&s<u.length;s++)Tt(u[s]);setTimeout(Ne,Ae.AUTOFIRMA_LAUNCHING_TIME,u,h-1)}else r("es.gob.afirma.standalone.ApplicationNotFoundException","No se ha podido conectar con AutoFirma.")}function Tt(u){var h;try{h=new WebSocket(j+u)}catch(s){console.log("Error estableciendo el WebSocket: "+s)}return h.onopen=function(s,n){E=!0,ne=this,console.log("Se abre el socket")},h.onclose=function(s){ne!=null&&ne===this&&(E=!1,ne=null,console.log("Se cierra el socket. Codigo WebSocket de cierre: "+(s?s.code:null)),r("java.lang.InterruptedException","AutoFirma se ha cerrado o ha cerrado el websocket de comunicacion"))},h.onmessage=function(s){console.log("Procesado por defecto del mensaje")},h.onerror=function(s){console.log("Procesado por defecto del error")},h}function Ke(u){ne.onmessage=fe,ne.onerror=function(h){console.log("Error en la comunicacion por websocket: "+h),Qe(ne,G,u-1)},Qe(ne,G,u)}var fe=function(u){console.log("Respuesta de la peticion de eco"),ne.onmessage=function(h){console.log("Respuesta obtenida de la operacion enviada"),_e(h.data)},ne.send(ee)};function Qe(u,h,s){if(s<=0){r("java.util.concurrent.TimeoutException","AutoFirma no respondio al saludo.");return}if(u.readyState===1)try{u.send("echo=-idsession="+h+"@EOF")}catch(n){console.log("Error en echo: "+n),setTimeout(Qe,Ae.AUTOFIRMA_LAUNCHING_TIME,u,h,s-1)}else console.log("El socket aun no esta preparado"),setTimeout(Qe,Ae.AUTOFIRMA_LAUNCHING_TIME,u,h,s-1)}function _e(u){if(u==A||u==null||u=="CANCEL"){r("es.gob.afirma.core.AOCancelledOperationException","Operacion cancelada por el usuario");return}if(u=="MEMORY_ERROR"){r("es.gob.afirma.core.OutOfMemoryError","El fichero que se pretende firmar o guardar excede de la memoria disponible para aplicacion");return}if(u.length>4&&u.substr(0,4)=="SAF_"){r("java.lang.Exception",u);return}if(u=="NULL"){r("java.lang.Exception","Error desconocido");return}if(Y==De)m(u);else if(Y==U)g(u,!1);else if(Y==se)g(u,!0);else if(Y==ye)C(u);else if(Y==ve)S(u);else if(Y==Ee)R(u);else if(Y==ue)O(u);else if(console.log("Operacion desconocida. Se devuelve directamente su resultado."),N){var h=N;ce(null,null),h(u)}else console.log("No se ha proporcionado funcion callback para procesar el resultado de la operacion")}function r(u,h){if(le=u,Z=h,Pe){var s=Pe;ce(null,null),s(u,h)}}function g(u,h){if(u.indexOf(":")<=0){r("java.lang.Exception","Respuesta no valida");return}if(!N){console.log("No se ha proporcionado funcion callback para procesar el resultado del lote de firma");return}var s,n,p=u.split("|");if(h)for(s=new Array,n=new Array,i=0;i<p.length;i++){var d=p[i].indexOf(":");s.push(p[i].substring(0,d)),n.push(p[i].substring(d+1).replace(/\-/g,"+").replace(/\_/g,"/"))}else{var d=p[0].indexOf(":");s=p[0].substring(0,d),n=p[0].substring(d+1).replace(/\-/g,"+").replace(/\_/g,"/")}if(N){var b=N;ce(null,null),b(s,n)}else console.log("No se ha proporcionado funcion callback a la que notificar el resultado de la carga de datos")}function m(u){if(u=="OK"||u=="SAVE_OK")if(N){var h=N;ce(null,null),h(u)}else console.log("No se ha proporcionado funcion callback a la notificar el resultado");else r("java.lang.Exception","Error desconocido al procesar los datos")}function C(u){if(N){var h=N;ce(null,null),h(u.replace(/\-/g,"+").replace(/\_/g,"/"))}else console.log("No se ha proporcionado funcion callback para devolver el certificado seleccionado")}function S(u){if(N){var h,s=null,n=u.indexOf("|");n==-1?h=u:(h=u.substring(0,n).replace(/\-/g,"+").replace(/\_/g,"/"),s=u.substring(n+1).replace(/\-/g,"+").replace(/\_/g,"/"));try{h=Ce.parseJSONData(h)}catch{}if(N){var p=N;ce(null,null),p(h,s)}else console.log("No se ha proporcionado funcion callback a la que devolver el resultado del lote")}else console.log("No se ha proporcionado funcion callback para procesar el resultado del lote de firma")}function R(u){if(!N){console.log("No se ha proporcionado funcion callback para procesar el log");return}var h=` === JAVASCRIPT INFORMATION === 
navigator.appCodeName: `+navigator.appCodeName+`
navigator.appName: `+navigator.appName+`
navigator.appVersion: `+navigator.appVersion+`
navigator.platform: `+navigator.platform+`
navigator.userAgent: `+navigator.userAgent+`
navigator.javaEnabled(): `+navigator.javaEnabled()+`
screen.width: `+(x.screen?screen.width:0)+`
screen.height: `+(x.screen?screen.height:0)+`

   === CLIENTE LOG === 
`+u;if(N){var s=N;ce(null,null),s(h)}else console.log("No se ha proporcionado funcion callback a la que devolver el log")}function O(u){if(!N){console.log("No se ha proporcionado funcion callback para procesar el resultado de la firma");return}var h,s=null,n=null,p=u.indexOf("|");if(p==-1)h=I.decode(u,!0).replace(/\-/g,"+").replace(/\_/g,"/");else{s=u.substring(0,p).replace(/\-/g,"+").replace(/\_/g,"/");var d=u.indexOf("|",p+1);d==-1?h=u.substring(p+1).replace(/\-/g,"+").replace(/\_/g,"/"):(h=u.substring(p+1,d).replace(/\-/g,"+").replace(/\_/g,"/"),n=I.decode(u.substring(d),!0))}if(N){var b=N;ce(null,null),b(h,s,n)}else console.log("No se ha proporcionado funcion callback a la que devolver la firma generada")}function y(u,h,s){var n=new Object;return n.key=u,n.value=h,n.avoidEncoding=!!s,n}function $(){return"Cliente JavaScript"}function k(){return Z}function w(){return le}return{echo:$,setKeyStore:gt,setPortRange:ot,sign:yt,coSign:xt,counterSign:bt,signBatchJSON:kt,signBatchXML:Ct,selectCertificate:vt,saveDataToFile:qe,signAndSaveToFile:at,getFileNameContentBase64:St,getMultiFileNameContentBase64:wt,setStickySignatory:Ot,setLocale:_t,getErrorMessage:k,getErrorType:w,getCurrentLog:ke}},Co=function(x,A,v){var D="",j="",U="",se,De=1,ve=500,Ee="https://127.0.0.1:",ye="",ue=0,Z=!1,le=!1,ne=!1,Y="",ee=ae.isInternetExplorer()?12e3:ae.isFirefox()?458752:1048576,E=!1,G=null,B=null,N=null,Pe=null,et=null,tt=null,ot=function(s,n){et=s,tt=n};function gt(s){G=s}function vt(s,n,p){B=n,N=p,yt(s)}function yt(s){var n=new Object;n.op=m("op","selectcert"),n.properties=m("properties",s!=null?I.encode(s):null),n.keystore=m("keystore",G??null),n.ksb64=m("ksb64",G!=null?I.encode(G):null),n.sticky=m("sticky",Q),q&&(n.resetSticky=m("resetsticky",q)),Oe(ce(n))}function xt(s,n,p,d,b,M){B=b,N=M,at("sign",s,n,p,d)}function bt(s,n,p,d,b,M){B=b,N=M,at("cosign",s,n,p,d)}function st(s,n,p,d,b,M){B=b,N=M,at("countersign",s,n,p,d)}function at(s,n,p,d,b){(n==v||n=="")&&(n=null),n!=null&&!dt(n)&&(n=n.replace(/\+/g,"-").replace(/\//g,"_"));var M=He(s,p,d,b,n,G);Oe(ce(M))}function Ct(s,n,p,d,b,M,V,we){B=V,N=we,kt(s,n,p,d,b,M)}function kt(s,n,p,d,b,M){(n==v||n=="")&&(n=null),n!=null&&!dt(n)&&(n=n.replace(/\+/g,"-").replace(/\//g,"_"));var V=Be(s,p,d,b,M,n,G);Oe(ce(V))}function St(s,n,p,d,b,M){B=b,N=M,ke(s,n,p,d,!1)}function wt(s,n,p,d,b,M){B=b,N=M,ke(s,n,p,d,!0)}function ke(s,n,p,d,b){(s==v||s=="")&&(s=null),s!=null&&(s=s.replace(/\+/g,"-").replace(/\//g,"_"));var M=qe(G,n,p,d,s,b);Oe(ce(M))}function qe(s,n,p,d,b,M){var V=new Object;return V.op=m("op","batch"),V.keystore=m("keystore",s??null),V.ksb64=m("ksb64",s!=null?I.encode(s):null),V.batchpresignerurl=m("batchpresignerurl",n),V.batchpostsignerurl=m("batchpostsignerurl",p),V.properties=m("properties",d!=null?I.encode(d):null),V.dat=m("dat",b==""?null:b),V.needcert=m("needcert",!0),V.sticky=m("sticky",Q),q&&(V.resetSticky=m("resetsticky",q)),M&&(V.jsonbatch=m("jsonbatch",!0)),Et&&(V.localBatchProcess=m("localBatchProcess",!0)),V}function ce(s){var n=[];Me&&n.push(m("mcv",Me));for(var p in s)n.push(s[p]);for(var d="afirma://"+encodeURIComponent(s.op.value)+"?",b=0;b<n.length;b++)n[b].value!=null&&n[b].value!="null"&&(d+=(b!=0?"&":"")+n[b].key+"="+encodeURIComponent(n[b].value));return d}function Oe(s){if(U==""){var n=Ce.getRandomPorts(et,tt);Ge(n),setTimeout(rt,Ae.AUTOFIRMA_LAUNCHING_TIME,n,s)}else E=!1,it(U,s,Ae.AUTOFIRMA_CONNECTION_RETRIES)}function Ge(s){for(var n="",p=0;p<s.length;p++)n+=s[p],p<s.length-1&&(n+=",");se=Ce.generateNewIdSession();var d="afirma://service?ports="+n+"&v="+De+"&jvc="+a+"&idsession="+se;Rt(d)}function He(s,n,p,d,b,M){var V=new Object;return V.op=m("op",s),V.keystore=m("keystore",M??null),V.ksb64=m("ksb64",M!=null?I.encode(M):null),V.algorithm=m("algorithm",n),V.format=m("format",p),V.properties=m("properties",d!=null?I.encode(d):null),V.dat=m("dat",b==""?null:b),V.sticky=m("sticky",Q),q&&(V.resetSticky=m("resetsticky",q)),V}function Be(s,n,p,d,b,M,V){var we=new Object;return we.op=m("op","signandsave"),we.cryptoOp=m("cop",s),we.keystore=m("keystore",V??null),we.ksb64=m("ksb64",V!=null?I.encode(V):null),we.algorithm=m("algorithm",n),we.format=m("format",p),we.properties=m("properties",d!=null?I.encode(d):null),we.filename=m("filename",b),we.dat=m("dat",M==""?null:M),we.sticky=m("sticky",Q),q&&(we.resetSticky=m("resetsticky",q)),we}function nt(s,n,p,d,b,M){var V=new Object;return V.op=m("op",s),V.title=m("title",n),V.extensions=m("exts",p),V.description=m("desc",d),V.filePath=m("filePath",b),V.multiload=m("multiload",M),V}function rt(s,n){E=!1;var p=new Object;p.locked=!1;for(var d=0;!E&&d<s.length;d++)it(s[d],n,Ae.AUTOFIRMA_CONNECTION_RETRIES,p)}function it(s,n,p,d){Pe=n;var b=We();b.open("POST",Ee+s+"/afirma",!0),b.setRequestHeader("Content-type","application/x-www-form-urlencoded"),b.onreadystatechange=function(){if(b.readyState==4&&b.status==200&&I.decode(b.responseText,!0)=="OK"&&!E)U=s,Y=Ee+U+"/afirma",E=!0,d&&(d.locked=!0),Z=Pe.indexOf("afirma://selectcert")>-1,le=Pe.indexOf("afirma://save")>-1,ne=Pe.indexOf("afirma://batch")>-1,Pe.indexOf("afirma://signandsave")>-1,xe();else if((!d||!d.locked)&&!E&&b.readyState!=2&&b.readyState!=3)if(p--,U!=""&&p<Ae.AUTOFIRMA_CONNECTION_RETRIES/2)U="",d&&(d.locked=!0),p=Ae.AUTOFIRMA_CONNECTION_RETRIES,Oe(Pe);else if(p==0){(!d||!d.locked)&&(d&&(d.locked=!0),N("es.gob.afirma.standalone.ApplicationNotFoundException","No se ha podido conectar con AutoFirma."));return}else setTimeout(Se,Ae.AUTOFIRMA_LAUNCHING_TIME,s,p,d)},E||b.send("echo=-idsession="+se+"@EOF")}function Se(s,n,p){it(s,Pe,n,p)}function xe(){var s=Pe;if(s.length>ee){lt(s,1,Math.ceil(s.length/ee));return}var n=We();n.open("POST",Y,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(n.status==404&&fe("java.lang.IOException",n.responseText),le){n.readyState==4&&I.decode(n.responseText)!=""&&Ke(I.decode(n.responseText));return}else if(n.readyState==4&&n.status==200&&n.responseText!=""){if(I.decode(n.responseText)=="MEMORY_ERROR"){fe("java.lang.OutOfMemoryError","Problema de memoria en servidor");return}ye="",Ne(1,I.decode(n.responseText,!0))}else n.responseText==""&&n.status==0&&n.readyState==0&&setTimeout(xe,ve)};try{n.onerror=function(p){p.target.status==0?fe("java.lang.IOException","Se ha perdido la conexion con la aplicacion @firma "+p.target.statusText):fe("java.lang.IOException","Ocurrio un error de red en la llamada al servicio de firma "+p.target.statusText)}}catch{}n.send("cmd="+I.encode(s,!0)+"idsession="+se+"@EOF")}function lt(s,n,p){var d=We();d.open("POST",Y,!0),d.setRequestHeader("Content-type","application/x-www-form-urlencoded");var b=s.substring((n-1)*ee,Math.min(ee*n,s.length));d.onreadystatechange=function(M){if(d.status==404){fe("java.lang.Exception",d.responseText);return}d.readyState==4&&d.status==200&&d.responseText!=""?(ue++,I.decode(d.responseText,!0)=="MORE_DATA_NEED"?ue<p&&lt(s,n+1,p):I.decode(d.responseText,!0)=="OK"?ue==p&&(ue=0,ft()):I.decode(d.responseText)=="MEMORY_ERROR"&&Ke(I.decode(d.responseText))):d.responseText==""&&d.status==0&&d.readyState==0&&setTimeout(lt,ve,s,n,p)};try{d.onerror=function(M){M.target.status==0?fe("java.lang.IOException","Se ha perdido la conexion con la aplicacion @firma "+M.target.statusText):fe("java.lang.IOException","Ocurrio un error de red en la llamada al servicio de firma "+M.target.statusText)}}catch{}d.send("fragment=@"+n+"@"+p+"@"+I.encode(b,!0)+"idsession="+se+"@EOF")}function ft(){httpRequest=We(),httpRequest.open("POST",Y,!0),httpRequest.setRequestHeader("Content-type","application/x-www-form-urlencoded"),httpRequest.onreadystatechange=function(){if(httpRequest.status==404&&fe("java.lang.Exception",httpRequest.responseText),le){httpRequest.readyState==4&&I.decode(httpRequest.responseText)!=""&&Ke(I.decode(httpRequest.responseText));return}else httpRequest.readyState==4&&httpRequest.status==200&&httpRequest.responseText!=""?(I.decode(httpRequest.responseText)=="MEMORY_ERROR"&&Ke(I.decode(httpRequest.responseText)),ye="",Ne(1,I.decode(httpRequest.responseText,!0))):httpRequest.status==0&&httpRequest.readyState==0&&setTimeout(ft,ve)};try{httpRequest.onerror=function(s){s.target.status==0?fe("java.lang.IOException","Se ha perdido la conexion con la aplicacion @firma "+s.target.statusText):fe("java.lang.IOException","Ocurrio un error de red en la llamada al servicio de firma "+s.target.statusText)}}catch{}httpRequest.send("firm=idsession="+se+"@EOF")}function Ne(s,n){httpRequest=We(),httpRequest.open("POST",Y,!0),httpRequest.setRequestHeader("Content-type","application/x-www-form-urlencoded"),httpRequest.onreadystatechange=function(){if(httpRequest.readyState==4&&httpRequest.status==200&&httpRequest.responseText!=""){if(I.decode(httpRequest.responseText)=="MEMORY_ERROR"){fe("java.lang.OutOfMemoryError","Problema de memoria en servidor");return}ye+=I.decode(httpRequest.responseText,!0),s==n?(ne?(Qe(ye),ne=!1):Z?(Tt(ye),Z=!1):Ke(ye),ye=""):Ne(s+1,n)}else httpRequest.responseText==""&&httpRequest.status==0&&httpRequest.readyState==0&&setTimeout(Ne,ve,s,n)};try{httpRequest.onerror=function(p){p.target.status==0?fe("java.lang.IOException","Se ha perdido la conexion con la aplicacion @firma "+p.target.statusText):fe("java.lang.IOException","Ocurrio un error de red en la llamada al servicio de firma "+p.target.statusText)}}catch{}s<=n&&httpRequest.send("send=@"+s+"@"+n+"idsession="+se+"@EOF")}function Tt(s){if(s==v||s==null||s=="CANCEL"){N("es.gob.afirma.core.AOCancelledOperationException","Operacion cancelada por el usuario");return}if(s.length>4&&s.substr(0,4)=="SAF_"){N("java.lang.Exception",s);return}if(s=="NULL"){N("java.lang.Exception","Error desconocido");return}B(s.replace(/\-/g,"+").replace(/\_/g,"/"))}function Ke(s){if(s==v||s==null||s=="CANCEL"){N("es.gob.afirma.core.AOCancelledOperationException","Operacion cancelada por el usuario");return}if(s=="OK"){try{s=Ce.parseJSONData(s)}catch{}B(s,null);return}if(s=="MEMORY_ERROR"){N("es.gob.afirma.core.OutOfMemoryError","El fichero que se pretende firmar o guardar excede de la memoria disponible para aplicacion");return}if(s.length>4&&s.substr(0,4)=="SAF_"){N("java.lang.Exception",s);return}if(s=="NULL"){N("java.lang.Exception","Error desconocido");return}if(s=="SAVE_OK"){B&&B(s);return}if(s.length>150&&s.substr(0,150).indexOf("<log>")!=-1){var n=` === JAVASCRIPT INFORMATION === 
navigator.appCodeName: `+navigator.appCodeName+`
navigator.appName: `+navigator.appName+`
navigator.appVersion: `+navigator.appVersion+`
navigator.platform: `+navigator.platform+`
navigator.userAgent: `+navigator.userAgent+`
navigator.javaEnabled(): `+navigator.javaEnabled()+`
screen.width: `+(A.screen?screen.width:0)+`
screen.height: `+(A.screen?screen.height:0)+`

   === CLIENTE LOG === 
`+s;B(n);return}if(s.indexOf(":")>0){var p=s.split("|");if(p.length==1){var Xe=p[0].indexOf(":"),d=p[0];Xe==-1?fileName=I.decode(d,!0):(fileName=d.substring(0,Xe),dataB64=d.substring(Xe+1).replace(/\-/g,"+").replace(/\_/g,"/")),B(fileName,dataB64);return}else if(p.length>1){var b=new Array,M=new Array;for(i=0;i<p.length;i++){var Xe=p[i].indexOf(":");Xe==-1?(b.push(p[i]),M.push("")):(b.push(p[i].substring(0,Xe)),M.push(p[i].substring(Xe+1).replace(/\-/g,"+").replace(/\_/g,"/")))}}B(b,M);return}var V,we=null,Xe=s.indexOf("|");Xe==-1?V=I.decode(s,!0).replace(/\-/g,"+").replace(/\_/g,"/"):(we=s.substring(0,Xe).replace(/\-/g,"+").replace(/\_/g,"/"),V=s.substring(Xe+1).replace(/\-/g,"+").replace(/\_/g,"/")),B(V,we)}function fe(s,n){N&&N(s,n)}function Qe(s){if(s==v||s==null||s=="CANCEL"){N("es.gob.afirma.core.AOCancelledOperationException","Operacion cancelada por el usuario");return}if(s.length>4&&s.substr(0,4)=="SAF_"){N("java.lang.Exception",s);return}if(s=="NULL"){N("java.lang.Exception","Error desconocido");return}var n,p=null,d=s.indexOf("|");d==-1?n=s:(n=s.substring(0,d).replace(/\-/g,"+").replace(/\_/g,"/"),p=s.substring(d+1).replace(/\-/g,"+").replace(/\_/g,"/"));try{n=Ce.parseJSONData(n)}catch{}B(n,p)}function _e(s,n,p,d,b,M,V){B=M,N=V,r(s,n,p,d,b)}function r(s,n,p,d,b){(s==v||s=="")&&(s=null),s!=null&&!dt(s)&&(s=s.replace(/\+/g,"-").replace(/\//g,"_"));var M=g(s,n,p,d,b);Oe(ce(M))}function g(s,n,p,d,b){var M=new Object;return M.op=m("op","save"),M.title=m("title",n),M.filename=m("filename",p),M.extension=m("exts",d),M.description=m("desc",b),M.dat=m("dat",s==""?null:s),M}function m(s,n){var p=new Object;return p.key=s,p.value=n,p}function C(s,n){return s!=null?I.encode(s):null}function S(s,n){return s!=null?I.decode(s):null}function R(s,n,p,d,b,M){B=b,N=M,$("load",s,n,p,d,!1)}function O(s,n,p,d,b,M){B=b,N=M,$("load",s,n,p,d,!0)}function y(s,n){B=s,N=n,k()}function $(s,n,p,d,b,M){var V=nt(s,n,p,d,b,M);Oe(ce(V))}function k(){var s=nt("getLog");Oe(ce(s))}function w(){return"Cliente JavaScript"}function u(){return D}function h(){return j}return{echo:w,checkTime:Pt,setKeyStore:gt,setPortRange:ot,sign:xt,coSign:bt,counterSign:st,signBatchJSON:wt,signBatchXML:St,selectCertificate:vt,saveDataToFile:_e,signAndSaveToFile:Ct,getFileNameContentBase64:R,getMultiFileNameContentBase64:O,getBase64FromText:C,getTextFromBase64:S,setStickySignatory:Ot,setLocale:_t,getErrorMessage:u,getErrorType:h,getCurrentLog:y}},Ft=function(x,A,v){var D=2e3,j=3,U=ae.isAndroid()||ae.isIOS()?4e3:3e3,se=ae.isAndroid()||ae.isIOS()?15:10,De=!0,ve="batch",Ee="certificate",ye="sign",ue=ye,Z,le="",ne="",Y=null,ee=null,E=null;if(x!=v&&x!=null)if(x.indexOf("://")!=-1&&x.indexOf("/",x.indexOf("://")+3)!=-1){var G=x.substring(0,x.indexOf("/",x.indexOf("://")+3));ee=G+"/afirma-signature-retriever/RetrieveService",E=G+"/afirma-signature-storage/StorageService"}else ee=x+"/afirma-signature-retriever/RetrieveService",E=x+"/afirma-signature-storage/StorageService";function B(r){Y=r}function N(r,g,m){ue=Ee;var C=Ce.generateNewIdSession(),S=ce(),R="selectcert";Q&&!q&&Z&&(r=xe(Z,r));var O=0,y=new Array;y[O++]={key:"ver",value:j},y[O++]={key:"op",value:R},C!=null&&C!=v&&(y[O++]={key:"id",value:C}),S!=null&&S!=v&&(y[O++]={key:"key",value:S}),Y!=null&&Y!=v&&(y[O++]={key:"keystore",value:Y},y[O++]={key:"ksb64",value:I.encode(Y)}),E!=null&&E!=v&&(y[O++]={key:"stservlet",value:E}),r!=null&&r!=v&&(y[O++]={key:"properties",value:I.encode(r)}),!ae.isAndroid()&&!ae.isIOS()&&(y[O++]={key:"aw",value:"true"});var $=Be(R,y);if(qe($)){if(E==null||E==v){ke("java.lang.IllegalArgumentException","No se ha indicado la direccion del servlet para el guardado de datos");return}else if(ee==null||ee==v){ke("java.lang.IllegalArgumentException","No se ha indicado la direccion del servlet para la recuperacion de datos");return}Ge(C,S,E,ee,R,y,g,m)}else He($,C,S,g,m)}function Pe(r,g,m,C,S,R){ot("sign",r,g,m,C,S,R)}function et(r,g,m,C,S,R){ot("cosign",r,g,m,C,S,R)}function tt(r,g,m,C,S,R){ot("countersign",r,g,m,C,S,R)}function ot(r,g,m,C,S,R,O){ue=ye,(g==v||g=="")&&(g=null),g!=null&&!dt(g)&&(g=g.replace(/\+/g,"-").replace(/\//g,"_"),g=g.replace(/\n/g,"").replace(/\r/g,"")),Q&&!q&&Z&&(S=xe(Z,S));var y=Ce.generateNewIdSession(),$=ce(),k=0,w=new Array;w[k++]={key:"ver",value:j},r!=null&&r!=v&&(w[k++]={key:"op",value:r}),y!=null&&y!=v&&(w[k++]={key:"id",value:y}),$!=null&&$!=v&&(w[k++]={key:"key",value:$}),Y!=null&&Y!=v&&(w[k++]={key:"keystore",value:Y},w[k++]={key:"ksb64",value:I.encode(Y)}),E!=null&&E!=v&&(w[k++]={key:"stservlet",value:E}),C!=null&&C!=v&&(w[k++]={key:"format",value:C}),m!=null&&m!=v&&(w[k++]={key:"algorithm",value:m}),S!=null&&S!=v&&(w[k++]={key:"properties",value:I.encode(S)}),!ae.isAndroid()&&!ae.isIOS()&&(w[k++]={key:"aw",value:"true"}),g!=null&&(w[k++]={key:"dat",value:g});var u=Be(r,w);if(qe(u)){if(E==null||E==v){ke("java.lang.IllegalArgumentException","No se ha indicado la direccion del servlet para el guardado de datos");return}Ge(y,$,E,ee,r,w,R,O)}else He(u,y,$,R,O)}function gt(r,g,m,C,S,R,O,y){ue=ye,(g==v||g=="")&&(g=null),g!=null&&!dt(g)&&(g=g.replace(/\+/g,"-").replace(/\//g,"_"),g=g.replace(/\n/g,"").replace(/\r/g,"")),Q&&!q&&Z&&(S=xe(Z,S));var $=Ce.generateNewIdSession(),k=ce(),w=0,u="signandsave",h=new Array;h[w++]={key:"ver",value:j},h[w++]={key:"op",value:u},r!=null&&r!=v&&(h[w++]={key:"cop",value:r}),$!=null&&$!=v&&(h[w++]={key:"id",value:$}),k!=null&&k!=v&&(h[w++]={key:"key",value:k}),Y!=null&&Y!=v&&(h[w++]={key:"keystore",value:Y},h[w++]={key:"ksb64",value:I.encode(Y)}),E!=null&&E!=v&&(h[w++]={key:"stservlet",value:E}),C!=null&&C!=v&&(h[w++]={key:"format",value:C}),m!=null&&m!=v&&(h[w++]={key:"algorithm",value:m}),S!=null&&S!=v&&(h[w++]={key:"properties",value:I.encode(S)}),R!=null&&R!=v&&(h[w++]={key:"filename",value:R}),!ae.isAndroid()&&!ae.isIOS()&&(h[w++]={key:"aw",value:"true"}),g!=null&&(h[w++]={key:"dat",value:g});var s=Be(u,h);if(qe(s)){if(E==null||E==v){ke("java.lang.IllegalArgumentException","No se ha indicado la direccion del servlet para el guardado de datos");return}Ge($,k,E,ee,u,h,O,y)}else He(s,$,k,O,y)}function vt(r,g,m,C,S,R){ue=ve,(r==v||r=="")&&(r=null),r!=null&&!dt(r)&&(r=r.replace(/\+/g,"-").replace(/\//g,"_"),r=r.replace(/\n/g,"").replace(/\r/g,"")),Q&&!q&&Z&&(C=xe(Z,C));var O=Ce.generateNewIdSession(),y=ce(),$="batch",k=0,w=new Array;w[k++]={key:"ver",value:j},w[k++]={key:"op",value:$},O!=null&&O!=v&&(w[k++]={key:"id",value:O}),y!=null&&y!=v&&(w[k++]={key:"key",value:y}),Y!=null&&Y!=v&&(w[k++]={key:"keystore",value:Y},w[k++]={key:"ksb64",value:I.encode(Y)}),E!=null&&E!=v&&(w[k++]={key:"stservlet",value:E}),g!=null&&g!=v&&(w[k++]={key:"batchpresignerurl",value:g}),m!=null&&m!=v&&(w[k++]={key:"batchpostsignerurl",value:m}),C!=null&&C!=v&&(w[k++]={key:"properties",value:I.encode(C)}),!ae.isAndroid()&&!ae.isIOS()&&(w[k++]={key:"aw",value:"true"}),w[k++]={key:"needcert",value:"true"},r!=null&&(w[k++]={key:"dat",value:r});var u=Be($,w);if(qe(u)){if(E==null||E==v){ke("java.lang.IllegalArgumentException","No se ha indicado la direccion del servlet para el guardado de datos");return}Ge(O,y,E,ee,$,w,S,R)}else He(u,O,y,S,R)}function yt(r,g,m,C,S,R){ue=ve,Q&&!q&&Z&&(C=xe(Z,C));var O=Ce.generateNewIdSession(),y=ce(),$="batch",k=0,w=new Array;w[k++]={key:"ver",value:j},w[k++]={key:"op",value:$},O!=null&&O!=v&&(w[k++]={key:"id",value:O}),y!=null&&y!=v&&(w[k++]={key:"key",value:y}),Y!=null&&Y!=v&&(w[k++]={key:"keystore",value:Y},w[k++]={key:"ksb64",value:I.encode(Y)}),E!=null&&E!=v&&(w[k++]={key:"stservlet",value:E}),g!=null&&g!=v&&(w[k++]={key:"batchpresignerurl",value:g}),m!=null&&m!=v&&(w[k++]={key:"batchpostsignerurl",value:m}),C!=null&&C!=v&&(w[k++]={key:"properties",value:I.encode(C)}),!ae.isAndroid()&&!ae.isIOS()&&(w[k++]={key:"aw",value:!0}),Et&&(w[k++]={key:"localBatchProcess",value:!0}),w[k++]={key:"needcert",value:!0},w[k++]={key:"jsonbatch",value:!0},w[k++]={key:"dat",value:r};var u=Be($,w);if(qe(u)){if(E==null||E==v){ke("java.lang.IllegalArgumentException","No se ha indicado la direccion del servlet para el guardado de datos");return}Ge(O,y,E,ee,$,w,S,R)}else He(u,O,y,S,R)}function xt(r,g,m,C,S,R,O){r!=v&&r!=null&&r!=""&&(r=r.replace(/\+/g,"-").replace(/\//g,"_"));var y=Ce.generateNewIdSession(),$=ce(),k=0,w="save",u=new Array;u[k++]={key:"ver",value:j},u[k++]={key:"op",value:w},y!=null&&y!=v&&(u[k++]={key:"id",value:y}),$!=null&&$!=v&&(u[k++]={key:"key",value:$}),E!=null&&E!=v&&(u[k++]={key:"stservlet",value:E}),g!=null&&g!=v&&(u[k++]={key:"title",value:g}),m!=null&&m!=v&&(u[k++]={key:"filename",value:m}),C!=null&&C!=v&&(u[k++]={key:"extension",value:C}),S!=null&&S!=v&&(u[k++]={key:"description",value:S}),!ae.isAndroid()&&!ae.isIOS()&&(u[k++]={key:"aw",value:"true"}),r!=null&&r!=v&&r!=""&&(u[k++]={key:"dat",value:r});var h=Be(w,u);if(qe(h)){if(E==null||E==v){ke("java.lang.IllegalArgumentException","No se ha indicado la direccion del servlet para el guardado de datos");return}Ge(y,$,E,ee,w,u,R,O)}else He(h,y,$,R,O)}function bt(r,g,m,C,S,R){var O="java.lang.UnsupportedOperationException",y="La operacion de carga de fichero no esta disponible por servidor intermedio";R?R(O,y):ke(O,y)}function st(r,g,m,C,S,R){var O="java.lang.UnsupportedOperationException",y="La operacion de carga de multiples ficheros no esta disponible por servidor intermedio";R?R(O,y):ke(O,y)}function at(){return"Cliente JavaScript"}function Ct(){return le}function kt(){return ne}function St(r,g){var m="java.lang.UnsupportedOperationException",C="La operacion de obtencion del log no esta disponible por servidor intermedio";g?g(m,C):ke(m,C)}function wt(r,g){E=r,ee=g}function ke(r,g){throw ne=r,le=g,new Error}function qe(r){return r.length>D}function ce(){var r;if(typeof A.crypto<"u"&&typeof A.crypto.getRandomValues<"u"){var g=new Uint32Array(1);A.crypto.getRandomValues(g),r=Oe(g[0]%1e8,8)}else r=Oe(Math.floor((Ce.getRandom()+1)%1e8),8);return r}function Oe(r,g){return g-=r.toString().length,g>0?new Array(g+(/\./.test(r)?2:1)).join("0")+r:r+""}function Ge(r,g,m,C,S,R,O,y){var $=Ce.generateNewIdSession(),k=We();k||ke("java.lang.Exception","Su navegador no permite preprocesar los datos que desea tratar"),k.open("POST",m,!0),k.setRequestHeader("Content-type","application/x-www-form-urlencoded"),k.onreadystatechange=function(){if(k.readyState==4)if(k.status==200){var u=rt(S,$,C,g);if(qe(u)){y("java.lang.IllegalArgumentException","La URL de invocacion al servicio de firma es demasiado larga.");return}He(u,r,g,O,y)}else console.log("Error al enviar los datos al servidor intermedio. HTTP Status: "+k.status),y("java.lang.IOException","Ocurrio un error al enviar los datos a la aplicacion nativa")};try{k.onerror=function(u){console.log("Error al enviar los datos al servidor intermedio (HTTP Status: "+k.status+"): "+u.message),y("java.lang.IOException","Ocurrio un error al enviar los datos al servicio intermedio para la comunicacion con la aplicacion nativa")}}catch{}Me&&(R[R.length]={key:"mcv",value:Me});var w="op=put&v=1_0&id="+$+"&dat="+Qe(nt(S,R),g);try{k.send(w)}catch{y("java.lang.IOException","No se pudo conectar con el servidor remoto")}}function He(r,g,m,C,S){De=!1,Rt(r),g&&(C||S)&&Tt(g,ee,m,r,C,S)}function Be(r,g){var m="jvc="+a;if(Me&&(m+="&mcv="+encodeURIComponent(Me)),g!=null&&g!=v)for(var C=0;C<g.length;C++)g[C].value!=null&&g[C].value!="null"&&(m+="&"+g[C].key+"="+encodeURIComponent(g[C].value));var S;return ae.isChrome()&&ae.isAndroid()?S="intent://"+r+"?"+m+"#Intent;scheme=afirma;package=es.gob.afirma;end":S="afirma://"+r+"?"+m,S}function nt(r,g){r=r??"op";var m="<"+r+">";if(g!=null)for(var C=0;C<g.length;C++)m+='<e k="'+g[C].key+'" v="'+g[C].value+'"/>';return I.encode(m+"</"+r+">")}function rt(r,g,m,C){var S=0,R=new Array;return R[S++]={key:"fileid",value:g},(m!=null||m!=v)&&(R[S++]={key:"rtservlet",value:m}),(C!=null||C!=v)&&(R[S++]={key:"key",value:C}),Be(r,R)}function it(r,g,m,C){if(r.substr(0,6).toLowerCase()=="err-06")return!0;if(r.substr(0,5).toLowerCase()=="#wait")return"reset";if(r.substr(0,4).toLowerCase()=="err-"&&r.indexOf(":=")!=-1)return le=r.substring(r.indexOf(":=")+2),r.substr(0,7).toLowerCase()=="err-11:"?ne="es.gob.afirma.core.AOCancelledOperationException":ne="java.lang.Exception",C(ne,le),!1;if(r=="CANCEL"||r==`CANCEL\r
`)return C("es.gob.afirma.core.AOCancelledOperationException","Operacion cancelada por el usuario"),!1;if(r=="OK"||r==`OK\r
`)return m(),!1;if(r.length>4&&r.substr(0,4)=="SAF_")return C("java.lang.Exception",r),!1;if(ue==ve){var S,O=null,$=r.indexOf("|");$==-1?g!=v&&g!=null?S=fe(r,g):S=_e(r):(g!=v&&g!=null?(S=fe(r.substring(0,$),g,!0),O=fe(r.substring($+1),g)):(S=_e(r.substring(0,$)),O=_e(r.substring($+1))),Q?O&&(Z=O):Z=null);try{S=Ce.parseJSONData(S)}catch{}return m(S,O),!1}else if(ue==Ee){var O;return g!=v&&g!=null?O=fe(r,g):O=_e(r),Z=Q?O:null,m(O),!1}var R,O=null,y=null,$=r.indexOf("|");if($==-1)g!=v&&g!=null?R=fe(r,g):R=_e(r);else{var k=r.indexOf("|",$+1);k==-1?g!=v&&g!=null?(O=fe(r.substring(0,$),g,!0),R=fe(r.substring($+1),g)):(O=_e(r.substring(0,$)),R=_e(r.substring($+1))):g!=v&&g!=null?(O=fe(r.substring(0,$),g,!0),R=fe(r.substring($+1,k),g,!0),y=I.decode(fe(r.substring(k+1),g))):(O=_e(r.substring(0,$)),R=_e(r.substring($+1)),y=I.decode(_e(r.substring(k+1))))}return Q?O&&(Z=O):Z=null,m(R,O,y),!1}function Se(r,g,m){ne=r!=null&&r.length>0?r:"java.lang.Exception",le=g!=null&&g.length>0?g:"No se ha podido extablecer la comunicación entre la aplicación de firma y la página web",m!=v&&m!=null&&m(ne,le)}function xe(r,g){for(var m=ft(g,`
`),C=[],S=0;S<m.length;S++)m[S]&&!lt(m[S])&&C.push(m[S]);C.push("filters=encodedcert:"+r),C.push("headless=true");var R="";if(C.length>0){R=C[0];for(var S=1;S<C.length;S++)R+=`
`+C[S]}return R}function lt(r){return r.indexOf("filters=")==0||r.indexOf("filter=")==0||r.indexOf("filters.")==0||r.indexOf("headless=")==0}function ft(r,g){var m=[];if(r){for(var C=0,S;(S=r.indexOf(g,C))!=-1;)m.push(r.substring(C,S)),C=S+1;m.push(r.substring(C))}return m}var Ne=0;function Tt(r,g,m,C,S,R){var O=We();O||ke("java.lang.Exception","Su navegador no permite obtener el resulado de la operación"),Ne=0,setTimeout(Ke,U,O,g,"op=get&v=1_0&id="+r+"&it=0",m,C,r,S,R)}function Ke(r,g,m,C,S,R,O,y){if(De){Se("es.gob.afirma.standalone.ApplicationNotFoundException","AutoFirma no se encuentra instalado en el sistema.",y);return}if(Ne>se){Se("java.util.concurrent.TimeoutException","El tiempo para la recepcion de la firma por la pagina web ha expirado",y);return}Ne++,r.onreadystatechange=function(){if(r.readyState==4)if(r.status==200){var $=it(r.responseText,C,O,y);if($){var k=Ne-1;$=="reset"&&(Ne=0),setTimeout(Ke,U,r,g,m.replace("&it="+k,"&it="+Ne),C,S,R,O,y)}}else Se("java.lang.Exception","No se pudo conectar con el servidor intermedio para la recuperacion del resultado de la operacion (Status: "+r.status+")",y)};try{r.onerror=function(){Se("java.lang.Exception","No se pudo conectar con el servidor intermedio para la recuperacion del resultado de la operacion (Status: "+r.status+")",y)}}catch{}r.open("POST",g,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded");try{r.send(m)}catch{Se("java.lang.IOException","Ocurrio un error de red en la llamada al servicio de firma",y);return}}function fe(r,g,m){var C=r.indexOf("."),S=r.substr(0,C),R=Ye.des(g,Ye.base64ToString(_e(r.substr(C+1))),0,0,null);return Ye.stringToBase64(R.substr(0,R.length-parseInt(S)-(m?0:8)))}function Qe(r,g){var m=Ye.base64ToString(_e(r)),C=(8-m.length%8)%8;return C+"."+Ye.stringToBase64(Ye.des(g,m,1,0,null)).replace(/\+/g,"-").replace(/\//g,"_")}function _e(r){return r&&r.replace(/\-/g,"+").replace(/\_/g,"/")}return{echo:at,setKeyStore:B,sign:Pe,coSign:et,counterSign:tt,signBatchJSON:yt,signBatchXML:vt,selectCertificate:N,saveDataToFile:xt,signAndSaveToFile:gt,getFileNameContentBase64:bt,getMultiFileNameContentBase64:st,setServlets:wt,setStickySignatory:Ot,setLocale:_t,getErrorMessage:Ct,getErrorType:kt,getCurrentLog:St}};return{VERSION:e,CHECKTIME_NO:Fe,CHECKTIME_RECOMMENDED:pt,CHECKTIME_OBLIGATORY:mt,JAVA_ARGUMENTS:_,SYSTEM_PROPERTIES:L,setForceAFirma:Xt,cargarMiniApplet:Nt,echo:mo,setJnlpService:Jt,isJNLP:Kt,needNativeAppInstalled:Bt,KEYSTORE_WINDOWS:Ue,KEYSTORE_APPLE:je,KEYSTORE_PKCS12:H,KEYSTORE_PKCS11:Ve,KEYSTORE_MOZILLA:be,KEYSTORE_SHARED_NSS:W,KEYSTORE_JAVA:T,KEYSTORE_JCEKS:Je,KEYSTORE_JAVACE:oe,KEYSTORE_DNIE:te,AUTOFIRMA_LAUNCHING_TIME:At,AUTOFIRMA_CONNECTION_RETRIES:ht,cargarAppAfirma:Nt,sign:zt,coSign:Qt,cosign:Zt,counterSign:eo,createBatch:so,addDocumentToBatch:ao,setLocalBatchProcess:no,signBatchProcess:ro,signBatch:oo,selectCertificate:Wt,signAndSaveToFile:to,getCurrentLog:po,saveDataToFile:co,getFileNameContentBase64:uo,getMultiFileNameContentBase64:fo,checkTime:Pt,setKeyStore:Yt,setForceWSMode:qt,setServlets:vo,setPortRange:yo,setStickySignatory:Ot,setLocale:_t,setMinimumClientVersion:Ht,getErrorMessage:ho,getErrorType:go,getBase64FromText:io,getTextFromBase64:lo,downloadRemoteData:Vt,isAndroid:ae.isAndroid,isIOS:ae.isIOS}}(window,void 0),I={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_keyStr_URL_SAFE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",encode:function(o,f){var e=f==!0?this._keyStr_URL_SAFE:this._keyStr,a="",_,L,P,ie,z,re,Q,q=0;for(o=I._utf8_encode(o);q<o.length;)_=o.charCodeAt(q++),L=o.charCodeAt(q++),P=o.charCodeAt(q++),ie=_>>2,z=(_&3)<<4|L>>4,re=(L&15)<<2|P>>6,Q=P&63,isNaN(L)?re=Q=64:isNaN(P)&&(Q=64),a=a+e.charAt(ie)+e.charAt(z)+e.charAt(re)+e.charAt(Q);return a},encodeArrayBuffer:function(o,f){for(var e=new Uint8Array(o),a=e.length,_=new Array(a);a--;)_[a]=String.fromCharCode(e[a]);return f?window.btoa(_.join("")).replace("+","-").replace("/","_"):window.btoa(_.join(""))},encodeByteArray:function(o,f){for(var e=f==!0?this._keyStr_URL_SAFE:this._keyStr,a=[],_=0;_<o.length;_+=3){var L=o[_],P=_+1<o.length,ie=P?o[_+1]:0,z=_+2<o.length,re=z?o[_+2]:0,Q=L>>2,q=(L&3)<<4|ie>>4,ge=(ie&15)<<2|re>>6,l=re&63;z||(l=64,P||(ge=64)),a.push(e.charAt(Q),e.charAt(q),e.charAt(ge),e.charAt(l))}return a.join("")},decode:function(o,f){var e=f==!0?this._keyStr_URL_SAFE:this._keyStr,a="",_,L,P,ie,z,re,Q,q=0;for(o=f==!0?o.replace(/[^A-Za-z0-9\-\_\=]/g,""):o.replace(/[^A-Za-z0-9\+\/\=]/g,"");q<o.length;)ie=e.indexOf(o.charAt(q++)),z=e.indexOf(o.charAt(q++)),re=e.indexOf(o.charAt(q++)),Q=e.indexOf(o.charAt(q++)),_=ie<<2|z>>4,L=(z&15)<<4|re>>2,P=(re&3)<<6|Q,a=a+String.fromCharCode(_),re!=64&&(a=a+String.fromCharCode(L)),Q!=64&&(a=a+String.fromCharCode(P));return a=I._utf8_decode(a),a},_utf8_encode:function(o){o=o.replace(/\r\n/g,`
`);for(var f="",e=0;e<o.length;e++){var a=o.charCodeAt(e);a<128?f+=String.fromCharCode(a):a>127&&a<2048?(f+=String.fromCharCode(a>>6|192),f+=String.fromCharCode(a&63|128)):(f+=String.fromCharCode(a>>12|224),f+=String.fromCharCode(a>>6&63|128),f+=String.fromCharCode(a&63|128))}return f},_utf8_decode:function(o){for(var f="",e=0,a=0,_=0;e<o.length;)if(a=o.charCodeAt(e),a<128)f+=String.fromCharCode(a),e++;else if(a>191&&a<224)_=o.charCodeAt(e+1),f+=String.fromCharCode((a&31)<<6|_&63),e+=2;else{_=o.charCodeAt(e+1);var L=o.charCodeAt(e+2);f+=String.fromCharCode((a&15)<<12|(_&63)<<6|L&63),e+=3}return f}},Ye={tableStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",tableStr_URL_SAFE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",des:function(o,f,e,a,_,L){var P=new Array(16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756),ie=new Array(-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344),z=new Array(520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584),re=new Array(8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928),Q=new Array(256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080),q=new Array(536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312),ge=new Array(2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154),l=new Array(268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696),de=Ye.des_createKeys(o),pe=0,Ue,je,H,Ve,be,W,T,Je,oe,te,Fe,pt,mt,At,ht=f.length,ct=0,Le=de.length==32?3:9;Le==3?Je=e?new Array(0,32,2):new Array(30,-2,-2):Je=e?new Array(0,32,2,62,30,-2,64,96,2):new Array(94,62,-2,32,64,2,30,-2,-2),L==2?f+="        ":L==1?(H=8-ht%8,f+=String.fromCharCode(H,H,H,H,H,H,H,H),H==8&&(ht+=8)):L||(f+="\0\0\0\0\0\0\0\0");var Ze="",Me="";for(a==1&&(oe=_.charCodeAt(pe++)<<24|_.charCodeAt(pe++)<<16|_.charCodeAt(pe++)<<8|_.charCodeAt(pe++),Fe=_.charCodeAt(pe++)<<24|_.charCodeAt(pe++)<<16|_.charCodeAt(pe++)<<8|_.charCodeAt(pe++),pe=0);pe<ht;){for(W=f.charCodeAt(pe++)<<24|f.charCodeAt(pe++)<<16|f.charCodeAt(pe++)<<8|f.charCodeAt(pe++),T=f.charCodeAt(pe++)<<24|f.charCodeAt(pe++)<<16|f.charCodeAt(pe++)<<8|f.charCodeAt(pe++),a==1&&(e?(W^=oe,T^=Fe):(te=oe,pt=Fe,oe=W,Fe=T)),H=(W>>>4^T)&252645135,T^=H,W^=H<<4,H=(W>>>16^T)&65535,T^=H,W^=H<<16,H=(T>>>2^W)&858993459,W^=H,T^=H<<2,H=(T>>>8^W)&16711935,W^=H,T^=H<<8,H=(W>>>1^T)&1431655765,T^=H,W^=H<<1,W=W<<1|W>>>31,T=T<<1|T>>>31,je=0;je<Le;je+=3){for(mt=Je[je+1],At=Je[je+2],Ue=Je[je];Ue!=mt;Ue+=At)Ve=T^de[Ue],be=(T>>>4|T<<28)^de[Ue+1],H=W,W=T,T=H^(ie[Ve>>>24&63]|re[Ve>>>16&63]|q[Ve>>>8&63]|l[Ve&63]|P[be>>>24&63]|z[be>>>16&63]|Q[be>>>8&63]|ge[be&63]);H=W,W=T,T=H}W=W>>>1|W<<31,T=T>>>1|T<<31,H=(W>>>1^T)&1431655765,T^=H,W^=H<<1,H=(T>>>8^W)&16711935,W^=H,T^=H<<8,H=(T>>>2^W)&858993459,W^=H,T^=H<<2,H=(W>>>16^T)&65535,T^=H,W^=H<<16,H=(W>>>4^T)&252645135,T^=H,W^=H<<4,a==1&&(e?(oe=W,Fe=T):(W^=te,T^=pt)),Me+=String.fromCharCode(W>>>24,W>>>16&255,W>>>8&255,W&255,T>>>24,T>>>16&255,T>>>8&255,T&255),ct+=8,ct==512&&(Ze+=Me,Me="",ct=0)}return Ze+Me},des_createKeys:function(o){for(var f=new Array(0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964),e=new Array(0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697),a=new Array(0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272),_=new Array(0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144),L=new Array(0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256),P=new Array(0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488),ie=new Array(0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746),z=new Array(0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568),re=new Array(0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578),Q=new Array(0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488),q=new Array(0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800),ge=new Array(0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744),l=new Array(0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128),de=new Array(0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261),pe=o.length>8?3:1,Ue=new Array(32*pe),je=new Array(0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0),H,Ve,be=0,W=0,T,Je=0;Je<pe;Je++){var oe=o.charCodeAt(be++)<<24|o.charCodeAt(be++)<<16|o.charCodeAt(be++)<<8|o.charCodeAt(be++),te=o.charCodeAt(be++)<<24|o.charCodeAt(be++)<<16|o.charCodeAt(be++)<<8|o.charCodeAt(be++);T=(oe>>>4^te)&252645135,te^=T,oe^=T<<4,T=(te>>>-16^oe)&65535,oe^=T,te^=T<<-16,T=(oe>>>2^te)&858993459,te^=T,oe^=T<<2,T=(te>>>-16^oe)&65535,oe^=T,te^=T<<-16,T=(oe>>>1^te)&1431655765,te^=T,oe^=T<<1,T=(te>>>8^oe)&16711935,oe^=T,te^=T<<8,T=(oe>>>1^te)&1431655765,te^=T,oe^=T<<1,T=oe<<8|te>>>20&240,oe=te<<24|te<<8&16711680|te>>>8&65280|te>>>24&240,te=T;for(var Fe=0;Fe<je.length;Fe++)je[Fe]?(oe=oe<<2|oe>>>26,te=te<<2|te>>>26):(oe=oe<<1|oe>>>27,te=te<<1|te>>>27),oe&=-15,te&=-15,H=f[oe>>>28]|e[oe>>>24&15]|a[oe>>>20&15]|_[oe>>>16&15]|L[oe>>>12&15]|P[oe>>>8&15]|ie[oe>>>4&15],Ve=z[te>>>28]|re[te>>>24&15]|Q[te>>>20&15]|q[te>>>16&15]|ge[te>>>12&15]|l[te>>>8&15]|de[te>>>4&15],T=(Ve>>>16^H)&65535,Ue[W++]=H^T,Ue[W++]=Ve^T<<16}return Ue},stringToBase64:function(o){for(var f="",e=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"),a=0;a<o.length;a++)f+=e[o.charCodeAt(a)>>4]+e[o.charCodeAt(a)&15];var _,L=f.replace(/\r|\n/g,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ");f="";try{_=String.fromCharCode.apply(null,L)}catch{for(var _="",a=0,P=L.length;a<P;a++)_+=String.fromCharCode(L[a])}return Ye.btoa(_,null)},base64ToString:function(o){for(var f=new Array("A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"),e=new Object,a=0;a<f.length;a++)e[f[a]]=a;e["="]=0;var _="",L,P,ie,z,re=o.length;o+="====";for(var a=0;a<re;a+=4)L=o.charAt(a),P=o.charAt(a+1),ie=o.charAt(a+2),z=o.charAt(a+3),_+=String.fromCharCode(e[L]<<2&255|e[P]>>4),ie!="="&&(_+=String.fromCharCode(e[P]<<4&255|e[ie]>>2)),z!="="&&(_+=String.fromCharCode(e[ie]<<6&255|e[z]));return _},btoa:function(o,f){for(var e=(f==!0?Ye.tableStr_URL_SAFE:Ye.tableStr).split(""),a=0,_=0,L=o.length/3,P=[];a<L;++a){var ie=o.charCodeAt(_++),z=o.charCodeAt(_++),re=o.charCodeAt(_++);if((ie|z|re)>255)throw new Error("String contains an invalid character");P[P.length]=e[ie>>2]+e[ie<<4&63|z>>4]+(isNaN(z)?"=":e[z<<2&63|re>>6])+(isNaN(z+re)?"=":e[re&63])}return P.join("")}};const he=o=>(No("data-v-50fc0500"),o=o(),Fo(),o),Vo={class:"no-imprimir"},qo={class:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight"},Ho={class:"py-12"},Bo={class:"max-w-10xl mx-auto sm:px-6 lg:px-24"},Ko={class:"card"},Xo={class:"-me-2 flex items-center sm:hidden"},Jo={class:"h-6 w-6",stroke:"currentColor",fill:"none",viewBox:"0 0 24 24"},Go={class:"text-center pt-2 pb-3 space-y-1"},Yo={class:"text-center pt-2 pb-3 space-y-1"},Wo={class:"text-center pt-2 pb-3 space-y-1"},zo={class:"text-center pt-2 pb-3 space-y-1"},Qo=he(()=>t("hr",null,null,-1)),Zo=he(()=>t("hr",null,null,-1)),es={class:"flex flex-col items-center space-y-2"},ts={class:"text-center pt-2 pb-3 space-y-1"},os=he(()=>t("hr",null,null,-1)),ss=he(()=>t("hr",null,null,-1)),as={class:"flex flex-col items-center space-y-2"},ns={class:"md:flex justify-between items-center hidden sm:block"},rs={class:"flex flex-col md:flex-row justify-start items-center"},is={class:"flex flex-wrap justify-start items-center"},ls={class:"relative inline-block w-50 flex justify-between"},cs=["disabled"],ds={class:"font-bold text-lg"},us={key:0,class:"pi pi-plus mr-2"},fs=["disabled"],ps=he(()=>t("i",{class:"pi pi-eye mr-2"},null,-1)),ms={class:"flex items-center"},hs={id:"app",class:"relative inline-block w-50 ml-2"},gs={class:"flex"},vs=he(()=>t("i",{class:"pi pi-plus mr-2"},null,-1)),ys={key:0,class:"split-button-container ml-2"},xs={class:"split-button-container ml-2"},bs=he(()=>t("hr",{class:"linea-grosor mt-5"},null,-1)),Cs={class:"selector flex flex-col md:flex-row justify-between mt-5 ml-12"},ks={class:"showCustomer mt-12"},Ss={class:"grid md:grid-cols-1 text-m gap-y-1"},ws={class:"flex items-center justify-between w-full"},Ts={key:0,class:"font-semibold whitespace-nowrap mr-3"},As={key:1,class:"font-semibold mr-3 flex-shrink-0 w-32"},Es={class:"text-gray-700 w-full font-bold text-lg"},Os={class:"relative w-full mr-20"},_s={class:"flex items-center justify-between w-full"},Is={class:"font-semibold mr-3 flex-shrink-0 w-32"},Ds={class:"text-gray-700 w-full uppercase"},Rs={class:"flex items-center justify-between w-full"},Ms={class:"font-semibold mr-3 flex-shrink-0 w-32"},Ps={class:"text-gray-700 w-full"},Ns={class:"flex items-center justify-between w-full"},Fs={class:"font-semibold mr-3 flex-shrink-0 w-32"},Ls={class:"text-gray-700 w-full"},$s={class:"flex items-center justify-between w-full"},Us={class:"font-semibold mr-3 flex-shrink-0 w-32"},js={key:0,class:"text-gray-700 w-full"},Vs={class:"grid md:grid-cols-1 text-sm gap-y-1 mr-28"},qs={class:"flex items-center cursor-pointer justify-end max-w-xs ml-auto"},Hs={class:"text-m font-medium text-gray-900 dark:text-gray-300 flex-shrink-0"},Bs=he(()=>t("div",{class:"relative w-11 h-6 ml-3 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:after:translate-x-full rtl:peer-checked:after:-translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"},null,-1)),Ks={class:"flex items-center justify-end w-full mt-4"},Xs={class:"font-semibold mr-4 flex-shrink-0"},Js={class:"input-wrapper"},Gs=["min"],Ys={class:"flex items-center"},Ws={class:"font-semibold mr-8 min-w-20 flex-shrink-0"},zs={class:"relative w-full"},Qs={key:0,class:"input-wrapper"},Zs={class:"font-bold flex absolute inset-y-0 left-0 items-center pl-3 pointer-events-none"},ea={class:"flex items-center justify-between w-full"},ta={class:"font-semibold mr-3 flex-shrink-0"},oa={class:"input-wrapper"},sa={class:"flex items-center justify-between w-full"},aa={class:"font-semibold mr-3 flex-shrink-0"},na={class:"input-wrapper"},ra=["min"],ia={class:"flex items-center justify-between"},la={class:"flex items-center"},ca=he(()=>t("div",{class:"flex-grow"},null,-1)),da={class:"relative rounded-md shadow-sm"},ua=["placeholder"],fa=he(()=>t("div",{class:"absolute inset-y-0 right-0 flex items-center pr-3"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"})])],-1)),pa={class:"relative text-gray-600"},ma={key:0,class:"flex justify-end mt-4 pr-4"},ha={class:"hidden md:flex justify-between mt-4 pr-4 mb-4"},ga={class:"totals-container w-1/3"},va={class:"ml-4 totals p-4 rounded-md"},ya={class:"w-full"},xa={class:"text-gray-600 pr-4"},ba={class:"text-gray-600 pr-4"},Ca={class:"relative w-full ml-4"},ka={class:"flex items-center pointer-events-none"},Sa={class:"absolute inset-y-0 right-0 flex items-center pr-3"},wa=he(()=>t("tr",null,[t("td",{colspan:"2"},[t("hr",{class:"my-2 border-gray-300"})])],-1)),Ta={class:"text-gray-600 pr-4"},Aa={key:0},Ea={key:1},Oa={key:2},_a={key:3},Ia={class:"pl-4"},Da={key:0},Ra={key:1},Ma={key:2},Pa={key:3},Na=he(()=>t("div",{class:"w-1/12"},null,-1)),Fa={class:"totals-container w-1/3"},La={class:"totals p-4 rounded-md"},$a={class:"w-full"},Ua={class:"text-gray-600 pr-4"},ja={class:"pl-4"},Va=he(()=>t("hr",{class:"my-2 border-gray-300"},null,-1)),qa={class:"text-gray-600 pr-4"},Ha={class:"pl-4"},Ba=he(()=>t("hr",{class:"my-2 border-gray-300"},null,-1)),Ka={class:"text-gray-600 pr-4"},Xa={class:"pl-4"},Ja={class:"flex flex-wrap justify-between mt-4 pr-4 mb-4 md:hidden"},Ga={class:"totals-container w-full md:w-1/3 flex flex-col mb-4 md:mb-0"},Ya=he(()=>t("i",{class:"pi pi-plus"},null,-1)),Wa={class:"ml-4 totals p-4 rounded-md flex-grow"},za={class:"w-full"},Qa={class:"text-gray-600 pr-4"},Za={class:"pl-4"},en=he(()=>t("tr",null,[t("td",{colspan:"2"},[t("hr",{class:"my-2 border-gray-300"})])],-1)),tn={class:"text-gray-600 pr-4"},on={key:0},sn={key:1},an={key:2},nn={key:3},rn={class:"pl-4"},ln={key:0},cn={key:1},dn={key:2},un={key:3},fn=he(()=>t("div",{class:"hidden md:block w-1/12"},null,-1)),pn={class:"totals-container w-full md:w-1/3 flex flex-col"},mn={class:"ml-4 totals bg-gray-100 p-4 rounded-md flex-grow"},hn={class:"w-full"},gn={class:"text-gray-600 pr-4"},vn={class:"pl-4"},yn={class:"text-gray-600 pr-4"},xn={class:"pl-4"},bn={class:"text-gray-600 pr-4"},Cn={class:"pl-4"},kn={style:{display:"flex","flex-direction":"column"}},Sn=["placeholder"],wn={style:{display:"flex","justify-content":"flex-end","margin-top":"8px"}},Tn={for:"name",class:"block text-sm font-medium text-gray-900 dark:text-white"},An={key:0,class:"flex align-items-center"},En={class:"flex align-items-center"},On={for:"name",class:"block text-sm font-medium text-gray-900 dark:text-white"},_n={key:0,class:"flex align-items-center"},In={class:"flex align-items-center"},Dn={for:"name",class:"block text-sm font-medium text-gray-900 dark:text-white"},Rn={key:0,class:"flex align-items-center"},Mn={class:"flex align-items-center"},Pn={class:"confirmation-content"},Nn=he(()=>t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),Fn={key:0},Ln={class:"confirmation-content"},$n=he(()=>t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1)),Un={key:0},jn={key:0,class:"flex align-items-center"},Vn={class:"flex align-items-center"},qn={class:"grid gap-3 md:grid-cols-1 justify-items"},Hn={class:"flex justify-between"},Bn=he(()=>t("i",{class:"pi pi-plus"},null,-1)),Kn={for:"name",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},Xn={key:0,class:"flex items-center"},Jn={class:"flex items-center"},Gn={key:0,for:"name",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},Yn={key:0,class:"flex items-center"},Wn={class:"flex items-center"},zn={class:"flex justify-end"},Qn={class:"grid gap-3 mb-6 md:grid-cols-2"},Zn={for:"name",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},er=["placeholder"],tr={for:"tax_number",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},or=["placeholder"],sr={class:"mb-6"},ar={for:"address",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},nr=["placeholder"],rr={class:"grid gap-3 mb-6 md:grid-cols-2"},ir={for:"town",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},lr=["placeholder"],cr={for:"province",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},dr=["placeholder"],ur={for:"post_code",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},fr=["placeholder"],pr={for:"country",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},mr=["placeholder"],hr={for:"email",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},gr=["placeholder"],vr={for:"phone",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},yr=["placeholder"],xr={class:"grid gap-3 md:grid-cols-1 justify-items-end"},br={type:"submit",class:"text-white bg-blue-600 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"},Cr={class:"imprimir"},kr={class:"invoice"},Sr={class:"invoice-header"},wr=he(()=>t("div",{class:"logo"},[t("img",{src:"https://d1csarkz8obe9u.cloudfront.net/posterpreviews/company-logo-design-template-e089327a5c476ce5c70c74f7359c5898_screen.jpg?ts=1672291305",alt:"Logo de la empresa"})],-1)),Tr={class:"invoice_details"},Ar={class:"invoice-info"},Er={class:"company-details"},Or={class:"name"},_r=he(()=>t("br",null,null,-1)),Ir={class:"customer-details"},Dr={class:"name"},Rr=he(()=>t("br",null,null,-1)),Mr={class:"invoice-table"},Pr={class:"header"},Nr={class:"table-break"},Fr={class:"table-container"},Lr={class:"totals"},$r={class:"title"},Ur={class:"title"},jr={class:"title"},Vr={class:"bank"},qr={class:"text-gray-600 pr-4"},Hr={key:0},Br={key:1},Kr={key:2},Xr={key:3},Jr={class:"pl-4"},Gr={key:0},Yr={key:1},Wr={key:2},zr={key:3},Qr={components:{TableDocumentSelector:Ut},data(){return{itemsSave:[{label:this.$t("Guardar y crear nueva"),icon:"pi pi-refresh",command:()=>this.saveAndReset()},{label:this.$t("Firmar factura"),icon:"pi pi-file-check",command:()=>this.saveAndSign()},{label:this.$t("Cancelar"),command:()=>this.cancelInvoice()}],itemsExport:[{label:this.$t("PDF"),icon:"pi pi-file-pdf",command:()=>this.exportToPDF()},{label:this.$t("XML"),icon:"pi pi-file",command:()=>this.exportToXML()},{label:this.$t("XML Firmado"),icon:"pi pi-file-check",command:()=>this.downloadSignedXml()},{label:this.$t("Enviar XML por Correo"),icon:"pi pi-file-check",command:()=>this.sendToMAilXML()}],taxMap:new Map,today:new Date,fecha:"",fechaPaid:"",expiration:"",fechaFormateada:"",loading:!0,isSaving:!1,isChecked:!1,isMobileMenuOpen:!1,showTable:!1,isDropdownOpen:!1,selectedOption:null,saveRestart:!1,taxTypes:[],taxValues:[],taxOptions:[{label:"0",value:0},{label:"4",value:4},{label:"5",value:5},{label:"7",value:7},{label:"8",value:8},{label:"10",value:10},{label:"16",value:16},{label:"18",value:18},{label:"21",value:21}],paymentMethods:[{id:1},{id:2},{id:3},{id:4}],imageUrl:"https://placehold.co/300x300/e2e8f0/e2e8f0",companies:null,customers:null,types:[],series:[],serie:"",counter:"",updateDate:!1,showButton:!1,productDialog:!1,documentDialog:!1,customerDialog:!1,deleteProductDialog:!1,deleteProductsDialog:!1,selectACustomerDialog:!1,selectAPaymentMethodDialog:!1,documentListDialog:!1,descriptionDialog:!1,selectedDescription:"",productDescription:"",options:[],concepts:[],selectedBankAccount:[],selectedEmail:[],selectedPhone:[],products:[],selectedCompany:[],selectedCustomer:[],selectedType:[],selectedSerie:[],emails:[],phones:[],selectedProducts:[],selectedPaymentMethod:[],selectedPaymentSystemId:"",payment_methods:null,filters:{},submitted:!1,myDocument:{document_counter:"",number:"",company_id_company:"",company_id_customer:"",documents_type_id:"",documents_series_id:"",payment_system_id:"",expiration:"",date:"",date_paid:"",amount:"",payment_methods_id:"",totalTax:"",subTotal:"",paid:!1,invoiced:!1,isReceived:!1,concept:[]},customer:{id:"",name:"",tax_number:"",email:"",phone:"",address:"",post_code:"",town:"",province:"",country:""},company:{id:"",name:"",tax_number:"",email:"",phone:"",address:"",post_code:"",town:"",province:"",country:"",documentId:""}}},computed:{charCount(){return this.selectedDescription===null?"":this.selectedDescription.length},dynamicOptionLabel(){switch(this.selectedPaymentMethod.id){case 1:case 7:return"complete_bank_account";case 3:return"phone";case 4:return"email";default:return""}},isDropdownHidden(){return this.dynamicOptionLabel===""},subtotal(){return this.products.reduce((o,f)=>o+f.subTotal,0)},totalIVA(){return this.products.reduce((o,f)=>o+f.priceTax,0)},totalConIVA(){return this.subtotal+this.totalIVA}},async created(){this.filters={global:{value:null,matchMode:Do.CONTAINS}},this.isChecked=this.$page.props.isChecked,this.myDocument.isReceived=this.$page.props.isChecked,console.log("isChecked Create "+this.isChecked),this.fecha=await this.getDate(),this.fechaPaid=await this.getDate(),this.expiration=await this.getExpirationDate()},async mounted(){await this.fetchCompanies(),await this.fetchCustomers(),await this.fetchPayments(),this.isChecked?(this.selectedType.id=1,this.selectedType.name="Factura",this.selectedSerie=[]):await this.fetchDocuments()},watch:{fecha(o){this.validateDate()},selectedPaymentMethod(o){console.log("PaymentId "+o.id),this.handlePaymentMethodChange(o)},selectedOption(o){if(console.log("NewValue"),console.log(o),o)switch(this.selectedPaymentMethod.id){case 1:case 7:this.selectedBankAccount=o,this.selectedPaymentSystemId=o.id;break;case 3:this.selectedPhone=o,this.selectedPaymentSystemId=o.id;break;case 4:this.selectedEmail=o,this.selectedPaymentSystemId=o.id;break;default:this.selectedPaymentSystemId="";break}}},methods:{sendToMAilXML(){this.myDocumentSave(),this.calculateTaxes().then(()=>{this.myDocument.document_counter=1,console.log("contador: "+this.myDocument.document_counter),this.convertToFacturaeXML(),axios.post("/send-email",{data:{email:"janstopete@gmail.com",title:"Factura "+this.myDocument.number,body:"Factura "+this.myDocument.number}}).then(o=>{console.log("OK in the signed")}).catch(o=>{console.log(o)})})},saveAndSign(){this.myDocumentSave(),this.calculateTaxes().then(()=>{this.myDocument.document_counter=1,console.log("contador: "+this.myDocument.document_counter);const o=this.convertToFacturaeXML();this.addsign(o)})},addsign(o){if(this.myDocument.id==null)alert("Guarda el documeno");else{let a=function(P,ie){axios.post("/documents-sign",{datasing:{company_id:f,document_id:e,document_data:P}}).then(z=>{console.log("OK in the signed")}).catch(z=>{console.log(z)})},_=function(P,ie){console.log("ERR")};Ae.setForceWSMode(!0),Ae.cargarAppAfirma(),Ae.setServlets(window.location.origin+"/afirma-signature-storage/StorageService",window.location.origin+"/afirma-signature-retriever/RetrieveService");const f=this.company.id,e=this.myDocument.id;let L=Ae.getBase64FromText(o);Ae.sign(L!=null&&L!=null&&L!=""?L:null,"SHA512withRSA","AUTO","",a,_)}},validateDate(){new Date(this.fecha)>new Date(this.expiration)&&(alert("La fecha seleccionada no puede ser mayor que la fecha de vencimiento."),this.fecha=this.getDate(),this.expiration=this.getExpirationDate(),this.fechaPaid=this.fecha)},openDescriptionDialog(o){this.productDescription=o,this.selectedDescription=o.description,this.descriptionDialog=!0},saveDescription(){this.selectedDescription===null||this.selectedDescription.length<=255?(this.products.forEach(o=>{this.productDescription.id===o.id&&(o.description=this.selectedDescription)}),this.descriptionDialog=!1,this.selectedDescription=""):this.$toast(this.$t("Too many characters, need to be 255 at maximum"),"error")},async handlePaymentMethodChange(o){switch(o.id){case 1:console.log("handlePaymentMethodChange 1"),this.selectedPaymentMethod.name="Transferencia",await this.fetchBanks(),console.log("handlePayment "+this.selectedBankAccount.id);break;case 2:console.log("handlePaymentMethodChange 2"),this.selectedPaymentMethod.name="Efectivo";break;case 3:console.log("handlePaymentMethodChange 3"),this.selectedPaymentMethod.name="Bizum",await this.fetchPhones();break;case 4:console.log("handlePaymentMethodChange 4"),this.selectedPaymentMethod.name="Paypal",await this.fetchEmails();break;case 5:console.log("handlePaymentMethodChange 5"),this.selectedPaymentMethod.name="Tarjeta";break;case 6:console.log("handlePaymentMethodChange 6"),this.selectedPaymentMethod.name="Cheque";break;case 7:console.log("handlePaymentMethodChange 7"),this.selectedPaymentMethod.name="Domiciliación",await this.fetchBanks();break}},async handleDocumentSelected(o){o&&(this.documentListDialog=!1),this.company=this.selectedCompany,this.company.documentId=o;const f=await axios.get("/documents-show/"+this.company.id+"/"+this.company.documentId);if(f){this.myDocument=f.data.documents,this.fecha=this.myDocument.date,this.expiration=this.myDocument.expiration,this.selectedType.name=this.myDocument.document_type_name,this.selectedType.id=this.myDocument.documents_type_id,this.selectedSerie.id=this.myDocument.documents_series_id,this.selectedSerie.serie=this.myDocument.document_series_serie,this.selectedPaymentSystemId=this.myDocument.payment_system_id,this.selectedPaymentMethod.id=this.myDocument.payment_methods_id;let a=this.myDocument.number.replace(this.selectedSerie.serie,"");this.selectedSerie.number=a,this.myDocument.paid===0?(this.fechaPaid=await this.getDate(),this.myDocument.paid=!1):(this.fechaPaid=this.myDocument.date_paid,this.myDocument.paid=!0),this.selectedCompany=f.data.company,this.selectedCustomer=f.data.customer,this.concepts=f.data.concepts,this.products=f.data.concepts;for(let _=0;_<this.concepts.length;_++)this.products[_].taxes=parseFloat(this.concepts[_].tax);this.selectedPaymentMethod=[],this.selectedPaymentMethod.id=this.myDocument.payment_methods_id}else this.$toast(this.$t("Error connecting to the server"),"error")},async fetchBanks(){try{const o=await axios.get("/banks/"+this.selectedCompany.id);this.banks=o.data.accounts,console.log("this.banks"),console.log(this.banks),this.selectedBankAccount=await this.changePaymentMethodSystemId(this.banks),this.selectedPaymentSystemId=this.selectedBankAccount.id,console.log("selectedBankaccount"),console.log(this.selectedBankAccount),this.options=this.banks}catch(o){this.$toast(this.$t("Error connecting to the server"),"error"),console.log("banks error"),console.log(o)}},async fetchEmails(){try{const o=this.isChecked?`/emails/${this.selectedCustomer.id}`:`/emails/${this.selectedCompany.id}`,f=await axios.get(o);this.emails=f.data.emails,this.selectedEmail=await this.changePaymentMethodSystemId(this.emails),this.options=this.emails}catch{this.$toast(this.$t("Error connecting to the server"),"error")}},async fetchPhones(){try{const o=this.isChecked?`/phones/${this.selectedCustomer.id}`:`/phones/${this.selectedCompany.id}`,f=await axios.get(o);this.phones=f.data.phones,this.selectedPhone=await this.changePaymentMethodSystemId(this.phones),this.options=this.phones}catch{this.$toast(this.$t("Error connecting to the server"),"error")}},async changePaymentMethodSystemId(o){let f;if(console.log("Entra al methodSystem1"),this.selectedPaymentSystemId!=null){console.log("Entra al methodSystem2");let e=o.find(a=>a.id===this.selectedPaymentSystemId);console.log(this.selectedPaymentSystemId),console.log(o),console.log("Value "),console.log(e),e?(console.log("if value"),f=e,console.log(f)):(f=o.length>0?o[0]:null,console.log(f))}else f=o.length>0?o[0]:null,console.log(f);return f},async fetchPayments(){const o=this.isChecked?`/payment/${this.selectedCustomer.id}`:`/payment/${this.selectedCompany.id}`,f=await axios.get(o);this.payment_methods=f.data.methods,this.selectedPaymentMethod=this.payment_methods[0],console.log(this.selectedPaymentMethod)},async fetchCompanies(){try{const o=await axios.get("/companies-invoice");this.companies=o.data.companies,this.companies.length===1?(this.selectedCompany=this.companies[0],this.companyId=this.selectedCompany.id):this.selectedCompany=this.companies[0],this.loading=!1}catch(o){console.error("Error fetching data:",o),this.loading=!1}},async fetchCustomers(){try{const o=this.isChecked?`/providers/${this.selectedCompany.id}`:`/customers/${this.selectedCompany.id}`,f=await axios.get(o);this.isChecked?this.customers=f.data.providers:this.customers=f.data.customers,this.customers.length===1&&(this.selectedCustomer=this.customers[0]),this.loading=!1}catch(o){console.error("Error fetching data:",o),this.loading=!1}},hideDialog(){this.selectACustomerDialog=!1,this.selectAPaymentMethodDialog=!1,this.customerDialog=!1,this.submitted=!1},openNew(){this.selectACustomerDialog=!1,this.customer={companyID:this.selectedCompany.id},this.submitted=!1,this.customerDialog=!0},selectACustomer(){this.selectACustomerDialog=!0},selectAProvider(){this.selectACustomerDialog=!0},selectAPaymentMethod(){this.selectAPaymentMethodDialog=!0},saveCustomer(){let o;this.isChecked?o=axios.post("/provider",this.customer):o=axios.post("/customer",this.customer),o.then(f=>{this.customer.id=f.data.companyId,this.selectedCustomer=this.customer}).catch(f=>{console.error("Error:",f),this.customerDialog=!1}),this.customerDialog=!1},async downloadSignedXml(){window.open("/documents-signed/"+this.myDocument.id)},async handleCompanySelection(){this.selectedCustomer=[];try{const o=await axios.get("/customers/"+this.selectedCompany.id);await this.fetchDocuments(),await this.fetchPayments(),this.customers=o.data.customers,this.customers.length===1&&(this.selectedCustomer=this.customers[0])}catch(o){console.error("Error fetching phone data:",o)}},async fetchDocuments(){await axios.get("/documents-type").then(o=>(this.types=o.data.types,this.selectedType=this.types[0],axios.get("/documents-serie/"+this.selectedType.id+"/"+this.selectedCompany.id))).catch(o=>{console.error("Error fetching phone data:",o)}).then(o=>{o&&(this.series=o.data.series,this.selectedSerie=this.series[0])}).catch(o=>{console.error("Error fetching data:",o),this.loading=!1})},handleListDocument(){this.documentListDialog=!0},handleTypeSelection(){this.selectedSerie=[],axios.get("/documents-serie/"+this.selectedType.id+"/"+this.selectedCompany.id).then(o=>{this.series=o.data.series}).catch(o=>{console.error("Error fetching phone data:",o)})},selectCompany(){this.productDialog=!0},selectDocument(){this.documentDialog=!0},openFileInput(){this.$refs.fileInput.click()},handleFileChange(o){const f=o.target.files[0],e=new FileReader;e.onload=()=>{this.imageUrl=e.result},e.readAsDataURL(f)},addRow(){let o={reference:"",description:"",price:0,quantity:0,discount:0,discount_reason:"Descuento profesional",subtotal:0,taxes:21,priceTax:0,total:0,id:this.products.length+1};this.products.push(o)},saveAndReset(){this.saveRestart=!0,this.checkDocument()},handleClick(){this.$nextTick(()=>{const f=this.$refs.splitButton.$el.querySelector(".p-splitbutton-menubutton");f&&(f.classList.add("no-print"),f.click())})},checkDocument(){this.isChecked?this.saveDocument():axios.get("/documents-serie/"+this.selectedType.id+"/"+this.selectedCompany.id+"/"+this.selectedSerie.serie).then(o=>{if(this.date=o.data.date.date,this.serie=o.data.serie.number,this.selectedSerie.number<=this.serie)switch(prompt(`El número de documento ya existe. ¿Qué deseas hacer?
1. Conservar el número ingresado: ${this.selectedSerie.serie}${this.selectedSerie.number} 
2. Asignar el siguiente valor disponible: ${this.selectedSerie.serie}${++this.serie}`)){case null:this.$toast(this.$t("Operation cancelled."),"error");break;case"1":this.$toast(this.$t("The number entered will be retained: ")+this.selectedSerie.serie+this.selectedSerie.number,"success"),this.serie="",this.saveDocument();break;case"2":this.updateDate=!0,this.selectedSerie.number=this.serie,this.$toast(this.$t("The following available number has been assigned: ")+this.selectedSerie.serie+this.selectedSerie.number,"success"),this.serie="",this.saveDocument();break;default:this.$toast(this.$t("Invalid input."),"error")}else if(this.date>this.fecha){let f=this.dateFormat(this.date),e=this.dateFormat(this.fecha);switch(prompt(`La fecha seleccionada es anterior a la de la última factura, ¿deseas asignarle la fecha actual?
1. Conservar la fecha seleccionada: ${e} 
2. Asignar la fecha actual: ${f}`)){case null:this.$toast(this.$t("Operation cancelled."),"error");break;case"1":this.$toast(this.$t("The date will be retained: ")+this.fecha,"success"),this.saveDocument();break;case"2":this.fecha=getDate(),this.$toast(this.$t("The current date has been assigned."),"success"),this.saveDocument();break;default:this.$toast(this.$t("Invalid input."),"error")}}else this.saveDocument()}).catch(o=>{this.$toast(this.$t("Error saving document data."),"error"),console.log(o)})},myDocumentSave(){this.isChecked?(this.myDocument.number=this.selectedSerie.number,this.myDocument.company_id_company=this.selectedCustomer.id,this.myDocument.company_id_customer=this.selectedCompany.id,this.myDocument.documents_series_id=""):(this.myDocument.number=this.selectedSerie.serie+this.selectedSerie.number,this.myDocument.document_counter=this.selectedSerie.number,this.myDocument.company_id_company=this.selectedCompany.id,this.myDocument.company_id_customer=this.selectedCustomer.id,this.myDocument.documents_series_id=this.selectedSerie.id),this.myDocument.paid?this.myDocument.date_paid=this.fechaPaid:this.myDocument.date_paid="",this.myDocument.documents_type_id=this.selectedType.id,this.updateDate&&(this.fecha=this.getDate(),this.expiration=this.getExpirationDate()),this.myDocument.expiration=this.expiration,this.myDocument.date=this.fecha,this.updateDate=!1,this.myDocument.payment_methods_id=this.selectedPaymentMethod.id,console.log("selectedPaymentSystemId"),console.log(this.selectedPaymentSystemId),this.myDocument.payment_system_id=this.selectedPaymentSystemId,this.myDocument.document_counter=1,this.myDocument.subTotal=this.subtotal.toFixed(2),this.myDocument.totalTax=this.totalIVA.toFixed(2),this.myDocument.amount=this.totalConIVA.toFixed(2)},saveDocument(){this.myDocumentSave(),this.selectedType.id==1&&(this.myDocument.invoiced=!0),console.log(this.fecha),console.log(this.expiration),this.myDocument.concept=[],this.products.forEach(o=>{try{let f={reference:o.reference,description:o.description,quantity:o.quantity,price:o.price,taxes:o.taxes,discount:o.discount,discount_reason:o.discount_reason,total:this.calculateTotal(o)};this.myDocument.concept.push(f)}catch(f){console.error("Error al crear el objeto newProduct:",f)}}),axios.post("/documents",{documentData:this.myDocument}).then(o=>{this.myDocument.id=o.data.documentId,console.log("saveDocument id"+this.myDocument.id),this.$toast(this.$t("Invoice saved correctly."),"success"),this.myDocument.concept=[],this.saveRestart&&this.resetData()}).catch(o=>{this.$toast(this.$t("Error saving invoice."),"error"),console.log(o),this.myDocument.concept=[]})},getDate(){const o=this.today.getFullYear(),f=(this.today.getMonth()+1).toString().padStart(2,"0"),e=this.today.getDate().toString().padStart(2,"0");return`${o}-${f}-${e}`},getExpirationDate(){const o=new Date;o.setDate(this.today.getDate()+15);const f=o.getFullYear(),e=(o.getMonth()+1).toString().padStart(2,"0"),a=o.getDate().toString().padStart(2,"0");return`${f}-${e}-${a}`},resetData(){this.isSaving=!0,setTimeout(function(){window.location.reload()},1e3)},calculateGross(o){return o.quantity*o.price},calculateTax(o){return o.priceTax=parseFloat(o.taxes/100*parseFloat(o.subTotal)),o.priceTax},calculateTotal(o){let f=this.calculateTax(o);return o.total=f+parseFloat(o.subTotal),o.total.toFixed(2)},calculateSubtotal(o){let f=parseFloat(o.quantity)*parseFloat(o.price);return o.subTotal=f-o.discount/100*f,o.subTotal},confirmDeleteProduct(o){this.product=o,this.deleteProductDialog=!0},deleteProduct(){this.products=this.products.filter(o=>o.id!==this.product.id),this.product=null,this.deleteProductDialog=!1},confirmDeleteSelected(){this.deleteProductsDialog=!0},deleteSelectedProducts(){this.selectedProducts.forEach(o=>{this.products=this.products.filter(f=>f.id!==o.id)}),this.selectedProducts=[],this.deleteProductsDialog=!1},dateFormat(o){let f=new Date(o),e=f.getDate(),a=f.getMonth()+1,_=f.getFullYear();return e<10&&(e="0"+e),a<10&&(a="0"+a),`${e}/${a}/${_}`},manejarFecha(){let o=this.dateFormat(this.fecha),f=prompt(`La fecha seleccionada (${o}) es anterior a la de la última factura, ¿deseas asignarle la fecha actual?
1. Conservar la fecha seleccionada. 
2. Asignar la fecha actual.`);if(f!=="1"){if(f==="2"){let e=new Date().toISOString().split("T")[0];this.dateFormat(e)}}},calcularImporteBase(o,f){return o<=0?0:f/(o/100)},exportToPDF(){this.myDocumentSave(),this.calculateTaxes().then(()=>{this.showTable=!this.showTable,window.print()}).catch(o=>{this.$toast(this.$t("Could not generate the PDF."),"error")})},exportToXML(){this.myDocumentSave(),this.calculateTaxes().then(()=>{this.myDocument.document_counter=1;const o=this.convertToFacturaeXML();console.log("contador: "+this.myDocument.document_counter),this.$toast(this.$t("XML document generated correctly."),"success"),this.downloadXML(o,"factura.xml")}).catch(o=>{this.$toast(this.$t("Could not generate the XML."),"error")})},convertToFacturaeXML(){let o=`<?xml version="1.0" encoding="UTF-8"?>
            <fe:Facturae xmlns:ds="http://www.w3.org/2000/09/xmldsig#" xmlns:fe="http://www.facturae.es/Facturae/2014/v3.2.1/Facturae">
                <FileHeader>
                    <SchemaVersion>3.2.1</SchemaVersion>
                    <Modality>I</Modality>
                    <InvoiceIssuerType>EM</InvoiceIssuerType>
                    <Batch>
                        <BatchIdentifier>${this.selectedCompany.tax_number}${this.selectedSerie.number}${this.selectedSerie.serie}</BatchIdentifier>
                        <InvoicesCount>${this.myDocument.document_counter}</InvoicesCount>
                        <TotalInvoicesAmount>
                            <TotalAmount>${this.myDocument.amount}</TotalAmount>
                        </TotalInvoicesAmount>
                        <TotalOutstandingAmount>
                            <TotalAmount>${this.myDocument.amount}</TotalAmount>
                        </TotalOutstandingAmount>
                        <TotalExecutableAmount>
                            <TotalAmount>${this.myDocument.amount}</TotalAmount>
                        </TotalExecutableAmount>
                        <InvoiceCurrencyCode>EUR</InvoiceCurrencyCode>
                    </Batch>
                </FileHeader> 
                
                <Parties>
                    <SellerParty>
                        <TaxIdentification>
                            <PersonTypeCode>J</PersonTypeCode>
                            <ResidenceTypeCode>R</ResidenceTypeCode>
                            <TaxIdentificationNumber>${this.selectedCompany.tax_number}</TaxIdentificationNumber>
                        </TaxIdentification>
                        <LegalEntity>
                            <CorporateName>${this.selectedCompany.name}</CorporateName>
                            <AddressInSpain>
                                <Address>${this.selectedCompany.address}</Address>
                                <PostCode>${this.selectedCompany.post_code}</PostCode>
                                <Town>${this.selectedCompany.town}</Town>
                                <Province>${this.selectedCompany.province}</Province>
                                <CountryCode>ESP</CountryCode>
                            </AddressInSpain>
                            <ContactDetails>
                                <Telephone>${this.selectedCompany.phone}</Telephone>
                                <ElectronicMail>${this.selectedCompany.email}</ElectronicMail>
                            </ContactDetails>
                        </LegalEntity>
                    </SellerParty>
                    
                    <BuyerParty>
                        <TaxIdentification>
                            <PersonTypeCode>J</PersonTypeCode>
                            <ResidenceTypeCode>R</ResidenceTypeCode>
                            <TaxIdentificationNumber>${this.selectedCustomer.tax_number}</TaxIdentificationNumber>
                        </TaxIdentification>
                        <LegalEntity>
                            <CorporateName>${this.selectedCustomer.name}</CorporateName>
                            <AddressInSpain>
                                <Address>${this.selectedCustomer.address}</Address>
                                <PostCode>${this.selectedCustomer.post_code}</PostCode>
                                <Town>${this.selectedCustomer.town}</Town>
                                <Province>${this.selectedCustomer.province}</Province>
                                <CountryCode>ESP</CountryCode>
                            </AddressInSpain>
                            <ContactDetails>
                                <Telephone>${this.selectedCustomer.phone}</Telephone>
                                <ElectronicMail>${this.selectedCustomer.email}</ElectronicMail>
                            </ContactDetails>
                        </LegalEntity>
                    </BuyerParty> 
                </Parties>
                <Invoices>
                    <Invoice>
                        <InvoiceHeader>
                            <InvoiceNumber>${this.selectedSerie.number}</InvoiceNumber>
                            <InvoiceSeriesCode>${this.selectedSerie.serie}</InvoiceSeriesCode>
                            <InvoiceDocumentType>FC</InvoiceDocumentType>
                            <InvoiceClass>OO</InvoiceClass>
                        </InvoiceHeader>
                        <InvoiceIssueData>
                            <IssueDate>${this.myDocument.date}</IssueDate>
                            <InvoiceCurrencyCode>EUR</InvoiceCurrencyCode>
                            <TaxCurrencyCode>EUR</TaxCurrencyCode>
                            <LanguageName>es</LanguageName>
                        </InvoiceIssueData>
                        <TaxesOutputs>
`;return this.taxMap.forEach((f,e)=>{o+=`  <Tax>
`,o+=`    <TaxTypeCode>01</TaxTypeCode>
`,o+=`    <TaxRate>${parseFloat(e).toFixed(2)}</TaxRate>
`,o+=`    <TaxableBase>
`,o+=`      <TotalAmount>${this.calcularImporteBase(e,f).toFixed(2)}</TotalAmount>
`,o+=`    </TaxableBase>
`,o+=`    <TaxAmount>
`,o+=`      <TotalAmount>${f.toFixed(2)}</TotalAmount>
`,o+=`    </TaxAmount>
`,o+=`  </Tax>
`}),o+=`</TaxesOutputs>
                        <InvoiceTotals>
                            <TotalGrossAmount>${this.subtotal.toFixed(2)}</TotalGrossAmount>
                            <TotalGeneralDiscounts>0.0</TotalGeneralDiscounts>
                            <TotalGeneralSurcharges>0.0</TotalGeneralSurcharges>
                            <TotalGrossAmountBeforeTaxes>${this.subtotal.toFixed(2)}</TotalGrossAmountBeforeTaxes>
                            <TotalTaxOutputs>${this.totalIVA.toFixed(2)}</TotalTaxOutputs>
                            <TotalTaxesWithheld>0.0</TotalTaxesWithheld>
                            <InvoiceTotal>${this.myDocument.amount}</InvoiceTotal>
                            <TotalOutstandingAmount>${this.myDocument.amount}</TotalOutstandingAmount>
                            <TotalExecutableAmount>${this.myDocument.amount}</TotalExecutableAmount>
                        </InvoiceTotals>
                        <Items>`,this.products.forEach(f=>{o+=`
                    <InvoiceLine>
                        <ItemDescription>${f.description}</ItemDescription>
                        <Quantity>${f.quantity}</Quantity>
                        <UnitOfMeasure>01</UnitOfMeasure>
                        <UnitPriceWithoutTax>${f.price}</UnitPriceWithoutTax>
                        <TotalCost>${f.quantity*f.price}</TotalCost>
                        <DiscountsAndRebates>
                            <Discount>
                                <DiscountReason>${f.discount_reason}</DiscountReason>
                                <DiscountRate>${parseFloat(f.discount).toFixed(1)}</DiscountRate>
                                <DiscountAmount>${(f.quantity*f.price*(f.discount/100)).toFixed(1)}</DiscountAmount>
                            </Discount>
                        </DiscountsAndRebates>
                        <GrossAmount>${f.subTotal}</GrossAmount>
                        <TaxesOutputs>
                            <Tax>
                                <TaxTypeCode>01</TaxTypeCode>
                                <TaxRate>${f.taxes}</TaxRate>
                                <TaxableBase>
                                    <TotalAmount>${f.subTotal}</TotalAmount>
                                </TaxableBase>
                                <TaxAmount>
                                    <TotalAmount>${f.priceTax.toFixed(2)}</TotalAmount>
                                </TaxAmount>
                            </Tax>
                        </TaxesOutputs>
                    </InvoiceLine>`}),o+=`
                        </Items>
                    </Invoice>
                </Invoices>
            </fe:Facturae>`,o},downloadXML(o,f){const e=new Blob([o],{type:"application/xml"}),a=document.createElement("a");a.href=URL.createObjectURL(e),a.download=f,a.click(),URL.revokeObjectURL(a.href)},cancelInvoice(){confirm("Los cambios no serán guardados")&&this.resetData()},calculateTaxes(){return new Promise((o,f)=>{try{this.taxMap.clear(),this.products.forEach(e=>{let a=e.taxes,_=parseFloat(e.priceTax);if(this.taxMap.has(a)){let L=this.taxMap.get(a);this.taxMap.set(a,L+_)}else this.taxMap.set(a,_)}),o()}catch(e){f(e)}})}}},Zr=Object.assign(Qr,{__name:"Document",setup(o){const f=Io(!1);return(e,a)=>{const _=Ro("ResponsiveNavLink"),L=So,P=_o,ie=Oo,z=wo,re=To,Q=Ao,q=Eo,ge=ko;return X(),J(Mt,null,[t("div",Vo,[F(Lo,{title:"Document"},{header:K(()=>[t("h2",qo,c(e.$t("New invoice")),1)]),default:K(()=>[t("div",Ho,[t("div",Bo,[t("div",{class:$e({"border-blue-500 border-2":e.isChecked,"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg":!0})},[t("div",Ko,[t("div",Xo,[t("button",{class:"inline-flex items-center justify-center p-2 bg-gray-100 rounded-md text-gray-400 dark:text-gray-500 hover:text-gray-500 dark:hover:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-900 focus:outline-none focus:bg-gray-100 dark:focus:bg-gray-900 focus:text-gray-500 dark:focus:text-gray-400 transition duration-150 ease-in-out",onClick:a[0]||(a[0]=l=>f.value=!f.value)},[(X(),J("svg",Jo,[t("path",{class:$e({hidden:f.value,"inline-flex":!f.value}),"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h16"},null,2),t("path",{class:$e({hidden:!f.value,"inline-flex":f.value}),"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},null,2)]))])]),t("div",{class:$e([{block:f.value,hidden:!f.value},"sm:hidden bg-white"])},[t("div",Go,[F(_,{onClick:a[1]||(a[1]=l=>e.selectCompany())},{default:K(()=>[me(c(e.selectedCompany.name),1)]),_:1})]),t("div",Yo,[F(_,{onClick:a[2]||(a[2]=l=>e.handleListDocument())},{default:K(()=>[me(c(e.$t("Document check")),1)]),_:1})]),t("div",Wo,[F(_,{onClick:a[3]||(a[3]=l=>e.resetData())},{default:K(()=>[me(c(e.$t("New invoice")),1)]),_:1})]),t("div",zo,[Qo,t("h3",null,c(e.$t("Download")),1),Zo,t("div",es,[F(L,{onClick:e.exportToPDF},{default:K(()=>[me(c(e.$t("PDF")),1)]),_:1},8,["onClick"]),F(L,{onClick:e.exportToXML},{default:K(()=>[me(c(e.$t("XML")),1)]),_:1},8,["onClick"]),F(L,{onClick:e.exportToXML},{default:K(()=>[me(c(e.$t("XML Firmadoo")),1)]),_:1},8,["onClick"])])]),t("div",ts,[os,t("h3",null,c(e.$t("Save")),1),ss,t("div",as,[F(L,{onClick:e.saveAndReset},{default:K(()=>[me(c(e.$t("Guardar y crear nueva")),1)]),_:1},8,["onClick"]),F(L,{onClick:e.saveAndSign},{default:K(()=>[me(c(e.$t("Firmar factura")),1)]),_:1},8,["onClick"]),F(L,{onClick:e.cancelInvoice},{default:K(()=>[me(c(e.$t("Cancel")),1)]),_:1},8,["onClick"])])])],2),t("div",ns,[t("div",rs,[t("div",is,[t("div",ls,[!e.loading&&e.companies.length>0?(X(),J("button",{key:0,type:"button",class:"px-4 py-2 bg-gray-800 hover:bg-gray-900 focus:ring-4 focus:ring-gray-300 font-medium rounded-lg text-white flex items-center",onClick:a[4]||(a[4]=l=>e.companies.length>1?e.selectCompany():null),disabled:e.companies.length===1},[t("span",ds,[e.companies.length>1?(X(),J("i",us)):Re("",!0),me(" "+c(e.selectedCompany.name),1)])],8,cs)):Re("",!0),t("button",{type:"button",class:$e(["ml-2 px-4 py-2 bg-yellow-400 hover:bg-yellow-500 focus:ring-4 focus:ring-yellow-300 font-medium rounded-lg text-white rounded flex items-center justify-between",{"opacity-50":!e.selectedCompany.id}]),onClick:a[5]||(a[5]=l=>e.handleListDocument()),disabled:!e.selectedCompany.id},[t("span",null,[ps,me(" "+c(e.$t("Document check")),1)])],10,fs)])])]),t("div",ms,[t("div",hs,[t("div",gs,[F(L,{type:"button",class:$e(["px-4 ml-2 py-2 bg-green-500 hover:bg-green-600 focus:ring-4 focus:ring-green-300 font-medium rounded-lg text-white text-white rounded flex items-center justify-between",{"opacity-50":!e.selectedCompany.id}]),onClick:a[6]||(a[6]=l=>e.resetData()),disabled:!e.selectedCompany.id},{default:K(()=>[t("span",null,[vs,me(" "+c(e.$t("New invoice")),1)])]),_:1},8,["class","disabled"])])]),e.isChecked?Re("",!0):(X(),J("div",ys,[F(P,{ref:"splitButton",class:$e(["bg-purple-400 hover:bg-purple-500 focus:ring-4 focus:ring-pur-300 font-medium rounded-lg text-white text-white p-2",{"opacity-50":e.totalConIVA===0||e.isSaving||!e.selectedCustomer.id||!e.selectedSerie.number}]),label:e.$t("Download"),onClick:e.handleClick,model:e.itemsExport,disabled:e.totalConIVA===0||e.isSaving||!e.selectedCustomer.id||!e.selectedSerie.number},{icon:K(()=>[t("i",{class:$e(["pi pi-download mr-2",{"opacity-50":e.totalConIVA===0}])},null,2)]),_:1},8,["label","onClick","model","disabled","class"])])),t("div",xs,[F(P,{class:$e(["blue-button",{"opacity-50":e.totalConIVA===0||e.isSaving||!e.selectedCustomer.id||!e.selectedSerie.number}]),label:e.$t("Save"),onClick:e.checkDocument,model:e.itemsSave,disabled:e.totalConIVA===0||e.isSaving||!e.selectedCustomer.id||!e.selectedSerie.number},{icon:K(()=>[t("i",{class:$e(["pi pi-save mr-2",{"opacity-50":e.totalConIVA===0}])},null,2)]),_:1},8,["label","onClick","model","disabled","class"])])])]),bs,t("div",Cs,[t("div",ks,[t("div",Ss,[t("div",ws,[t("div",null,[e.selectedCustomer.name?(X(),J("div",As,c(e.isChecked?e.$t("Provider"):e.$t("Customer"))+": ",1)):(X(),J("div",Ts,c(e.isChecked?e.$t("Select a provider"):e.$t("Select a customer")),1))]),t("div",Es,c(e.selectedCustomer.name),1),t("div",Os,[F(L,{type:"button",icon:"pi pi-search",id:"voice-search",onClick:e.selectACustomer,class:"bg-gray-100 p-2 rounded-md text-gray-900 text-sm hover:bg-gray-300"},null,8,["onClick"])])]),t("div",null,[t("div",_s,[t("div",Is,c(e.$t("Tax number"))+":",1),t("div",Ds,c(e.selectedCustomer.tax_number),1)]),t("div",Rs,[t("div",Ms,c(e.$t("Phone"))+":",1),t("div",Ps,c(e.selectedCustomer.phone),1)]),t("div",Ns,[t("div",Fs,c(e.$t("Email"))+":",1),t("div",Ls,c(e.selectedCustomer.email),1)]),t("div",$s,[t("div",Us,c(e.$t("Address"))+":",1),e.selectedCustomer.name?(X(),J("div",js,c(e.selectedCustomer.address)+", "+c(e.selectedCustomer.post_code)+", "+c(e.selectedCustomer.town)+", "+c(e.selectedCustomer.province)+" ( "+c(e.selectedCustomer.country)+" ) ",1)):Re("",!0)])])])]),t("div",Vs,[t("label",qs,[t("span",Hs,c(e.$t("Mark as paid")),1),Te(t("input",{type:"checkbox",class:"sr-only peer","onUpdate:modelValue":a[7]||(a[7]=l=>e.myDocument.paid=l)},null,512),[[Mo,e.myDocument.paid]]),Bs]),t("div",Ks,[t("div",Xs,c(e.$t("Payment date"))+":",1),t("div",Js,[Te(t("input",{type:"date",min:e.fecha,"onUpdate:modelValue":a[8]||(a[8]=l=>e.fechaPaid=l),onChange:a[9]||(a[9]=(...l)=>e.cambiarFormatoFecha&&e.cambiarFormatoFecha(...l)),disabled:!1,class:$e([{"bg-gray-100 text-gray-300 cursor-not-allowed":!e.myDocument.paid,"bg-white text-black":e.myDocument.paid,"pointer-events-none":!e.myDocument.paid},"styled-input bg-gray-50 border border-gray-300 rounded-md w-48 px-3 py-2 focus:outline-none focus:border-blue-400"])},null,42,Gs),[[Ie,e.fechaPaid]])])]),t("form",Ys,[t("div",Ws,"Nº "+c(e.selectedType.name)+":",1),t("div",zs,[e.isChecked?Te((X(),J("input",{key:1,type:"text",id:"voice-search",class:"border-gray-300 rounded-md text-gray-900 text-sm focus:ring-blue-500 focus:border-blue-500 block w-[161px] pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500","onUpdate:modelValue":a[12]||(a[12]=l=>e.selectedSerie.number=l),required:""},null,512)),[[Ie,e.selectedSerie.number]]):(X(),J("div",Qs,[t("div",Zs,c(e.selectedSerie.serie)+" / ",1),Te(t("input",{type:"text",id:"voice-search",class:"border-gray-300 rounded-md text-gray-900 text-sm focus:ring-blue-500 focus:border-blue-500 block w-full pl-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500","onUpdate:modelValue":a[10]||(a[10]=l=>e.selectedSerie.number=l),required:""},null,512),[[Ie,e.selectedSerie.number]]),F(L,{type:"button",icon:"pi pi-search",onClick:a[11]||(a[11]=l=>e.selectDocument()),class:"button-search font-bold flex absolute inset-y-0 right-0 items-center border-gray-300 pr-1"})]))])]),t("div",ea,[t("div",ta,c(e.$t("Date"))+":",1),t("div",oa,[Te(t("input",{type:"date","onUpdate:modelValue":a[13]||(a[13]=l=>e.fecha=l),onChange:a[14]||(a[14]=(...l)=>e.cambiarFormatoFecha&&e.cambiarFormatoFecha(...l)),class:"styled-input bg-gray-50 border border-gray-300 rounded-md w-48 px-3 py-2 focus:outline-none focus:border-blue-400"},null,544),[[Ie,e.fecha]])])]),t("div",sa,[t("div",aa,c(e.$t("Expiration"))+":",1),t("div",na,[Te(t("input",{type:"date","onUpdate:modelValue":a[15]||(a[15]=l=>e.expiration=l),min:e.fecha,onChange:a[16]||(a[16]=(...l)=>e.cambiarFormatoFecha&&e.cambiarFormatoFecha(...l)),class:"styled-input bg-gray-50 border border-gray-300 rounded-md w-48 px-3 py-2 focus:outline-none focus:border-blue-400"},null,40,ra),[[Ie,e.expiration]])])])])]),F(ie,{class:"mb-4 mt-8 border border-slate-200 ..."},{start:K(()=>[t("div",ia,[t("div",la,[F(L,{label:e.$t("Concept"),icon:"pi pi-plus",severity:"success",class:"mr-2 bg-green-500 hover:bg-green-600 focus:ring-4 focus:ring-green-300 font-medium rounded-lg text-white rounded-md p-2",onClick:e.addRow},null,8,["label","onClick"]),F(L,{label:e.$t("Delete"),icon:"pi pi-trash",severity:"danger",class:"bg-red-400 hover:bg-red-500 focus:ring-4 focus:ring-red-300 font-medium rounded-lg text-white rounded-md p-2",onClick:e.confirmDeleteSelected,disabled:!e.selectedProducts||!e.selectedProducts.length},null,8,["label","onClick","disabled"])]),ca])]),end:K(()=>[t("div",da,[Te(t("input",{type:"search",class:"block w-full h-11 rounded-md border-0 py-1.5 pl-3 pr-10 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm","onUpdate:modelValue":a[17]||(a[17]=l=>e.filters.global.value=l),placeholder:e.$t("Search...")},null,8,ua),[[Ie,e.filters.global.value]]),fa])]),_:1}),F(q,{ref:"dt",value:e.products,selection:e.selectedProducts,"onUpdate:selection":a[18]||(a[18]=l=>e.selectedProducts=l),dataKey:"id",class:"w-full lg:w-4/4 mx-auto",filters:e.filters},{default:K(()=>[F(z,{selectionMode:"multiple",exportable:!1,class:"datetable checkbox"}),F(z,{field:"reference",header:e.$t("Reference"),sortable:"",class:"dateTable w-1/4"},{body:K(l=>[F(re,{class:"input w-full",placeholder:e.$t("Reference"),modelValue:l.data.reference,"onUpdate:modelValue":de=>l.data.reference=de},null,8,["placeholder","modelValue","onUpdate:modelValue"])]),_:1},8,["header"]),F(z,{field:"description",header:e.$t("Concept"),sortable:"",class:"dateTable w-full"},{body:K(l=>[t("div",pa,[F(re,{modelValue:l.data.description,"onUpdate:modelValue":de=>l.data.description=de,placeholder:e.$t("Concept"),class:"input bg-white mt-3 rounded-md border border-gray-100 text-m"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),F(L,{type:"submit",icon:"pi pi-search-plus",onClick:de=>e.openDescriptionDialog(l.data),class:"bg-gray-100 hover:bg-gray-200 p-2 absolute right-0 top-0 mt-3 mr-0.5 rounded rounded-r-lg rounded-l-none"},null,8,["onClick"])])]),_:1},8,["header"]),F(z,{field:"quantity",header:e.$t("Quantity"),sortable:"",class:"dateTable w-1/8"},{body:K(l=>[F(re,{class:"input input-short w-full",modelValue:l.data.quantity,"onUpdate:modelValue":de=>l.data.quantity=de},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["header"]),F(z,{field:"price",header:e.$t("Price"),sortable:"",class:"dateTable w-1/8"},{body:K(l=>[F(re,{class:"input input-short w-full",modelValue:l.data.price,"onUpdate:modelValue":de=>l.data.price=de},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["header"]),F(z,{field:"discount",header:e.$t("Discount (%)"),sortable:"",class:"dateTable w-1/4"},{body:K(l=>[F(re,{class:"input input-short w-full",modelValue:l.data.discount,"onUpdate:modelValue":de=>l.data.discount=de},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["header"]),F(z,{field:"subTotal",header:e.$t("Subtotal"),sortable:"",class:"dateTable w-1/12"},{body:K(l=>[F(re,{class:"input input-short w-1/12",value:e.calculateSubtotal(l.data),readonly:""},null,8,["value"])]),_:1},8,["header"]),F(z,{field:"taxes",header:e.$t("Tax (%)"),sortable:"",class:"dateTable w-1/4"},{body:K(l=>[F(Q,{class:"input-short w-full",modelValue:l.data.taxes,"onUpdate:modelValue":de=>l.data.taxes=de,options:e.taxOptions,optionLabel:"label",optionValue:"value"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1},8,["header"]),F(z,{field:"total",header:e.$t("Total"),sortable:"",class:"dateTable w-1/12"},{body:K(l=>[F(re,{class:"input input-short w-1/12",value:e.calculateTotal(l.data),readonly:""},null,8,["value"])]),_:1},8,["header"]),F(z,{exportable:!1,header:e.$t("Utility"),class:"dateTable w-1/12"},{body:K(l=>[F(L,{icon:"pi pi-trash",outlined:"",rounded:"",class:"simpleDelete-button",severity:"danger",onClick:de=>e.confirmDeleteProduct(l.data)},null,8,["onClick"])]),_:1},8,["header"])]),_:1},8,["value","selection","filters"]),e.showButton?(X(),J("div",ma,[F(L,{label:e.$t("Concept"),icon:"pi pi-plus",severity:"success",class:"bg-green-500 hover:bg-green-600 focus:ring-4 focus:ring-green-300 font-medium rounded-lg text-white",onClick:a[19]||(a[19]=l=>e.addRow())},null,8,["label"])])):Re("",!0),t("div",ha,[t("div",ga,[t("div",va,[t("table",ya,[t("tbody",null,[t("tr",null,[t("td",xa,c(e.$t("Payment method"))+":",1),t("td",ba,[t("div",Ca,[t("div",ka,c(e.selectedPaymentMethod.name),1),t("div",Sa,[F(L,{type:"button",icon:"pi pi-search",id:"voice-search",onClick:a[20]||(a[20]=l=>e.selectAPaymentMethod()),class:"bg-gray-100 p-2 rounded-md text-gray-900 text-sm hover:bg-gray-300"})])])])]),wa,t("tr",null,[t("td",Ta,[e.selectedPaymentMethod.id===1||e.selectedPaymentMethod.id===7?(X(),J("span",Aa,c(e.$t("Bank account"))+":",1)):e.selectedPaymentMethod.id===3?(X(),J("span",Ea,c(e.$t("Phone"))+":",1)):e.selectedPaymentMethod.id===4?(X(),J("span",Oa,c(e.$t("Email"))+":",1)):(X(),J("span",_a,c("")))]),t("td",Ia,[e.selectedPaymentMethod.id===1||e.selectedPaymentMethod.id===7?(X(),J("span",Da,c(e.selectedBankAccount.complete_bank_account),1)):e.selectedPaymentMethod.id===3?(X(),J("span",Ra,c(e.selectedPhone.phone),1)):e.selectedPaymentMethod.id===4?(X(),J("span",Ma,c(e.selectedEmail.email),1)):(X(),J("span",Pa,c("")))])])])])])]),Na,t("div",Fa,[t("button",{class:"ml-4 mb-5 rounded-md",onClick:a[21]||(a[21]=l=>e.selectAPaymentMethod())}),t("div",La,[t("table",$a,[t("tbody",null,[t("tr",null,[t("td",Ua,c(e.$t("Subtotal (excluding Tax)"))+":",1),t("td",ja,c(e.subtotal.toFixed(2))+"€",1)]),Va,t("tr",null,[t("td",qa,c(e.$t("Total Tax"))+":",1),t("td",Ha,c(e.totalIVA.toFixed(2))+"€",1)]),Ba,t("tr",null,[t("td",Ka,c(e.$t("Total (with IVA)"))+":",1),t("td",Xa,c(e.totalConIVA.toFixed(2))+"€",1)])])])])])])])],2),t("div",Ja,[t("div",Ga,[t("button",{class:"ml-4 mb-2 success-button rounded-md",onClick:a[22]||(a[22]=l=>e.selectAPaymentMethod())},[Ya,me(" "+c(e.$t("Payment method")),1)]),t("div",Wa,[t("table",za,[t("tbody",null,[t("tr",null,[t("td",Qa,c(e.$t("Payment method"))+": ",1),t("td",Za,c(e.selectedPaymentMethod.name),1)]),en,t("tr",null,[t("td",tn,[e.selectedPaymentMethod.id===1||e.selectedPaymentMethod.id===7?(X(),J("span",on,c(e.$t("Bank account"))+":",1)):e.selectedPaymentMethod.id===3?(X(),J("span",sn,c(e.$t("Phone"))+":",1)):e.selectedPaymentMethod.id===4?(X(),J("span",an,c(e.$t("Email"))+":",1)):(X(),J("span",nn,c("")))]),t("td",rn,[e.selectedPaymentMethod.id===1||e.selectedPaymentMethod.id===7?(X(),J("span",ln,c(e.selectedBankAccount.complete_bank_account),1)):e.selectedPaymentMethod.id===3?(X(),J("span",cn,c(e.selectedPhone.phone),1)):e.selectedPaymentMethod.id===4?(X(),J("span",dn,c(e.selectedEmail.email),1)):(X(),J("span",un,c("")))])])])])])]),fn,t("div",pn,[t("div",mn,[t("table",hn,[t("tbody",null,[t("tr",null,[t("td",gn,c(e.$t("Subtotal (excluding Tax)"))+":",1),t("td",vn,c(e.subtotal.toFixed(2))+"€",1)]),t("tr",null,[t("td",yn,c(e.$t("Total Tax"))+":",1),t("td",xn,c(e.totalIVA.toFixed(2))+"€",1)]),t("tr",null,[t("td",bn,c(e.$t("Total (with IVA)"))+":",1),t("td",Cn,c(e.totalConIVA.toFixed(2))+"€",1)])])])])])])])]),F(ge,{visible:e.descriptionDialog,"onUpdate:visible":a[24]||(a[24]=l=>e.descriptionDialog=l),style:{width:"450px"},header:e.$t("Concept"),modal:""},{footer:K(()=>[F(L,{label:e.$t("Save"),icon:"pi pi-check",onClick:e.saveDescription},null,8,["label","onClick"])]),default:K(()=>[t("div",kn,[Te(t("textarea",{"onUpdate:modelValue":a[23]||(a[23]=l=>e.selectedDescription=l),rows:"7",class:"block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("Insert the description here")},null,8,Sn),[[Ie,e.selectedDescription]]),t("div",wn,[t("div",{class:$e({"char-counter":!0,"text-red-500":e.charCount>255})},c(e.charCount)+"/255 ",3)])])]),_:1},8,["visible","header"]),F(ge,{visible:e.productDialog,"onUpdate:visible":a[26]||(a[26]=l=>e.productDialog=l),header:e.$t("Select companies"),modal:!0,onChange:e.handleCompanySelection,class:"p-fluid w-full sm:w-3/4 md:w-2/3 lg:w-1/2 max-w-4xl"},{default:K(()=>[t("label",Tn,c(e.$t("Select your company"))+":",1),F(Q,{modelValue:e.selectedCompany,"onUpdate:modelValue":a[25]||(a[25]=l=>e.selectedCompany=l),options:e.companies,filter:"",optionLabel:"name",class:"w-full h-11 md:w-64rem mb-4 bg-gray-50 border border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500",onChange:e.handleCompanySelection},{value:K(l=>[l.value?(X(),J("div",An,[t("div",null,c(l.value.name),1)])):Re("",!0)]),option:K(l=>[t("div",En,[t("div",null,c(l.option.name),1)])]),_:1},8,["modelValue","options","onChange"])]),_:1},8,["visible","header","onChange"]),F(ge,{visible:e.documentDialog,"onUpdate:visible":a[29]||(a[29]=l=>e.documentDialog=l),style:{width:"450px"},header:e.$t("Select document"),modal:!0,onChange:e.handleTypeSelection},{default:K(()=>[t("label",On,c(e.$t("Select document type")),1),F(Q,{modelValue:e.selectedType,"onUpdate:modelValue":a[27]||(a[27]=l=>e.selectedType=l),options:e.types,filter:"",optionLabel:"name",class:"w-full h-11 md:w-64rem mb-4 bg-gray-50 border border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500",onChange:e.handleTypeSelection},{value:K(l=>[l.value?(X(),J("div",_n,[t("div",null,c(l.value.name),1)])):Re("",!0)]),option:K(l=>[t("div",In,[t("div",null,c(l.option.name),1)])]),_:1},8,["modelValue","options","onChange"]),t("label",Dn,c(e.$t("Select document serie")),1),F(Q,{modelValue:e.selectedSerie,"onUpdate:modelValue":a[28]||(a[28]=l=>e.selectedSerie=l),options:e.series,filter:"",optionLabel:"serie",class:"w-full h-11 md:w-64rem mb-4 bg-gray-50 border border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500"},{value:K(l=>[l.value?(X(),J("div",Rn,[t("div",null,c(l.value.serie),1)])):Re("",!0)]),option:K(l=>[t("div",Mn,[t("div",null,c(l.option.serie),1)])]),_:1},8,["modelValue","options"])]),_:1},8,["visible","header","onChange"]),F(ge,{visible:e.documentListDialog,"onUpdate:visible":a[30]||(a[30]=l=>e.documentListDialog=l),class:"w-3/4",header:e.isChecked?e.$t("Received invoices"):e.$t("Emitted invoices"),modal:!0},{default:K(()=>[F(Ut,{companyId:e.selectedCompany.id,isChecked:e.isChecked,onDocumentSelected:e.handleDocumentSelected},null,8,["companyId","isChecked","onDocumentSelected"])]),_:1},8,["visible","header"]),F(ge,{visible:e.deleteProductDialog,"onUpdate:visible":a[32]||(a[32]=l=>e.deleteProductDialog=l),style:{width:"450px"},header:e.$t("Confirm"),modal:!0},{footer:K(()=>[F(L,{label:e.$t("No"),icon:"pi pi-times",text:"",onClick:a[31]||(a[31]=l=>e.deleteProductDialog=!1)},null,8,["label"]),F(L,{label:e.$t("Yes"),icon:"pi pi-check",text:"",onClick:e.deleteProduct},null,8,["label","onClick"])]),default:K(()=>[t("div",Pn,[Nn,e.companies?(X(),J("span",Fn,[me(c(e.$t("Are you sure you want to delete")),1),t("b",null,c(e.companies.name),1),me("?")])):Re("",!0)])]),_:1},8,["visible","header"]),F(ge,{visible:e.deleteProductsDialog,"onUpdate:visible":a[34]||(a[34]=l=>e.deleteProductsDialog=l),style:{width:"450px"},header:e.$t("Confirm"),modal:!0},{footer:K(()=>[F(L,{label:e.$t("No"),icon:"pi pi-times",text:"",onClick:a[33]||(a[33]=l=>e.deleteProductsDialog=!1)},null,8,["label"]),F(L,{label:e.$t("Yes"),icon:"pi pi-check",text:"",onClick:e.deleteSelectedProducts},null,8,["label","onClick"])]),default:K(()=>[t("div",Ln,[$n,e.companies?(X(),J("span",Un,c(e.$t("Are you sure you want to delete the selected concepts?")),1)):Re("",!0)])]),_:1},8,["visible","header"]),F(ge,{visible:e.selectACustomerDialog,"onUpdate:visible":a[38]||(a[38]=l=>e.selectACustomerDialog=l),header:e.isChecked?e.$t("Select a provider"):e.$t("Select a customer"),id:"titleCompany",modal:!0,class:"p-fluid w-full sm:w-3/4 md:w-2/3 lg:w-1/2 max-w-4xl"},{default:K(()=>[F(Q,{modelValue:e.selectedCustomer,"onUpdate:modelValue":a[35]||(a[35]=l=>e.selectedCustomer=l),options:e.customers,filter:"",optionLabel:"name",class:"w-full h-11 md:w-64rem mb-4 bg-gray-50 border border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500"},{value:K(l=>[l.value?(X(),J("div",jn,[t("div",null,c(l.value.name),1)])):Re("",!0)]),option:K(l=>[t("div",Vn,[t("div",null,c(l.option.name),1)])]),_:1},8,["modelValue","options"]),t("div",qn,[t("div",Hn,[t("button",{class:"bg-green-500 hover:bg-green-600 focus:ring-4 focus:ring-green-300 font-medium rounded-lg text-white text-white p-2 mr-1 mr-1 rounded-md",onClick:a[36]||(a[36]=(...l)=>e.openNew&&e.openNew(...l))},[Bn,me(" "+c(e.isChecked?e.$t("Create provider"):e.$t("Create customer")),1)]),t("button",{class:"text-white bg-red-600 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800",onClick:a[37]||(a[37]=l=>e.hideDialog())},c(e.$t("Close")),1)])])]),_:1},8,["visible","header"]),F(ge,{visible:e.selectAPaymentMethodDialog,"onUpdate:visible":a[42]||(a[42]=l=>e.selectAPaymentMethodDialog=l),header:e.$t("Select a payment method"),id:"titleCompany",modal:!0,class:"p-fluid w-full sm:w-3/4 md:w-2/3 lg:w-1/2 max-w-4xl"},{default:K(()=>[t("label",Kn,c(e.$t("Payment method")),1),F(Q,{modelValue:e.selectedPaymentMethod,"onUpdate:modelValue":a[39]||(a[39]=l=>e.selectedPaymentMethod=l),options:e.payment_methods,filter:"",optionLabel:"name",class:"w-full h-11 md:w-64rem mb-4 bg-gray-50 border border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500"},{value:K(l=>[l.value?(X(),J("div",Xn,[t("div",null,c(l.value.name),1)])):Re("",!0)]),option:K(l=>[t("div",Jn,[t("div",null,c(l.option.name),1)])]),_:1},8,["modelValue","options"]),e.isDropdownHidden?Re("",!0):(X(),J("label",Gn,c(e.$t("Select an option")),1)),e.isDropdownHidden?Re("",!0):(X(),Po(Q,{key:1,modelValue:e.selectedOption,"onUpdate:modelValue":a[40]||(a[40]=l=>e.selectedOption=l),options:e.options,filter:"",optionLabel:e.dynamicOptionLabel,class:"w-full h-11 md:w-64rem mb-4 bg-gray-50 border border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500"},{value:K(l=>[l.value?(X(),J("div",Yn,[t("div",null,c(l.value[e.dynamicOptionLabel]),1)])):Re("",!0)]),option:K(l=>[t("div",Wn,[t("div",null,c(l.option[e.dynamicOptionLabel]),1)])]),_:1},8,["modelValue","options","optionLabel"])),t("div",zn,[t("button",{class:"text-white bg-red-600 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800",onClick:a[41]||(a[41]=l=>e.hideDialog())},c(e.$t("Close")),1)])]),_:1},8,["visible","header"]),F(ge,{visible:e.customerDialog,"onUpdate:visible":a[54]||(a[54]=l=>e.customerDialog=l),header:e.$t("Create company"),id:"titleCompany",modal:!0,class:"p-fluid"},{default:K(()=>[t("form",{style:{width:"800px"},onSubmit:a[53]||(a[53]=$t((...l)=>e.saveCustomer&&e.saveCustomer(...l),["prevent"]))},[t("div",Qn,[t("div",null,[t("label",Zn,c(e.$t("Company name")),1),Te(t("input",{type:"text",id:"name","onUpdate:modelValue":a[43]||(a[43]=l=>e.customer.name=l),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("Company name"),required:""},null,8,er),[[Ie,e.customer.name]])]),t("div",null,[t("label",tr,c(e.$t("Tax number")),1),Te(t("input",{type:"text",id:"tax_number","onUpdate:modelValue":a[44]||(a[44]=l=>e.customer.tax_number=l),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("Tax number"),required:""},null,8,or),[[Ie,e.customer.tax_number]])])]),t("div",sr,[t("label",ar,c(e.$t("Address")),1),Te(t("input",{type:"text",id:"address1","onUpdate:modelValue":a[45]||(a[45]=l=>e.customer.address=l),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("Address"),required:""},null,8,nr),[[Ie,e.customer.address]])]),t("div",rr,[t("div",null,[t("label",ir,c(e.$t("Town")),1),Te(t("input",{type:"text",id:"town","onUpdate:modelValue":a[46]||(a[46]=l=>e.customer.town=l),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("Town"),required:""},null,8,lr),[[Ie,e.customer.town]])]),t("div",null,[t("label",cr,c(e.$t("Province")),1),Te(t("input",{type:"text",id:"province","onUpdate:modelValue":a[47]||(a[47]=l=>e.customer.province=l),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("Province"),required:""},null,8,dr),[[Ie,e.customer.province]])]),t("div",null,[t("label",ur,c(e.$t("Post code")),1),Te(t("input",{type:"text",id:"post_code","onUpdate:modelValue":a[48]||(a[48]=l=>e.customer.post_code=l),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("Post code"),pattern:"^\\d+$",required:""},null,8,fr),[[Ie,e.customer.post_code]])]),t("div",null,[t("label",pr,c(e.$t("Country")),1),Te(t("input",{type:"text",id:"country","onUpdate:modelValue":a[49]||(a[49]=l=>e.customer.country=l),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("Country"),required:""},null,8,mr),[[Ie,e.customer.country]])]),t("div",null,[t("label",hr,c(e.$t("Email")),1),Te(t("input",{type:"email",id:"email","onUpdate:modelValue":a[50]||(a[50]=l=>e.customer.email=l),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("info@mycompany.com"),required:""},null,8,gr),[[Ie,e.customer.email]])]),t("div",null,[t("label",vr,c(e.$t("Phone")),1),Te(t("input",{type:"tel",id:"phone","onUpdate:modelValue":a[51]||(a[51]=l=>e.customer.phone=l),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("Phone"),pattern:"(?:\\+?(\\d{1,3}))?\\s?(?:\\(?\\d{1,4}\\)?)?\\s?\\d{6,10}$",required:""},null,8,yr),[[Ie,e.customer.phone]])])]),t("div",xr,[t("div",null,[t("button",{class:"mr-3 text-white bg-red-600 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800",onClick:a[52]||(a[52]=$t(l=>e.hideDialog(),["prevent"]))},c(e.$t("Close")),1),t("button",br,c(e.$t("Save")),1)])])],32)]),_:1},8,["visible","header"])]),_:1})]),t("div",Cr,[t("div",kr,[t("div",Sr,[wr,t("div",Tr,[t("h3",null,c(e.selectedType.name),1),t("p",null,[t("strong",null,c(e.$t("Date"))+": ",1),me(c(e.fecha),1)]),t("p",null,[t("strong",null,c(e.$t("Expiration"))+": ",1),me(c(e.expiration),1)]),t("p",null,[t("strong",null,c(e.$t("Number of"))+" "+c(e.selectedType.name)+":",1),me(" "+c(e.selectedSerie.serie)+" "+c(e.selectedSerie.number),1)])])]),t("div",Ar,[t("div",Er,[t("h3",null,[t("strong",null,c(e.$t("Company")),1)]),t("p",Or,c(e.selectedCompany.name),1),t("p",null,c(e.selectedCompany.tax_number),1),t("p",null,[me(c(e.selectedCompany.address),1),_r,me(" "+c(e.selectedCompany.post_code)+", "+c(e.selectedCompany.town)+", "+c(e.selectedCompany.province)+", "+c("(")+" "+c(e.selectedCompany.country)+" "+c(")"),1)]),t("p",null,c(e.selectedCompany.email),1),t("p",null,c(e.selectedCompany.phone),1)]),t("div",Ir,[t("h3",null,[t("strong",null,c(e.$t("Customer")),1)]),t("p",Dr,c(e.selectedCustomer.name),1),t("p",null,c(e.selectedCustomer.tax_number),1),t("p",null,[me(c(e.selectedCustomer.address),1),Rr,me(" "+c(e.selectedCustomer.post_code)+", "+c(e.selectedCustomer.town)+", "+c(e.selectedCustomer.province)+", "+c("(")+" "+c(e.selectedCustomer.country)+" "+c(")"),1)]),t("p",null,c(e.selectedCustomer.email),1),t("p",null,c(e.selectedCustomer.phone),1)])]),t("table",Mr,[t("thead",null,[t("tr",Pr,[t("th",null,c(e.$t("Reference")),1),t("th",null,c(e.$t("Description")),1),t("th",null,c(e.$t("Quantity")),1),t("th",null,c(e.$t("Price")),1),t("th",null,c(e.$t("Discount (%)")),1),t("th",null,c(e.$t("Subtotal")),1),t("th",null,c(e.$t("Tax (%)")),1),t("th",null,c(e.$t("Total")),1)])]),t("tbody",null,[(X(!0),J(Mt,null,Lt(e.products,l=>(X(),J("tr",{key:l.id},[t("td",null,c(l.reference),1),t("td",null,c(l.description),1),t("td",null,c(l.quantity),1),t("td",null,c(l.price),1),t("td",null,c(l.discount),1),t("td",null,c(l.subTotal),1),t("td",null,c(l.taxes),1),t("td",null,c(e.calculateTotal(l)),1)]))),128))])]),t("div",Nr,[t("div",Fr,[t("table",Lr,[t("tr",null,[t("td",$r,c(e.$t("Subtotal (excluding Tax)")),1),t("td",null,c(e.subtotal.toFixed(2))+"€",1)]),(X(!0),J(Mt,null,Lt(e.taxMap,(l,de)=>(X(),J("tr",{key:de},[t("td",Ur,c(e.$t("Total IVA"))+" "+c(Object.values(l)[0])+" %",1),t("td",null,c(Object.values(l)[1].toFixed(2))+"€",1)]))),128)),t("tr",null,[t("td",jr,[t("strong",null,c(e.$t("Total (with IVA)")),1)]),t("td",null,[t("strong",null,c(e.totalConIVA.toFixed(2))+"€",1)])])])]),t("table",Vr,[t("tr",null,[t("td",null,c(e.$t("Payment method"))+":",1),t("td",null,c(e.selectedPaymentMethod.name),1)]),t("tr",null,[t("td",qr,[e.selectedPaymentMethod.id===2?(X(),J("span",Hr,c(""))):e.selectedPaymentMethod.id===3?(X(),J("span",Br,c(e.$t("Phone"))+":",1)):e.selectedPaymentMethod.id===4?(X(),J("span",Kr,c(e.$t("Email"))+":",1)):(X(),J("span",Xr,c(e.$t("Bank account"))+":",1))]),t("td",Jr,[e.selectedPaymentMethod.id===1?(X(),J("span",Gr,c(e.selectedBankAccount.complete_bank_account),1)):e.selectedPaymentMethod.id===3?(X(),J("span",Yr,c(e.selectedPhone.phone),1)):e.selectedPaymentMethod.id===4?(X(),J("span",Wr,c(e.selectedEmail.email),1)):(X(),J("span",zr,c("")))])])])])])])],64)}}}),ci=$o(Zr,[["__scopeId","data-v-50fc0500"]]);export{ci as default};
