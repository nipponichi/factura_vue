import{s as y}from"./dialog.esm-Cx5sVhN_.js";import{s as v,a as w,b as _}from"./column.esm-oOxVb6Zo.js";import{o as r,c as x,w as i,i as p,j as D,a as t,t as l,e as g,g as $,f as b,b as d,k as u,v as m}from"./app-BEfExbJH.js";import{_ as C}from"./AppLayout-FbYF6R7B.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const F={class:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight"},T={class:"py-12"},k={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},S={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg"},B={class:"card"},N={class:"relative inline-block flex mb-5"},V={class:"font-bold text-lg"},j=t("i",{class:"pi pi-plus mr-2"},null,-1),M={class:"flex flex-col sm:flex-row justify-between items-center mt-2 space-y-2 sm:space-y-0"},R={class:"flex items-center space-x-2 sm:space-x-0"},A={class:"font-semibold mr-3"},U={class:"flex items-center space-x-2 sm:space-x-0"},I={class:"font-semibold ml-3"},E={class:"relative rounded-md shadow-sm ml-auto"},O=["placeholder"],z=t("div",{class:"absolute inset-y-0 left-0 flex items-center pl-3"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"})])],-1),Y={class:"text-center"},H={class:"flex justify-center gap-2 text-sm text-gray-500"},K={class:"w-1/3 text-center px-3"},L={class:"w-1/3 text-center px-12"},q={class:"w-1/3 text-center pl-16"},G={class:"flex gap-2 justify-center"},J={class:"w-1/3 border-r border-gray-400 px-2 text-center"},Q={class:"w-1/3 border-r border-gray-400 px-2 text-center"},W={class:"w-1/3 px-2 text-center"},X={class:"text-center"},Z={class:"flex gap-2 justify-center text-sm text-gray-500"},P={class:"w-1/3 text-center px-3"},ee={class:"w-1/3 text-center px-12"},te={class:"w-1/3 text-center pl-16"},ae={class:"flex gap-2 justify-center"},se={class:"w-1/3 border-r border-gray-400 px-2 text-center"},oe={class:"w-1/3 border-r border-gray-400 px-2 text-center"},le={class:"w-1/3 px-2 text-center"},ne={class:"flex flex-col items-center justify-center sm:flex-row sm:justify-end"},ie={class:"totals-container w-full sm:w-1/3 mb-4 sm:mb-0 sm:ml-4"},de={class:"totals p-4 rounded-md"},ce={class:"w-full"},re={class:"text-gray-600 pr-4"},ue={class:"pl-4"},me=t("hr",{class:"my-2 border-gray-300"},null,-1),he={class:"text-gray-600 pr-4"},pe={class:"pl-4"},ge=t("hr",{class:"my-2 border-gray-300"},null,-1),be={class:"text-gray-600 pr-4"},fe={class:"pl-4"},ye={for:"name",class:"block text-sm font-medium text-gray-900 dark:text-white"},ve={key:0,class:"flex align-items-center"},we={class:"flex align-items-center"},_e={data(){return{documents:[],companies:[],totalDocuments:[],balance:{subtotal:0,amount:0,tax:0},initialDate:"",endDate:"",startDate:"",selectedCompany:"",accountingDialog:!1,selectedDocuments:[],filters:{global:{value:null,matchMode:p.CONTAINS}}}},created(){this.filters={global:{value:null,matchMode:p.CONTAINS}};const n=new Date,e=n.getFullYear(),s=(n.getMonth()+1).toString().padStart(2,"0"),o=n.getDate().toString().padStart(2,"0");this.initialDate=`${e}-01-01`,this.endDate=`${e}-${s}-${o}`,console.log(this.initialDate),console.log(this.endDate)},async mounted(){this.companies=this.$page.props.companies,this.selectedCompany=this.companies[0],await this.fetchDocuments(),await this.calculateBalance(),await this.itemsFiltrados()},watch:{async selectedCompany(n,e){n!==e&&(await this.fetchDocuments(),await this.calculateBalance(),await this.itemsFiltrados())},async hadleCalculateBalance(){await this.calculateBalance()}},methods:{async fetchDocuments(){await D.get(`/accountings/${this.selectedCompany.id}`).then(n=>{console.log(n.data.documents);let e,s;for(let o=0;o<n.data.documents.length;o++)e=n.data.documents[o].date,s=this.dateFormat(e),n.data.documents[o].dateFormatted=s,console.log("fetch: "+s);this.totalDocuments=n.data.documents.filter(o=>o.documents_type_id===1)}).catch(n=>{console.error("Error fetching documents data:",n)})},async itemsFiltrados(){if(this.documents=[],!this.initialDate||!this.endDate)return this.totalDocuments;const n=new Date(this.initialDate),e=new Date(this.endDate);this.documents=this.totalDocuments.filter(s=>{const o=new Date(s.date);return o>=n&&o<=e}),await this.calculateBalance()},async calculateBalance(){console.log("calculateTotal1"),console.log(this.balance),this.balance={subtotal:0,amount:0,tax:0};let n=0,e=0,s=0;for(let o=0;o<this.documents.length;o++)this.documents[o].isReceived?(n-=parseFloat(this.documents[o].amount),e-=parseFloat(this.documents[o].subtotal),s-=parseFloat(this.documents[o].tax)):(n+=parseFloat(this.documents[o].amount),e+=parseFloat(this.documents[o].subtotal),s+=parseFloat(this.documents[o].tax));this.balance={subtotal:e.toFixed(2),amount:n.toFixed(2),tax:s.toFixed(2)},console.log("calculateTotal2"),console.log(this.balance)},dateFormat(n){let e=new Date(n),s=e.getDate(),o=e.getMonth()+1,c=e.getFullYear();return s<10&&(s="0"+s),o<10&&(o="0"+o),`${s}/${o}/${c}`},hideDialog(){this.accountingDialog=!1},openNew(){this.accountingDialog=!0}}},Te=Object.assign(_e,{__name:"TableAccounting",setup(n){return(e,s)=>{const o=v,c=w,h=_,f=y;return r(),x(C,{title:"Accounting"},{header:i(()=>[t("h2",F,l(e.$t("Accounting")),1)]),default:i(()=>[t("div",T,[t("div",k,[t("div",S,[t("div",null,[t("div",B,[t("div",N,[!e.loading&&e.companies.length>0?(r(),g("button",{key:0,type:"button",class:"px-4 py-2 bg-black text-white border border-gray-200 rounded-md flex items-center justify-between",onClick:s[0]||(s[0]=(...a)=>e.openNew&&e.openNew(...a))},[t("span",V,[j,$(" "+l(e.selectedCompany.name),1)])])):b("",!0)]),d(c,{ref:"dt",value:e.documents,selection:e.selectedDocuments,"onUpdate:selection":s[6]||(s[6]=a=>e.selectedDocuments=a),dataKey:"id",selectionMode:"single",onRowClick:e.handleRowClick},{header:i(()=>[t("div",M,[t("div",R,[t("div",A,l(e.$t("Initial date"))+": ",1),u(t("input",{type:"date","onUpdate:modelValue":s[1]||(s[1]=a=>e.initialDate=a),onChange:s[2]||(s[2]=(...a)=>e.itemsFiltrados&&e.itemsFiltrados(...a)),class:"border border-gray-300 rounded-md w-48 px-3 py-2 focus:outline-none focus:border-blue-400"},null,544),[[m,e.initialDate]])]),t("div",U,[t("div",I,l(e.$t("End date"))+": ",1),u(t("input",{type:"date","onUpdate:modelValue":s[3]||(s[3]=a=>e.endDate=a),onChange:s[4]||(s[4]=(...a)=>e.itemsFiltrados&&e.itemsFiltrados(...a)),class:"border border-gray-300 rounded-md w-48 px-3 py-2 focus:outline-none focus:border-blue-400"},null,544),[[m,e.endDate]])]),t("div",E,[u(t("input",{type:"search",class:"block w-full h-11 rounded-md border-0 py-1.5 pl-10 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm","onUpdate:modelValue":s[5]||(s[5]=a=>e.filters.global.value=a),placeholder:e.$t("Search...")},null,8,O),[[m,e.filters.global.value]]),z])])]),default:i(()=>[d(o,{field:"dateFormatted",header:e.$t("Date"),sortable:"",class:"dateTable"},null,8,["header"]),d(o,{field:"number",header:e.$t("Concept"),sortable:"",class:"dateTable"},null,8,["header"]),d(o,{class:"dateTable"},{header:i(()=>[t("div",Y,[t("div",null,l(e.$t("Duty")),1),t("div",H,[t("div",K,l(e.$t("Subtotal")),1),t("div",L,l(e.$t("Tax")),1),t("div",q,l(e.$t("Total")),1)])])]),body:i(a=>[t("div",G,[t("div",J,l(a.data.isReceived?"-":a.data.subtotal),1),t("div",Q,l(a.data.isReceived?"-":a.data.tax),1),t("div",W,l(a.data.isReceived?"-":a.data.amount),1)])]),_:1}),d(o,{class:"dateTable"},{header:i(()=>[t("div",X,[t("div",null,l(e.$t("Have")),1),t("div",Z,[t("div",P,l(e.$t("Subtotal")),1),t("div",ee,l(e.$t("Tax")),1),t("div",te,l(e.$t("Total")),1)])])]),body:i(a=>[t("div",ae,[t("div",se,l(a.data.isReceived?a.data.subtotal:"-"),1),t("div",oe,l(a.data.isReceived?a.data.tax:"-"),1),t("div",le,l(a.data.isReceived?a.data.amount:"-"),1)])]),_:1})]),_:1},8,["value","selection","onRowClick"]),t("div",ne,[t("div",ie,[t("div",de,[t("table",ce,[t("tbody",null,[t("tr",null,[t("td",re,l(e.$t("Subtotal (excluding Tax)"))+":",1),t("td",ue,l(e.balance.subtotal)+"€",1)]),me,t("tr",null,[t("td",he,l(e.$t("Total Tax"))+":",1),t("td",pe,l(e.balance.tax)+"€",1)]),ge,t("tr",null,[t("td",be,l(e.$t("Total (with IVA)"))+":",1),t("td",fe,l(e.balance.amount)+"€",1)])])])])])])])])])])]),d(f,{visible:e.accountingDialog,"onUpdate:visible":s[8]||(s[8]=a=>e.accountingDialog=a),header:e.$t("Select companies"),modal:!0,onChange:e.handleCompanySelection,class:"p-fluid w-full sm:w-3/4 md:w-2/3 lg:w-1/2 max-w-4xl"},{default:i(()=>[t("label",ye,l(e.$t("Select your company"))+":",1),d(h,{modelValue:e.selectedCompany,"onUpdate:modelValue":s[7]||(s[7]=a=>e.selectedCompany=a),options:e.companies,filter:"",optionLabel:"name",class:"w-full h-11 md:w-64rem mb-4 bg-gray-50 border border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500",onChange:e.handleCompanySelection},{value:i(a=>[a.value?(r(),g("div",ve,[t("div",null,l(a.value.name),1)])):b("",!0)]),option:i(a=>[t("div",we,[t("div",null,l(a.option.name),1)])]),_:1},8,["modelValue","options","onChange"])]),_:1},8,["visible","header","onChange"])]),_:1})}}});export{Te as default};
