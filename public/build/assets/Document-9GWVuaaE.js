import{s as yo,a as bo}from"./toolbar.esm-Cd-vN5-F.js";import{a as Co,b as To,d as Ao,c as So,s as wo}from"./column.esm-Bmqoyq0V.js";import{s as ko}from"./document-CdvRMPnJ.js";import{o as se,e as ie,a as t,b as B,w as ee,t as d,g as Ce,F as Ft,h as Eo,j as Oo,f as Fe,l as Ee,x as _o,n as Ot,z as Io,v as De,c as Ro,m as Pt}from"./app-5aQVHSgM.js";import{_ as Do}from"./AppLayout-aAt5cx5Z.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";if(document.all&&!window.setTimeout.isPolyfill){var No=window.setTimeout;window.setTimeout=function(r,e){var s=Array.prototype.slice.call(arguments,2);return No(r instanceof Function?function(){r.apply(null,s)}:r,e)},window.setTimeout.isPolyfill=!0}var Mo=window.XMLHttpRequest,Te=function(r,e){var s="1.8.2.1",b=2,F=null,Z=null,E=null,W=null,Q=null,ue=!1,J=!1,a=!1,de=new Array;de.es_ES={checktime_warn:"Se ha detectado un desfase horario entre su sistema y el servidor. Se recomienda que se corrija antes de pulsar Aceptar para continuar.",checktime_err:"Se ha detectado un desfase horario entre su sistema y el servidor. Debe corregir la hora de su sistema y recargar esta página antes de continuar.",checktime_local_time:"Hora de su sistema",checktime_server_time:"Hora del servidor"},de.gl_ES={checktime_warn:"Destectouse un desfase horario entre o seu sistema e o servidor. Recoméndase corrixilo antes de pulsar Aceptar para continuar.",checktime_err:"Destectouse un desfase horario entre o seu sistema e o servidor. Debe corrixir a hora do seu sistema antes de continuar.",checktime_local_time:"Hora do seu sistema",checktime_server_time:"Hora do servidor"};var Ye=de.es_ES,Re=Ye,fe=null,Pe="WINDOWS",Le="APPLE",V="PKCS12",$e="PKCS11",ge="MOZ_UNI",K="SHARED_NSS",w="JAVA",Ke="JCEKS",z="JAVACE",X="DNIEJAVA",Ne="CT_NO",dt="CT_RECOMMENDED",ft="CT_OBLIGATORY",St=2e3,pt=15,it=!1,Me,ze,Oe,Xe=null,wt=!1;function Lt(){return"WebSocket"in r||"MozWebSocket"in r}function lt(x){return x!=null&&x.length>8&&(x.substr(0,5)=="http:"||x.substr(0,6)=="https:")}var _t=null,It=null,ut=null;function $t(x,k,g){_t=k,It=g;var R=Ge();R.open("GET",x,!0),"responseType"in R&&Uint8Array?(R.responseType="arraybuffer",ut="arraybuffer"):"overrideMimeType"in R?(R.overrideMimeType("text/plain; charset=x-user-defined"),ut="string"):(R.setRequestHeader("Accept-Charset","x-user-defined"),ut="bytearray"),"onload"in R||(R.onreadystatechange=function(){this.readyState===4&&this.onload()}),R.onload=function($){if(R.readyState==4&&R.status==200&&_t){"response"in this||(this.response=new VBArray(this.responseBody).toArray());var L;ut=="arraybuffer"?L=I.encodeArrayBuffer(this.response):ut=="bytearray"?L=I.encodeByteArray(this.response):ut=="string"?L=I.encode(this.response):this.onerror(new Error("No se conoce el modo usado para la descarga de los datos")),_t(L)}};try{R.onerror=function($){It&&It($)}}catch{}R.send()}function Ge(){var x=null;if(typeof XMLHttpRequest<"u")typeof Sarissa<"u"&&Sarissa.originalXMLHttpRequest?x=new Sarissa.originalXMLHttpRequest:x=new Mo;else if(typeof r.ActiveXObject<"u")try{x=new ActiveXObject("Msxml2.XMLHTTP.4.0")}catch{try{x=new ActiveXObject("MSXML2.XMLHTTP")}catch{try{x=new ActiveXObject("Microsoft.XMLHTTP")}catch{x=null}}}return x}var Ut=function(x){it=x},Vt=function(x){Oe=x};function jt(){return!0}function qt(){return!1}var Ht=function(x){},Kt=function(x){},Dt=function(x,k,g){if(!(!x||x==Ne||k&&k<=0)){k||(k=3e5);try{var R;g?R=g:R=document.URL+"/"+Math.random();var $=Ge();$.open("GET",R,!1),$.send();var L=new Date,te=new Date($.getResponseHeader("Date"));if(te==null||te.getTime()==0)return;console.log("Hora cliente: "+L),console.log("Hora servidor: "+te);var ke=Math.abs(L.getTime()-te.getTime());ke>k&&(x==dt?alert(Re.checktime_warn+`
`+Re.checktime_local_time+": "+L.toLocaleString()+`
`+Re.checktime_server_time+": "+te.toLocaleString()):x==ft&&(ue=!0,alert(Re.checktime_err+`
`+Re.checktime_local_time+": "+L.toLocaleString()+`
`+Re.checktime_server_time+": "+te.toLocaleString())))}catch(pe){console.log("Error en la obtencion de la hora del servidor: "+pe);return}}};function Bt(){return oe.isFirefox()?ge:null}var Jt=function(x){E.setKeyStore(x??fe),a=!0},Yt=function(x,k,g){E.selectCertificate(x,k,g),a=!1},Gt=function(x,k,g,R,$,L){E.sign(x,k,g,R,$,L),a=!1},Xt=function(x,k,g,R,$,L,te){E.coSign(x,g,R,$,L,te),a=!1},Wt=function(x,k,g,R,$,L){E.coSign(x,k,g,R,$,L),a=!1},zt=function(x,k,g,R,$,L){E.counterSign(x,k,g,R,$,L),a=!1},Qt=function(x,k,g,R,$,L,te,ke){E.signAndSaveToFile(x,k,g,R,$,L,te,ke),a=!1},Zt=function(x,k,g,R,$,L){E.signBatchXML(x,k,g,R,$,L),a=!1},eo=function(x,k,g,R){var $=new Object;$.algorithm=x,$.format=k,$.suboperation=g,R&&($.extraparams=I.encode(R)),$.singlesigns=new Array,Xe=$},to=function(x,k,g,R,$){if(!x||k==null)throw new Error("No se ha indicado el id o datareference de la firma");if(!Xe)throw new Error("No hay ningun lote creado. Es necesario crear uno antes de agregar firmas");ve.checkExistingId(Xe.singlesigns,x);var L=new Object;L.id=x,L.datareference=k,g&&(L.format=g),R&&(L.suboperation=R),$&&(L.extraparams=I.encode($)),Xe.singlesigns.push(L)},oo=function(x){wt=x},ro=function(x,k,g,R,$,L){if(!Xe)throw new Error("No hay ningun lote creado. Es necesario crear uno antes de firmar.");Xe.stoponerror=x;var te=I.encode(JSON.stringify(Xe),!0);E.signBatchJSON(te,k,g,R,$,L),Xe=null,a=!1},ao=function(x){return x!=null?I.encode(x):null},no=function(x){return x!=null?I.decode(x):null},so=function(x,k,g,R,$,L,te){E.saveDataToFile(x,k,g,R,$,L,te)},io=function(x,k,g,R,$,L){E.getFileNameContentBase64(x,k,g,R,$,L)},lo=function(x,k,g,R,$,L){E.getMultiFileNameContentBase64(x,k,g,R,$,L)},uo=function(x,k){E.getCurrentLog(x,k)},co=function(){return E.echo()},kt=function(x){J&&!x&&(a=!0),J=x},Et=function(x){Re=x==null||de[x]==null?Ye:de[x]},fo=function(){return E.getErrorMessage()},po=function(){return E.getErrorType()},mo=function(x,k){W=x,Q=k,E&&E.setServlets&&E.setServlets(x,k)},ho=function(x,k){var g=1024,R=65535;Me=x&&x>=g&&x<=R?x:g,ze=k?k<=R&&k>=Me?k:R:x&&x==Me?Me:R,E&&E.setPortRange&&E.setPortRange(Me,ze)};function Rt(x){if(oe.isChrome()||oe.isIOS()||oe.isAndroid()&&oe.isFirefox())document.location=x;else{if(document.getElementById("iframeAfirma")!=null)try{var k=document.getElementById("iframeAfirma");k.outerHTML="",k=null}catch{}navigator.msLaunchUri?navigator.msLaunchUri(x,null,function(){wrongInstallation=!0}):go(x)}}function go(x){var k=document.createElement("iframe"),g=document.createAttribute("id");g.value="iframeAfirma",k.setAttributeNode(g);var R=document.createAttribute("src");R.value=x,k.setAttributeNode(R);var $=document.createAttribute("height");$.value=1,k.setAttributeNode($);var L=document.createAttribute("width");if(L.value=1,k.setAttributeNode(L),!oe.isInternetExplorer7orLower()){var te=document.createAttribute("style");te.value="display: none;",k.setAttributeNode(te)}document.body.appendChild(k)}function Nt(x,k,g){if(ue){console&&console.log&&console.log("Se ha detectado un desfase grave entre la hora del sistema y la del servidor. Se cancela la carga del cliente de firma");return}it||oe.isIOS()||oe.isAndroid()?(E=new Mt(x,r,e),(W||Q)&&E.setServlets(W,Q)):Lt()&&!oe.isInternetExplorer()&&!oe.isFirefox60orLower()?(E=new vo(r,e),Me&&E.setPortRange(Me,ze)):!oe.isInternetExplorer10orLower()&&!oe.isSafari10()?(E=new xo(x,r,e),Me&&E.setPortRange(Me,ze)):(E=new Mt(x,r,e),(W||Q)&&E.setServlets(W,Q)),k||(k=Bt()),E.setKeyStore(k)}var oe=function(x,k){function g(){return navigator.userAgent.toUpperCase().indexOf("ANDROID")!=-1||navigator.appVersion.toUpperCase().indexOf("ANDROID")!=-1||navigator.userAgent.toUpperCase().indexOf("SILK/")!=-1||navigator.userAgent.toUpperCase().indexOf("KFJWI")!=-1||navigator.userAgent.toUpperCase().indexOf("KFJWA")!=-1||navigator.userAgent.toUpperCase().indexOf("KFTT")!=-1||navigator.userAgent.toUpperCase().indexOf("KFOT")!=-1||navigator.userAgent.toUpperCase().indexOf("KINDLE FIRE")!=-1}function R(){return navigator.userAgent.toUpperCase().indexOf("IPAD")!=-1||navigator.userAgent.toUpperCase().indexOf("IPOD")!=-1||navigator.userAgent.toUpperCase().indexOf("IPHONE")!=-1||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1}function $(){return!!navigator.userAgent.match(/MSIE/)||!!(navigator.userAgent.match(/Trident/)&&navigator.userAgent.match(/rv:11/))||!!navigator.userAgent.match(/Trident.*rv[ :]*11\./)}function L(){return!!navigator.userAgent.match(/MSIE/)}function te(){var le=navigator.userAgent.toLowerCase();return 7>=(le.indexOf("msie")!=-1)?parseInt(le.split("msie")[1]):!1}function ke(){return navigator.sayswho=function(){var le=navigator.userAgent,Y,ae=le.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(ae[1])?(Y=/\brv[ :]+(\d+)/g.exec(le)||[],"IE "+(Y[1]||"")):ae[1]==="Chrome"&&(Y=le.match(/\b(OPR|Edge)\/(\d+)/),Y!=null)?Y.slice(1).join(" ").replace("OPR","Opera"):(ae=ae[2]?[ae[1],ae[2]]:[navigator.appName,navigator.appVersion,"-?"],(Y=le.match(/version\/(\d+)/i))!=null&&ae.splice(1,1,Y[1]),ae.join(" "))}(),navigator.sayswho=="Safari 10"}function pe(){return navigator.userAgent.toUpperCase().indexOf("FIREFOX")!=-1}function Ae(){navigator.sayswho=function(){var Y=navigator.userAgent,ae,re=Y.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(re[1])?(ae=/\brv[ :]+(\d+)/g.exec(Y)||[],"IE "+(ae[1]||"")):re[1]==="Chrome"&&(ae=Y.match(/\b(OPR|Edge)\/(\d+)/),ae!=null)?ae.slice(1).join(" ").replace("OPR","Opera"):(re=re[2]?[re[1],re[2]]:[navigator.appName,navigator.appVersion,"-?"],(ae=Y.match(/version\/(\d+)/i))!=null&&re.splice(1,1,ae[1]),re.join(" "))}();var le=navigator.sayswho;return le.indexOf("Firefox")!=-1?60>=parseInt(le.split("Firefox")[1]):!1}function me(){return navigator.userAgent.toUpperCase().indexOf("CHROME/")!=-1||navigator.userAgent.toUpperCase().indexOf("CHROMIUM")!=-1}return{isAndroid:g,isIOS:R,isInternetExplorer:$,isInternetExplorer10orLower:L,isInternetExplorer7orLower:te,isSafari10:ke,isFirefox:pe,isFirefox60orLower:Ae,isChrome:me}}(),ve=function(x,k){var g=2147483648,R="1234567890abcdefghijklmnopqrstuwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",$=1024,L=49152,te=65535;function ke(){var G=20,O="",q;if(typeof x.crypto<"u"&&typeof x.crypto.getRandomValues<"u")q=new Uint32Array(G),x.crypto.getRandomValues(q);else{q=new Array(G);for(var j=0;j<G;j++)q[j]=pe()}for(var j=0;j<G;j++)O+=R.charAt(Math.floor(q[j]%R.length));return O}function pe(){return me()*g}var Ae;function me(){return Ae==k&&(Ae=new Date().getMilliseconds()*1e3*Math.random()),Ae=(Ae*9301+49297)%233280,Ae/233280}function le(G,O){var q=G?Math.max(G,$):L,j=O?Math.min(O,te):te,M=new Array;switch(j-q){case 0:M[0]=q;break;case 1:M[0]=Y(q,j,M),M[1]=Y(q,j,M);break;default:M[0]=Y(q,j,M),M[1]=Y(q,j,M),M[2]=Y(q,j,M)}return M}function Y(G,O,q){if(q.length>O-G)return 0;var j;do{var M=Math.floor(Math.random()*(O+1-G))+G;j=ae(M,q)}while(j);return M}function ae(G,O){for(var q=0;q<O.length;q++)if(O[q]===G)return!0;return!1}function re(G){var O=I.decode(G);return JSON.parse(O)}function H(G,O){for(var q=0;q<G.length;q++)if(G[q].id==O)throw new Error('El id de la firma a agregar = "'+G[q].id+'" ya existe en el lote')}return{generateNewIdSession:ke,getRandomPorts:le,parseJSONData:re,checkExistingId:H,getRandom:pe}}(r,e),vo=function(x,k){var g=4,R="127.0.0.1",$="wss://"+R+":",L="load",te="multiload",ke="save",pe="batch",Ae="log",me="certificate",le="sign",Y="",ae="",re="",H="",G="",O=!1,q=ve.generateNewIdSession(),j=null,M=null,_e=null,Qe=null,Ze=null,et=function(c,m){Qe=c,Ze=m},mt=function(c){j=c},ht=function(c,m,o){ne(m,o),H=me;var n=Be(c);he(ye(n))},gt=function(c,m,o,n,f,u){tt("sign",c,m,o,n,f,u)},vt=function(c,m,o,n,f,u){tt("cosign",c,m,o,n,f,u)},xt=function(c,m,o,n,f,u){tt("countersign",c,m,o,n,f,u)};function tt(c,m,o,n,f,u,y){ne(u,y),H=le;var N=Ve(c,o,n,f,Se(m));he(ye(N))}var ot=function(c,m,o,n,f,u,y,N){ne(y,N),H=le;var U=je(c,Se(m),o,n,f,u);he(ye(U))},yt=function(c,m,o,n,f,u){ne(f,u),H=pe;var y=rt(m,o,n,Se(c),!1);he(ye(y))},bt=function(c,m,o,n,f,u){ne(f,u),H=pe;var y=rt(m,o,n,c,!0);he(ye(y))},Ct=function(c,m,o,n,f,u){ne(f,u),H=L;var y=at("load",c,m,o,n,!1);he(ye(y))},Tt=function(c,m,o,n,f,u){ne(f,u),H=te;var y=at("load",c,m,o,n,!0);he(ye(y))},xe=function(c,m){ne(c,m),H=Ae;var o=at("getLog");he(ye(o))},Ue=function(c,m,o,n,f,u,y){ne(u,y),H=ke;var N=nt(Se(c),m,o,n,f);he(ye(N))};function ne(c,m){M=c,_e=m}function Se(c){return c?c.replace(/\+/g,"-").replace(/\//g,"_"):null}function Be(c){var m=new Object;return m.op=v("op","selectcert"),m.idsession=v("idsession",q),m.properties=v("properties",c!=null?I.encode(c,!0):null,!0),m.ksb64=v("ksb64",j!=null?I.encode(j,!0):null,!0),m.sticky=v("sticky",J),a&&(m.resetSticky=v("resetsticky",a)),m}function Ve(c,m,o,n,f){var u=new Object;return u.op=v("op",c),u.idsession=v("idsession",q),u.algorithm=v("algorithm",m),u.format=v("format",o),u.properties=v("properties",n!=null?I.encode(n,!0):null,!0),u.ksb64=v("ksb64",j!=null?I.encode(j,!0):null,!0),u.sticky=v("sticky",J),a&&(u.resetSticky=v("resetsticky",a)),u.dat=v("dat",f==""?null:f,!0),u}function je(c,m,o,n,f,u){var y=new Object;return y.op=v("op","signandsave"),y.idsession=v("idsession",q),y.cryptoOp=v("cop",c),y.algorithm=v("algorithm",o),y.format=v("format",n),y.properties=v("properties",f?I.encode(f,!0):null,!0),y.filename=v("filename",u),y.ksb64=v("ksb64",j?I.encode(j,!0):null,!0),y.sticky=v("sticky",J),a&&(y.resetSticky=v("resetsticky",a)),y.dat=v("dat",m==""?null:m,!0),y}function rt(c,m,o,n,f){var u=new Object;return u.op=v("op","batch"),u.idsession=v("idsession",q),u.batchpresignerurl=v("batchpresignerurl",c),u.batchpostsignerurl=v("batchpostsignerurl",m),u.properties=v("properties",o!=null?I.encode(o,!0):null,!0),u.ksb64=v("ksb64",j!=null?I.encode(j,!0):null,!0),u.sticky=v("sticky",J),a&&(u.resetSticky=v("resetsticky",a)),u.needcert=v("needcert",!0),u.dat=v("dat",n==""?null:n,!0),f&&(u.jsonbatch=v("jsonbatch",!0),wt&&(u.localBatchProcess=v("localBatchProcess",!0))),u}function at(c,m,o,n,f,u){var y=new Object;return y.op=v("op",c),y.idsession=v("idsession",q),y.title=v("title",m),y.extensions=v("exts",o),y.description=v("desc",n),y.filePath=v("filePath",f),y.multiload=v("multiload",u),y}function nt(c,m,o,n,f){var u=new Object;return u.op=v("op","save"),u.idsession=v("idsession",q),u.title=v("title",m),u.filename=v("filename",o),u.extension=v("exts",n),u.description=v("desc",f),u.dat=v("dat",c==""?null:c,!0),u}function ye(c){var m=[];Oe&&m.push(v("mcv",Oe));for(var o in c)m.push(c[o]);for(var n="afirma://"+encodeURIComponent(c.op.value)+"?",f=0;f<m.length;f++)m[f].value!=null&&m[f].value!="null"&&(n+=(f!=0?"&":"")+m[f].key+"="+(m[f].avoidEncoding===!0?m[f].value:encodeURIComponent(m[f].value)));return n}function he(c){if(G=c,st())console.log("Enviamos el mensaje al socket abierto"),qe(Te.AUTOFIRMA_CONNECTION_RETRIES);else{var m=ve.getRandomPorts(Qe,Ze);ct(m),console.log("Tratamos de conectar con el cliente a traves de WebSockets en los puertos "+m),setTimeout(Ie,3e3,m,Te.AUTOFIRMA_CONNECTION_RETRIES)}}function st(){return!!re&&O}function ct(c){for(var m="",o=0;o<c.length;o++)m+=c[o],o<c.length-1&&(m+=",");var n="afirma://websocket?ports="+m+"&v="+g+"&jvc="+b+"&idsession="+q;Rt(n)}function Ie(c,m){if(O)console.log("Enviamos el mensaje al socket"),qe(Te.AUTOFIRMA_CONNECTION_RETRIES);else if(m>0){for(var o=0;!O&&o<c.length;o++)At(c[o]);setTimeout(Ie,Te.AUTOFIRMA_LAUNCHING_TIME,c,m-1)}else l("es.gob.afirma.standalone.ApplicationNotFoundException","No se ha podido conectar con AutoFirma.")}function At(c){var m;try{m=new WebSocket($+c)}catch(o){console.log("Error estableciendo el WebSocket: "+o)}return m.onopen=function(o,n){O=!0,re=this,console.log("Se abre el socket")},m.onclose=function(o){re!=null&&re===this&&(O=!1,re=null,console.log("Se cierra el socket. Codigo WebSocket de cierre: "+(o?o.code:null)),l("java.lang.InterruptedException","AutoFirma se ha cerrado o ha cerrado el websocket de comunicacion"))},m.onmessage=function(o){console.log("Procesado por defecto del mensaje")},m.onerror=function(o){console.log("Procesado por defecto del error")},m}function qe(c){re.onmessage=ce,re.onerror=function(m){console.log("Error en la comunicacion por websocket: "+m),We(re,q,c-1)},We(re,q,c)}var ce=function(c){console.log("Respuesta de la peticion de eco"),re.onmessage=function(m){console.log("Respuesta obtenida de la operacion enviada"),we(m.data)},re.send(G)};function We(c,m,o){if(o<=0){l("java.util.concurrent.TimeoutException","AutoFirma no respondio al saludo.");return}if(c.readyState===1)try{c.send("echo=-idsession="+m+"@EOF")}catch(n){console.log("Error en echo: "+n),setTimeout(We,Te.AUTOFIRMA_LAUNCHING_TIME,c,m,o-1)}else console.log("El socket aun no esta preparado"),setTimeout(We,Te.AUTOFIRMA_LAUNCHING_TIME,c,m,o-1)}function we(c){if(c==k||c==null||c=="CANCEL"){l("es.gob.afirma.core.AOCancelledOperationException","Operacion cancelada por el usuario");return}if(c=="MEMORY_ERROR"){l("es.gob.afirma.core.OutOfMemoryError","El fichero que se pretende firmar o guardar excede de la memoria disponible para aplicacion");return}if(c.length>4&&c.substr(0,4)=="SAF_"){l("java.lang.Exception",c);return}if(c=="NULL"){l("java.lang.Exception","Error desconocido");return}if(H==ke)p(c);else if(H==L)h(c,!1);else if(H==te)h(c,!0);else if(H==me)C(c);else if(H==pe)A(c);else if(H==Ae)D(c);else if(H==le)_(c);else if(console.log("Operacion desconocida. Se devuelve directamente su resultado."),M){var m=M;ne(null,null),m(c)}else console.log("No se ha proporcionado funcion callback para procesar el resultado de la operacion")}function l(c,m){if(ae=c,Y=m,_e){var o=_e;ne(null,null),o(c,m)}}function h(c,m){if(c.indexOf(":")<=0){l("java.lang.Exception","Respuesta no valida");return}if(!M){console.log("No se ha proporcionado funcion callback para procesar el resultado del lote de firma");return}var o,n,f=c.split("|");if(m)for(o=new Array,n=new Array,i=0;i<f.length;i++){var u=f[i].indexOf(":");o.push(f[i].substring(0,u)),n.push(f[i].substring(u+1).replace(/\-/g,"+").replace(/\_/g,"/"))}else{var u=f[0].indexOf(":");o=f[0].substring(0,u),n=f[0].substring(u+1).replace(/\-/g,"+").replace(/\_/g,"/")}if(M){var y=M;ne(null,null),y(o,n)}else console.log("No se ha proporcionado funcion callback a la que notificar el resultado de la carga de datos")}function p(c){if(c=="OK"||c=="SAVE_OK")if(M){var m=M;ne(null,null),m(c)}else console.log("No se ha proporcionado funcion callback a la notificar el resultado");else l("java.lang.Exception","Error desconocido al procesar los datos")}function C(c){if(M){var m=M;ne(null,null),m(c.replace(/\-/g,"+").replace(/\_/g,"/"))}else console.log("No se ha proporcionado funcion callback para devolver el certificado seleccionado")}function A(c){if(M){var m,o=null,n=c.indexOf("|");n==-1?m=c:(m=c.substring(0,n).replace(/\-/g,"+").replace(/\_/g,"/"),o=c.substring(n+1).replace(/\-/g,"+").replace(/\_/g,"/"));try{m=ve.parseJSONData(m)}catch{}if(M){var f=M;ne(null,null),f(m,o)}else console.log("No se ha proporcionado funcion callback a la que devolver el resultado del lote")}else console.log("No se ha proporcionado funcion callback para procesar el resultado del lote de firma")}function D(c){if(!M){console.log("No se ha proporcionado funcion callback para procesar el log");return}var m=` === JAVASCRIPT INFORMATION === 
navigator.appCodeName: `+navigator.appCodeName+`
navigator.appName: `+navigator.appName+`
navigator.appVersion: `+navigator.appVersion+`
navigator.platform: `+navigator.platform+`
navigator.userAgent: `+navigator.userAgent+`
navigator.javaEnabled(): `+navigator.javaEnabled()+`
screen.width: `+(x.screen?screen.width:0)+`
screen.height: `+(x.screen?screen.height:0)+`

   === CLIENTE LOG === 
`+c;if(M){var o=M;ne(null,null),o(m)}else console.log("No se ha proporcionado funcion callback a la que devolver el log")}function _(c){if(!M){console.log("No se ha proporcionado funcion callback para procesar el resultado de la firma");return}var m,o=null,n=null,f=c.indexOf("|");if(f==-1)m=I.decode(c,!0).replace(/\-/g,"+").replace(/\_/g,"/");else{o=c.substring(0,f).replace(/\-/g,"+").replace(/\_/g,"/");var u=c.indexOf("|",f+1);u==-1?m=c.substring(f+1).replace(/\-/g,"+").replace(/\_/g,"/"):(m=c.substring(f+1,u).replace(/\-/g,"+").replace(/\_/g,"/"),n=I.decode(c.substring(u),!0))}if(M){var y=M;ne(null,null),y(m,o,n)}else console.log("No se ha proporcionado funcion callback a la que devolver la firma generada")}function v(c,m,o){var n=new Object;return n.key=c,n.value=m,n.avoidEncoding=!!o,n}function P(){return"Cliente JavaScript"}function T(){return Y}function S(){return ae}return{echo:P,setKeyStore:mt,setPortRange:et,sign:gt,coSign:vt,counterSign:xt,signBatchJSON:bt,signBatchXML:yt,selectCertificate:ht,saveDataToFile:Ue,signAndSaveToFile:ot,getFileNameContentBase64:Ct,getMultiFileNameContentBase64:Tt,setStickySignatory:kt,setLocale:Et,getErrorMessage:T,getErrorType:S,getCurrentLog:xe}},xo=function(x,k,g){var R="",$="",L="",te,ke=1,pe=500,Ae="https://127.0.0.1:",me="",le=0,Y=!1,ae=!1,re=!1,H="",G=oe.isInternetExplorer()?12e3:oe.isFirefox()?458752:1048576,O=!1,q=null,j=null,M=null,_e=null,Qe=null,Ze=null,et=function(o,n){Qe=o,Ze=n};function mt(o){q=o}function ht(o,n,f){j=n,M=f,gt(o)}function gt(o){var n=new Object;n.op=p("op","selectcert"),n.properties=p("properties",o!=null?I.encode(o):null),n.keystore=p("keystore",q??null),n.ksb64=p("ksb64",q!=null?I.encode(q):null),n.sticky=p("sticky",J),a&&(n.resetSticky=p("resetsticky",a)),Se(ne(n))}function vt(o,n,f,u,y,N){j=y,M=N,ot("sign",o,n,f,u)}function xt(o,n,f,u,y,N){j=y,M=N,ot("cosign",o,n,f,u)}function tt(o,n,f,u,y,N){j=y,M=N,ot("countersign",o,n,f,u)}function ot(o,n,f,u,y){(n==g||n=="")&&(n=null),n!=null&&!lt(n)&&(n=n.replace(/\+/g,"-").replace(/\//g,"_"));var N=Ve(o,f,u,y,n,q);Se(ne(N))}function yt(o,n,f,u,y,N,U,be){j=U,M=be,bt(o,n,f,u,y,N)}function bt(o,n,f,u,y,N){(n==g||n=="")&&(n=null),n!=null&&!lt(n)&&(n=n.replace(/\+/g,"-").replace(/\//g,"_"));var U=je(o,f,u,y,N,n,q);Se(ne(U))}function Ct(o,n,f,u,y,N){j=y,M=N,xe(o,n,f,u,!1)}function Tt(o,n,f,u,y,N){j=y,M=N,xe(o,n,f,u,!0)}function xe(o,n,f,u,y){(o==g||o=="")&&(o=null),o!=null&&(o=o.replace(/\+/g,"-").replace(/\//g,"_"));var N=Ue(q,n,f,u,o,y);Se(ne(N))}function Ue(o,n,f,u,y,N){var U=new Object;return U.op=p("op","batch"),U.keystore=p("keystore",o??null),U.ksb64=p("ksb64",o!=null?I.encode(o):null),U.batchpresignerurl=p("batchpresignerurl",n),U.batchpostsignerurl=p("batchpostsignerurl",f),U.properties=p("properties",u!=null?I.encode(u):null),U.dat=p("dat",y==""?null:y),U.needcert=p("needcert",!0),U.sticky=p("sticky",J),a&&(U.resetSticky=p("resetsticky",a)),N&&(U.jsonbatch=p("jsonbatch",!0)),wt&&(U.localBatchProcess=p("localBatchProcess",!0)),U}function ne(o){var n=[];Oe&&n.push(p("mcv",Oe));for(var f in o)n.push(o[f]);for(var u="afirma://"+encodeURIComponent(o.op.value)+"?",y=0;y<n.length;y++)n[y].value!=null&&n[y].value!="null"&&(u+=(y!=0?"&":"")+n[y].key+"="+encodeURIComponent(n[y].value));return u}function Se(o){if(L==""){var n=ve.getRandomPorts(Qe,Ze);Be(n),setTimeout(at,Te.AUTOFIRMA_LAUNCHING_TIME,n,o)}else O=!1,nt(L,o,Te.AUTOFIRMA_CONNECTION_RETRIES)}function Be(o){for(var n="",f=0;f<o.length;f++)n+=o[f],f<o.length-1&&(n+=",");te=ve.generateNewIdSession();var u="afirma://service?ports="+n+"&v="+ke+"&jvc="+b+"&idsession="+te;Rt(u)}function Ve(o,n,f,u,y,N){var U=new Object;return U.op=p("op",o),U.keystore=p("keystore",N??null),U.ksb64=p("ksb64",N!=null?I.encode(N):null),U.algorithm=p("algorithm",n),U.format=p("format",f),U.properties=p("properties",u!=null?I.encode(u):null),U.dat=p("dat",y==""?null:y),U.sticky=p("sticky",J),a&&(U.resetSticky=p("resetsticky",a)),U}function je(o,n,f,u,y,N,U){var be=new Object;return be.op=p("op","signandsave"),be.cryptoOp=p("cop",o),be.keystore=p("keystore",U??null),be.ksb64=p("ksb64",U!=null?I.encode(U):null),be.algorithm=p("algorithm",n),be.format=p("format",f),be.properties=p("properties",u!=null?I.encode(u):null),be.filename=p("filename",y),be.dat=p("dat",N==""?null:N),be.sticky=p("sticky",J),a&&(be.resetSticky=p("resetsticky",a)),be}function rt(o,n,f,u,y,N){var U=new Object;return U.op=p("op",o),U.title=p("title",n),U.extensions=p("exts",f),U.description=p("desc",u),U.filePath=p("filePath",y),U.multiload=p("multiload",N),U}function at(o,n){O=!1;var f=new Object;f.locked=!1;for(var u=0;!O&&u<o.length;u++)nt(o[u],n,Te.AUTOFIRMA_CONNECTION_RETRIES,f)}function nt(o,n,f,u){_e=n;var y=Ge();y.open("POST",Ae+o+"/afirma",!0),y.setRequestHeader("Content-type","application/x-www-form-urlencoded"),y.onreadystatechange=function(){if(y.readyState==4&&y.status==200&&I.decode(y.responseText,!0)=="OK"&&!O)L=o,H=Ae+L+"/afirma",O=!0,u&&(u.locked=!0),Y=_e.indexOf("afirma://selectcert")>-1,ae=_e.indexOf("afirma://save")>-1,re=_e.indexOf("afirma://batch")>-1,_e.indexOf("afirma://signandsave")>-1,he();else if((!u||!u.locked)&&!O&&y.readyState!=2&&y.readyState!=3)if(f--,L!=""&&f<Te.AUTOFIRMA_CONNECTION_RETRIES/2)L="",u&&(u.locked=!0),f=Te.AUTOFIRMA_CONNECTION_RETRIES,Se(_e);else if(f==0){(!u||!u.locked)&&(u&&(u.locked=!0),M("es.gob.afirma.standalone.ApplicationNotFoundException","No se ha podido conectar con AutoFirma."));return}else setTimeout(ye,Te.AUTOFIRMA_LAUNCHING_TIME,o,f,u)},O||y.send("echo=-idsession="+te+"@EOF")}function ye(o,n,f){nt(o,_e,n,f)}function he(){var o=_e;if(o.length>G){st(o,1,Math.ceil(o.length/G));return}var n=Ge();n.open("POST",H,!0),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.onreadystatechange=function(){if(n.status==404&&ce("java.lang.IOException",n.responseText),ae){n.readyState==4&&I.decode(n.responseText)!=""&&qe(I.decode(n.responseText));return}else if(n.readyState==4&&n.status==200&&n.responseText!=""){if(I.decode(n.responseText)=="MEMORY_ERROR"){ce("java.lang.OutOfMemoryError","Problema de memoria en servidor");return}me="",Ie(1,I.decode(n.responseText,!0))}else n.responseText==""&&n.status==0&&n.readyState==0&&setTimeout(he,pe)};try{n.onerror=function(f){f.target.status==0?ce("java.lang.IOException","Se ha perdido la conexion con la aplicacion @firma "+f.target.statusText):ce("java.lang.IOException","Ocurrio un error de red en la llamada al servicio de firma "+f.target.statusText)}}catch{}n.send("cmd="+I.encode(o,!0)+"idsession="+te+"@EOF")}function st(o,n,f){var u=Ge();u.open("POST",H,!0),u.setRequestHeader("Content-type","application/x-www-form-urlencoded");var y=o.substring((n-1)*G,Math.min(G*n,o.length));u.onreadystatechange=function(N){if(u.status==404){ce("java.lang.Exception",u.responseText);return}u.readyState==4&&u.status==200&&u.responseText!=""?(le++,I.decode(u.responseText,!0)=="MORE_DATA_NEED"?le<f&&st(o,n+1,f):I.decode(u.responseText,!0)=="OK"?le==f&&(le=0,ct()):I.decode(u.responseText)=="MEMORY_ERROR"&&qe(I.decode(u.responseText))):u.responseText==""&&u.status==0&&u.readyState==0&&setTimeout(st,pe,o,n,f)};try{u.onerror=function(N){N.target.status==0?ce("java.lang.IOException","Se ha perdido la conexion con la aplicacion @firma "+N.target.statusText):ce("java.lang.IOException","Ocurrio un error de red en la llamada al servicio de firma "+N.target.statusText)}}catch{}u.send("fragment=@"+n+"@"+f+"@"+I.encode(y,!0)+"idsession="+te+"@EOF")}function ct(){httpRequest=Ge(),httpRequest.open("POST",H,!0),httpRequest.setRequestHeader("Content-type","application/x-www-form-urlencoded"),httpRequest.onreadystatechange=function(){if(httpRequest.status==404&&ce("java.lang.Exception",httpRequest.responseText),ae){httpRequest.readyState==4&&I.decode(httpRequest.responseText)!=""&&qe(I.decode(httpRequest.responseText));return}else httpRequest.readyState==4&&httpRequest.status==200&&httpRequest.responseText!=""?(I.decode(httpRequest.responseText)=="MEMORY_ERROR"&&qe(I.decode(httpRequest.responseText)),me="",Ie(1,I.decode(httpRequest.responseText,!0))):httpRequest.status==0&&httpRequest.readyState==0&&setTimeout(ct,pe)};try{httpRequest.onerror=function(o){o.target.status==0?ce("java.lang.IOException","Se ha perdido la conexion con la aplicacion @firma "+o.target.statusText):ce("java.lang.IOException","Ocurrio un error de red en la llamada al servicio de firma "+o.target.statusText)}}catch{}httpRequest.send("firm=idsession="+te+"@EOF")}function Ie(o,n){httpRequest=Ge(),httpRequest.open("POST",H,!0),httpRequest.setRequestHeader("Content-type","application/x-www-form-urlencoded"),httpRequest.onreadystatechange=function(){if(httpRequest.readyState==4&&httpRequest.status==200&&httpRequest.responseText!=""){if(I.decode(httpRequest.responseText)=="MEMORY_ERROR"){ce("java.lang.OutOfMemoryError","Problema de memoria en servidor");return}me+=I.decode(httpRequest.responseText,!0),o==n?(re?(We(me),re=!1):Y?(At(me),Y=!1):qe(me),me=""):Ie(o+1,n)}else httpRequest.responseText==""&&httpRequest.status==0&&httpRequest.readyState==0&&setTimeout(Ie,pe,o,n)};try{httpRequest.onerror=function(f){f.target.status==0?ce("java.lang.IOException","Se ha perdido la conexion con la aplicacion @firma "+f.target.statusText):ce("java.lang.IOException","Ocurrio un error de red en la llamada al servicio de firma "+f.target.statusText)}}catch{}o<=n&&httpRequest.send("send=@"+o+"@"+n+"idsession="+te+"@EOF")}function At(o){if(o==g||o==null||o=="CANCEL"){M("es.gob.afirma.core.AOCancelledOperationException","Operacion cancelada por el usuario");return}if(o.length>4&&o.substr(0,4)=="SAF_"){M("java.lang.Exception",o);return}if(o=="NULL"){M("java.lang.Exception","Error desconocido");return}j(o.replace(/\-/g,"+").replace(/\_/g,"/"))}function qe(o){if(o==g||o==null||o=="CANCEL"){M("es.gob.afirma.core.AOCancelledOperationException","Operacion cancelada por el usuario");return}if(o=="OK"){try{o=ve.parseJSONData(o)}catch{}j(o,null);return}if(o=="MEMORY_ERROR"){M("es.gob.afirma.core.OutOfMemoryError","El fichero que se pretende firmar o guardar excede de la memoria disponible para aplicacion");return}if(o.length>4&&o.substr(0,4)=="SAF_"){M("java.lang.Exception",o);return}if(o=="NULL"){M("java.lang.Exception","Error desconocido");return}if(o=="SAVE_OK"){j&&j(o);return}if(o.length>150&&o.substr(0,150).indexOf("<log>")!=-1){var n=` === JAVASCRIPT INFORMATION === 
navigator.appCodeName: `+navigator.appCodeName+`
navigator.appName: `+navigator.appName+`
navigator.appVersion: `+navigator.appVersion+`
navigator.platform: `+navigator.platform+`
navigator.userAgent: `+navigator.userAgent+`
navigator.javaEnabled(): `+navigator.javaEnabled()+`
screen.width: `+(k.screen?screen.width:0)+`
screen.height: `+(k.screen?screen.height:0)+`

   === CLIENTE LOG === 
`+o;j(n);return}if(o.indexOf(":")>0){var f=o.split("|");if(f.length==1){var He=f[0].indexOf(":"),u=f[0];He==-1?fileName=I.decode(u,!0):(fileName=u.substring(0,He),dataB64=u.substring(He+1).replace(/\-/g,"+").replace(/\_/g,"/")),j(fileName,dataB64);return}else if(f.length>1){var y=new Array,N=new Array;for(i=0;i<f.length;i++){var He=f[i].indexOf(":");He==-1?(y.push(f[i]),N.push("")):(y.push(f[i].substring(0,He)),N.push(f[i].substring(He+1).replace(/\-/g,"+").replace(/\_/g,"/")))}}j(y,N);return}var U,be=null,He=o.indexOf("|");He==-1?U=I.decode(o,!0).replace(/\-/g,"+").replace(/\_/g,"/"):(be=o.substring(0,He).replace(/\-/g,"+").replace(/\_/g,"/"),U=o.substring(He+1).replace(/\-/g,"+").replace(/\_/g,"/")),j(U,be)}function ce(o,n){M&&M(o,n)}function We(o){if(o==g||o==null||o=="CANCEL"){M("es.gob.afirma.core.AOCancelledOperationException","Operacion cancelada por el usuario");return}if(o.length>4&&o.substr(0,4)=="SAF_"){M("java.lang.Exception",o);return}if(o=="NULL"){M("java.lang.Exception","Error desconocido");return}var n,f=null,u=o.indexOf("|");u==-1?n=o:(n=o.substring(0,u).replace(/\-/g,"+").replace(/\_/g,"/"),f=o.substring(u+1).replace(/\-/g,"+").replace(/\_/g,"/"));try{n=ve.parseJSONData(n)}catch{}j(n,f)}function we(o,n,f,u,y,N,U){j=N,M=U,l(o,n,f,u,y)}function l(o,n,f,u,y){(o==g||o=="")&&(o=null),o!=null&&!lt(o)&&(o=o.replace(/\+/g,"-").replace(/\//g,"_"));var N=h(o,n,f,u,y);Se(ne(N))}function h(o,n,f,u,y){var N=new Object;return N.op=p("op","save"),N.title=p("title",n),N.filename=p("filename",f),N.extension=p("exts",u),N.description=p("desc",y),N.dat=p("dat",o==""?null:o),N}function p(o,n){var f=new Object;return f.key=o,f.value=n,f}function C(o,n){return o!=null?I.encode(o):null}function A(o,n){return o!=null?I.decode(o):null}function D(o,n,f,u,y,N){j=y,M=N,P("load",o,n,f,u,!1)}function _(o,n,f,u,y,N){j=y,M=N,P("load",o,n,f,u,!0)}function v(o,n){j=o,M=n,T()}function P(o,n,f,u,y,N){var U=rt(o,n,f,u,y,N);Se(ne(U))}function T(){var o=rt("getLog");Se(ne(o))}function S(){return"Cliente JavaScript"}function c(){return R}function m(){return $}return{echo:S,checkTime:Dt,setKeyStore:mt,setPortRange:et,sign:vt,coSign:xt,counterSign:tt,signBatchJSON:Tt,signBatchXML:Ct,selectCertificate:ht,saveDataToFile:we,signAndSaveToFile:yt,getFileNameContentBase64:D,getMultiFileNameContentBase64:_,getBase64FromText:C,getTextFromBase64:A,setStickySignatory:kt,setLocale:Et,getErrorMessage:c,getErrorType:m,getCurrentLog:v}},Mt=function(x,k,g){var R=2e3,$=3,L=oe.isAndroid()||oe.isIOS()?4e3:3e3,te=oe.isAndroid()||oe.isIOS()?15:10,ke=!0,pe="batch",Ae="certificate",me="sign",le=me,Y,ae="",re="",H=null,G=null,O=null;if(x!=g&&x!=null)if(x.indexOf("://")!=-1&&x.indexOf("/",x.indexOf("://")+3)!=-1){var q=x.substring(0,x.indexOf("/",x.indexOf("://")+3));G=q+"/afirma-signature-retriever/RetrieveService",O=q+"/afirma-signature-storage/StorageService"}else G=x+"/afirma-signature-retriever/RetrieveService",O=x+"/afirma-signature-storage/StorageService";function j(l){H=l}function M(l,h,p){le=Ae;var C=ve.generateNewIdSession(),A=ne(),D="selectcert";J&&!a&&Y&&(l=he(Y,l));var _=0,v=new Array;v[_++]={key:"ver",value:$},v[_++]={key:"op",value:D},C!=null&&C!=g&&(v[_++]={key:"id",value:C}),A!=null&&A!=g&&(v[_++]={key:"key",value:A}),H!=null&&H!=g&&(v[_++]={key:"keystore",value:H},v[_++]={key:"ksb64",value:I.encode(H)}),O!=null&&O!=g&&(v[_++]={key:"stservlet",value:O}),l!=null&&l!=g&&(v[_++]={key:"properties",value:I.encode(l)}),!oe.isAndroid()&&!oe.isIOS()&&(v[_++]={key:"aw",value:"true"});var P=je(D,v);if(Ue(P)){if(O==null||O==g){xe("java.lang.IllegalArgumentException","No se ha indicado la direccion del servlet para el guardado de datos");return}else if(G==null||G==g){xe("java.lang.IllegalArgumentException","No se ha indicado la direccion del servlet para la recuperacion de datos");return}Be(C,A,O,G,D,v,h,p)}else Ve(P,C,A,h,p)}function _e(l,h,p,C,A,D){et("sign",l,h,p,C,A,D)}function Qe(l,h,p,C,A,D){et("cosign",l,h,p,C,A,D)}function Ze(l,h,p,C,A,D){et("countersign",l,h,p,C,A,D)}function et(l,h,p,C,A,D,_){le=me,(h==g||h=="")&&(h=null),h!=null&&!lt(h)&&(h=h.replace(/\+/g,"-").replace(/\//g,"_"),h=h.replace(/\n/g,"").replace(/\r/g,"")),J&&!a&&Y&&(A=he(Y,A));var v=ve.generateNewIdSession(),P=ne(),T=0,S=new Array;S[T++]={key:"ver",value:$},l!=null&&l!=g&&(S[T++]={key:"op",value:l}),v!=null&&v!=g&&(S[T++]={key:"id",value:v}),P!=null&&P!=g&&(S[T++]={key:"key",value:P}),H!=null&&H!=g&&(S[T++]={key:"keystore",value:H},S[T++]={key:"ksb64",value:I.encode(H)}),O!=null&&O!=g&&(S[T++]={key:"stservlet",value:O}),C!=null&&C!=g&&(S[T++]={key:"format",value:C}),p!=null&&p!=g&&(S[T++]={key:"algorithm",value:p}),A!=null&&A!=g&&(S[T++]={key:"properties",value:I.encode(A)}),!oe.isAndroid()&&!oe.isIOS()&&(S[T++]={key:"aw",value:"true"}),h!=null&&(S[T++]={key:"dat",value:h});var c=je(l,S);if(Ue(c)){if(O==null||O==g){xe("java.lang.IllegalArgumentException","No se ha indicado la direccion del servlet para el guardado de datos");return}Be(v,P,O,G,l,S,D,_)}else Ve(c,v,P,D,_)}function mt(l,h,p,C,A,D,_,v){le=me,(h==g||h=="")&&(h=null),h!=null&&!lt(h)&&(h=h.replace(/\+/g,"-").replace(/\//g,"_"),h=h.replace(/\n/g,"").replace(/\r/g,"")),J&&!a&&Y&&(A=he(Y,A));var P=ve.generateNewIdSession(),T=ne(),S=0,c="signandsave",m=new Array;m[S++]={key:"ver",value:$},m[S++]={key:"op",value:c},l!=null&&l!=g&&(m[S++]={key:"cop",value:l}),P!=null&&P!=g&&(m[S++]={key:"id",value:P}),T!=null&&T!=g&&(m[S++]={key:"key",value:T}),H!=null&&H!=g&&(m[S++]={key:"keystore",value:H},m[S++]={key:"ksb64",value:I.encode(H)}),O!=null&&O!=g&&(m[S++]={key:"stservlet",value:O}),C!=null&&C!=g&&(m[S++]={key:"format",value:C}),p!=null&&p!=g&&(m[S++]={key:"algorithm",value:p}),A!=null&&A!=g&&(m[S++]={key:"properties",value:I.encode(A)}),D!=null&&D!=g&&(m[S++]={key:"filename",value:D}),!oe.isAndroid()&&!oe.isIOS()&&(m[S++]={key:"aw",value:"true"}),h!=null&&(m[S++]={key:"dat",value:h});var o=je(c,m);if(Ue(o)){if(O==null||O==g){xe("java.lang.IllegalArgumentException","No se ha indicado la direccion del servlet para el guardado de datos");return}Be(P,T,O,G,c,m,_,v)}else Ve(o,P,T,_,v)}function ht(l,h,p,C,A,D){le=pe,(l==g||l=="")&&(l=null),l!=null&&!lt(l)&&(l=l.replace(/\+/g,"-").replace(/\//g,"_"),l=l.replace(/\n/g,"").replace(/\r/g,"")),J&&!a&&Y&&(C=he(Y,C));var _=ve.generateNewIdSession(),v=ne(),P="batch",T=0,S=new Array;S[T++]={key:"ver",value:$},S[T++]={key:"op",value:P},_!=null&&_!=g&&(S[T++]={key:"id",value:_}),v!=null&&v!=g&&(S[T++]={key:"key",value:v}),H!=null&&H!=g&&(S[T++]={key:"keystore",value:H},S[T++]={key:"ksb64",value:I.encode(H)}),O!=null&&O!=g&&(S[T++]={key:"stservlet",value:O}),h!=null&&h!=g&&(S[T++]={key:"batchpresignerurl",value:h}),p!=null&&p!=g&&(S[T++]={key:"batchpostsignerurl",value:p}),C!=null&&C!=g&&(S[T++]={key:"properties",value:I.encode(C)}),!oe.isAndroid()&&!oe.isIOS()&&(S[T++]={key:"aw",value:"true"}),S[T++]={key:"needcert",value:"true"},l!=null&&(S[T++]={key:"dat",value:l});var c=je(P,S);if(Ue(c)){if(O==null||O==g){xe("java.lang.IllegalArgumentException","No se ha indicado la direccion del servlet para el guardado de datos");return}Be(_,v,O,G,P,S,A,D)}else Ve(c,_,v,A,D)}function gt(l,h,p,C,A,D){le=pe,J&&!a&&Y&&(C=he(Y,C));var _=ve.generateNewIdSession(),v=ne(),P="batch",T=0,S=new Array;S[T++]={key:"ver",value:$},S[T++]={key:"op",value:P},_!=null&&_!=g&&(S[T++]={key:"id",value:_}),v!=null&&v!=g&&(S[T++]={key:"key",value:v}),H!=null&&H!=g&&(S[T++]={key:"keystore",value:H},S[T++]={key:"ksb64",value:I.encode(H)}),O!=null&&O!=g&&(S[T++]={key:"stservlet",value:O}),h!=null&&h!=g&&(S[T++]={key:"batchpresignerurl",value:h}),p!=null&&p!=g&&(S[T++]={key:"batchpostsignerurl",value:p}),C!=null&&C!=g&&(S[T++]={key:"properties",value:I.encode(C)}),!oe.isAndroid()&&!oe.isIOS()&&(S[T++]={key:"aw",value:!0}),wt&&(S[T++]={key:"localBatchProcess",value:!0}),S[T++]={key:"needcert",value:!0},S[T++]={key:"jsonbatch",value:!0},S[T++]={key:"dat",value:l};var c=je(P,S);if(Ue(c)){if(O==null||O==g){xe("java.lang.IllegalArgumentException","No se ha indicado la direccion del servlet para el guardado de datos");return}Be(_,v,O,G,P,S,A,D)}else Ve(c,_,v,A,D)}function vt(l,h,p,C,A,D,_){l!=g&&l!=null&&l!=""&&(l=l.replace(/\+/g,"-").replace(/\//g,"_"));var v=ve.generateNewIdSession(),P=ne(),T=0,S="save",c=new Array;c[T++]={key:"ver",value:$},c[T++]={key:"op",value:S},v!=null&&v!=g&&(c[T++]={key:"id",value:v}),P!=null&&P!=g&&(c[T++]={key:"key",value:P}),O!=null&&O!=g&&(c[T++]={key:"stservlet",value:O}),h!=null&&h!=g&&(c[T++]={key:"title",value:h}),p!=null&&p!=g&&(c[T++]={key:"filename",value:p}),C!=null&&C!=g&&(c[T++]={key:"extension",value:C}),A!=null&&A!=g&&(c[T++]={key:"description",value:A}),!oe.isAndroid()&&!oe.isIOS()&&(c[T++]={key:"aw",value:"true"}),l!=null&&l!=g&&l!=""&&(c[T++]={key:"dat",value:l});var m=je(S,c);if(Ue(m)){if(O==null||O==g){xe("java.lang.IllegalArgumentException","No se ha indicado la direccion del servlet para el guardado de datos");return}Be(v,P,O,G,S,c,D,_)}else Ve(m,v,P,D,_)}function xt(l,h,p,C,A,D){var _="java.lang.UnsupportedOperationException",v="La operacion de carga de fichero no esta disponible por servidor intermedio";D?D(_,v):xe(_,v)}function tt(l,h,p,C,A,D){var _="java.lang.UnsupportedOperationException",v="La operacion de carga de multiples ficheros no esta disponible por servidor intermedio";D?D(_,v):xe(_,v)}function ot(){return"Cliente JavaScript"}function yt(){return ae}function bt(){return re}function Ct(l,h){var p="java.lang.UnsupportedOperationException",C="La operacion de obtencion del log no esta disponible por servidor intermedio";h?h(p,C):xe(p,C)}function Tt(l,h){O=l,G=h}function xe(l,h){throw re=l,ae=h,new Error}function Ue(l){return l.length>R}function ne(){var l;if(typeof k.crypto<"u"&&typeof k.crypto.getRandomValues<"u"){var h=new Uint32Array(1);k.crypto.getRandomValues(h),l=Se(h[0]%1e8,8)}else l=Se(Math.floor((ve.getRandom()+1)%1e8),8);return l}function Se(l,h){return h-=l.toString().length,h>0?new Array(h+(/\./.test(l)?2:1)).join("0")+l:l+""}function Be(l,h,p,C,A,D,_,v){var P=ve.generateNewIdSession(),T=Ge();T||xe("java.lang.Exception","Su navegador no permite preprocesar los datos que desea tratar"),T.open("POST",p,!0),T.setRequestHeader("Content-type","application/x-www-form-urlencoded"),T.onreadystatechange=function(){if(T.readyState==4)if(T.status==200){if(url=at(A,P,C,h),Ue(url)){v("java.lang.IllegalArgumentException","La URL de invocacion al servicio de firma es demasiado larga.");return}Ve(url,l,h,_,v)}else console.log("Error al enviar los datos al servidor intermedio. HTTP Status: "+T.status),v("java.lang.IOException","Ocurrio un error al enviar los datos a la aplicacion nativa")};try{T.onerror=function(c){console.log("Error al enviar los datos al servidor intermedio (HTTP Status: "+T.status+"): "+c.message),v("java.lang.IOException","Ocurrio un error al enviar los datos al servicio intermedio para la comunicacion con la aplicacion nativa")}}catch{}Oe&&(D[D.length]={key:"mcv",value:Oe});var S="op=put&v=1_0&id="+P+"&dat="+We(rt(A,D),h);try{T.send(S)}catch{v("java.lang.IOException","No se pudo conectar con el servidor remoto")}}function Ve(l,h,p,C,A){ke=!1,Rt(l),h&&(C||A)&&At(h,G,p,l,C,A)}function je(l,h){var p="jvc="+b;if(Oe&&(p+="&mcv="+encodeURIComponent(Oe)),h!=null&&h!=g)for(var C=0;C<h.length;C++)h[C].value!=null&&h[C].value!="null"&&(p+="&"+h[C].key+"="+encodeURIComponent(h[C].value));var A;return oe.isChrome()&&oe.isAndroid()?A="intent://"+l+"?"+p+"#Intent;scheme=afirma;package=es.gob.afirma;end":A="afirma://"+l+"?"+p,A}function rt(l,h){l=l??"op";var p="<"+l+">";if(h!=null)for(var C=0;C<h.length;C++)p+='<e k="'+h[C].key+'" v="'+h[C].value+'"/>';return I.encode(p+"</"+l+">")}function at(l,h,p,C){var A=0,D=new Array;return D[A++]={key:"fileid",value:h},(p!=null||p!=g)&&(D[A++]={key:"rtservlet",value:p}),(C!=null||C!=g)&&(D[A++]={key:"key",value:C}),je(l,D)}function nt(l,h,p,C){if(l.substr(0,6).toLowerCase()=="err-06")return!0;if(l.substr(0,5).toLowerCase()=="#wait")return"reset";if(l.substr(0,4).toLowerCase()=="err-"&&l.indexOf(":=")!=-1)return ae=l.substring(l.indexOf(":=")+2),l.substr(0,7).toLowerCase()=="err-11:"?re="es.gob.afirma.core.AOCancelledOperationException":re="java.lang.Exception",C(re,ae),!1;if(l=="CANCEL"||l==`CANCEL\r
`)return C("es.gob.afirma.core.AOCancelledOperationException","Operacion cancelada por el usuario"),!1;if(l=="OK"||l==`OK\r
`)return p(),!1;if(l.length>4&&l.substr(0,4)=="SAF_")return C("java.lang.Exception",l),!1;if(le==pe){var A,_=null,P=l.indexOf("|");P==-1?h!=g&&h!=null?A=ce(l,h):A=we(l):(h!=g&&h!=null?(A=ce(l.substring(0,P),h,!0),_=ce(l.substring(P+1),h)):(A=we(l.substring(0,P)),_=we(l.substring(P+1))),J?_&&(Y=_):Y=null);try{A=ve.parseJSONData(A)}catch{}return p(A,_),!1}else if(le==Ae){var _;return h!=g&&h!=null?_=ce(l,h):_=we(l),Y=J?_:null,p(_),!1}var D,_=null,v=null,P=l.indexOf("|");if(P==-1)h!=g&&h!=null?D=ce(l,h):D=we(l);else{var T=l.indexOf("|",P+1);T==-1?h!=g&&h!=null?(_=ce(l.substring(0,P),h,!0),D=ce(l.substring(P+1),h)):(_=we(l.substring(0,P)),D=we(l.substring(P+1))):h!=g&&h!=null?(_=ce(l.substring(0,P),h,!0),D=ce(l.substring(P+1,T),h,!0),v=I.decode(ce(l.substring(T+1),h))):(_=we(l.substring(0,P)),D=we(l.substring(P+1)),v=I.decode(we(l.substring(T+1))))}return J?_&&(Y=_):Y=null,p(D,_,v),!1}function ye(l,h,p){re=l!=null&&l.length>0?l:"java.lang.Exception",ae=h!=null&&h.length>0?h:"No se ha podido extablecer la comunicación entre la aplicación de firma y la página web",p!=g&&p!=null&&p(re,ae)}function he(l,h){for(var p=ct(h,`
`),C=[],A=0;A<p.length;A++)p[A]&&!st(p[A])&&C.push(p[A]);C.push("filters=encodedcert:"+l),C.push("headless=true");var D="";if(C.length>0){D=C[0];for(var A=1;A<C.length;A++)D+=`
`+C[A]}return D}function st(l){return l.indexOf("filters=")==0||l.indexOf("filter=")==0||l.indexOf("filters.")==0||l.indexOf("headless=")==0}function ct(l,h){var p=[];if(l){for(var C=0,A;(A=l.indexOf(h,C))!=-1;)p.push(l.substring(C,A)),C=A+1;p.push(l.substring(C))}return p}var Ie=0;function At(l,h,p,C,A,D){var _=Ge();_||xe("java.lang.Exception","Su navegador no permite obtener el resulado de la operación"),Ie=0,setTimeout(qe,L,_,h,"op=get&v=1_0&id="+l+"&it=0",p,C,l,A,D)}function qe(l,h,p,C,A,D,_,v){if(ke){ye("es.gob.afirma.standalone.ApplicationNotFoundException","AutoFirma no se encuentra instalado en el sistema.",v);return}if(Ie>te){ye("java.util.concurrent.TimeoutException","El tiempo para la recepcion de la firma por la pagina web ha expirado",v);return}Ie++,l.onreadystatechange=function(){if(l.readyState==4)if(l.status==200){var P=nt(l.responseText,C,_,v);if(P){var T=Ie-1;P=="reset"&&(Ie=0),setTimeout(qe,L,l,h,p.replace("&it="+T,"&it="+Ie),C,A,D,_,v)}}else ye("java.lang.Exception","No se pudo conectar con el servidor intermedio para la recuperacion del resultado de la operacion (Status: "+l.status+")",v)};try{l.onerror=function(){ye("java.lang.Exception","No se pudo conectar con el servidor intermedio para la recuperacion del resultado de la operacion (Status: "+l.status+")",v)}}catch{}l.open("POST",h,!0),l.setRequestHeader("Content-type","application/x-www-form-urlencoded");try{l.send(p)}catch{ye("java.lang.IOException","Ocurrio un error de red en la llamada al servicio de firma",v);return}}function ce(l,h,p){var C=l.indexOf("."),A=l.substr(0,C),D=Je.des(h,Je.base64ToString(we(l.substr(C+1))),0,0,null);return Je.stringToBase64(D.substr(0,D.length-parseInt(A)-(p?0:8)))}function We(l,h){var p=Je.base64ToString(we(l)),C=(8-p.length%8)%8;return C+"."+Je.stringToBase64(Je.des(h,p,1,0,null)).replace(/\+/g,"-").replace(/\//g,"_")}function we(l){return l&&l.replace(/\-/g,"+").replace(/\_/g,"/")}return{echo:ot,setKeyStore:j,sign:_e,coSign:Qe,counterSign:Ze,signBatchJSON:gt,signBatchXML:ht,selectCertificate:M,saveDataToFile:vt,signAndSaveToFile:mt,getFileNameContentBase64:xt,getMultiFileNameContentBase64:tt,setServlets:Tt,setStickySignatory:kt,setLocale:Et,getErrorMessage:yt,getErrorType:bt,getCurrentLog:Ct}};return{VERSION:s,CHECKTIME_NO:Ne,CHECKTIME_RECOMMENDED:dt,CHECKTIME_OBLIGATORY:ft,JAVA_ARGUMENTS:F,SYSTEM_PROPERTIES:Z,setForceAFirma:Ht,cargarMiniApplet:Nt,echo:co,setJnlpService:Kt,isJNLP:qt,needNativeAppInstalled:jt,KEYSTORE_WINDOWS:Pe,KEYSTORE_APPLE:Le,KEYSTORE_PKCS12:V,KEYSTORE_PKCS11:$e,KEYSTORE_MOZILLA:ge,KEYSTORE_SHARED_NSS:K,KEYSTORE_JAVA:w,KEYSTORE_JCEKS:Ke,KEYSTORE_JAVACE:z,KEYSTORE_DNIE:X,AUTOFIRMA_LAUNCHING_TIME:St,AUTOFIRMA_CONNECTION_RETRIES:pt,cargarAppAfirma:Nt,sign:Gt,coSign:Xt,cosign:Wt,counterSign:zt,createBatch:eo,addDocumentToBatch:to,setLocalBatchProcess:oo,signBatchProcess:ro,signBatch:Zt,selectCertificate:Yt,signAndSaveToFile:Qt,getCurrentLog:uo,saveDataToFile:so,getFileNameContentBase64:io,getMultiFileNameContentBase64:lo,checkTime:Dt,setKeyStore:Jt,setForceWSMode:Ut,setServlets:mo,setPortRange:ho,setStickySignatory:kt,setLocale:Et,setMinimumClientVersion:Vt,getErrorMessage:fo,getErrorType:po,getBase64FromText:ao,getTextFromBase64:no,downloadRemoteData:$t,isAndroid:oe.isAndroid,isIOS:oe.isIOS}}(window,void 0),I={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_keyStr_URL_SAFE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",encode:function(r,e){var s=e==!0?this._keyStr_URL_SAFE:this._keyStr,b="",F,Z,E,W,Q,ue,J,a=0;for(r=I._utf8_encode(r);a<r.length;)F=r.charCodeAt(a++),Z=r.charCodeAt(a++),E=r.charCodeAt(a++),W=F>>2,Q=(F&3)<<4|Z>>4,ue=(Z&15)<<2|E>>6,J=E&63,isNaN(Z)?ue=J=64:isNaN(E)&&(J=64),b=b+s.charAt(W)+s.charAt(Q)+s.charAt(ue)+s.charAt(J);return b},encodeArrayBuffer:function(r,e){for(var s=new Uint8Array(r),b=s.length,F=new Array(b);b--;)F[b]=String.fromCharCode(s[b]);return e?window.btoa(F.join("")).replace("+","-").replace("/","_"):window.btoa(F.join(""))},encodeByteArray:function(r,e){for(var s=e==!0?this._keyStr_URL_SAFE:this._keyStr,b=[],F=0;F<r.length;F+=3){var Z=r[F],E=F+1<r.length,W=E?r[F+1]:0,Q=F+2<r.length,ue=Q?r[F+2]:0,J=Z>>2,a=(Z&3)<<4|W>>4,de=(W&15)<<2|ue>>6,Ye=ue&63;Q||(Ye=64,E||(de=64)),b.push(s.charAt(J),s.charAt(a),s.charAt(de),s.charAt(Ye))}return b.join("")},decode:function(r,e){var s=e==!0?this._keyStr_URL_SAFE:this._keyStr,b="",F,Z,E,W,Q,ue,J,a=0;for(r=e==!0?r.replace(/[^A-Za-z0-9\-\_\=]/g,""):r.replace(/[^A-Za-z0-9\+\/\=]/g,"");a<r.length;)W=s.indexOf(r.charAt(a++)),Q=s.indexOf(r.charAt(a++)),ue=s.indexOf(r.charAt(a++)),J=s.indexOf(r.charAt(a++)),F=W<<2|Q>>4,Z=(Q&15)<<4|ue>>2,E=(ue&3)<<6|J,b=b+String.fromCharCode(F),ue!=64&&(b=b+String.fromCharCode(Z)),J!=64&&(b=b+String.fromCharCode(E));return b=I._utf8_decode(b),b},_utf8_encode:function(r){r=r.replace(/\r\n/g,`
`);for(var e="",s=0;s<r.length;s++){var b=r.charCodeAt(s);b<128?e+=String.fromCharCode(b):b>127&&b<2048?(e+=String.fromCharCode(b>>6|192),e+=String.fromCharCode(b&63|128)):(e+=String.fromCharCode(b>>12|224),e+=String.fromCharCode(b>>6&63|128),e+=String.fromCharCode(b&63|128))}return e},_utf8_decode:function(r){for(var e="",s=0,b=0,F=0;s<r.length;)if(b=r.charCodeAt(s),b<128)e+=String.fromCharCode(b),s++;else if(b>191&&b<224)F=r.charCodeAt(s+1),e+=String.fromCharCode((b&31)<<6|F&63),s+=2;else{F=r.charCodeAt(s+1);var Z=r.charCodeAt(s+2);e+=String.fromCharCode((b&15)<<12|(F&63)<<6|Z&63),s+=3}return e}},Je={tableStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",tableStr_URL_SAFE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",des:function(r,e,s,b,F,Z){var E=new Array(16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756),W=new Array(-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344),Q=new Array(520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584),ue=new Array(8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928),J=new Array(256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080),a=new Array(536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312),de=new Array(2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154),Ye=new Array(268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696),Re=Je.des_createKeys(r),fe=0,Pe,Le,V,$e,ge,K,w,Ke,z,X,Ne,dt,ft,St,pt=e.length,it=0,Me=Re.length==32?3:9;Me==3?Ke=s?new Array(0,32,2):new Array(30,-2,-2):Ke=s?new Array(0,32,2,62,30,-2,64,96,2):new Array(94,62,-2,32,64,2,30,-2,-2),Z==2?e+="        ":Z==1?(V=8-pt%8,e+=String.fromCharCode(V,V,V,V,V,V,V,V),V==8&&(pt+=8)):Z||(e+="\0\0\0\0\0\0\0\0");var ze="",Oe="";for(b==1&&(z=F.charCodeAt(fe++)<<24|F.charCodeAt(fe++)<<16|F.charCodeAt(fe++)<<8|F.charCodeAt(fe++),Ne=F.charCodeAt(fe++)<<24|F.charCodeAt(fe++)<<16|F.charCodeAt(fe++)<<8|F.charCodeAt(fe++),fe=0);fe<pt;){for(K=e.charCodeAt(fe++)<<24|e.charCodeAt(fe++)<<16|e.charCodeAt(fe++)<<8|e.charCodeAt(fe++),w=e.charCodeAt(fe++)<<24|e.charCodeAt(fe++)<<16|e.charCodeAt(fe++)<<8|e.charCodeAt(fe++),b==1&&(s?(K^=z,w^=Ne):(X=z,dt=Ne,z=K,Ne=w)),V=(K>>>4^w)&252645135,w^=V,K^=V<<4,V=(K>>>16^w)&65535,w^=V,K^=V<<16,V=(w>>>2^K)&858993459,K^=V,w^=V<<2,V=(w>>>8^K)&16711935,K^=V,w^=V<<8,V=(K>>>1^w)&1431655765,w^=V,K^=V<<1,K=K<<1|K>>>31,w=w<<1|w>>>31,Le=0;Le<Me;Le+=3){for(ft=Ke[Le+1],St=Ke[Le+2],Pe=Ke[Le];Pe!=ft;Pe+=St)$e=w^Re[Pe],ge=(w>>>4|w<<28)^Re[Pe+1],V=K,K=w,w=V^(W[$e>>>24&63]|ue[$e>>>16&63]|a[$e>>>8&63]|Ye[$e&63]|E[ge>>>24&63]|Q[ge>>>16&63]|J[ge>>>8&63]|de[ge&63]);V=K,K=w,w=V}K=K>>>1|K<<31,w=w>>>1|w<<31,V=(K>>>1^w)&1431655765,w^=V,K^=V<<1,V=(w>>>8^K)&16711935,K^=V,w^=V<<8,V=(w>>>2^K)&858993459,K^=V,w^=V<<2,V=(K>>>16^w)&65535,w^=V,K^=V<<16,V=(K>>>4^w)&252645135,w^=V,K^=V<<4,b==1&&(s?(z=K,Ne=w):(K^=X,w^=dt)),Oe+=String.fromCharCode(K>>>24,K>>>16&255,K>>>8&255,K&255,w>>>24,w>>>16&255,w>>>8&255,w&255),it+=8,it==512&&(ze+=Oe,Oe="",it=0)}return ze+Oe},des_createKeys:function(r){for(var e=new Array(0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964),s=new Array(0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697),b=new Array(0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272),F=new Array(0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144),Z=new Array(0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256),E=new Array(0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488),W=new Array(0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746),Q=new Array(0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568),ue=new Array(0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578),J=new Array(0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488),a=new Array(0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800),de=new Array(0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744),Ye=new Array(0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128),Re=new Array(0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261),fe=r.length>8?3:1,Pe=new Array(32*fe),Le=new Array(0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0),V,$e,ge=0,K=0,w,Ke=0;Ke<fe;Ke++){var z=r.charCodeAt(ge++)<<24|r.charCodeAt(ge++)<<16|r.charCodeAt(ge++)<<8|r.charCodeAt(ge++),X=r.charCodeAt(ge++)<<24|r.charCodeAt(ge++)<<16|r.charCodeAt(ge++)<<8|r.charCodeAt(ge++);w=(z>>>4^X)&252645135,X^=w,z^=w<<4,w=(X>>>-16^z)&65535,z^=w,X^=w<<-16,w=(z>>>2^X)&858993459,X^=w,z^=w<<2,w=(X>>>-16^z)&65535,z^=w,X^=w<<-16,w=(z>>>1^X)&1431655765,X^=w,z^=w<<1,w=(X>>>8^z)&16711935,z^=w,X^=w<<8,w=(z>>>1^X)&1431655765,X^=w,z^=w<<1,w=z<<8|X>>>20&240,z=X<<24|X<<8&16711680|X>>>8&65280|X>>>24&240,X=w;for(var Ne=0;Ne<Le.length;Ne++)Le[Ne]?(z=z<<2|z>>>26,X=X<<2|X>>>26):(z=z<<1|z>>>27,X=X<<1|X>>>27),z&=-15,X&=-15,V=e[z>>>28]|s[z>>>24&15]|b[z>>>20&15]|F[z>>>16&15]|Z[z>>>12&15]|E[z>>>8&15]|W[z>>>4&15],$e=Q[X>>>28]|ue[X>>>24&15]|J[X>>>20&15]|a[X>>>16&15]|de[X>>>12&15]|Ye[X>>>8&15]|Re[X>>>4&15],w=($e>>>16^V)&65535,Pe[K++]=V^w,Pe[K++]=$e^w<<16}return Pe},stringToBase64:function(r){for(var e="",s=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"),b=0;b<r.length;b++)e+=s[r.charCodeAt(b)>>4]+s[r.charCodeAt(b)&15];var F,Z=e.replace(/\r|\n/g,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ");e="";try{F=String.fromCharCode.apply(null,Z)}catch{for(var F="",b=0,E=Z.length;b<E;b++)F+=String.fromCharCode(Z[b])}return Je.btoa(F,null)},base64ToString:function(r){for(var e=new Array("A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"),s=new Object,b=0;b<e.length;b++)s[e[b]]=b;s["="]=0;var F="",Z,E,W,Q,ue=r.length;r+="====";for(var b=0;b<ue;b+=4)Z=r.charAt(b),E=r.charAt(b+1),W=r.charAt(b+2),Q=r.charAt(b+3),F+=String.fromCharCode(s[Z]<<2&255|s[E]>>4),W!="="&&(F+=String.fromCharCode(s[E]<<4&255|s[W]>>2)),Q!="="&&(F+=String.fromCharCode(s[W]<<6&255|s[Q]));return F},btoa:function(r,e){for(var s=(e==!0?Je.tableStr_URL_SAFE:Je.tableStr).split(""),b=0,F=0,Z=r.length/3,E=[];b<Z;++b){var W=r.charCodeAt(F++),Q=r.charCodeAt(F++),ue=r.charCodeAt(F++);if((W|Q|ue)>255)throw new Error("String contains an invalid character");E[E.length]=s[W>>2]+s[W<<4&63|Q>>4]+(isNaN(Q)?"=":s[Q<<2&63|ue>>6])+(isNaN(Q+ue)?"=":s[ue&63])}return E.join("")}};const Fo={class:"no-imprimir"},Po={class:"font-semibold text-xl text-gray-800 dark:text-gray-200 leading-tight"},Lo={class:"py-12"},$o={class:"max-w-10xl mx-auto sm:px-6 lg:px-24"},Uo={class:"bg-white dark:bg-gray-800 overflow-hidden shadow-xl sm:rounded-lg"},Vo={class:"card"},jo={class:"relative inline-block flex mb-5"},qo={class:"font-bold text-lg"},Ho=t("i",{class:"pi pi-plus mr-2"},null,-1),Ko={class:"md:flex justify-between items-center"},Bo={class:"flex flex-col md:flex-row justify-start items-center"},Jo={class:"flex flex-wrap justify-start items-center"},Yo={class:"relative inline-block w-50"},Go={class:"flex items-center ml-2"},Xo={for:"link-checkbox",class:"ms-2 mr-2 text-sm font-medium text-gray-900 dark:text-gray-300"},Wo={class:"flex items-center"},zo={id:"app",class:"relative inline-block w-50 ml-2"},Qo={class:"flex"},Zo=["disabled"],er=t("i",{class:"pi pi-plus mr-2"},null,-1),tr=["disabled"],or=t("i",{class:"pi pi-upload mr-2"},null,-1),rr={class:"absolute right-0 w-48 bg-white border border-gray-300 rounded shadow-lg"},ar=t("i",{class:"pi pi-file-pdf mr-2"},null,-1),nr=t("i",{class:"pi pi-file-export mr-2"},null,-1),sr={class:"split-button-container ml-2"},ir=t("hr",{class:"linea-grosor mt-5"},null,-1),lr={class:"selector flex flex-col md:flex-row justify-between mt-5 ml-12"},ur={class:"showCustomer"},cr={class:"grid md:grid-cols-1 text-m gap-y-1"},dr={class:"flex items-center justify-between w-full"},fr={class:"font-semibold mr-3 flex-shrink-0 w-32"},pr={class:"text-gray-700 w-full font-bold text-lg"},mr={class:"flex items-center justify-between w-full"},hr={class:"font-semibold mr-3 flex-shrink-0 w-32"},gr={class:"text-gray-700 w-full uppercase"},vr={class:"flex items-center justify-between w-full"},xr={class:"font-semibold mr-3 flex-shrink-0 w-32"},yr={class:"text-gray-700 w-full"},br={class:"flex items-center justify-between w-full"},Cr={class:"font-semibold mr-3 flex-shrink-0 w-32"},Tr={class:"text-gray-700 w-full"},Ar={class:"flex items-center justify-between w-full"},Sr={class:"font-semibold mr-3 flex-shrink-0 w-32"},wr={class:"text-gray-700 w-full"},kr={class:"grid md:grid-cols-1 text-sm gap-y-1 mr-28"},Er={class:"flex items-center justify-between w-full"},Or={class:"font-semibold mr-3 min-w-20 flex-shrink-0"},_r={class:"text-gray-700 ml-3 flex-shrink-0 font-bold text-lg"},Ir={class:"flex items-center justify-between w-full"},Rr={class:"font-semibold mr-3 flex-shrink-0"},Dr={class:"flex items-center justify-between w-full"},Nr={class:"font-semibold mr-3 flex-shrink-0"},Mr={class:"flex items-center justify-between"},Fr={class:"flex items-center"},Pr=t("div",{class:"flex-grow"},null,-1),Lr={class:"relative rounded-md shadow-sm"},$r=["placeholder"],Ur=t("div",{class:"absolute inset-y-0 right-0 flex items-center pr-3"},[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"})])],-1),Vr={key:0,class:"flex justify-end mt-4 pr-4"},jr={class:"hidden md:flex justify-between mt-4 pr-4 mb-4"},qr={class:"totals-container w-1/3"},Hr=t("i",{class:"pi pi-plus"},null,-1),Kr={class:"ml-4 totals p-4 rounded-md"},Br={class:"w-full"},Jr={class:"text-gray-600 pr-4"},Yr={class:"pl-4"},Gr=t("tr",null,[t("td",{colspan:"2"},[t("hr",{class:"my-2 border-gray-300"})])],-1),Xr={class:"text-gray-600 pr-4"},Wr={key:0},zr={key:1},Qr={key:2},Zr={key:3},e0={class:"pl-4"},t0={key:0},o0={key:1},r0={key:2},a0={key:3},n0=t("div",{class:"w-1/12"},null,-1),s0={class:"totals-container w-1/3"},i0={class:"totals p-4 rounded-md"},l0={class:"w-full"},u0={class:"text-gray-600 pr-4"},c0={class:"pl-4"},d0=t("hr",{class:"my-2 border-gray-300"},null,-1),f0={class:"text-gray-600 pr-4"},p0={class:"pl-4"},m0=t("hr",{class:"my-2 border-gray-300"},null,-1),h0={class:"text-gray-600 pr-4"},g0={class:"pl-4"},v0={class:"flex flex-wrap justify-between mt-4 pr-4 mb-4 md:hidden"},x0={class:"totals-container w-full md:w-1/3 flex flex-col mb-4 md:mb-0"},y0=t("i",{class:"pi pi-plus"},null,-1),b0={class:"ml-4 totals p-4 rounded-md flex-grow"},C0={class:"w-full"},T0={class:"text-gray-600 pr-4"},A0={class:"pl-4"},S0=t("tr",null,[t("td",{colspan:"2"},[t("hr",{class:"my-2 border-gray-300"})])],-1),w0={class:"text-gray-600 pr-4"},k0={class:"pl-4"},E0=t("div",{class:"hidden md:block w-1/12"},null,-1),O0={class:"totals-container w-full md:w-1/3 flex flex-col"},_0={class:"ml-4 totals bg-gray-100 p-4 rounded-md flex-grow"},I0={class:"w-full"},R0={class:"text-gray-600 pr-4"},D0={class:"pl-4"},N0={class:"text-gray-600 pr-4"},M0={class:"pl-4"},F0={class:"text-gray-600 pr-4"},P0={class:"pl-4"},L0={for:"name",class:"block text-sm font-medium text-gray-900 dark:text-white"},$0={key:0,class:"flex align-items-center"},U0={class:"flex align-items-center"},V0={for:"name",class:"block text-sm font-medium text-gray-900 dark:text-white"},j0={key:0,class:"flex align-items-center"},q0={class:"flex align-items-center"},H0={for:"name",class:"block text-sm font-medium text-gray-900 dark:text-white"},K0={key:0,class:"flex align-items-center"},B0={class:"flex align-items-center"},J0={class:"confirmation-content"},Y0=t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),G0={key:0},X0={class:"confirmation-content"},W0=t("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),z0={key:0},Q0={key:0,class:"flex align-items-center"},Z0={class:"flex align-items-center"},ea={class:"grid gap-3 md:grid-cols-1 justify-items"},ta={class:"flex justify-between"},oa=t("i",{class:"pi pi-plus"},null,-1),ra={for:"name",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},aa={key:0,class:"flex items-center"},na={class:"flex items-center"},sa={key:0,for:"name",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},ia={key:0,class:"flex items-center"},la={class:"flex items-center"},ua={class:"flex justify-end"},ca={class:"grid gap-3 mb-6 md:grid-cols-2"},da={for:"name",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},fa=["placeholder","required"],pa={for:"tax_number",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},ma=["placeholder","required"],ha={class:"mb-6"},ga={for:"address",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},va=["placeholder","required"],xa={class:"grid gap-3 mb-6 md:grid-cols-2"},ya={for:"town",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},ba=["placeholder","required"],Ca={for:"province",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},Ta=["placeholder","required"],Aa={for:"post_code",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},Sa=["placeholder","required"],wa={for:"country",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},ka=["placeholder","required"],Ea={for:"email",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},Oa=["placeholder","required"],_a={for:"phone",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},Ia=["placeholder","required"],Ra={class:"grid gap-3 md:grid-cols-1 justify-items-end"},Da={type:"submit",class:"text-white bg-blue-600 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"},Na={class:"imprimir"},Ma={class:"invoice"},Fa={class:"invoice-header"},Pa=t("div",{class:"logo"},[t("img",{src:"https://d1csarkz8obe9u.cloudfront.net/posterpreviews/company-logo-design-template-e089327a5c476ce5c70c74f7359c5898_screen.jpg?ts=1672291305",alt:"Logo de la empresa"})],-1),La={class:"invoice_details"},$a={class:"invoice-info"},Ua={class:"company-details"},Va={class:"name"},ja=t("br",null,null,-1),qa={class:"customer-details"},Ha={class:"name"},Ka=t("br",null,null,-1),Ba={class:"invoice-table"},Ja={class:"header"},Ya={class:"table-break"},Ga={class:"table-container"},Xa={class:"totals"},Wa={class:"title"},za={class:"title"},Qa={class:"bank"},Za={class:"text-gray-600 pr-4"},en={key:0},tn={key:1},on={key:2},rn={key:3},an={class:"pl-4"},nn={key:0},sn={key:1},ln={key:2},un={key:3},cn={data(){return{items:[{label:this.$t("Guardar y crear nueva"),icon:"pi pi-refresh",command:()=>this.saveAndReset()},{label:this.$t("Cancelar"),command:()=>this.cancelInvoice()}],taxMap:new Map,fecha:"",expiration:"",fechaFormateada:"",loading:!0,isSaving:!1,isMobileMenuOpen:!1,showTable:!1,isDropdownOpen:!1,isDropdownOpenExport:!1,saveRestart:!1,taxTypes:[],taxValues:[],taxOptions:[{label:"0",value:0},{label:"4",value:4},{label:"5",value:5},{label:"7",value:7},{label:"8",value:8},{label:"10",value:10},{label:"16",value:16},{label:"18",value:18},{label:"21",value:21}],paymentMethods:[{id:1},{id:2},{id:3},{id:4}],imageUrl:"https://placehold.co/300x300/e2e8f0/e2e8f0",companies:null,customers:null,types:[],series:[],serie:"",counter:"",showButton:!1,productDialog:!1,documentDialog:!1,customerDialog:!1,deleteProductDialog:!1,deleteProductsDialog:!1,selectACustomerDialog:!1,selectAPaymentMethodDialog:!1,selectedOption:[],options:[],selectedBankAccount:[],selectedEmail:[],selectedPhone:[],products:[],selectedCompany:[],selectedCustomer:[],selectedType:[],selectedSerie:[],emails:[],phones:[],selectedProducts:[],selectedPaymentMethod:[],filters:{},submitted:!1,myDocument:{document_counter:"",number:"",company_id_company:"",company_id_customer:"",documents_type_id:"",documents_series_id:"",bank_account_id:"",expiration:"",date:"",amount:"",payment_methods_id:"",totalTax:"",subTotal:"",paid:!1,invoiced:!1,concept:[]},customer:{id:"",name:"",tax_number:"",email:"",phone:"",address:"",post_code:"",town:"",province:"",country:""}}},computed:{dynamicOptionLabel(){switch(this.selectedPaymentMethod.id){case 1:return"complete_bank_account";case 3:return"phone";case 4:return"email";default:return""}},isDropdownHidden(){return this.dynamicOptionLabel===""},subtotal(){return this.products.reduce((r,e)=>r+e.subTotal,0)},totalIVA(){return this.products.reduce((r,e)=>r+e.priceTax,0)},totalConIVA(){return this.subtotal+this.totalIVA}},created(){this.filters={global:{value:null,matchMode:Oo.CONTAINS}};const r=new Date,e=r.getFullYear(),s=(r.getMonth()+1).toString().padStart(2,"0"),b=r.getDate().toString().padStart(2,"0");this.fecha=`${e}-${s}-${b}`,this.expiration=`${e}-${s}-${b}`},mounted(){this.fetchCompanies(),this.fetchDocuments(),this.fetchPayments()},watch:{selectedPaymentMethod(r){this.handlePaymentMethodChange(r)}},methods:{logWindowInfo(){},handlePaymentMethodChange(r){switch(r.id){case 1:this.fetchBanks();break;case 2:break;case 3:this.fetchPhones();break;case 4:this.fetchEmails();break}},fetchBanks(){axios.get("/banks/"+this.selectedCompany.id).then(r=>{this.banks=r.data.accounts,this.selectedBankAccount=this.banks[0],this.options=this.banks}).catch(r=>{this.$toast(this.$t("Error connecting to the server"),"error")})},fetchEmails(){axios.get("/emails/"+this.selectedCompany.id).then(r=>{this.emails=r.data.emails,this.selectedEmail=this.emails[0],this.options=this.emails}).catch(r=>{this.$toast(this.$t("Error connecting to the server"),"error")})},fetchPhones(){axios.get("/phones/"+this.selectedCompany.id).then(r=>{this.phones=r.data.phones,this.selectedPhone=this.phones[0],this.options=this.phones}).catch(r=>{this.$toast(this.$t("Error connecting to the server"),"error")})},fetchPayments(){axios.get("/payment").then(r=>{this.payment_methods=r.data.methods,this.selectedPaymentMethod=this.payment_methods[0]})},handleScroll(){window.scrollY>200?this.showButton=!0:this.showButton=!1},toggleDropdown(){this.isDropdownOpen=!this.isDropdownOpen},toggleDropdownExport(){this.isDropdownOpenExport=!this.isDropdownOpenExport},toggleMobileMenu(){this.isMobileMenuOpen=!this.isMobileMenuOpen},fetchCompanies(){axios.get("/companies-invoice").then(r=>(this.companies=r.data.companies,this.companies.length===1?(this.selectedCompany=this.companies[0],axios.get("/customers/"+this.selectedCompany.id)):(this.selectedCompany=this.companies[0],this.loading=!1,axios.get("/customers/"+this.selectedCompany.id)))).then(r=>{r&&(this.customers=r.data.customers,this.customers.length===1&&(this.selectedCustomer=this.customers[0])),this.loading=!1}).catch(r=>{console.error("Error fetching data:",r),this.loading=!1})},hideDialog(){this.selectACustomerDialog=!1,this.selectAPaymentMethodDialog=!1,this.customerDialog=!1,this.submitted=!1},openNew(){this.selectACustomerDialog=!1,this.customer={companyID:this.selectedCompany.id},this.submitted=!1,this.customerDialog=!0},selectACustomer(){this.selectACustomerDialog=!0},selectAPaymentMethod(){this.selectAPaymentMethodDialog=!0},saveCustomer(){axios.post("/customer",this.customer).then(r=>{this.customer.id=r.data.companyId,this.selectedCustomer=this.customer,this.customerDialog=!1}).catch(r=>{this.$toast(this.$t("Error connecting to the server"),"error"),this.customerDialog=!1})},handleCompanySelection(){this.selectedCustomer=[],axios.get("/customers/"+this.selectedCompany.id).then(r=>{this.customers=r.data.customers,this.customers.length===1&&(this.selectedCustomer=this.customers[0])}).catch(r=>{console.error("Error fetching phone data:",r)})},fetchDocuments(){axios.get("/documents-type").then(r=>(this.types=r.data.types,this.selectedType=this.types[0],axios.get("/documents-serie/"+this.selectedType.id+"/"+this.selectedCompany.id))).catch(r=>{console.error("Error fetching phone data:",r)}).then(r=>{r&&(this.series=r.data.series,this.selectedSerie=this.series[0])}).catch(r=>{console.error("Error fetching data:",r),this.loading=!1})},handleTypeSelection(){this.selectedSerie=[],axios.get("/documents-serie/"+this.selectedType.id+"/"+this.selectedCompany.id).then(r=>{this.series=r.data.series}).catch(r=>{console.error("Error fetching phone data:",r)})},selectCompany(){this.productDialog=!0},selectDocument(){this.documentDialog=!0},openFileInput(){this.$refs.fileInput.click()},handleFileChange(r){const e=r.target.files[0],s=new FileReader;s.onload=()=>{this.imageUrl=s.result},s.readAsDataURL(e)},addRow(){let r={reference:"5.01.02.003",description:"Collar",price:8,quantity:1,discount:15,discount_reason:"Descuento profesional",subtotal:0,taxes:21,priceTax:0,total:0,id:this.products.length+1};this.products.push(r)},saveAndReset(){this.saveRestart=!0,this.checkDocument()},checkDocument(){axios.get("/documents-serie/"+this.selectedType.id+"/"+this.selectedCompany.id+"/"+this.selectedSerie.serie).then(r=>{if(this.date=r.data.date.date,this.serie=r.data.serie.number,this.selectedSerie.number<=this.serie)switch(prompt(`El número de documento ya existe. ¿Qué deseas hacer?
1. Conservar el número ingresado: ${this.selectedSerie.serie}${this.selectedSerie.number} 
2. Asignar el siguiente valor disponible: ${this.selectedSerie.serie}${++this.serie}`)){case null:this.$toast(this.$t("Operation cancelled."),"error");break;case"1":this.$toast(this.$t("The number entered will be retained: ")+this.selectedSerie.serie+this.selectedSerie.number,"success"),this.serie="",this.saveDocument();break;case"2":this.selectedSerie.number=this.serie,this.$toast(this.$t("The following available number has been assigned: ")+this.selectedSerie.serie+this.selectedSerie.number,"success"),this.serie="",this.saveDocument();break;default:this.$toast(this.$t("Invalid input."),"error")}else if(this.date>this.fecha){let e=this.dateFormat(this.date),s=this.dateFormat(this.fecha);switch(prompt(`La fecha seleccionada es anterior a la de la última factura, ¿deseas asignarle la fecha actual?
1. Conservar la fecha seleccionada: ${s} 
2. Asignar la fecha actual: ${e}`)){case null:this.$toast(this.$t("Operation cancelled."),"error");break;case"1":this.$toast(this.$t("The date will be retained: ")+this.fecha,"success"),this.saveDocument();break;case"2":const F=new Date,Z=F.getFullYear(),E=(F.getMonth()+1).toString().padStart(2,"0"),W=F.getDate().toString().padStart(2,"0");this.fecha=`${Z}-${E}-${W}`,this.$toast(this.$t("The current date has been assigned."),"success"),this.saveDocument();break;default:this.$toast(this.$t("Invalid input."),"error")}}else this.saveDocument()}).catch(r=>{this.$toast(this.$t("Error saving document data."),"error")})},myDocumentSave(){this.myDocument.number=this.selectedSerie.serie+this.selectedSerie.number,this.myDocument.document_counter=this.selectedSerie.number,this.myDocument.expiration=this.expiration,this.myDocument.payment_methods_id=this.selectedPaymentMethod.id,this.myDocument.company_id_company=this.selectedCompany.id,this.myDocument.company_id_customer=this.selectedCustomer.id,this.myDocument.documents_type_id=this.selectedType.id,this.myDocument.documents_series_id=this.selectedSerie.id,this.myDocument.date=this.fecha,this.myDocument.document_counter=1,this.myDocument.bank_account_id=this.selectedCompany.bank_account_id,this.myDocument.subTotal=this.subtotal.toFixed(2),this.myDocument.totalTax=this.totalIVA.toFixed(2),this.myDocument.amount=this.totalConIVA.toFixed(2)},saveDocument(){this.myDocumentSave(),this.selectedType.id==1&&(this.myDocument.invoiced=!0),this.products.forEach(r=>{try{let e={reference:r.reference,description:r.description,quantity:r.quantity,price:r.price,taxes:r.taxes,discount:r.discount,discount_reason:r.discount_reason,total:this.calculateTotal(r)};this.myDocument.concept.push(e)}catch(e){console.error("Error al crear el objeto newProduct:",e)}}),axios.post("/documents",{documentData:this.myDocument}).then(r=>{this.$toast(this.$t("Invoice saved correctly."),"success"),this.myDocument.concept=[],this.saveRestart&&this.resetData()}).catch(r=>{this.$toast(this.$t("Error saving invoice."),"error"),this.myDocument.concept=[]})},resetData(){this.isSaving=!0,setTimeout(function(){window.location.reload()},3e3)},calculateGross(r){return r.quantity*r.price},calculateTax(r){return r.priceTax=parseFloat(r.taxes/100*r.subTotal),r.priceTax},calculateTotal(r){let e=this.calculateTax(r);return r.total=e+r.subTotal,r.total.toFixed(2)},calculateSubtotal(r){let e=parseFloat(r.quantity)*parseFloat(r.price);return r.subTotal=e-r.discount/100*e,r.subTotal},confirmDeleteProduct(r){this.product=r,this.deleteProductDialog=!0},deleteProduct(){this.products=this.products.filter(r=>r.id!==this.product.id),this.product=null,this.deleteProductDialog=!1},confirmDeleteSelected(){this.deleteProductsDialog=!0},deleteSelectedProducts(){this.selectedProducts.forEach(r=>{this.products=this.products.filter(e=>e.id!==r.id)}),this.selectedProducts=[],this.deleteProductsDialog=!1},dateFormat(r){let e=new Date(r),s=e.getDate(),b=e.getMonth()+1,F=e.getFullYear();return s<10&&(s="0"+s),b<10&&(b="0"+b),`${s}/${b}/${F}`},manejarFecha(){let r=this.dateFormat(this.fecha),e=prompt(`La fecha seleccionada (${r}) es anterior a la de la última factura, ¿deseas asignarle la fecha actual?
1. Conservar la fecha seleccionada. 
2. Asignar la fecha actual.`);if(e==="1")console.log("Se conservará la fecha seleccionada:",r);else if(e==="2"){let s=new Date().toISOString().split("T")[0],b=this.dateFormat(s);console.log("Se asignará la fecha actual:",b)}else console.log("Opción no válida.")},calcularImporteBase(r,e){return r<=0?0:e/(r/100)},exportToPDF(){this.myDocumentSave(),this.calculateTaxes().then(()=>{this.showTable=!this.showTable,window.print()}).catch(r=>{this.$toast(this.$t("Could not generate the PDF."),"error")})},addsign(r){Te.setForceWSMode(!0),Te.cargarAppAfirma(),Te.setServlets(window.location.origin+"/afirma-signature-storage/StorageService",window.location.origin+"/afirma-signature-retriever/RetrieveService");var e=Te.getBase64FromText(r);Te.signAndSaveToFile("sign",e!=null&&e!=null&&e!=""?e:null,"SHA512withRSA","AUTO","",null,showSignResultCallback,showErrorCallback)},exportToXML(){this.myDocumentSave(),this.calculateTaxes().then(()=>{this.myDocument.document_counter=1,console.log("contador: "+this.myDocument.document_counter);const r=this.convertToFacturaeXML();this.$toast(this.$t("XML document generated correctly."),"success"),this.addsign(r)})},convertToFacturaeXML(){let r=`<?xml version="1.0" encoding="UTF-8"?>
            <fe:Facturae xmlns:ds="http://www.w3.org/2000/09/xmldsig#" xmlns:fe="http://www.facturae.es/Facturae/2014/v3.2.1/Facturae">
                <FileHeader>
                    <SchemaVersion>3.2.1</SchemaVersion>
                    <Modality>I</Modality>
                    <InvoiceIssuerType>EM</InvoiceIssuerType>
                    <Batch>
                        <BatchIdentifier>${this.selectedCompany.tax_number}${this.selectedSerie.number}${this.selectedSerie.serie}</BatchIdentifier>
                        <InvoicesCount>${this.myDocument.document_counter}</InvoicesCount>
                        <TotalInvoicesAmount>
                            <TotalAmount>${this.myDocument.amount}</TotalAmount>
                        </TotalInvoicesAmount>
                        <TotalOutstandingAmount>
                            <TotalAmount>${this.myDocument.amount}</TotalAmount>
                        </TotalOutstandingAmount>
                        <TotalExecutableAmount>
                            <TotalAmount>${this.myDocument.amount}</TotalAmount>
                        </TotalExecutableAmount>
                        <InvoiceCurrencyCode>EUR</InvoiceCurrencyCode>
                    </Batch>
                </FileHeader> 
                
                <Parties>
                    <SellerParty>
                        <TaxIdentification>
                            <PersonTypeCode>J</PersonTypeCode>
                            <ResidenceTypeCode>R</ResidenceTypeCode>
                            <TaxIdentificationNumber>${this.selectedCompany.tax_number}</TaxIdentificationNumber>
                        </TaxIdentification>
                        <LegalEntity>
                            <CorporateName>${this.selectedCompany.name}</CorporateName>
                            <AddressInSpain>
                                <Address>${this.selectedCompany.address}</Address>
                                <PostCode>${this.selectedCompany.post_code}</PostCode>
                                <Town>${this.selectedCompany.town}</Town>
                                <Province>${this.selectedCompany.province}</Province>
                                <CountryCode>ESP</CountryCode>
                            </AddressInSpain>
                            <ContactDetails>
                                <Telephone>${this.selectedCompany.phone}</Telephone>
                                <ElectronicMail>${this.selectedCompany.email}</ElectronicMail>
                            </ContactDetails>
                        </LegalEntity>
                    </SellerParty>
                    
                    <BuyerParty>
                        <TaxIdentification>
                            <PersonTypeCode>J</PersonTypeCode>
                            <ResidenceTypeCode>R</ResidenceTypeCode>
                            <TaxIdentificationNumber>${this.selectedCustomer.tax_number}</TaxIdentificationNumber>
                        </TaxIdentification>
                        <LegalEntity>
                            <CorporateName>${this.selectedCustomer.name}</CorporateName>
                            <AddressInSpain>
                                <Address>${this.selectedCustomer.address}</Address>
                                <PostCode>${this.selectedCustomer.post_code}</PostCode>
                                <Town>${this.selectedCustomer.town}</Town>
                                <Province>${this.selectedCustomer.province}</Province>
                                <CountryCode>ESP</CountryCode>
                            </AddressInSpain>
                            <ContactDetails>
                                <Telephone>${this.selectedCustomer.phone}</Telephone>
                                <ElectronicMail>${this.selectedCustomer.email}</ElectronicMail>
                            </ContactDetails>
                        </LegalEntity>
                    </BuyerParty> 
                </Parties>
                <Invoices>
                    <Invoice>
                        <InvoiceHeader>
                            <InvoiceNumber>${this.selectedSerie.number}</InvoiceNumber>
                            <InvoiceSeriesCode>${this.selectedSerie.serie}</InvoiceSeriesCode>
                            <InvoiceDocumentType>FC</InvoiceDocumentType>
                            <InvoiceClass>OO</InvoiceClass>
                        </InvoiceHeader>
                        <InvoiceIssueData>
                            <IssueDate>${this.myDocument.date}</IssueDate>
                            <InvoiceCurrencyCode>EUR</InvoiceCurrencyCode>
                            <TaxCurrencyCode>EUR</TaxCurrencyCode>
                            <LanguageName>es</LanguageName>
                        </InvoiceIssueData>
                        <TaxesOutputs>
`;return this.taxMap.forEach((e,s)=>{r+=`  <Tax>
`,r+=`    <TaxTypeCode>01</TaxTypeCode>
`,r+=`    <TaxRate>${parseFloat(s).toFixed(2)}</TaxRate>
`,r+=`    <TaxableBase>
`,r+=`      <TotalAmount>${this.calcularImporteBase(s,e).toFixed(2)}</TotalAmount>
`,r+=`    </TaxableBase>
`,r+=`    <TaxAmount>
`,r+=`      <TotalAmount>${e.toFixed(2)}</TotalAmount>
`,r+=`    </TaxAmount>
`,r+=`  </Tax>
`}),r+=`</TaxesOutputs>
                        <InvoiceTotals>
                            <TotalGrossAmount>${this.subtotal.toFixed(2)}</TotalGrossAmount>
                            <TotalGeneralDiscounts>0.0</TotalGeneralDiscounts>
                            <TotalGeneralSurcharges>0.0</TotalGeneralSurcharges>
                            <TotalGrossAmountBeforeTaxes>${this.subtotal.toFixed(2)}</TotalGrossAmountBeforeTaxes>
                            <TotalTaxOutputs>${this.totalIVA.toFixed(2)}</TotalTaxOutputs>
                            <TotalTaxesWithheld>0.0</TotalTaxesWithheld>
                            <InvoiceTotal>${this.myDocument.amount}</InvoiceTotal>
                            <TotalOutstandingAmount>${this.myDocument.amount}</TotalOutstandingAmount>
                            <TotalExecutableAmount>${this.myDocument.amount}</TotalExecutableAmount>
                        </InvoiceTotals>
                        <Items>`,this.products.forEach(e=>{r+=`
                    <InvoiceLine>
                        <ItemDescription>${e.description}</ItemDescription>
                        <Quantity>${e.quantity}</Quantity>
                        <UnitOfMeasure>01</UnitOfMeasure>
                        <UnitPriceWithoutTax>${e.price}</UnitPriceWithoutTax>
                        <TotalCost>${e.quantity*e.price}</TotalCost>
                        <DiscountsAndRebates>
                            <Discount>
                                <DiscountReason>${e.discount_reason}</DiscountReason>
                                <DiscountRate>${parseFloat(e.discount).toFixed(1)}</DiscountRate>
                                <DiscountAmount>${(e.quantity*e.price*(e.discount/100)).toFixed(1)}</DiscountAmount>
                            </Discount>
                        </DiscountsAndRebates>
                        <GrossAmount>${e.subTotal}</GrossAmount>
                        <TaxesOutputs>
                            <Tax>
                                <TaxTypeCode>01</TaxTypeCode>
                                <TaxRate>${e.taxes}</TaxRate>
                                <TaxableBase>
                                    <TotalAmount>${e.subTotal}</TotalAmount>
                                </TaxableBase>
                                <TaxAmount>
                                    <TotalAmount>${e.priceTax.toFixed(2)}</TotalAmount>
                                </TaxAmount>
                            </Tax>
                        </TaxesOutputs>
                    </InvoiceLine>`}),r+=`
                        </Items>
                    </Invoice>
                </Invoices>
            </fe:Facturae>`,r},cancelInvoice(){confirm("¿Está seguro? Los datos de esta factura serán descartados")&&this.resetData()},calculateTaxes(){return new Promise((r,e)=>{try{this.taxMap.clear(),this.products.forEach(s=>{let b=s.taxes,F=parseFloat(s.priceTax);if(this.taxMap.has(b)){let Z=this.taxMap.get(b);this.taxMap.set(b,Z+F)}else this.taxMap.set(b,F)}),r()}catch(s){e(s)}})}}},xn=Object.assign(cn,{__name:"Document",setup(r){return(e,s)=>{const b=Co,F=ko,Z=yo,E=To,W=Ao,Q=So,ue=wo,J=bo;return se(),ie(Ft,null,[t("div",Fo,[B(Do,{title:"Document"},{header:ee(()=>[t("h2",Po,d(e.$t("New invoice")),1)]),default:ee(()=>[t("div",Lo,[t("div",$o,[t("div",Uo,[t("div",Vo,[t("div",jo,[!e.loading&&e.companies.length>0?(se(),ie("button",{key:0,type:"button",class:"px-4 py-2 bg-black text-white border border-gray-200 rounded-md flex items-center justify-between",onClick:s[0]||(s[0]=(...a)=>e.selectCompany&&e.selectCompany(...a))},[t("span",qo,[Ho,Ce(" "+d(e.selectedCompany.name),1)])])):Fe("",!0)]),t("div",Ko,[t("div",Bo,[t("div",Jo,[t("div",Yo,[B(b,{label:e.$t("Customer"),icon:"pi pi-plus",class:"success-button text-white p-2",onClick:s[1]||(s[1]=a=>e.selectACustomer())},null,8,["label"])]),t("div",Go,[t("label",Xo,d(e.$t("Mark as paid")),1),Ee(t("input",{id:"link-checkbox",type:"checkbox","onUpdate:modelValue":s[2]||(s[2]=a=>e.myDocument.paid=a),class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[_o,e.myDocument.paid]])])])]),t("div",Wo,[t("div",zo,[t("div",Qo,[t("button",{type:"button",class:Ot(["px-4 py-2 mr-2 success-button text-white rounded flex items-center justify-between",{"opacity-50":!e.selectedCompany.id}]),onClick:s[3]||(s[3]=a=>e.selectDocument()),disabled:!e.selectedCompany.id},[t("span",null,[er,Ce(" "+d(e.$t("Document type")),1)])],10,Zo),t("button",{type:"button",class:Ot(["px-4 py-2 bg-purple-600 text-white rounded-md flex items-center justify-between",{"opacity-50":e.totalConIVA<=0||e.isSaving||!e.selectedCustomer.id}]),onClick:s[4]||(s[4]=(...a)=>e.toggleDropdownExport&&e.toggleDropdownExport(...a)),disabled:e.totalConIVA<=0||e.isSaving},[or,Ce(" "+d(e.$t("Export")),1)],10,tr)]),Ee(t("div",rr,[t("button",{type:"button",class:"px-4 py-2 rounded-l flex items-center justify-between",onClick:s[5]||(s[5]=a=>e.exportToPDF())},[t("span",null,[ar,Ce(" "+d(e.$t("PDF")),1)])]),t("button",{type:"button",class:"px-4 py-2 rounded-r flex items-center",onClick:s[6]||(s[6]=a=>e.exportToXML())},[t("span",null,[nr,Ce(" "+d(e.$t("XML")),1)])])],512),[[Io,e.isDropdownOpenExport]])]),t("div",sr,[B(F,{class:Ot(["blue-button",{"opacity-50":e.totalConIVA<=0||e.isSaving||!e.selectedCustomer.id}]),label:e.$t("Save"),onClick:e.checkDocument,model:e.items,disabled:e.totalConIVA<=0||e.isSaving},{icon:ee(()=>[t("i",{class:Ot(["pi pi-save mr-2",{"opacity-50":e.totalConIVA<=0}])},null,2)]),_:1},8,["label","onClick","model","disabled","class"])])])]),ir,t("div",lr,[t("div",ur,[t("div",cr,[t("div",dr,[t("div",fr,d(e.$t("Customer"))+":",1),t("div",pr,d(e.selectedCustomer.name),1)]),t("div",mr,[t("div",hr,d(e.$t("Tax number"))+":",1),t("div",gr,d(e.selectedCustomer.tax_number),1)]),t("div",vr,[t("div",xr,d(e.$t("Phone"))+":",1),t("div",yr,d(e.selectedCustomer.phone),1)]),t("div",br,[t("div",Cr,d(e.$t("Email"))+":",1),t("div",Tr,d(e.selectedCustomer.email),1)]),t("div",Ar,[t("div",Sr,d(e.$t("Address"))+":",1),t("div",wr,d(e.selectedCustomer.address)+", "+d(e.selectedCustomer.post_code)+", "+d(e.selectedCustomer.town)+", "+d(e.selectedCustomer.province)+" ( "+d(e.selectedCustomer.country)+" ) ",1)])])]),t("div",kr,[t("div",Er,[t("div",Or,"Nº "+d(e.selectedType.name)+":",1),t("div",_r,d(e.selectedSerie.serie)+"  / ",1),Ee(t("input",{type:"text",class:"border border-gray-300 rounded-md w-48 px-3 py-2 focus:outline-none focus:border-blue-400","onUpdate:modelValue":s[7]||(s[7]=a=>e.selectedSerie.number=a)},null,512),[[De,e.selectedSerie.number]])]),t("div",Ir,[t("div",Rr,d(e.$t("Date"))+":",1),Ee(t("input",{type:"date","onUpdate:modelValue":s[8]||(s[8]=a=>e.fecha=a),onChange:s[9]||(s[9]=(...a)=>e.cambiarFormatoFecha&&e.cambiarFormatoFecha(...a)),class:"border border-gray-300 rounded-md w-48 px-3 py-2 focus:outline-none focus:border-blue-400"},null,544),[[De,e.fecha]])]),t("div",Dr,[t("div",Nr,d(e.$t("Expiration"))+":",1),Ee(t("input",{type:"date","onUpdate:modelValue":s[10]||(s[10]=a=>e.expiration=a),onChange:s[11]||(s[11]=(...a)=>e.cambiarFormatoFecha&&e.cambiarFormatoFecha(...a)),class:"border border-gray-300 rounded-md w-48 px-3 py-2 focus:outline-none focus:border-blue-400"},null,544),[[De,e.expiration]])])])]),B(Z,{class:"mb-4 mt-8 border border-slate-200 ..."},{start:ee(()=>[t("div",Mr,[t("div",Fr,[B(b,{label:e.$t("Concept"),icon:"pi pi-plus",severity:"success",class:"mr-2 success-button",onClick:e.addRow},null,8,["label","onClick"]),B(b,{label:e.$t("Delete"),icon:"pi pi-trash",severity:"danger",class:"danger-button",onClick:e.confirmDeleteSelected,disabled:!e.selectedProducts||!e.selectedProducts.length},null,8,["label","onClick","disabled"])]),Pr])]),end:ee(()=>[t("div",Lr,[Ee(t("input",{type:"search",class:"block w-full h-11 rounded-md border-0 py-1.5 pl-3 pr-10 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm","onUpdate:modelValue":s[12]||(s[12]=a=>e.filters.global.value=a),placeholder:e.$t("Search...")},null,8,$r),[[De,e.filters.global.value]]),Ur])]),_:1}),B(ue,{ref:"dt",value:e.products,selection:e.selectedProducts,"onUpdate:selection":s[13]||(s[13]=a=>e.selectedProducts=a),dataKey:"id",class:"w-full lg:w-4/4 mx-auto"},{default:ee(()=>[B(E,{selectionMode:"multiple",exportable:!1,class:"datetable checkbox"}),B(E,{field:"reference",header:e.$t("Reference"),sortable:"",class:"dateTable w-1/4"},{body:ee(a=>[B(W,{class:"input w-full",placeholder:e.$t("Reference"),modelValue:a.data.reference,"onUpdate:modelValue":de=>a.data.reference=de},null,8,["placeholder","modelValue","onUpdate:modelValue"])]),_:1},8,["header"]),B(E,{field:"product",header:e.$t("Description"),sortable:"",class:"dateTable w-full"},{body:ee(a=>[B(W,{class:"input w-full",placeholder:e.$t("Description"),modelValue:a.data.description,"onUpdate:modelValue":de=>a.data.description=de},null,8,["placeholder","modelValue","onUpdate:modelValue"])]),_:1},8,["header"]),B(E,{field:"quantity",header:e.$t("Quantity"),sortable:"",class:"dateTable w-1/8"},{body:ee(a=>[B(W,{class:"input input-short w-full",modelValue:a.data.quantity,"onUpdate:modelValue":de=>a.data.quantity=de},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["header"]),B(E,{field:"price",header:e.$t("Price"),sortable:"",class:"dateTable w-1/4"},{body:ee(a=>[B(W,{class:"input input-short w-full",modelValue:a.data.price,"onUpdate:modelValue":de=>a.data.price=de},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["header"]),B(E,{field:"discount",header:e.$t("Discount (%)"),sortable:"",class:"dateTable w-1/4"},{body:ee(a=>[B(W,{class:"input input-short w-full",modelValue:a.data.discount,"onUpdate:modelValue":de=>a.data.discount=de},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["header"]),B(E,{field:"subTotal",header:e.$t("Subtotal"),sortable:"",class:"dateTable w-1/12"},{body:ee(a=>[B(W,{class:"input input-short w-1/12",value:e.calculateSubtotal(a.data),readonly:""},null,8,["value"])]),_:1},8,["header"]),B(E,{field:"taxes",header:e.$t("Tax (%)"),sortable:"",class:"dateTable w-1/4"},{body:ee(a=>[B(Q,{class:"input-short w-full",modelValue:a.data.taxes,"onUpdate:modelValue":de=>a.data.taxes=de,options:e.taxOptions,optionLabel:"label",optionValue:"value"},null,8,["modelValue","onUpdate:modelValue","options"])]),_:1},8,["header"]),B(E,{field:"total",header:e.$t("Total"),sortable:"",class:"dateTable w-1/12"},{body:ee(a=>[B(W,{class:"input input-short w-1/12",value:e.calculateTotal(a.data),readonly:""},null,8,["value"])]),_:1},8,["header"]),B(E,{exportable:!1,header:e.$t("Utility"),class:"dateTable w-1/12"},{body:ee(a=>[B(b,{icon:"pi pi-trash",outlined:"",rounded:"",class:"simpleDelete-button",severity:"danger",onClick:de=>e.confirmDeleteProduct(a.data)},null,8,["onClick"])]),_:1},8,["header"])]),_:1},8,["value","selection"]),e.showButton?(se(),ie("div",Vr,[B(b,{label:e.$t("Concept"),icon:"pi pi-plus",severity:"success",class:"success-button",onClick:s[14]||(s[14]=a=>e.addRow())},null,8,["label"])])):Fe("",!0),t("div",jr,[t("div",qr,[t("button",{class:"ml-4 mb-2 success-button text-white rounded-md p-2",onClick:s[15]||(s[15]=a=>e.selectAPaymentMethod())},[Hr,Ce(" "+d(e.$t("Payment method")),1)]),t("div",Kr,[t("table",Br,[t("tbody",null,[t("tr",null,[t("td",Jr,d(e.$t("Payment method"))+":",1),t("td",Yr,d(e.selectedPaymentMethod.name),1)]),Gr,t("tr",null,[t("td",Xr,[e.selectedPaymentMethod.id===2?(se(),ie("span",Wr,d(""))):e.selectedPaymentMethod.id===3?(se(),ie("span",zr,d(e.$t("Phone"))+":",1)):e.selectedPaymentMethod.id===4?(se(),ie("span",Qr,d(e.$t("Email"))+":",1)):(se(),ie("span",Zr,d(e.$t("Bank account"))+":",1))]),t("td",e0,[e.selectedPaymentMethod.id===2?(se(),ie("span",t0,d(""))):e.selectedPaymentMethod.id===3?(se(),ie("span",o0,d(e.selectedPhone.phone),1)):e.selectedPaymentMethod.id===4?(se(),ie("span",r0,d(e.selectedEmail.email),1)):(se(),ie("span",a0,d(e.selectedBankAccount.complete_bank_account),1))])])])])])])]),n0,t("div",s0,[t("button",{class:"ml-4 mb-5 rounded-md",onClick:s[16]||(s[16]=a=>e.selectAPaymentMethod())}),t("div",i0,[t("table",l0,[t("tbody",null,[t("tr",null,[t("td",u0,d(e.$t("Subtotal (excluding Tax)"))+":",1),t("td",c0,d(e.subtotal.toFixed(2))+"€",1)]),d0,t("tr",null,[t("td",f0,d(e.$t("Total Tax"))+":",1),t("td",p0,d(e.totalIVA.toFixed(2))+"€",1)]),m0,t("tr",null,[t("td",h0,d(e.$t("Total (with IVA)"))+":",1),t("td",g0,d(e.totalConIVA.toFixed(2))+"€",1)])])])])])])]),t("div",v0,[t("div",x0,[t("button",{class:"ml-4 mb-2 success-button rounded-md",onClick:s[17]||(s[17]=a=>e.selectAPaymentMethod())},[y0,Ce(" "+d(e.$t("Payment method")),1)]),t("div",b0,[t("table",C0,[t("tbody",null,[t("tr",null,[t("td",T0,d(e.$t("Payment method"))+":",1),t("td",A0,d(e.selectedPaymentMethod.name),1)]),S0,t("tr",null,[t("td",w0,d(e.$t("Bank account"))+":",1),t("td",k0,d(e.selectedBankAccount.complete_bank_account),1)])])])])]),E0,t("div",O0,[t("div",_0,[t("table",I0,[t("tbody",null,[t("tr",null,[t("td",R0,d(e.$t("Subtotal (excluding Tax)"))+":",1),t("td",D0,d(e.subtotal.toFixed(2))+"€",1)]),t("tr",null,[t("td",N0,d(e.$t("Total Tax"))+":",1),t("td",M0,d(e.totalIVA.toFixed(2))+"€",1)]),t("tr",null,[t("td",F0,d(e.$t("Total (with IVA)"))+":",1),t("td",P0,d(e.totalConIVA.toFixed(2))+"€",1)])])])])])])])]),B(J,{visible:e.productDialog,"onUpdate:visible":s[19]||(s[19]=a=>e.productDialog=a),header:e.$t("Select companies"),modal:!0,onChange:e.handleCompanySelection,class:"p-fluid w-full sm:w-3/4 md:w-2/3 lg:w-1/2 max-w-4xl"},{default:ee(()=>[t("label",L0,d(e.$t("Select your company"))+":",1),B(Q,{modelValue:e.selectedCompany,"onUpdate:modelValue":s[18]||(s[18]=a=>e.selectedCompany=a),options:e.companies,filter:"",optionLabel:"name",class:"w-full h-11 md:w-64rem mb-4 bg-gray-50 border border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500",onChange:e.handleCompanySelection},{value:ee(a=>[a.value?(se(),ie("div",$0,[t("div",null,d(a.value.name),1)])):Fe("",!0)]),option:ee(a=>[t("div",U0,[t("div",null,d(a.option.name),1)])]),_:1},8,["modelValue","options","onChange"])]),_:1},8,["visible","header","onChange"]),B(J,{visible:e.documentDialog,"onUpdate:visible":s[22]||(s[22]=a=>e.documentDialog=a),style:{width:"450px"},header:e.$t("Select document"),modal:!0,onChange:e.handleTypeSelection},{default:ee(()=>[t("label",V0,d(e.$t("Select document type")),1),B(Q,{modelValue:e.selectedType,"onUpdate:modelValue":s[20]||(s[20]=a=>e.selectedType=a),options:e.types,filter:"",optionLabel:"name",class:"w-full h-11 md:w-64rem mb-4 bg-gray-50 border border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500",onChange:e.handleTypeSelection},{value:ee(a=>[a.value?(se(),ie("div",j0,[t("div",null,d(a.value.name),1)])):Fe("",!0)]),option:ee(a=>[t("div",q0,[t("div",null,d(a.option.name),1)])]),_:1},8,["modelValue","options","onChange"]),t("label",H0,d(e.$t("Select document serie")),1),B(Q,{modelValue:e.selectedSerie,"onUpdate:modelValue":s[21]||(s[21]=a=>e.selectedSerie=a),options:e.series,filter:"",optionLabel:"serie",class:"w-full h-11 md:w-64rem mb-4 bg-gray-50 border border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500"},{value:ee(a=>[a.value?(se(),ie("div",K0,[t("div",null,d(a.value.serie),1)])):Fe("",!0)]),option:ee(a=>[t("div",B0,[t("div",null,d(a.option.serie),1)])]),_:1},8,["modelValue","options"])]),_:1},8,["visible","header","onChange"]),B(J,{visible:e.deleteProductDialog,"onUpdate:visible":s[24]||(s[24]=a=>e.deleteProductDialog=a),style:{width:"450px"},header:e.$t("Confirm"),modal:!0},{footer:ee(()=>[B(b,{label:e.$t("No"),icon:"pi pi-times",text:"",onClick:s[23]||(s[23]=a=>e.deleteProductDialog=!1)},null,8,["label"]),B(b,{label:e.$t("Yes"),icon:"pi pi-check",text:"",onClick:e.deleteProduct},null,8,["label","onClick"])]),default:ee(()=>[t("div",J0,[Y0,e.companies?(se(),ie("span",G0,[Ce(d(e.$t("Are you sure you want to delete")),1),t("b",null,d(e.companies.name),1),Ce("?")])):Fe("",!0)])]),_:1},8,["visible","header"]),B(J,{visible:e.deleteProductsDialog,"onUpdate:visible":s[26]||(s[26]=a=>e.deleteProductsDialog=a),style:{width:"450px"},header:e.$t("Confirm"),modal:!0},{footer:ee(()=>[B(b,{label:e.$t("No"),icon:"pi pi-times",text:"",onClick:s[25]||(s[25]=a=>e.deleteProductsDialog=!1)},null,8,["label"]),B(b,{label:e.$t("Yes"),icon:"pi pi-check",text:"",onClick:e.deleteSelectedProducts},null,8,["label","onClick"])]),default:ee(()=>[t("div",X0,[W0,e.companies?(se(),ie("span",z0,d(e.$t("Are you sure you want to delete the selected concepts?")),1)):Fe("",!0)])]),_:1},8,["visible","header"]),B(J,{visible:e.selectACustomerDialog,"onUpdate:visible":s[30]||(s[30]=a=>e.selectACustomerDialog=a),header:e.$t("Select a customer"),id:"titleCompany",modal:!0,class:"p-fluid w-full sm:w-3/4 md:w-2/3 lg:w-1/2 max-w-4xl"},{default:ee(()=>[B(Q,{modelValue:e.selectedCustomer,"onUpdate:modelValue":s[27]||(s[27]=a=>e.selectedCustomer=a),options:e.customers,filter:"",optionLabel:"name",class:"w-full h-11 md:w-64rem mb-4 bg-gray-50 border border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500"},{value:ee(a=>[a.value?(se(),ie("div",Q0,[t("div",null,d(a.value.name),1)])):Fe("",!0)]),option:ee(a=>[t("div",Z0,[t("div",null,d(a.option.name),1)])]),_:1},8,["modelValue","options"]),t("div",ea,[t("div",ta,[t("button",{class:"success-button mr-1 mr-1 rounded-md",onClick:s[28]||(s[28]=(...a)=>e.openNew&&e.openNew(...a))},[oa,Ce(" "+d(e.$t("Create customer")),1)]),t("button",{class:"text-white bg-red-600 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800",onClick:s[29]||(s[29]=a=>e.hideDialog())},d(e.$t("Close")),1)])])]),_:1},8,["visible","header"]),B(J,{visible:e.selectAPaymentMethodDialog,"onUpdate:visible":s[34]||(s[34]=a=>e.selectAPaymentMethodDialog=a),header:e.$t("Select a payment method"),id:"titleCompany",modal:!0,class:"p-fluid w-full sm:w-3/4 md:w-2/3 lg:w-1/2 max-w-4xl"},{default:ee(()=>[t("label",ra,d(e.$t("Payment method")),1),B(Q,{modelValue:e.selectedPaymentMethod,"onUpdate:modelValue":s[31]||(s[31]=a=>e.selectedPaymentMethod=a),options:e.payment_methods,filter:"",optionLabel:"name",class:"w-full h-11 md:w-64rem mb-4 bg-gray-50 border border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500"},{value:ee(a=>[a.value?(se(),ie("div",aa,[t("div",null,d(a.value.name),1)])):Fe("",!0)]),option:ee(a=>[t("div",na,[t("div",null,d(a.option.name),1)])]),_:1},8,["modelValue","options"]),e.isDropdownHidden?Fe("",!0):(se(),ie("label",sa,d(e.$t("Select an option")),1)),e.isDropdownHidden?Fe("",!0):(se(),Ro(Q,{key:1,modelValue:e.selectedOption,"onUpdate:modelValue":s[32]||(s[32]=a=>e.selectedOption=a),options:e.options,filter:"",optionLabel:e.dynamicOptionLabel,class:"w-full h-11 md:w-64rem mb-4 bg-gray-50 border border-gray-300 focus:border-blue-500 focus:ring-blue-500 dark:focus:border-blue-500 dark:focus:ring-blue-500"},{value:ee(a=>[a.value?(se(),ie("div",ia,[t("div",null,d(a.value[e.dynamicOptionLabel]),1)])):Fe("",!0)]),option:ee(a=>[t("div",la,[t("div",null,d(a.option[e.dynamicOptionLabel]),1)])]),_:1},8,["modelValue","options","optionLabel"])),t("div",ua,[t("button",{class:"text-white bg-red-600 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800",onClick:s[33]||(s[33]=a=>e.hideDialog())},d(e.$t("Close")),1)])]),_:1},8,["visible","header"]),B(J,{visible:e.customerDialog,"onUpdate:visible":s[46]||(s[46]=a=>e.customerDialog=a),header:e.$t("Create company"),id:"titleCompany",modal:!0,class:"p-fluid"},{default:ee(()=>[t("form",{style:{width:"800px"},onSubmit:s[45]||(s[45]=Pt((...a)=>e.saveCustomer&&e.saveCustomer(...a),["prevent"]))},[t("div",ca,[t("div",null,[t("label",da,d(e.$t("Company name")),1),Ee(t("input",{type:"text",id:"name","onUpdate:modelValue":s[35]||(s[35]=a=>e.customer.name=a),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("Company name"),required:!e.selectedCustomer},null,8,fa),[[De,e.customer.name]])]),t("div",null,[t("label",pa,d(e.$t("Tax number")),1),Ee(t("input",{type:"text",id:"tax_number","onUpdate:modelValue":s[36]||(s[36]=a=>e.customer.tax_number=a),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("Tax number"),required:!e.selectedCustomer},null,8,ma),[[De,e.customer.tax_number]])])]),t("div",ha,[t("label",ga,d(e.$t("Address")),1),Ee(t("input",{type:"text",id:"address1","onUpdate:modelValue":s[37]||(s[37]=a=>e.customer.address=a),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("Address"),required:!e.selectedCustomer},null,8,va),[[De,e.customer.address]])]),t("div",xa,[t("div",null,[t("label",ya,d(e.$t("Town")),1),Ee(t("input",{type:"text",id:"town","onUpdate:modelValue":s[38]||(s[38]=a=>e.customer.town=a),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("Town"),required:!e.selectedCustomer},null,8,ba),[[De,e.customer.town]])]),t("div",null,[t("label",Ca,d(e.$t("Province")),1),Ee(t("input",{type:"text",id:"province","onUpdate:modelValue":s[39]||(s[39]=a=>e.customer.province=a),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("Province"),required:!e.selectedCustomer},null,8,Ta),[[De,e.customer.province]])]),t("div",null,[t("label",Aa,d(e.$t("Post code")),1),Ee(t("input",{type:"text",id:"post_code","onUpdate:modelValue":s[40]||(s[40]=a=>e.customer.post_code=a),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("Post code"),pattern:"^\\d+$",required:!e.selectedCustomer},null,8,Sa),[[De,e.customer.post_code]])]),t("div",null,[t("label",wa,d(e.$t("Country")),1),Ee(t("input",{type:"text",id:"country","onUpdate:modelValue":s[41]||(s[41]=a=>e.customer.country=a),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("Country"),required:!e.selectedCustomer},null,8,ka),[[De,e.customer.country]])]),t("div",null,[t("label",Ea,d(e.$t("Email")),1),Ee(t("input",{type:"email",id:"email","onUpdate:modelValue":s[42]||(s[42]=a=>e.customer.email=a),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("info@mycompany.com"),required:!e.selectedCustomer},null,8,Oa),[[De,e.customer.email]])]),t("div",null,[t("label",_a,d(e.$t("Phone")),1),Ee(t("input",{type:"tel",id:"phone","onUpdate:modelValue":s[43]||(s[43]=a=>e.customer.phone=a),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:e.$t("Phone"),pattern:"^\\+\\d{1,3}\\s?\\d{1,14}$",required:!e.selectedCustomer},null,8,Ia),[[De,e.customer.phone]])])]),t("div",Ra,[t("div",null,[t("button",{class:"mr-3 text-white bg-red-600 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800",onClick:s[44]||(s[44]=Pt(a=>e.hideDialog(),["prevent"]))},d(e.$t("Close")),1),t("button",Da,d(e.$t("Save")),1)])])],32)]),_:1},8,["visible","header"])]),_:1})]),t("div",Na,[t("div",Ma,[t("div",Fa,[Pa,t("div",La,[t("h3",null,d(e.selectedType.name),1),t("p",null,[t("strong",null,d(e.$t("Date"))+": ",1),Ce(d(e.fecha),1)]),t("p",null,[t("strong",null,d(e.$t("Expiration"))+": ",1),Ce(d(e.expiration),1)]),t("p",null,[t("strong",null,d(e.$t("Number of"))+" "+d(e.selectedType.name)+":",1),Ce(" "+d(e.selectedSerie.serie)+" "+d(e.selectedSerie.number),1)])])]),t("div",$a,[t("div",Ua,[t("h3",null,[t("strong",null,d(e.$t("Company")),1)]),t("p",Va,d(e.selectedCompany.name),1),t("p",null,d(e.selectedCompany.tax_number),1),t("p",null,[Ce(d(e.selectedCompany.address),1),ja,Ce(" "+d(e.selectedCompany.post_code)+", "+d(e.selectedCompany.town)+", "+d(e.selectedCompany.province)+", "+d("(")+" "+d(e.selectedCompany.country)+" "+d(")"),1)]),t("p",null,d(e.selectedCompany.email),1),t("p",null,d(e.selectedCompany.phone),1)]),t("div",qa,[t("h3",null,[t("strong",null,d(e.$t("Customer")),1)]),t("p",Ha,d(e.selectedCustomer.name),1),t("p",null,d(e.selectedCustomer.tax_number),1),t("p",null,[Ce(d(e.selectedCustomer.address),1),Ka,Ce(" "+d(e.selectedCustomer.post_code)+", "+d(e.selectedCustomer.town)+", "+d(e.selectedCustomer.province)+", "+d("(")+" "+d(e.selectedCustomer.country)+" "+d(")"),1)]),t("p",null,d(e.selectedCustomer.email),1),t("p",null,d(e.selectedCustomer.phone),1)])]),t("table",Ba,[t("thead",null,[t("tr",Ja,[t("th",null,d(e.$t("Reference")),1),t("th",null,d(e.$t("Description")),1),t("th",null,d(e.$t("Quantity")),1),t("th",null,d(e.$t("Price")),1),t("th",null,d(e.$t("Discount (%)")),1),t("th",null,d(e.$t("Subtotal")),1),t("th",null,d(e.$t("Tax (%)")),1),t("th",null,d(e.$t("Total")),1)])]),t("tbody",null,[(se(!0),ie(Ft,null,Eo(e.products,a=>(se(),ie("tr",{key:a.id},[t("td",null,d(a.reference),1),t("td",null,d(a.description),1),t("td",null,d(a.quantity),1),t("td",null,d(a.price),1),t("td",null,d(a.discount),1),t("td",null,d(a.subTotal),1),t("td",null,d(a.taxes),1),t("td",null,d(e.calculateTotal(a)),1)]))),128))])]),t("div",Ya,[t("div",Ga,[t("table",Xa,[t("tr",null,[t("td",Wa,d(e.$t("Subtotal (excluding Tax)")),1),t("td",null,d(e.subtotal.toFixed(2))+"€",1)]),t("tr",null,[t("td",za,[t("strong",null,d(e.$t("Total (with IVA)")),1)]),t("td",null,[t("strong",null,d(e.totalConIVA.toFixed(2))+"€",1)])])])]),t("table",Qa,[t("tr",null,[t("td",null,d(e.$t("Payment method"))+":",1),t("td",null,d(e.selectedPaymentMethod.name),1)]),t("tr",null,[t("td",Za,[e.selectedPaymentMethod.id===2?(se(),ie("span",en,d(""))):e.selectedPaymentMethod.id===3?(se(),ie("span",tn,d(e.$t("Phone"))+":",1)):e.selectedPaymentMethod.id===4?(se(),ie("span",on,d(e.$t("Email"))+":",1)):(se(),ie("span",rn,d(e.$t("Bank account"))+":",1))]),t("td",an,[e.selectedPaymentMethod.id===2?(se(),ie("span",nn,d(""))):e.selectedPaymentMethod.id===3?(se(),ie("span",sn,d(e.selectedPhone.phone),1)):e.selectedPaymentMethod.id===4?(se(),ie("span",ln,d(e.selectedEmail.email),1)):(se(),ie("span",un,d(e.selectedBankAccount.complete_bank_account),1))])])])])])])],64)}}});export{xn as default};
