import{s as T,a as k}from"./toolbar.esm-B0TbK0bb.js";import{s as w,a as C,b as x}from"./column.esm-CUrjiXZs.js";import{j as P,k as m,o as h,e as p,a as n,b as o,w as a,t as u,l as S,v as $,g as f,f as g}from"./app-DWuN0MW6.js";import{_ as E}from"./_plugin-vue_export-helper-DlAUqK2U.js";const I={data(){return{documents:null,deleteDocumentDialog:!1,deleteDocumentsDialog:!1,serie:"",date:"",myDocument:{id:"",number:"",company_id_company:"",company_id_customer:"",documents_type_id:"",documents_series_id:"",date:"",subTotal:"",totalTax:"",amount:"",paid:"",customer_name:""},selectedDocuments:[],filters:{},submitted:!1}},created(){this.filters={global:{value:null,matchMode:P.CONTAINS}};const e=new Date,t=e.getFullYear(),r=(e.getMonth()+1).toString().padStart(2,"0"),y=e.getDate().toString().padStart(2,"0");this.fecha=`${t}-${r}-${y}`},mounted(){this.fetchDocuments()},methods:{fetchDocuments(){let e=window.location.pathname.split("/").pop();console.log("ID company "+e),m.get("/documents-serie/"+e).then(t=>{this.documents=t.data.documents}).catch(t=>{console.error("Error fetching documents data:",t)})},confirmDeleteProduct(e){console.log("Confirm deletee"),this.document=e,this.deleteDocumentDialog=!0},deleteProduct(){console.log("DELETE"),this.documents=this.documents.filter(e=>e.id!==this.document.id),this.deleteDocumentDialog=!1,m.delete("/documents/"+this.document.id).then(e=>{console.log(e)}).catch(e=>{console.log(e.response)}),this.document={}},confirmDeleteSelected(){console.log("CONFIRM DELETE SELECTED"),this.deleteDocumentsDialog=!0},deleteSelectedProducts(){this.selectedDocuments.forEach(e=>{m.delete("/documents/"+e.id).then(t=>{console.log("Factura eliminada:",e.id),this.documents=this.documents.filter(r=>r.id!==e.id)}).catch(t=>{console.error("Error al eliminar la factura:",t)})}),this.selectedDocuments=[],this.deleteDocumentsDialog=!1},handleInfoButtonClick(e){let t=window.location.pathname.split("/").pop();this.myDocument.id=e.id,this.myDocument.number=e.number,this.myDocument.company_id_company=e.company_id_company,this.myDocument.company_id_customer=e.company_id_customer,this.myDocument.documents_type_id=e.documents_type_id,this.myDocument.documents_series_id=e.documents_series_id,this.myDocument.date=e.date,this.myDocument.subTotal=e.subTotal,this.myDocument.amount=e.amount,this.myDocument.totalTax=e.totalTax,this.myDocument.paid=e.paid,this.myDocument.customer_name=e.customer_name,this.$inertia.get(`/companies/${t}/document/${this.myDocument.id}`)},checkDocument(){m.get("/documents-serie/"+this.selectedType.id+"/"+this.selectedCompany.id+"/"+this.selectedSerie.serie).then(e=>{this.date=e.data.date.date,console.log("date "+this.date),console.log("fecha "+this.fecha),this.serie=e.data.serie.number,console.log("Serie "+this.serie),console.log("selectedSerie "+this.selectedSerie.number),this.date>this.fecha?confirm("La fecha seleccionada es anterior a la de la última factura, ¿deseas asignarle la fecha actual?")&&(alert("Se ha asignado la fecha actual"),this.makeInvoice()):(this.fecha=this.date,this.makeInvoice())}).catch(e=>{console.error("Error al guardar los datos del documento:",e.response)})},makeInvoice(){window.location.pathname.split("/").pop(),this.myDocument.id=slotProps.id,this.myDocument.number=slotProps.number,this.myDocument.company_id_company=slotProps.company_id_company,this.myDocument.company_id_customer=slotProps.company_id_customer,this.myDocument.documents_type_id=slotProps.documents_type_id,this.myDocument.documents_series_id=slotProps.documents_series_id,this.myDocument.date=slotProps.date,this.myDocument.subTotal=slotProps.subTotal,this.myDocument.amount=slotProps.amount,this.myDocument.totalTax=slotProps.totalTax,this.myDocument.paid=slotProps.paid,this.myDocument.customer_name=slotProps.customer_name,console.log("Fecha factura: "+this.fecha),this.myDocument.document_counter=this.number,console.log("numero factura: "+this.myDocument.document_counter),this.myDocument.company_id_company=this.selectedCompany.id,this.myDocument.company_id_customer=this.selectedCustomer.id,this.myDocument.documents_type_id=1,this.myDocument.number=slotProps.document_series_serie+this.number,this.myDocument.documents_series_id=1,this.myDocument.date=this.fecha,this.myDocument.subTotal=this.subtotal.toFixed(2),this.myDocument.totalTax=this.totalIVA.toFixed(2),this.myDocument.amount=this.totalConIVA.toFixed(2),this.products.forEach(e=>{let t={reference:e.reference,description:e.product,quantity:e.quantity,price:e.price,tax:e.taxes,total:this.calculateTotal(e).toFixed(2)};this.myDocument.concept.push(t)}),m.post("/documents",{documentData:this.myDocument}).then(e=>{console.log("ha pasao")}).catch(e=>{console.log("ha fallao"),console.error("Error al guardar los datos del documento:",e.response)})}}},N={class:"card"},F={class:"flex justify-between items-center mt-2"},L={class:"relative rounded-md shadow-sm w-1/4"},M=["placeholder"],A=n("div",{class:"absolute inset-y-0 left-0 flex items-center pl-3"},[n("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[n("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"})])],-1),B={class:"confirmation-content"},R=n("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),V={key:0},z={class:"confirmation-content"},U=n("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),O={key:0};function Y(e,t,r,y,s,d){const l=C,_=T,c=x,b=w,D=k;return h(),p("div",null,[n("div",N,[o(_,{class:"mb-4 border border-slate-200 ..."},{start:a(()=>[o(l,{label:"Delete",icon:"pi pi-trash",severity:"danger",class:"danger-button",onClick:d.confirmDeleteSelected,disabled:!s.selectedDocuments||!s.selectedDocuments.length},null,8,["onClick","disabled"])]),_:1}),o(b,{ref:"dt",value:s.documents,selection:s.selectedDocuments,"onUpdate:selection":t[1]||(t[1]=i=>s.selectedDocuments=i),dataKey:"id",paginator:!0,rows:10,filters:s.filters,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:`${e.$t("Showing")} {first} ${e.$t("of")} {last} ${e.$t("of")} {totalRecords} ${e.$t("documents")}`},{header:a(()=>[n("div",F,[n("h4",null,u(e.$t("Manage documents")),1),n("div",L,[S(n("input",{type:"search",class:"block w-full h-11 rounded-md border-0 py-1.5 pl-10 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm","onUpdate:modelValue":t[0]||(t[0]=i=>s.filters.global.value=i),placeholder:e.$t("Search...")},null,8,M),[[$,s.filters.global.value]]),A])])]),default:a(()=>[o(c,{selectionMode:"multiple",exportable:!1,class:"datetable checkbox"}),o(c,{field:"number",header:e.$t("Number"),sortable:"",class:"dateTable"},null,8,["header"]),o(c,{field:"customer_name",header:e.$t("Receiver"),sortable:"",class:"dateTable"},null,8,["header"]),o(c,{field:"date",header:e.$t("Date"),sortable:"",class:"dateTable"},null,8,["header"]),o(c,{field:"amount",header:e.$t("Amount"),sortable:"",class:"dateTable"},null,8,["header"]),o(c,{field:"document_type_name",header:e.$t("Type"),sortable:"",class:"dateTable"},null,8,["header"]),o(c,{exportable:!1,class:"dateTable"},{body:a(i=>[o(l,{icon:"pi pi-pencil",outlined:"",rounded:"",class:"mr-2 edit-button",onClick:v=>d.handleInfoButtonClick(i.data)},null,8,["onClick"]),o(l,{icon:"pi pi-trash",outlined:"",rounded:"",class:"simpleDelete-button",severity:"danger",onClick:v=>d.confirmDeleteProduct(i.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","selection","filters","currentPageReportTemplate"])]),o(D,{visible:s.deleteDocumentDialog,"onUpdate:visible":t[3]||(t[3]=i=>s.deleteDocumentDialog=i),style:{width:"450px"},header:e.$t("Confirm"),modal:!0},{footer:a(()=>[o(l,{label:"No",icon:"pi pi-times",text:"",onClick:t[2]||(t[2]=i=>s.deleteDocumentDialog=!1)}),o(l,{label:"Yes",icon:"pi pi-check",text:"",onClick:d.deleteProduct},null,8,["onClick"])]),default:a(()=>[n("div",B,[R,e.document?(h(),p("span",V,[f(u(e.$t("Are you sure you want to delete")),1),n("b",null,u(e.document.number),1),f("?")])):g("",!0)])]),_:1},8,["visible","header"]),o(D,{visible:s.deleteDocumentsDialog,"onUpdate:visible":t[5]||(t[5]=i=>s.deleteDocumentsDialog=i),style:{width:"450px"},header:e.$t("Confirm"),modal:!0},{footer:a(()=>[o(l,{label:"No",icon:"pi pi-times",text:"",onClick:t[4]||(t[4]=i=>s.deleteDocumentsDialog=!1)}),o(l,{label:"Yes",icon:"pi pi-check",text:"",onClick:d.deleteSelectedProducts},null,8,["onClick"])]),default:a(()=>[n("div",z,[U,s.myDocument?(h(),p("span",O,u(e.$t("Are you sure you want to delete the selected documents?")),1)):g("",!0)])]),_:1},8,["visible","header"])])}const H=E(I,[["render",Y]]);export{H as default};
