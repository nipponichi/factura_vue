import{s as $}from"./dialog.esm-B3tRSsX1.js";import{a as C,c as M,s as x}from"./column.esm--ydOaD-6.js";import{s as S}from"./toolbar.esm-C6J5HQjW.js";import{i as N,j as c,o as a,e as g,a as i,b as l,w as h,c as u,f as d,t as p,k as b,v,m as T,x as U,g as k}from"./app-DA2h9FRH.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";const R={data(){return{phones:null,phoneDialog:!1,deletePhoneDialog:!1,deletePhonesDialog:!1,myPhone:{id:"",phone:"",favourite:"",isMobile:0,companyID:window.location.pathname.split("/").pop()},originalPhone:{},selectedPhones:[],filters:{},submitted:!1}},created(){this.filters={global:{value:null,matchMode:N.CONTAINS}}},mounted(){this.fetchPhones()},methods:{fetchPhones(){let e=window.location.pathname.split("/").pop();c.get("/phones/"+e).then(t=>{this.phones=t.data.phones}).catch(t=>{throw this.$toast(this.$t("Error connecting to the server"),"error"),t})},openNew(){this.myPhone={phone:"",companyID:window.location.pathname.split("/").pop()},this.submitted=!1,this.phoneDialog=!0},hideDialog(){this.phoneDialog=!1,this.submitted=!1},async saveMyPhone(){this.myPhone.favourite==null&&(this.myPhone.favourite=!1),this.myPhone.isMobile=0;try{if(this.myPhone.id)this.updateMyPhone();else{const e=await c.post("/phone",this.myPhone);this.$toast(this.$t(e.data.message),e.data.type)}this.fetchPhones(),this.phoneDialog=!1,this.updateFields()}catch{this.$toast(this.$t("Error connecting to the server"),"error"),this.phoneDialog=!1}},editMyPhone(e){this.originalPhone={...e},this.myPhone.phone=e.phone,this.myPhone.id=e.id,this.myPhone.favourite=e.favourite,this.phoneDialog=!0},updateMyPhone(){if(this.originalPhone.companyID=this.myPhone.companyID,this.originalPhone.isMobile=this.myPhone.isMobile,console.log(JSON.stringify(this.originalPhone)),console.log(JSON.stringify(this.myPhone)),JSON.stringify(this.originalPhone)===JSON.stringify(this.myPhone)){this.$toast(this.$t("Successfully updated."),"success"),this.phoneDialog=!1;return}c.put("/phone/"+this.myPhone.id,this.myPhone).then(async e=>{this.$toast(this.$t(e.data.message),e.data.type),this.phoneDialog=!1,this.fetchPhones(),this.updateFields()}).catch(e=>{this.$toast(this.$t("Error connecting to the server"),"error"),this.phoneDialog=!1})},async makeFavourite(e){if(e.favourite)return this.$toast(this.$t("Already selected as a favorite."),"warning");try{const t=await c.put("/phones/"+e.id);this.$toast(this.$t(t.data.message),t.data.type),this.phoneDialog=!1,this.fetchPhones(),this.updateFields()}catch{this.$toast(this.$t("Error connecting to the server"),"error"),this.phoneDialog=!1}},confirmDeletePhone(e){this.myPhone=e,this.deletePhoneDialog=!0},deleteMyPhone(){c.delete("/phone/"+this.myPhone.id).then(e=>{e.data.type==="success"&&(this.phones=this.phones.filter(t=>t.id!==this.myPhone.id)),this.$toast(this.$t(e.data.message),e.data.type)}).catch(e=>{this.$toast(this.$t(e.response.message),e.response.type)}),this.deletePhoneDialog=!1},confirmDeleteSelected(){this.deletePhonesDialog=!0},deleteSelectedPhones(){this.selectedPhones.forEach(e=>{c.delete("/phone/"+e.id).then(t=>{t.data.type==="success"&&(this.phones=this.phones.filter(P=>P.id!==e.id)),this.$toast(this.$t(t.data.message),t.data.type)}).catch(t=>{(t.response||t.response.status===400)&&this.$toast(this.$t(t.response.message),t.response.type)})}),this.deletePhonesDialog=!1},updateFields(){this.phones.forEach(e=>{e.favourite&&this.$emit("updatePhone",e.phone)})}}},_={class:"card"},E={class:"flex justify-between items-center mt-2"},V={class:"relative rounded-md shadow-sm w-1/4"},B=["placeholder"],I=i("div",{class:"absolute inset-y-0 left-0 flex items-center pl-3"},[i("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor"},[i("path",{"fill-rule":"evenodd",d:"M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z","clip-rule":"evenodd"})])],-1),L={class:"utility-button"},O={class:"grid gap-3 mb-6 md:grid-cols-1"},A={for:"phone",class:"block mb-2 text-sm font-medium text-gray-900 dark:text-white"},z=["placeholder"],J={key:0,class:"flex items-center"},j={for:"link-checkbox",class:"ms-2 text-sm font-medium text-gray-900 dark:text-gray-300"},Y={class:"grid gap-3 md:grid-cols-1 justify-items-end"},q={type:"submit",class:"text-white bg-blue-600 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800"},K={class:"confirmation-content"},G=i("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),H={key:0},Q={class:"confirmation-content"},W=i("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem"}},null,-1),X={key:0};function Z(e,t,P,ee,o,n){const r=M,w=S,m=x,D=C,f=$;return a(),g("div",null,[i("div",_,[l(w,{class:"mb-4 border border-slate-200 ..."},{start:h(()=>[e.$page.props.user.permissions.includes("create phone")?(a(),u(r,{key:0,label:e.$t("New"),icon:"pi pi-plus",severity:"success",class:"mr-2 success-button",onClick:n.openNew},null,8,["label","onClick"])):d("",!0),e.$page.props.user.permissions.includes("delete phone")?(a(),u(r,{key:1,label:e.$t("Delete"),icon:"pi pi-trash",severity:"danger",class:"danger-button",onClick:n.confirmDeleteSelected,disabled:!o.selectedPhones||!o.selectedPhones.length},null,8,["label","onClick","disabled"])):d("",!0)]),_:1}),l(D,{ref:"dt",value:o.phones,selection:o.selectedPhones,"onUpdate:selection":t[1]||(t[1]=s=>o.selectedPhones=s),dataKey:"id",onRowSelect:e.onRowSelect,paginator:!0,rows:10,filters:o.filters,paginatorTemplate:"FirstPageLink PrevPageLink PageLinks NextPageLink LastPageLink CurrentPageReport RowsPerPageDropdown",rowsPerPageOptions:[5,10,25],currentPageReportTemplate:`${e.$t("Showing")} {first} ${e.$t("of")} {last} ${e.$t("of")} {totalRecords} ${e.$t("phones")}`},{header:h(()=>[i("div",E,[i("h4",null,p(e.$t("Manage Phones")),1),i("div",V,[b(i("input",{type:"search",class:"block w-full h-11 rounded-md border-0 py-1.5 pl-10 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-indigo-600 sm:text-sm","onUpdate:modelValue":t[0]||(t[0]=s=>o.filters.global.value=s),placeholder:e.$t("Search...")},null,8,B),[[v,o.filters.global.value]]),I])])]),default:h(()=>[l(m,{selectionMode:"multiple",exportable:!1,class:"datetable checkbox w-16"}),l(m,{field:"phone",header:e.$t("Phone"),sortable:"",class:"dateTable"},null,8,["header"]),e.$page.props.user.permissions.includes("update phone")?(a(),u(m,{key:0,exportable:!1,header:e.$t("Favourite"),class:"dateTable w-24 text-center"},{body:h(s=>[s.data.favourite?(a(),u(r,{key:0,icon:"pi pi-star-fill",class:"mr-2 fav-button",onClick:y=>n.makeFavourite(s.data)},null,8,["onClick"])):(a(),u(r,{key:1,icon:"pi pi-star",class:"mr-2 fav-button",onClick:y=>n.makeFavourite(s.data)},null,8,["onClick"]))]),_:1},8,["header"])):d("",!0),i("div",L,[l(m,{exportable:!1,header:e.$t("Utilities"),class:"headerUtil dateTable w-24"},{body:h(s=>[e.$page.props.user.permissions.includes("update phone")?(a(),u(r,{key:0,icon:"pi pi-pencil",outlined:"",rounded:"",class:"mr-2 edit-button",onClick:y=>n.editMyPhone(s.data)},null,8,["onClick"])):d("",!0),e.$page.props.user.permissions.includes("delete phone")?(a(),u(r,{key:1,icon:"pi pi-trash",outlined:"",rounded:"",class:"simpleDelete-button",severity:"danger",onClick:y=>n.confirmDeletePhone(s.data)},null,8,["onClick"])):d("",!0)]),_:1},8,["header"])])]),_:1},8,["value","selection","onRowSelect","filters","currentPageReportTemplate"])]),i("template",null,[l(f,{visible:o.phoneDialog,"onUpdate:visible":t[6]||(t[6]=s=>o.phoneDialog=s),header:o.myPhone.id?e.$t("Update phone"):e.$t("Create phone"),id:"titlePhone",modal:!0,class:"p-fluid"},{default:h(()=>[i("form",{style:{"max-width":"600px"},onSubmit:t[5]||(t[5]=T((...s)=>n.saveMyPhone&&n.saveMyPhone(...s),["prevent"]))},[i("div",O,[i("div",null,[i("label",A,p(e.$t("Phone")),1),b(i("input",{type:"tel",id:"phone","onUpdate:modelValue":t[2]||(t[2]=s=>o.myPhone.phone=s),class:"bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500",placeholder:o.myPhone.id?e.$t("Update phone"):e.$t("Create phone"),pattern:"(\\+34\\s?)?(\\d{9})",required:""},null,8,z),[[v,o.myPhone.phone]])]),o.myPhone.id?d("",!0):(a(),g("div",J,[b(i("input",{id:"link-checkbox",type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=s=>o.myPhone.favourite=s),class:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"},null,512),[[U,o.myPhone.favourite]]),i("label",j,p(e.$t("Mark this phone number as a favourite"))+".",1)]))]),i("div",Y,[i("div",null,[i("button",{type:"button",class:"mr-3 text-white bg-red-600 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-full sm:w-auto px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800",onClick:t[4]||(t[4]=(...s)=>n.hideDialog&&n.hideDialog(...s))},p(e.$t("Close")),1),i("button",q,p(o.myPhone.id?e.$t("Update"):e.$t("Save")),1)])])],32)]),_:1},8,["visible","header"])]),l(f,{visible:o.deletePhoneDialog,"onUpdate:visible":t[8]||(t[8]=s=>o.deletePhoneDialog=s),style:{width:"450px"},header:e.$t("Confirm"),modal:!0},{footer:h(()=>[l(r,{label:e.$t("No"),icon:"pi pi-times",text:"",onClick:t[7]||(t[7]=s=>o.deletePhoneDialog=!1)},null,8,["label"]),l(r,{label:e.$t("Yes"),icon:"pi pi-check",text:"",onClick:n.deleteMyPhone},null,8,["label","onClick"])]),default:h(()=>[i("div",K,[G,o.myPhone?(a(),g("span",H,[k(p(e.$t("Are you sure you want to delete")),1),i("b",null,p(o.myPhone.phone),1),k("?")])):d("",!0)])]),_:1},8,["visible","header"]),l(f,{visible:o.deletePhonesDialog,"onUpdate:visible":t[10]||(t[10]=s=>o.deletePhonesDialog=s),style:{width:"450px"},header:e.$t("Confirm"),modal:!0},{footer:h(()=>[l(r,{label:e.$t("No"),icon:"pi pi-times",text:"",onClick:t[9]||(t[9]=s=>o.deletePhonesDialog=!1)},null,8,["label"]),l(r,{label:e.$t("Yes"),icon:"pi pi-check",text:"",onClick:n.deleteSelectedPhones},null,8,["label","onClick"])]),default:h(()=>[i("div",Q,[W,o.myPhone?(a(),g("span",X,p(e.$t("Are you sure you want to delete the selected phones?")),1)):d("",!0)])]),_:1},8,["visible","header"])])}const le=F(R,[["render",Z]]);export{le as default};
